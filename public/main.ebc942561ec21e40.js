var vw=Object.defineProperty,xw=Object.defineProperties,bw=Object.getOwnPropertyDescriptors,y0=Object.getOwnPropertySymbols,ww=Object.prototype.hasOwnProperty,Ew=Object.prototype.propertyIsEnumerable,v0=(yn,Ct,xe)=>Ct in yn?vw(yn,Ct,{enumerable:!0,configurable:!0,writable:!0,value:xe}):yn[Ct]=xe,Hn=(yn,Ct)=>{for(var xe in Ct||(Ct={}))ww.call(Ct,xe)&&v0(yn,xe,Ct[xe]);if(y0)for(var xe of y0(Ct))Ew.call(Ct,xe)&&v0(yn,xe,Ct[xe]);return yn},Gs=(yn,Ct)=>xw(yn,bw(Ct));(self.webpackChunkmapasApp=self.webpackChunkmapasApp||[]).push([[179],{6086:(yn,Ct,xe)=>{"use strict";function je(Re,$e,tt,lt){return new(tt||(tt=Promise))(function(Ye,Tt){function Sn(Wn){try{nn(lt.next(Wn))}catch(zi){Tt(zi)}}function Er(Wn){try{nn(lt.throw(Wn))}catch(zi){Tt(zi)}}function nn(Wn){Wn.done?Ye(Wn.value):function(Ye){return Ye instanceof tt?Ye:new tt(function(Tt){Tt(Ye)})}(Wn.value).then(Sn,Er)}nn((lt=lt.apply(Re,$e||[])).next())})}function Ot(Re){return this instanceof Ot?(this.v=Re,this):new Ot(Re)}function pn(Re,$e,tt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Pt,lt=tt.apply(Re,$e||[]),Ye=[];return Pt={},Tt("next"),Tt("throw"),Tt("return"),Pt[Symbol.asyncIterator]=function(){return this},Pt;function Tt(lr){lt[lr]&&(Pt[lr]=function(Nr){return new Promise(function(Wr,kn){Ye.push([lr,Nr,Wr,kn])>1||Sn(lr,Nr)})})}function Sn(lr,Nr){try{!function(lr){lr.value instanceof Ot?Promise.resolve(lr.value.v).then(nn,Wn):zi(Ye[0][2],lr)}(lt[lr](Nr))}catch(Wr){zi(Ye[0][3],Wr)}}function nn(lr){Sn("next",lr)}function Wn(lr){Sn("throw",lr)}function zi(lr,Nr){lr(Nr),Ye.shift(),Ye.length&&Sn(Ye[0][0],Ye[0][1])}}function zt(Re){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var tt,$e=Re[Symbol.asyncIterator];return $e?$e.call(Re):(Re=function(Re){var $e="function"==typeof Symbol&&Symbol.iterator,tt=$e&&Re[$e],lt=0;if(tt)return tt.call(Re);if(Re&&"number"==typeof Re.length)return{next:function(){return Re&&lt>=Re.length&&(Re=void 0),{value:Re&&Re[lt++],done:!Re}}};throw new TypeError($e?"Object is not iterable.":"Symbol.iterator is not defined.")}(Re),tt={},lt("next"),lt("throw"),lt("return"),tt[Symbol.asyncIterator]=function(){return this},tt);function lt(Ye){tt[Ye]=Re[Ye]&&function(Tt){return new Promise(function(Sn,Er){!function(Ye,Tt,Sn,Er){Promise.resolve(Er).then(function(nn){Ye({value:nn,done:Sn})},Tt)}(Sn,Er,(Tt=Re[Ye](Tt)).done,Tt.value)})}}}xe.d(Ct,{mG:()=>je,qq:()=>Ot,FC:()=>pn,KL:()=>zt})},401:function(yn){yn.exports=function(){"use strict";var Ct,xe,ue;function oe(c,Et){if(Ct)if(xe){var an="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ct+")(sharedChunk); ("+xe+")(sharedChunk); self.onerror = null;",Gt={};Ct(Gt),ue=Et(Gt),"undefined"!=typeof window&&(ue.workerUrl=window.URL.createObjectURL(new Blob([an],{type:"text/javascript"})))}else xe=Et;else Ct=Et}return oe(0,function(c){var an=Gt;function Gt(n,e,i,a){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=a,this.p2x=i,this.p2y=a}Gt.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},Gt.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},Gt.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},Gt.prototype.solveCurveX=function(n,e){var i,a,u,f,g;for(void 0===e&&(e=1e-6),u=n,g=0;g<8;g++){if(f=this.sampleCurveX(u)-n,Math.abs(f)<e)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=f/x}if((u=n)<(i=0))return i;if(u>(a=1))return a;for(;i<a;){if(f=this.sampleCurveX(u),Math.abs(f-n)<e)return u;n>f?i=u:a=u,u=.5*(a-i)+i}return u},Gt.prototype.solve=function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))};var je=ze;function ze(n,e){this.x=n,this.y=e}ze.prototype={clone:function(){return new ze(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),i=Math.sin(n),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround:function(n,e){var i=Math.cos(n),a=Math.sin(n),u=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ze.convert=function(n){return n instanceof ze?n:Array.isArray(n)?new ze(n[0],n[1]):n};var He="undefined"!=typeof self?self:{};const mt=Math.pow(2,53)-1,Zt=Math.PI/180,Tn=180/Math.PI;function it(n){return n*Zt}function Ut(n){return n*Tn}const hn=[[0,0],[1,0],[1,1],[0,1]];function Ot(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function pn(n,e,i,a){const u=new an(n,e,i,a);return function(f){return u.solve(f)}}const on=pn(.25,.1,.25,1);function zt(n,e,i){return Math.min(i,Math.max(e,n))}function gt(n,e,i){const a=i-e,u=((n-e)%a+a)%a+e;return u===e?i:u}function mn(n,e,i){if(!n.length)return i(null,[]);let a=n.length;const u=new Array(n.length);let f=null;n.forEach((g,x)=>{e(g,(b,D)=>{b&&(f=b),u[x]=D,0==--a&&i(f,u)})})}function Fn(n){const e=[];for(const i in n)e.push(n[i]);return e}function gn(n,...e){for(const i of e)for(const a in i)n[a]=i[a];return n}let dn=1;function Ht(){return dn++}function Re(){return function n(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function $e(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function tt(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function lt(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Pt(n,e){return-1!==n.indexOf(e,n.length-e.length)}function Ye(n,e,i){const a={};for(const u in n)a[u]=e.call(i||this,n[u],u,n);return a}function Tt(n,e,i){const a={};for(const u in n)e.call(i||this,n[u],u,n)&&(a[u]=n[u]);return a}function Sn(n){return Array.isArray(n)?n.map(Sn):"object"==typeof n&&n?Ye(n,Sn):n}const Er={};function nn(n){Er[n]||("undefined"!=typeof console&&console.warn(n),Er[n]=!0)}function Wn(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function zi(n){let e=0;for(let i,a,u=0,f=n.length,g=f-1;u<f;g=u++)i=n[u],a=n[g],e+=(a.x-i.x)*(i.y+a.y);return e}function lr(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Nr(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,u,f)=>{const g=u||f;return e[a]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Wr,kn,Wi,Xr=null;function to(n){if(null==Xr){const e=n.navigator?n.navigator.userAgent:null;Xr=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Xr}function Ir(n){try{const e=He[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(e){return!1}}const On={now:()=>void 0!==Wi?Wi:He.performance.now(),setNow(n){Wi=n},restoreNow(){Wi=void 0},frame(n){const e=He.requestAnimationFrame(n);return{cancel:()=>He.cancelAnimationFrame(e)}},getImageData(n,e=0){const i=He.document.createElement("canvas"),a=i.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return i.width=n.width,i.height=n.height,a.drawImage(n,0,0,n.width,n.height),a.getImageData(-e,-e,n.width+2*e,n.height+2*e)},resolveURL:n=>(Wr||(Wr=He.document.createElement("a")),Wr.href=n,Wr.href),get devicePixelRatio(){return He.devicePixelRatio},get prefersReducedMotion(){return!!He.matchMedia&&(null==kn&&(kn=He.matchMedia("(prefers-reduced-motion: reduce)")),kn.matches)}};let Bi;const jn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Bi){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Bi=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch(e){Bi=n}}return Bi},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},xi={supported:!1,testSupport:function(n){!Xi&&Rr&&(Kr?Lr(n):$n=n)}};let $n,Rr,Xi=!1,Kr=!1;function Lr(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Rr),n.isContextLost())return;xi.supported=!0}catch(i){}n.deleteTexture(e),Xi=!0}He.document&&(Rr=He.document.createElement("img"),Rr.onload=function(){$n&&Lr($n),$n=null,Kr=!0},Rr.onerror=function(){Xi=!0,$n=null},Rr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Pi="01",Eo="NO_ACCESS_TOKEN";function dt(n){return 0===n.indexOf("mapbox:")}function Ae(n){return jn.API_URL_REGEX.test(n)}const Oe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function bt(n){const e=n.match(Oe);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function pt(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}function _t(n){if(!n)return null;const e=n.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(He.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(i){return null}}class Vt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=_t(jn.ACCESS_TOKEN);let a="";return a=i&&i.u?He.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(Number("0x"+f)))):jn.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${a}`:`mapbox.eventData:${a}`}fetchEventData(){const e=Ir("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const u=He.localStorage.getItem(i);u&&(this.eventData=JSON.parse(u));const f=He.localStorage.getItem(a);f&&(this.anonId=f)}catch(u){nn("Unable to read from LocalStorage")}}saveEventData(){const e=Ir("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{He.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&He.localStorage.setItem(i,JSON.stringify(this.eventData))}catch(u){nn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,a,u){if(!jn.EVENTS_URL)return;const f=bt(jn.EVENTS_URL);f.params.push(`access_token=${u||jn.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.6.1",skuId:Pi,userId:this.anonId},x=i?gn(g,i):g,b={url:pt(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=ee(b,D=>{this.pendingRequest=null,a(D),this.saveEventData(),this.processRequests(u)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const en=new class extends Vt{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){jn.EVENTS_URL&&jn.ACCESS_TOKEN&&Array.isArray(n)&&n.some(i=>dt(i)||Ae(i))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=_t(jn.ACCESS_TOKEN),i=e?e.u:jn.ACCESS_TOKEN;let a=i!==this.eventData.tokenU;tt(this.anonId)||(this.anonId=Re(),a=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),g=new Date(u),x=(u-this.eventData.lastSuccess)/864e5;a=a||x>=1||x<-1||f.getDate()!==g.getDate()}else a=!0;if(!a)return this.processRequests();this.postEvent(u,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=i)},n)}},En=en.postTurnstileEvent.bind(en),_r=new class extends Vt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,i,a){this.skuToken=e,this.errorCb=a,jn.EVENTS_URL&&(i||jn.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(Eo)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),tt(this.anonId)||(this.anonId=Re()),this.postEvent(i,{skuToken:this.skuToken},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n))}},fi=_r.postMapLoadEvent.bind(_r),Ur=new class extends Vt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,i,a){if(!jn.API_URL||!jn.SESSION_PATH)return;const u=bt(jn.API_URL+jn.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${a||jn.ACCESS_TOKEN||""}`);const f={url:pt(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=pe(f,g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(a)})}getSessionAPI(n,e,i,a){this.skuToken=e,this.errorCb=a,jn.SESSION_PATH&&jn.API_URL&&(i||jn.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(Eo)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n)}},Xn=Ur.getSessionAPI.bind(Ur),qt=new Set,Rn="mapbox-tiles";let tr,Gn,Vr=500,bi=50;function uo(){He.caches&&!tr&&(tr=He.caches.open(Rn))}function nr(n){const e=n.indexOf("?");return e<0?n:n.slice(0,e)}let Ni=1/0;const Fo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Fo);class wi extends Error{constructor(e,i,a){401===i&&Ae(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Q=lr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===He.location.protocol?He.parent:He).location.href,j=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(Q())&&!/^\w+:/.test(i))){if(He.fetch&&He.Request&&He.AbortController&&He.Request.prototype.hasOwnProperty("signal"))return function(a,u){const f=new He.AbortController,g=new He.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Q(),signal:f.signal});let x=!1,b=!1;const D=(A=g.url).indexOf("sku=")>0&&Ae(A);var A;"json"===a.type&&g.headers.set("Accept","application/json");const P=($,Z,K)=>{if(b)return;if($&&"SecurityError"!==$.message&&nn($),Z&&K)return F(Z);const ce=Date.now();He.fetch(g).then(de=>{if(de.ok){const be=D?de.clone():null;return F(de,be,ce)}return u(new wi(de.statusText,de.status,a.url))}).catch(de=>{20!==de.code&&u(new Error(de.message))})},F=($,Z,K)=>{("arrayBuffer"===a.type?$.arrayBuffer():"json"===a.type?$.json():$.text()).then(ce=>{b||(Z&&K&&function(de,be,Me){if(uo(),!tr)return;const Pe={status:be.status,statusText:be.statusText,headers:new He.Headers};be.headers.forEach((Ne,et)=>Pe.headers.set(et,Ne));const Fe=Nr(be.headers.get("Cache-Control")||"");Fe["no-store"]||(Fe["max-age"]&&Pe.headers.set("Expires",new Date(Me+1e3*Fe["max-age"]).toUTCString()),new Date(Pe.headers.get("Expires")).getTime()-Me<42e4||function(Ne,et){if(void 0===Gn)try{new Response(new ReadableStream),Gn=!0}catch(Ke){Gn=!1}Gn?et(Ne.body):Ne.blob().then(et)}(be,Ne=>{const et=new He.Response(Ne,Pe);uo(),tr&&tr.then(Ke=>Ke.put(nr(de.url),et)).catch(Ke=>nn(Ke.message))}))}(g,Z,K),x=!0,u(null,ce,$.headers.get("Cache-Control"),$.headers.get("Expires")))}).catch(ce=>{b||u(new Error(ce.message))})};return D?function($,Z){if(uo(),!tr)return Z(null);const K=nr($.url);tr.then(ce=>{ce.match(K).then(de=>{const be=function(Me){if(!Me)return!1;const Pe=new Date(Me.headers.get("Expires")||0),Fe=Nr(Me.headers.get("Cache-Control")||"");return Pe>Date.now()&&!Fe["no-cache"]}(de);ce.delete(K),be&&ce.put(K,de.clone()),Z(null,de,be)}).catch(Z)}).catch(Z)}(g,P):P(null,null),{cancel:()=>{b=!0,x||f.abort()}}}(n,e);if(lr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(a,u){const f=new He.XMLHttpRequest;f.open(a.method||"GET",a.url,!0),"arrayBuffer"===a.type&&(f.responseType="arraybuffer");for(const g in a.headers)f.setRequestHeader(g,a.headers[g]);return"json"===a.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===a.credentials,f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let g=f.response;if("json"===a.type)try{g=JSON.parse(f.response)}catch(x){return u(x)}u(null,g,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new wi(f.statusText,f.status,a.url))},f.send(a.body),{cancel:()=>f.abort()}}(n,e)},H=function(n,e){return j(gn(n,{type:"arrayBuffer"}),e)},ee=function(n,e){return j(gn(n,{method:"POST"}),e)},pe=function(n,e){return j(gn(n,{method:"GET"}),e)};function Ee(n){const e=He.document.createElement("a");return e.href=n,e.protocol===He.document.location.protocol&&e.host===He.document.location.host}const Le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Be,Ce;Be=[],Ce=0;const Ue=function(n,e){if(xi.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Ce>=jn.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Be.push(f),f}Ce++;let i=!1;const a=()=>{if(!i)for(i=!0,Ce--;Be.length&&Ce<jn.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Be.shift(),{requestParameters:g,callback:x,cancelled:b}=f;b||(f.cancel=Ue(g,x).cancel)}},u=H(n,(f,g,x,b)=>{a(),f?e(f):g&&(He.createImageBitmap?function(D,A){const P=new He.Blob([new Uint8Array(D)],{type:"image/png"});He.createImageBitmap(P).then(F=>{A(null,F)}).catch(F=>{A(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(D,A)=>e(D,A,x,b)):function(D,A){const P=new He.Image,F=He.URL;P.onload=()=>{A(null,P),F.revokeObjectURL(P.src),P.onload=null,He.requestAnimationFrame(()=>{P.src=Le})},P.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const $=new He.Blob([new Uint8Array(D)],{type:"image/png"});P.src=D.byteLength?F.createObjectURL($):Le}(g,(D,A)=>e(D,A,x,b)))});return{cancel:()=>{u.cancel(),a()}}};function st(n,e,i){i[n]&&-1!==i[n].indexOf(e)||(i[n]=i[n]||[],i[n].push(e))}function At(n,e,i){if(i&&i[n]){const a=i[n].indexOf(e);-1!==a&&i[n].splice(a,1)}}class ct{constructor(e,i={}){gn(this,i),this.type=e}}class tn extends ct{constructor(e,i={}){super("error",gn({error:e},i))}}class St{on(e,i){return this._listeners=this._listeners||{},st(e,i,this._listeners),this}off(e,i){return At(e,i,this._listeners),At(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},st(e,i,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,i){"string"==typeof e&&(e=new ct(e,i||{}));const a=e.type;if(this.listens(a)){e.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const x of u)x.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const x of f)At(a,x,this._oneTimeListeners),x.call(this,e);const g=this._eventedParent;g&&(gn(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof tn&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var we=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class te{constructor(e,i,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),null!=i&&i.__line__&&(this.line=i.__line__)}}function ye(n){const e=n.value;return e?[new te(n.key,e,"constants have been deprecated as of v8")]:[]}function ae(n,...e){for(const i of e)for(const a in i)n[a]=i[a];return n}function ke(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function qe(n){if(Array.isArray(n))return n.map(qe);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=qe(n[i]);return e}return ke(n)}class Rt extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class xn{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,u]of i)this.bindings[a]=u}concat(e){return new xn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Mt={kind:"null"},Xe={kind:"number"},rn={kind:"string"},ln={kind:"boolean"},cr={kind:"color"},yr={kind:"object"},bn={kind:"value"},Mr={kind:"collator"},ho={kind:"formatted"},no={kind:"resolvedImage"};function _n(n,e){return{kind:"array",itemType:n,N:e}}function mr(n){if("array"===n.kind){const e=mr(n.itemType);return"number"==typeof n.N?`array<${e}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${e}>`}return n.kind}const fo=[Mt,Xe,rn,ln,cr,ho,yr,_n(bn),no];function po(n,e){if("error"===e.kind)return null;if("array"===n.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!po(n.itemType,e.itemType))&&("number"!=typeof n.N||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if("value"===n.kind)for(const i of fo)if(!po(i,e))return null}return`Expected ${mr(n)} but found ${mr(e)} instead.`}function Ko(n,e){return e.some(i=>i.kind===n.kind)}function Dr(n,e){return e.some(i=>"null"===i?null===n:"array"===i?Array.isArray(n):"object"===i?n&&!Array.isArray(n)&&"object"==typeof n:i===typeof n)}function Jo(n){var e={exports:{}};return n(e,e.exports),e.exports}var pi=Jo(function(n,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(x){return(x=Math.round(x))<0?0:x>255?255:x}function u(x){return a("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function f(x){return(b="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:b>1?1:b;var b}function g(x,b,D){return D<0?D+=1:D>1&&(D-=1),6*D<1?x+(b-x)*D*6:2*D<1?b:3*D<2?x+(b-x)*(2/3-D)*6:x}try{e.parseCSSColor=function(x){var b,D=x.replace(/ /g,"").toLowerCase();if(D in i)return i[D].slice();if("#"===D[0])return 4===D.length?(b=parseInt(D.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:7===D.length&&(b=parseInt(D.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var A=D.indexOf("("),P=D.indexOf(")");if(-1!==A&&P+1===D.length){var F=D.substr(0,A),$=D.substr(A+1,P-(A+1)).split(","),Z=1;switch(F){case"rgba":if(4!==$.length)return null;Z=f($.pop());case"rgb":return 3!==$.length?null:[u($[0]),u($[1]),u($[2]),Z];case"hsla":if(4!==$.length)return null;Z=f($.pop());case"hsl":if(3!==$.length)return null;var K=(parseFloat($[0])%360+360)%360/360,ce=f($[1]),de=f($[2]),be=de<=.5?de*(ce+1):de+ce-de*ce,Me=2*de-be;return[a(255*g(Me,be,K+1/3)),a(255*g(Me,be,K)),a(255*g(Me,be,K-1/3)),Z];default:return null}}return null}}catch(x){}});class In{constructor(e,i,a,u=1){this.r=e,this.g=i,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof In)return e;if("string"!=typeof e)return;const i=pi.parseCSSColor(e);return i?new In(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,a,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(a)},${u})`}toArray(){const{r:e,g:i,b:a,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*i/u,255*a/u,u]}}In.black=new In(0,0,0,1),In.white=new In(1,1,1,1),In.transparent=new In(0,0,0,0),In.red=new In(1,0,0,1),In.blue=new In(0,0,1,1);class rr{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oo{constructor(e,i,a,u,f){this.text=e,this.image=i,this.scale=a,this.fontStack=u,this.textColor=f}}class Ar{constructor(e){this.sections=e}static fromString(e){return new Ar([new Oo(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Ar?e:Ar.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(a)}return e}}class ti{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ti({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Cs(n,e,i,a){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===a||"number"==typeof a&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof a?[n,e,i,a]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function zo(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof In||n instanceof rr||n instanceof Ar||n instanceof ti)return!0;if(Array.isArray(n)){for(const e of n)if(!zo(e))return!1;return!0}if("object"==typeof n){for(const e in n)if(!zo(n[e]))return!1;return!0}return!1}function Cr(n){if(null===n)return Mt;if("string"==typeof n)return rn;if("boolean"==typeof n)return ln;if("number"==typeof n)return Xe;if(n instanceof In)return cr;if(n instanceof rr)return Mr;if(n instanceof Ar)return ho;if(n instanceof ti)return no;if(Array.isArray(n)){const e=n.length;let i;for(const a of n){const u=Cr(a);if(i){if(i===u)continue;i=bn;break}i=u}return _n(i||bn,e)}return yr}function si(n){const e=typeof n;return null===n?"":"string"===e||"number"===e||"boolean"===e?String(n):n instanceof In||n instanceof Ar||n instanceof ti?n.toString():JSON.stringify(n)}class jr{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!zo(e[1]))return i.error("invalid value");const a=e[1];let u=Cr(a);const f=i.expectedType;return"array"!==u.kind||0!==u.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(u=f),new jr(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof In?["rgba"].concat(this.value.toArray()):this.value instanceof Ar?this.value.serialize():this.value}}class ur{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ki={string:rn,number:Xe,boolean:ln,object:yr};class $r{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,u=1;const f=e[0];if("array"===f){let x,b;if(e.length>2){const D=e[1];if("string"!=typeof D||!(D in ki)||"object"===D)return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=ki[D],u++}else x=bn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}a=_n(x,b)}else a=ki[f];const g=[];for(;u<e.length;u++){const x=i.parse(e[u],u,bn);if(!x)return null;g.push(x)}return new $r(a,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!po(this.type,Cr(a)))return a;if(i===this.args.length-1)throw new ur(`Expected value to be of type ${mr(this.type)}, but found ${mr(Cr(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if("array"===e.kind){const a=e.itemType;if("string"===a.kind||"number"===a.kind||"boolean"===a.kind){i.push(a.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(a=>a.serialize()))}}class Bo{constructor(e){this.type=ho,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&"object"==typeof a)return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let g=1;g<=e.length-1;++g){const x=e[g];if(f&&"object"==typeof x&&!Array.isArray(x)){f=!1;let b=null;if(x["font-scale"]&&(b=i.parse(x["font-scale"],1,Xe),!b))return null;let D=null;if(x["text-font"]&&(D=i.parse(x["text-font"],1,_n(rn)),!D))return null;let A=null;if(x["text-color"]&&(A=i.parse(x["text-color"],1,cr),!A))return null;const P=u[u.length-1];P.scale=b,P.font=D,P.textColor=A}else{const b=i.parse(e[g],1,bn);if(!b)return null;const D=b.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new Bo(u)}evaluate(e){return new Ar(this.sections.map(i=>{const a=i.content.evaluate(e);return Cr(a)===no?new Oo("",a,null,null,null):new Oo(si(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class Qo{constructor(e){this.type=no,this.input=e}static parse(e,i){if(2!==e.length)return i.error("Expected two arguments.");const a=i.parse(e[1],1,rn);return a?new Qo(a):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),a=ti.fromString(i);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(i)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ts={"to-boolean":ln,"to-color":cr,"to-number":Xe,"to-string":rn};class Jr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0];if(("to-boolean"===a||"to-string"===a)&&2!==e.length)return i.error("Expected one argument.");const u=Ts[a],f=[];for(let g=1;g<e.length;g++){const x=i.parse(e[g],g,bn);if(!x)return null;f.push(x)}return new Jr(u,f)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let i,a;for(const u of this.args){if(i=u.evaluate(e),a=null,i instanceof In)return i;if("string"==typeof i){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Cs(i[0],i[1],i[2],i[3]),!a))return new In(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new ur(a||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const a of this.args){if(i=a.evaluate(e),null===i)return 0;const u=Number(i);if(!isNaN(u))return u}throw new ur(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?Ar.fromString(si(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?ti.fromString(si(this.args[0].evaluate(e))):si(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Bo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Qo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Pl=["Unknown","Point","LineString","Polygon"];class Ss{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Pl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-e[0])+this.featureDistanceData.bearing[1]*(u*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=In.parse(e)),i}}class Ei{constructor(e,i,a,u){this.name=e,this.type=i,this._evaluate=a,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const a=e[0],u=Ei.definitions[a];if(!u)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=g.filter(([D])=>!Array.isArray(D)||D.length===e.length-1);let b=null;for(const[D,A]of x){b=new ds(i.registry,i.path,null,i.scope);const P=[];let F=!1;for(let $=1;$<e.length;$++){const Z=e[$],K=Array.isArray(D)?D[$-1]:D.type,ce=b.parse(Z,1+P.length,K);if(!ce){F=!0;break}P.push(ce)}if(!F)if(Array.isArray(D)&&D.length!==P.length)b.error(`Expected ${D.length} arguments, but found ${P.length} instead.`);else{for(let $=0;$<P.length;$++){const Z=Array.isArray(D)?D[$]:D.type,K=P[$];b.concat($+1).checkSubtype(Z,K.type)}if(0===b.errors.length)return new Ei(a,f,A,P)}}if(1===x.length)i.errors.push(...b.errors);else{const D=(x.length?x:g).map(([P])=>{return F=P,Array.isArray(F)?`(${F.map(mr).join(", ")})`:`(${mr(F.type)}...)`;var F}).join(" | "),A=[];for(let P=1;P<e.length;P++){const F=i.parse(e[P],1+A.length);if(!F)return null;A.push(mr(F.type))}i.error(`Expected arguments of type ${D}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){Ei.definitions=i;for(const a in i)e[a]=Ei}}class sa{constructor(e,i,a){this.type=Mr,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");const a=e[1];if("object"!=typeof a||Array.isArray(a))return i.error("Collator options argument must be an object.");const u=i.parse(void 0!==a["case-sensitive"]&&a["case-sensitive"],1,ln);if(!u)return null;const f=i.parse(void 0!==a["diacritic-sensitive"]&&a["diacritic-sensitive"],1,ln);if(!f)return null;let g=null;return a.locale&&(g=i.parse(a.locale,1,rn),!g)?null:new sa(u,f,g)}evaluate(e){return new rr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ls=8192;function Hs(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function cs(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function il(n,e){const i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*ls),Math.round(a*u*ls)]}function kl(n,e,i){const a=n[0]-e[0],u=n[1]-e[1],f=n[0]-i[0],g=n[1]-i[1];return a*g-f*u==0&&a*f<=0&&u*g<=0}function aa(n,e){let i=!1;for(let g=0,x=e.length;g<x;g++){const b=e[g];for(let D=0,A=b.length;D<A-1;D++){if(kl(n,b[D],b[D+1]))return!1;(u=b[D])[1]>(a=n)[1]!=(f=b[D+1])[1]>a[1]&&a[0]<(f[0]-u[0])*(a[1]-u[1])/(f[1]-u[1])+u[0]&&(i=!i)}}var a,u,f;return i}function Pa(n,e){for(let i=0;i<e.length;i++)if(aa(n,e[i]))return!0;return!1}function la(n,e,i,a){const u=a[0]-i[0],f=a[1]-i[1],g=(n[0]-i[0])*f-u*(n[1]-i[1]),x=(e[0]-i[0])*f-u*(e[1]-i[1]);return g>0&&x<0||g<0&&x>0}function Rl(n,e,i){for(const D of i)for(let A=0;A<D.length-1;++A)if((x=[(g=D[A+1])[0]-(f=D[A])[0],g[1]-f[1]])[0]*(b=[(u=e)[0]-(a=n)[0],u[1]-a[1]])[1]-x[1]*b[0]!=0&&la(a,u,f,g)&&la(f,g,a,u))return!0;var a,u,f,g,x,b;return!1}function Ll(n,e){for(let i=0;i<n.length;++i)if(!aa(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Rl(n[i],n[i+1],e))return!1;return!0}function hc(n,e){for(let i=0;i<e.length;i++)if(Ll(n,e[i]))return!0;return!1}function Ui(n,e,i){const a=[];for(let u=0;u<n.length;u++){const f=[];for(let g=0;g<n[u].length;g++){const x=il(n[u][g],i);Hs(e,x),f.push(x)}a.push(f)}return a}function us(n,e,i){const a=[];for(let u=0;u<n.length;u++){const f=Ui(n[u],e,i);a.push(f)}return a}function ol(n,e,i,a){if(n[0]<i[0]||n[0]>i[2]){const u=.5*a;let f=n[0]-i[0]>u?-a:i[0]-n[0]>u?a:0;0===f&&(f=n[0]-i[2]>u?-a:i[2]-n[0]>u?a:0),n[0]+=f}Hs(e,n)}function hs(n,e,i,a){const u=Math.pow(2,a.z)*ls,f=[a.x*ls,a.y*ls],g=[];for(const x of n)for(const b of x){const D=[b.x+f[0],b.y+f[1]];ol(D,e,i,u),g.push(D)}return g}function es(n,e,i,a){const u=Math.pow(2,a.z)*ls,f=[a.x*ls,a.y*ls],g=[];for(const b of n){const D=[];for(const A of b){const P=[A.x+f[0],A.y+f[1]];Hs(e,P),D.push(P)}g.push(D)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const b of g)for(const D of b)ol(D,e,i,u)}var x;return g}class No{constructor(e,i){this.type=ln,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(zo(e[1])){const a=e[1];if("FeatureCollection"===a.type)for(let u=0;u<a.features.length;++u){const f=a.features[u].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new No(a,a.features[u].geometry)}else if("Feature"===a.type){const u=a.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new No(a,a.geometry)}else if("Polygon"===a.type||"MultiPolygon"===a.type)return new No(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(i,a){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if("Polygon"===a.type){const x=Ui(a.coordinates,f,g),b=hs(i.geometry(),u,f,g);if(!cs(u,f))return!1;for(const D of b)if(!aa(D,x))return!1}if("MultiPolygon"===a.type){const x=us(a.coordinates,f,g),b=hs(i.geometry(),u,f,g);if(!cs(u,f))return!1;for(const D of b)if(!Pa(D,x))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(i,a){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if("Polygon"===a.type){const x=Ui(a.coordinates,f,g),b=es(i.geometry(),u,f,g);if(!cs(u,f))return!1;for(const D of b)if(!Ll(D,x))return!1}if("MultiPolygon"===a.type){const x=us(a.coordinates,f,g),b=es(i.geometry(),u,f,g);if(!cs(u,f))return!1;for(const D of b)if(!hc(D,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Is(n){if(n instanceof Ei&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof No)return!1;let e=!0;return n.eachChild(i=>{e&&!Is(i)&&(e=!1)}),e}function ka(n){if(n instanceof Ei&&"feature-state"===n.name)return!1;let e=!0;return n.eachChild(i=>{e&&!ka(i)&&(e=!1)}),e}function Un(n,e){if(n instanceof Ei&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(a=>{i&&!Un(a,e)&&(i=!1)}),i}class Ra{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new Ra(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ds{constructor(e,i=[],a,u=new xn,f=[]){this.registry=e,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=u,this.errors=f,this.expectedType=a}parse(e,i,a,u,f={}){return i?this.concat(i,a,u)._parse(e,f):this._parse(e,f)}_parse(e,i){function a(u,f,g){return"assert"===g?new $r(f,[u]):"coerce"===g?new Jr(f,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let g=f.parse(e,this);if(!g)return null;if(this.expectedType){const x=this.expectedType,b=g.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==b.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==b.kind&&"string"!==b.kind){if(this.checkSubtype(x,b))return null}else g=a(g,x,i.typeAnnotation||"coerce");else g=a(g,x,i.typeAnnotation||"assert")}if(!(g instanceof jr)&&"resolvedImage"!==g.type.kind&&Do(g)){const x=new Ss;try{g=new jr(g.type,g.evaluate(x))}catch(b){return this.error(b.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a){const u="number"==typeof e?this.path.concat(e):this.path,f=a?this.scope.concat(a):this.scope;return new ds(this.registry,u,i||null,f,this.errors)}error(e,...i){const a=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new Rt(a,e))}checkSubtype(e,i){const a=po(e,i);return a&&this.error(a),a}}function Do(n){if(n instanceof Ra)return Do(n.boundExpression);if(n instanceof Ei&&"error"===n.name||n instanceof sa||n instanceof No)return!1;const e=n instanceof Jr||n instanceof $r;let i=!0;return n.eachChild(a=>{i=e?i&&Do(a):i&&a instanceof jr}),!!i&&Is(n)&&Un(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ca(n,e){const i=n.length-1;let a,u,f=0,g=i,x=0;for(;f<=g;)if(x=Math.floor((f+g)/2),a=n[x],u=n[x+1],a<=e){if(x===i||e<u)return x;f=x+1}else{if(!(a>e))throw new ur("Input is not a number.");g=x-1}return 0}class Co{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of a)this.labels.push(u),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,Xe);if(!a)return null;const u=[];let f=null;i.expectedType&&"value"!==i.expectedType.kind&&(f=i.expectedType);for(let g=1;g<e.length;g+=2){const x=1===g?-1/0:e[g],b=e[g+1],D=g,A=g+1;if("number"!=typeof x)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(u.length&&u[u.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const P=i.parse(b,A,f);if(!P)return null;f=f||P.type,u.push([x,P])}return new Co(f,a,u)}evaluate(e){const i=this.labels,a=this.outputs;if(1===i.length)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return a[0].evaluate(e);const f=i.length;return u>=i[f-1]?a[f-1].evaluate(e):a[ca(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}function Jn(n,e,i){return n*(1-i)+e*i}var Ms=Object.freeze({__proto__:null,number:Jn,color:function(n,e,i){return new In(Jn(n.r,e.r,i),Jn(n.g,e.g,i),Jn(n.b,e.b,i),Jn(n.a,e.a,i))},array:function(n,e,i){return n.map((a,u)=>Jn(a,e[u],i))}});const Ws=4/29,Qr=6/29,z=3*Qr*Qr,W=Math.PI/180,B=180/Math.PI;function J(n){return n>.008856451679035631?Math.pow(n,1/3):n/z+Ws}function Se(n){return n>Qr?n*n*n:z*(n-Ws)}function ot(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function ht(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function cn(n){const e=ht(n.r),i=ht(n.g),a=ht(n.b),u=J((.4124564*e+.3575761*i+.1804375*a)/.95047),f=J((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-J((.0193339*e+.119192*i+.9503041*a)/1.08883)),alpha:n.a}}function or(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,a=isNaN(n.b)?e:e-n.b/200;return e=1*Se(e),i=.95047*Se(i),a=1.08883*Se(a),new In(ot(3.2404542*i-1.5371385*e-.4985314*a),ot(-.969266*i+1.8760108*e+.041556*a),ot(.0556434*i-.2040259*e+1.0572252*a),n.alpha)}function fn(n,e,i){const a=e-n;return n+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const hr={forward:cn,reverse:or,interpolate:function(n,e,i){return{l:Jn(n.l,e.l,i),a:Jn(n.a,e.a,i),b:Jn(n.b,e.b,i),alpha:Jn(n.alpha,e.alpha,i)}}},Yn={forward:function(n){const{l:e,a:i,b:a}=cn(n),u=Math.atan2(a,i)*B;return{h:u<0?u+360:u,c:Math.sqrt(i*i+a*a),l:e,alpha:n.a}},reverse:function(n){const e=n.h*W,i=n.c;return or({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:fn(n.h,e.h,i),c:Jn(n.c,e.c,i),l:Jn(n.l,e.l,i),alpha:Jn(n.alpha,e.alpha,i)}}};var Fr=Object.freeze({__proto__:null,lab:hr,hcl:Yn});class Dn{constructor(e,i,a,u,f){this.type=e,this.operator=i,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[g,x]of f)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(e,i,a,u){let f=0;if("exponential"===e.name)f=mi(i,e.base,a,u);else if("linear"===e.name)f=mi(i,1,a,u);else if("cubic-bezier"===e.name){const g=e.controlPoints;f=new an(g[0],g[1],g[2],g[3]).solve(mi(i,1,a,u))}return f}static parse(e,i){let[a,u,f,...g]=e;if(!Array.isArray(u)||0===u.length)return i.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const D=u[1];if("number"!=typeof D)return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:D}}else{if("cubic-bezier"!==u[0])return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const D=u.slice(1);if(4!==D.length||D.some(A=>"number"!=typeof A||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Xe),!f)return null;const x=[];let b=null;"interpolate-hcl"===a||"interpolate-lab"===a?b=cr:i.expectedType&&"value"!==i.expectedType.kind&&(b=i.expectedType);for(let D=0;D<g.length;D+=2){const A=g[D],P=g[D+1],F=D+3,$=D+4;if("number"!=typeof A)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(x.length&&x[x.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const Z=i.parse(P,$,b);if(!Z)return null;b=b||Z.type,x.push([A,Z])}return"number"===b.kind||"color"===b.kind||"array"===b.kind&&"number"===b.itemType.kind&&"number"==typeof b.N?new Dn(b,a,u,f,x):i.error(`Type ${mr(b)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(1===i.length)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return a[0].evaluate(e);const f=i.length;if(u>=i[f-1])return a[f-1].evaluate(e);const g=ca(i,u),x=Dn.interpolationFactor(this.interpolation,u,i[g],i[g+1]),b=a[g].evaluate(e),D=a[g+1].evaluate(e);return"interpolate"===this.operator?Ms[this.type.kind.toLowerCase()](b,D,x):"interpolate-hcl"===this.operator?Yn.reverse(Yn.interpolate(Yn.forward(b),Yn.forward(D),x)):hr.reverse(hr.interpolate(hr.forward(b),hr.forward(D),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function mi(n,e,i,a){const u=a-i,f=n-i;return 0===u?0:1===e?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}class To{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const u=i.expectedType;u&&"value"!==u.kind&&(a=u);const f=[];for(const x of e.slice(1)){const b=i.parse(x,1+f.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,f.push(b)}const g=u&&f.some(x=>po(u,x.type));return new To(g?bn:a,f)}evaluate(e){let i,a=null,u=0;for(const f of this.args)if(u++,a=f.evaluate(e),a&&a instanceof ti&&!a.available&&(i||(i=a.name),a=null,u===this.args.length&&(a=i)),null!==a)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Di{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let f=1;f<e.length-1;f+=2){const g=e[f];if("string"!=typeof g)return i.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const x=i.parse(e[f+1],f+1);if(!x)return null;a.push([g,x])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return u?new Di(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}class ai{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Xe),u=i.parse(e[2],2,_n(i.expectedType||bn));return a&&u?new ai(u.type.itemType,a,u):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new ur(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new ur(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new ur(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ro{constructor(e,i){this.type=ln,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,bn),u=i.parse(e[2],2,bn);return a&&u?Ko(a.type,[ln,rn,Xe,Mt,bn])?new ro(a,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${mr(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!Dr(i,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${mr(Cr(i))} instead.`);if(!Dr(a,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${mr(Cr(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ts{constructor(e,i,a){this.type=Xe,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,bn),u=i.parse(e[2],2,bn);if(!a||!u)return null;if(!Ko(a.type,[ln,rn,Xe,Mt,bn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${mr(a.type)} instead`);if(4===e.length){const f=i.parse(e[3],3,Xe);return f?new ts(a,u,f):null}return new ts(a,u)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Dr(i,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${mr(Cr(i))} instead.`);if(!Dr(a,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${mr(Cr(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(i,u)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class fs{constructor(e,i,a,u,f,g){this.inputType=e,this.type=i,this.input=a,this.cases=u,this.outputs=f,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,u;i.expectedType&&"value"!==i.expectedType.kind&&(u=i.expectedType);const f={},g=[];for(let D=2;D<e.length-1;D+=2){let A=e[D];const P=e[D+1];Array.isArray(A)||(A=[A]);const F=i.concat(D);if(0===A.length)return F.error("Expected at least one branch label.");for(const Z of A){if("number"!=typeof Z&&"string"!=typeof Z)return F.error("Branch labels must be numbers or strings.");if("number"==typeof Z&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof Z&&Math.floor(Z)!==Z)return F.error("Numeric branch labels must be integer values.");if(a){if(F.checkSubtype(a,Cr(Z)))return null}else a=Cr(Z);if(void 0!==f[String(Z)])return F.error("Branch labels must be unique.");f[String(Z)]=g.length}const $=i.parse(P,D,u);if(!$)return null;u=u||$.type,g.push($)}const x=i.parse(e[1],1,bn);if(!x)return null;const b=i.parse(e[e.length-1],e.length-1,u);return b?"value"!==x.type.kind&&i.concat(1).checkSubtype(a,x.type)?null:new fs(a,u,x,f,g,b):null}evaluate(e){const i=this.input.evaluate(e);return(Cr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],u={};for(const g of i){const x=u[this.cases[g]];void 0===x?(u[this.cases[g]]=a.length,a.push([this.cases[g],[g]])):a[x][1].push(g)}const f=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,x]of a)e.push(1===x.length?f(x[0]):x.map(f)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}class Ci{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&"value"!==i.expectedType.kind&&(a=i.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const x=i.parse(e[g],g,ln);if(!x)return null;const b=i.parse(e[g+1],g+1,a);if(!b)return null;u.push([x,b]),a=a||b.type}const f=i.parse(e[e.length-1],e.length-1,a);return f?new Ci(a,u,f):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class ua{constructor(e,i,a,u){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,bn),u=i.parse(e[2],2,Xe);if(!a||!u)return null;if(!Ko(a.type,[_n(bn),rn,bn]))return i.error(`Expected first argument to be of type array or string, but found ${mr(a.type)} instead`);if(4===e.length){const f=i.parse(e[3],3,Xe);return f?new ua(a.type,a,u,f):null}return new ua(a.type,a,u)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Dr(i,["string","array"]))throw new ur(`Expected first argument to be of type array or string, but found ${mr(Cr(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(a,u)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function As(n,e){return"=="===n||"!="===n?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Ln(n,e,i,a){return 0===a.compare(e,i)}function La(n,e,i){const a="=="!==n&&"!="!==n;return class x0{constructor(f,g,x){this.type=ln,this.lhs=f,this.rhs=g,this.collator=x,this.hasUntypedArgument="value"===f.type.kind||"value"===g.type.kind}static parse(f,g){if(3!==f.length&&4!==f.length)return g.error("Expected two or three arguments.");const x=f[0];let b=g.parse(f[1],1,bn);if(!b)return null;if(!As(x,b.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${mr(b.type)}'.`);let D=g.parse(f[2],2,bn);if(!D)return null;if(!As(x,D.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${mr(D.type)}'.`);if(b.type.kind!==D.type.kind&&"value"!==b.type.kind&&"value"!==D.type.kind)return g.error(`Cannot compare types '${mr(b.type)}' and '${mr(D.type)}'.`);a&&("value"===b.type.kind&&"value"!==D.type.kind?b=new $r(D.type,[b]):"value"!==b.type.kind&&"value"===D.type.kind&&(D=new $r(b.type,[D])));let A=null;if(4===f.length){if("string"!==b.type.kind&&"string"!==D.type.kind&&"value"!==b.type.kind&&"value"!==D.type.kind)return g.error("Cannot use collator to compare non-string types.");if(A=g.parse(f[3],3,Mr),!A)return null}return new x0(b,D,A)}evaluate(f){const g=this.lhs.evaluate(f),x=this.rhs.evaluate(f);if(a&&this.hasUntypedArgument){const b=Cr(g),D=Cr(x);if(b.kind!==D.kind||"string"!==b.kind&&"number"!==b.kind)throw new ur(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${D.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=Cr(g),D=Cr(x);if("string"!==b.kind||"string"!==D.kind)return e(f,g,x)}return this.collator?i(f,g,x,this.collator.evaluate(f)):e(f,g,x)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[n];return this.eachChild(g=>{f.push(g.serialize())}),f}}}const dc=La("==",function(n,e,i){return e===i},Ln),fc=La("!=",function(n,e,i){return e!==i},function(n,e,i,a){return!Ln(0,e,i,a)}),Hc=La("<",function(n,e,i){return e<i},function(n,e,i,a){return a.compare(e,i)<0}),pc=La(">",function(n,e,i){return e>i},function(n,e,i,a){return a.compare(e,i)>0}),Fl=La("<=",function(n,e,i){return e<=i},function(n,e,i,a){return a.compare(e,i)<=0}),Zc=La(">=",function(n,e,i){return e>=i},function(n,e,i,a){return a.compare(e,i)>=0});class wt{constructor(e,i,a,u,f){this.type=rn,this.number=e,this.locale=i,this.currency=a,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");const a=i.parse(e[1],1,Xe);if(!a)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parse(u.locale,1,rn),!f))return null;let g=null;if(u.currency&&(g=i.parse(u.currency,1,rn),!g))return null;let x=null;if(u["min-fraction-digits"]&&(x=i.parse(u["min-fraction-digits"],1,Xe),!x))return null;let b=null;return u["max-fraction-digits"]&&(b=i.parse(u["max-fraction-digits"],1,Xe),!b)?null:new wt(a,f,g,x,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Zn{constructor(e){this.type=Xe,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?"array"!==a.type.kind&&"string"!==a.type.kind&&"value"!==a.type.kind?i.error(`Expected argument of type string or array, but found ${mr(a.type)} instead.`):new Zn(a):null}evaluate(e){const i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new ur(`Expected value to be of type string or array, but found ${mr(Cr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Ps={"==":dc,"!=":fc,">":pc,"<":Hc,">=":Zc,"<=":Fl,array:$r,at:ai,boolean:$r,case:Ci,coalesce:To,collator:sa,format:Bo,image:Qo,in:ro,"index-of":ts,interpolate:Dn,"interpolate-hcl":Dn,"interpolate-lab":Dn,length:Zn,let:Di,literal:jr,match:fs,number:$r,"number-format":wt,object:$r,slice:ua,step:Co,string:$r,"to-boolean":Jr,"to-color":Jr,"to-number":Jr,"to-string":Jr,var:Ra,within:No};function li(n,[e,i,a,u]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const f=u?u.evaluate(n):1,g=Cs(e,i,a,f);if(g)throw new ur(g);return new In(e/255*f,i/255*f,a/255*f,f)}function ha(n,e){return n in e}function Xs(n,e){const i=e[n];return void 0===i?null:i}function ni(n){return{type:n}}function Fa(n){return{result:"success",value:n}}function ps(n){return{result:"error",value:n}}function Uo(n){return"data-driven"===n["property-type"]||"cross-faded-data-driven"===n["property-type"]}function mc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function da(n){return!!n.expression&&n.expression.interpolated}function Qn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}function Ti(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function ms(n){return n}function Ol(n,e){const i="color"===e.type,a=n.stops&&"object"==typeof n.stops[0][0],u=a||!(a||void 0!==n.property),f=n.type||(da(e)?"exponential":"interval");if(i&&((n=ae({},n)).stops&&(n.stops=n.stops.map(D=>[D[0],In.parse(D[1])])),n.default=In.parse(n.default?n.default:e.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!Fr[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,x,b;if("exponential"===f)g=al;else if("interval"===f)g=sl;else if("categorical"===f){g=ns,x=Object.create(null);for(const D of n.stops)x[D[0]]=D[1];b=typeof n.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);g=qc}if(a){const D={},A=[];for(let $=0;$<n.stops.length;$++){const Z=n.stops[$],K=Z[0].zoom;void 0===D[K]&&(D[K]={zoom:K,type:n.type,property:n.property,default:n.default,stops:[]},A.push(K)),D[K].stops.push([Z[0].value,Z[1]])}const P=[];for(const $ of A)P.push([D[$].zoom,Ol(D[$],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Dn.interpolationFactor.bind(void 0,F),zoomStops:P.map($=>$[0]),evaluate:({zoom:$},Z)=>al({stops:P,base:n.base},e,$).evaluate($,Z)}}if(u){const D="exponential"===f?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Dn.interpolationFactor.bind(void 0,D),zoomStops:n.stops.map(A=>A[0]),evaluate:({zoom:A})=>g(n,e,A,x,b)}}return{kind:"source",evaluate(D,A){const P=A&&A.properties?A.properties[n.property]:void 0;return void 0===P?Vo(n.default,e.default):g(n,e,P,x,b)}}}function Vo(n,e,i){return void 0!==n?n:void 0!==e?e:void 0!==i?i:void 0}function ns(n,e,i,a,u){return Vo(typeof i===u?a[i]:void 0,n.default,e.default)}function sl(n,e,i){if("number"!==Qn(i))return Vo(n.default,e.default);const a=n.stops.length;if(1===a||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const u=ca(n.stops.map(f=>f[0]),i);return n.stops[u][1]}function al(n,e,i){const a=void 0!==n.base?n.base:1;if("number"!==Qn(i))return Vo(n.default,e.default);const u=n.stops.length;if(1===u||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const f=ca(n.stops.map(A=>A[0]),i),g=function(A,P,F,$){const Z=$-F,K=A-F;return 0===Z?0:1===P?K/Z:(Math.pow(P,K)-1)/(Math.pow(P,Z)-1)}(i,a,n.stops[f][0],n.stops[f+1][0]),x=n.stops[f][1],b=n.stops[f+1][1];let D=Ms[e.type]||ms;if(n.colorSpace&&"rgb"!==n.colorSpace){const A=Fr[n.colorSpace];D=(P,F)=>A.reverse(A.interpolate(A.forward(P),A.forward(F),g))}return"function"==typeof x.evaluate?{evaluate(...A){const P=x.evaluate.apply(void 0,A),F=b.evaluate.apply(void 0,A);if(void 0!==P&&void 0!==F)return D(P,F,g)}}:D(x,b,g)}function qc(n,e,i){return"color"===e.type?i=In.parse(i):"formatted"===e.type?i=Ar.fromString(i.toString()):"resolvedImage"===e.type?i=ti.fromString(i.toString()):Qn(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Vo(i,n.default,e.default)}Ei.register(Ps,{error:[{kind:"error"},[rn],(n,[e])=>{throw new ur(e.evaluate(n))}],typeof:[rn,[bn],(n,[e])=>mr(Cr(e.evaluate(n)))],"to-rgba":[_n(Xe,4),[cr],(n,[e])=>e.evaluate(n).toArray()],rgb:[cr,[Xe,Xe,Xe],li],rgba:[cr,[Xe,Xe,Xe,Xe],li],has:{type:ln,overloads:[[[rn],(n,[e])=>ha(e.evaluate(n),n.properties())],[[rn,yr],(n,[e,i])=>ha(e.evaluate(n),i.evaluate(n))]]},get:{type:bn,overloads:[[[rn],(n,[e])=>Xs(e.evaluate(n),n.properties())],[[rn,yr],(n,[e,i])=>Xs(e.evaluate(n),i.evaluate(n))]]},"feature-state":[bn,[rn],(n,[e])=>Xs(e.evaluate(n),n.featureState||{})],properties:[yr,[],n=>n.properties()],"geometry-type":[rn,[],n=>n.geometryType()],id:[bn,[],n=>n.id()],zoom:[Xe,[],n=>n.globals.zoom],pitch:[Xe,[],n=>n.globals.pitch||0],"distance-from-center":[Xe,[],n=>n.distanceFromCenter()],"heatmap-density":[Xe,[],n=>n.globals.heatmapDensity||0],"line-progress":[Xe,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[Xe,[],n=>n.globals.skyRadialProgress||0],accumulated:[bn,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[Xe,ni(Xe),(n,e)=>{let i=0;for(const a of e)i+=a.evaluate(n);return i}],"*":[Xe,ni(Xe),(n,e)=>{let i=1;for(const a of e)i*=a.evaluate(n);return i}],"-":{type:Xe,overloads:[[[Xe,Xe],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Xe],(n,[e])=>-e.evaluate(n)]]},"/":[Xe,[Xe,Xe],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Xe,[Xe,Xe],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Xe,[],()=>Math.LN2],pi:[Xe,[],()=>Math.PI],e:[Xe,[],()=>Math.E],"^":[Xe,[Xe,Xe],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Xe,[Xe],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Xe,[Xe],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Xe,[Xe],(n,[e])=>Math.log(e.evaluate(n))],log2:[Xe,[Xe],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Xe,[Xe],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Xe,[Xe],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Xe,[Xe],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Xe,[Xe],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Xe,[Xe],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Xe,[Xe],(n,[e])=>Math.atan(e.evaluate(n))],min:[Xe,ni(Xe),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[Xe,ni(Xe),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[Xe,[Xe],(n,[e])=>Math.abs(e.evaluate(n))],round:[Xe,[Xe],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Xe,[Xe],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Xe,[Xe],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[ln,[rn,bn],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[ln,[bn],(n,[e])=>n.id()===e.value],"filter-type-==":[ln,[rn],(n,[e])=>n.geometryType()===e.value],"filter-<":[ln,[rn,bn],(n,[e,i])=>{const a=n.properties()[e.value],u=i.value;return typeof a==typeof u&&a<u}],"filter-id-<":[ln,[bn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[ln,[rn,bn],(n,[e,i])=>{const a=n.properties()[e.value],u=i.value;return typeof a==typeof u&&a>u}],"filter-id->":[ln,[bn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[ln,[rn,bn],(n,[e,i])=>{const a=n.properties()[e.value],u=i.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[ln,[bn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[ln,[rn,bn],(n,[e,i])=>{const a=n.properties()[e.value],u=i.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[ln,[bn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[ln,[bn],(n,[e])=>e.value in n.properties()],"filter-has-id":[ln,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[ln,[_n(rn)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[ln,[_n(bn)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[ln,[rn,_n(bn)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[ln,[rn,_n(bn)],(n,[e,i])=>function(a,u,f,g){for(;f<=g;){const x=f+g>>1;if(u[x]===a)return!0;u[x]>a?g=x-1:f=x+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ln,overloads:[[[ln,ln],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[ni(ln),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:ln,overloads:[[[ln,ln],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[ni(ln),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[ln,[ln],(n,[e])=>!e.evaluate(n)],"is-supported-script":[ln,[rn],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[rn,[rn],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[rn,[rn],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[rn,ni(bn),(n,e)=>e.map(i=>si(i.evaluate(n))).join("")],"resolved-locale":[rn,[Mr],(n,[e])=>e.evaluate(n).resolvedLocale()]});class zl{constructor(e,i){var a;this.expression=e,this._warningHistory={},this._evaluator=new Ss,this._defaultValue=i?"color"===(a=i).type&&Ti(a.default)?new In(0,0,0,0):"color"===a.type?In.parse(a.default)||null:void 0===a.default?null:a.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(e,i,a,u,f,g,x,b){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,u,f,g,x,b){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=b||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new ur(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,"undefined"!=typeof console&&console.warn(D.message)),this._defaultValue}}}function mo(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in Ps}function ks(n,e){const i=new ds(Ps,[],e?function(u){const f={color:cr,string:rn,number:Xe,enum:rn,boolean:ln,formatted:ho,resolvedImage:no};return"array"===u.type?_n(f[u.value]||bn,u.length):f[u.type]}(e):void 0),a=i.parse(n,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return a?Fa(new zl(a,e)):ps(i.errors)}class gs{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent="constant"!==e&&!ka(i.expression)}evaluateWithoutErrorHandling(e,i,a,u,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,u,f,g)}evaluate(e,i,a,u,f,g){return this._styleExpression.evaluate(e,i,a,u,f,g)}}class Ys{constructor(e,i,a,u){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent="camera"!==e&&!ka(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,a,u,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,u,f,g)}evaluate(e,i,a,u,f,g){return this._styleExpression.evaluate(e,i,a,u,f,g)}interpolationFactor(e,i,a){return this.interpolationType?Dn.interpolationFactor(this.interpolationType,e,i,a):0}}function Wc(n,e){if("error"===(n=ks(n,e)).result)return n;const i=n.value.expression,a=Is(i);if(!a&&!Uo(e))return ps([new Rt("","data expressions not supported")]);const u=Un(i,["zoom","pitch","distance-from-center"]);if(!u&&!mc(e))return ps([new Rt("","zoom expressions not supported")]);const f=So(i);return f||u?f instanceof Rt?ps([f]):f instanceof Dn&&!da(e)?ps([new Rt("",'"interpolate" expressions cannot be used with this property')]):Fa(f?new Ys(a?"camera":"composite",n.value,f.labels,f instanceof Dn?f.interpolation:void 0):new gs(a?"constant":"source",n.value)):ps([new Rt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Rs{constructor(e,i){this._parameters=e,this._specification=i,ae(this,Ol(this._parameters,this._specification))}static deserialize(e){return new Rs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function So(n){let e=null;if(n instanceof Di)e=So(n.result);else if(n instanceof To){for(const i of n.args)if(e=So(i),e)break}else(n instanceof Co||n instanceof Dn)&&n.input instanceof Ei&&"zoom"===n.input.name&&(e=n);return e instanceof Rt||n.eachChild(i=>{const a=So(i);a instanceof Rt?e=a:!e&&a?e=new Rt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Rt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function io(n){const e=n.key,i=n.value,a=n.valueSpec||{},u=n.objectElementValidators||{},f=n.style,g=n.styleSpec;let x=[];const b=Qn(i);if("object"!==b)return[new te(e,i,`object expected, ${b} found`)];for(const D in i){const A=D.split(".")[0],P=a[A]||a["*"];let F;if(u[A])F=u[A];else if(a[A])F=$i;else if(u["*"])F=u["*"];else{if(!a["*"]){x.push(new te(e,i[D],`unknown property "${D}"`));continue}F=$i}x=x.concat(F({key:(e&&`${e}.`)+D,value:i[D],valueSpec:P,style:f,styleSpec:g,object:i,objectKey:D},i))}for(const D in a)u[D]||a[D].required&&void 0===a[D].default&&void 0===i[D]&&x.push(new te(e,i,`missing required property "${D}"`));return x}function fa(n){const e=n.value,i=n.valueSpec,a=n.style,u=n.styleSpec,f=n.key,g=n.arrayElementValidator||$i;if("array"!==Qn(e))return[new te(f,e,`array expected, ${Qn(e)} found`)];if(i.length&&e.length!==i.length)return[new te(f,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new te(f,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let x={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum};u.$version<7&&(x.function=i.function),"object"===Qn(i.value)&&(x=i.value);let b=[];for(let D=0;D<e.length;D++)b=b.concat(g({array:e,arrayIndex:D,value:e[D],valueSpec:x,style:a,styleSpec:u,key:`${f}[${D}]`}));return b}function ll(n){const e=n.key,i=n.value,a=n.valueSpec;let u=Qn(i);if("number"===u&&i!=i&&(u="NaN"),"number"!==u)return[new te(e,i,`number expected, ${u} found`)];if("minimum"in a){let f=a.minimum;if("array"===Qn(a.minimum)&&(f=a.minimum[n.arrayIndex]),i<f)return[new te(e,i,`${i} is less than the minimum value ${f}`)]}if("maximum"in a){let f=a.maximum;if("array"===Qn(a.maximum)&&(f=a.maximum[n.arrayIndex]),i>f)return[new te(e,i,`${i} is greater than the maximum value ${f}`)]}return[]}function Oa(n){const e=n.valueSpec,i=ke(n.value.type);let a,u,f,g={};const x="categorical"!==i&&void 0===n.value.property,b=!x,D="array"===Qn(n.value.stops)&&"array"===Qn(n.value.stops[0])&&"object"===Qn(n.value.stops[0][0]),A=io({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function($){if("identity"===i)return[new te($.key,$.value,'identity function may not have a "stops" property')];let Z=[];const K=$.value;return Z=Z.concat(fa({key:$.key,value:K,valueSpec:$.valueSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:P})),"array"===Qn(K)&&0===K.length&&Z.push(new te($.key,K,"array must have at least one stop")),Z},default:function($){return $i({key:$.key,value:$.value,valueSpec:e,style:$.style,styleSpec:$.styleSpec})}}});return"identity"===i&&x&&A.push(new te(n.key,n.value,'missing required property "property"')),"identity"===i||n.value.stops||A.push(new te(n.key,n.value,'missing required property "stops"')),"exponential"===i&&n.valueSpec.expression&&!da(n.valueSpec)&&A.push(new te(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!Uo(n.valueSpec)?A.push(new te(n.key,n.value,"property functions not supported")):x&&!mc(n.valueSpec)&&A.push(new te(n.key,n.value,"zoom functions not supported"))),"categorical"!==i&&!D||void 0!==n.value.property||A.push(new te(n.key,n.value,'"property" property is required')),A;function P($){let Z=[];const K=$.value,ce=$.key;if("array"!==Qn(K))return[new te(ce,K,`array expected, ${Qn(K)} found`)];if(2!==K.length)return[new te(ce,K,`array length 2 expected, length ${K.length} found`)];if(D){if("object"!==Qn(K[0]))return[new te(ce,K,`object expected, ${Qn(K[0])} found`)];if(void 0===K[0].zoom)return[new te(ce,K,"object stop key must have zoom")];if(void 0===K[0].value)return[new te(ce,K,"object stop key must have value")];if(f&&f>ke(K[0].zoom))return[new te(ce,K[0].zoom,"stop zoom values must appear in ascending order")];ke(K[0].zoom)!==f&&(f=ke(K[0].zoom),u=void 0,g={}),Z=Z.concat(io({key:`${ce}[0]`,value:K[0],valueSpec:{zoom:{}},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:ll,value:F}}))}else Z=Z.concat(F({key:`${ce}[0]`,value:K[0],valueSpec:{},style:$.style,styleSpec:$.styleSpec},K));return mo(qe(K[1]))?Z.concat([new te(`${ce}[1]`,K[1],"expressions are not allowed in function stops.")]):Z.concat($i({key:`${ce}[1]`,value:K[1],valueSpec:e,style:$.style,styleSpec:$.styleSpec}))}function F($,Z){const K=Qn($.value),ce=ke($.value),de=null!==$.value?$.value:Z;if(a){if(K!==a)return[new te($.key,de,`${K} stop domain type must match previous stop domain type ${a}`)]}else a=K;if("number"!==K&&"string"!==K&&"boolean"!==K)return[new te($.key,de,"stop domain value must be a number, string, or boolean")];if("number"!==K&&"categorical"!==i){let be=`number expected, ${K} found`;return Uo(e)&&void 0===i&&(be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new te($.key,de,be)]}return"categorical"!==i||"number"!==K||isFinite(ce)&&Math.floor(ce)===ce?"categorical"!==i&&"number"===K&&void 0!==u&&ce<u?[new te($.key,de,"stop domain values must appear in ascending order")]:(u=ce,"categorical"===i&&ce in g?[new te($.key,de,"stop domain values must be unique")]:(g[ce]=!0,[])):[new te($.key,de,`integer expected, found ${ce}`)]}}function jo(n){const e=("property"===n.expressionContext?Wc:ks)(qe(n.value),n.valueSpec);if("error"===e.result)return e.value.map(a=>new te(`${n.key}${a.key}`,n.value,a.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!i.outputDefined())return[new te(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!ka(i))return[new te(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return Bl(i,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!Un(i,["zoom","feature-state"]))return[new te(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!Is(i))return[new te(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Bl(n,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const u of e.valueSpec.expression.parameters)i.delete(u);if(0===i.size)return[];const a=[];return n instanceof Ei&&i.has(n.name)?[new te(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(u=>{a.push(...Bl(u,e))}),a)}function pa(n){const e=n.key,i=n.value,a=n.valueSpec,u=[];return Array.isArray(a.values)?-1===a.values.indexOf(ke(i))&&u.push(new te(e,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(a.values).indexOf(ke(i))&&u.push(new te(e,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function ci(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!ci(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Io(n,e="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ci(n)||(n=cl(n));const i=n;let a=!0;try{a=function(D){if(!_s(D))return D;let A=qe(D);return Ks(A),A=Gr(A),A}(i)}catch(D){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const u=we[`filter_${e}`],f=ks(a,u);let g=null;if("error"===f.result)throw new Error(f.value.map(D=>`${D.key}: ${D.message}`).join(", "));g=(D,A,P)=>f.value.evaluate(D,A,{},P);let x=null,b=null;if(a!==i){const D=ks(i,u);if("error"===D.result)throw new Error(D.value.map(A=>`${A.key}: ${A.message}`).join(", "));x=(A,P,F,$,Z)=>D.value.evaluate(A,P,{},F,void 0,void 0,$,Z),b=!Is(D.value.expression)}return g=g,{filter:g,dynamicFilter:x||void 0,needGeometry:Vl(a),needFeature:!!b}}function Gr(n){if(!Array.isArray(n))return n;const e=function(i){if(Nl.has(i[0]))for(let a=1;a<i.length;a++)if(_s(i[a]))return!0;return i}(n);return!0===e?e:e.map(i=>Gr(i))}function Ks(n){let e=!1;const i=[];if("case"===n[0]){for(let a=1;a<n.length-1;a+=2)e=e||_s(n[a]),i.push(n[a+1]);i.push(n[n.length-1])}else if("match"===n[0]){e=e||_s(n[1]);for(let a=2;a<n.length-1;a+=2)i.push(n[a+1]);i.push(n[n.length-1])}else if("step"===n[0]){e=e||_s(n[1]);for(let a=1;a<n.length-1;a+=2)i.push(n[a+1])}e&&(n.length=0,n.push("any",...i));for(let a=1;a<n.length;a++)Ks(n[a])}function _s(n){if(!Array.isArray(n))return!1;if("pitch"===(e=n[0])||"distance-from-center"===e)return!0;var e;for(let i=1;i<n.length;i++)if(_s(n[i]))return!0;return!1}const Nl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ul(n,e){return n<e?-1:n>e?1:0}function Vl(n){if(!Array.isArray(n))return!1;if("within"===n[0])return!0;for(let e=1;e<n.length;e++)if(Vl(n[e]))return!0;return!1}function cl(n){if(!n)return!0;const e=n[0];return n.length<=1?"any"!==e:"=="===e?ys(n[1],n[2],"=="):"!="===e?ga(ys(n[1],n[2],"==")):"<"===e||">"===e||"<="===e||">="===e?ys(n[1],n[2],e):"any"===e?(i=n.slice(1),["any"].concat(i.map(cl))):"all"===e?["all"].concat(n.slice(1).map(cl)):"none"===e?["all"].concat(n.slice(1).map(cl).map(ga)):"in"===e?ma(n[1],n.slice(2)):"!in"===e?ga(ma(n[1],n.slice(2))):"has"===e?za(n[1]):"!has"===e?ga(za(n[1])):"within"!==e||n;var i}function ys(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function ma(n,e){if(0===e.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Ul)]]:["filter-in-small",n,["literal",e]]}}function za(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function ga(n){return["!",n]}function Vi(n){if(ci(qe(n.value))){const e=qe(n.layerType);return jo(ae({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${e||"fill"}`]}))}return gc(n)}function gc(n){const e=n.value,i=n.key;if("array"!==Qn(e))return[new te(i,e,`array expected, ${Qn(e)} found`)];const a=n.styleSpec;let u,f=[];if(e.length<1)return[new te(i,e,"filter array must have at least 1 element")];switch(f=f.concat(pa({key:`${i}[0]`,value:e[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),ke(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===ke(e[1])&&f.push(new te(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&f.push(new te(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Qn(e[1]),"string"!==u&&f.push(new te(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let g=2;g<e.length;g++)u=Qn(e[g]),"$type"===ke(e[1])?f=f.concat(pa({key:`${i}[${g}]`,value:e[g],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&f.push(new te(`${i}[${g}]`,e[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)f=f.concat(gc({key:`${i}[${g}]`,value:e[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=Qn(e[1]),2!==e.length?f.push(new te(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&f.push(new te(`${i}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=Qn(e[1]),2!==e.length?f.push(new te(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&f.push(new te(`${i}[1]`,e[1],`object expected, ${u} found`))}return f}function Yi(n,e){const i=n.key,a=n.style,u=n.styleSpec,f=n.value,g=n.objectKey,x=u[`${e}_${n.layerType}`];if(!x)return[];const b=g.match(/^(.*)-transition$/);if("paint"===e&&b&&x[b[1]]&&x[b[1]].transition)return $i({key:i,value:f,valueSpec:u.transition,style:a,styleSpec:u});const D=n.valueSpec||x[g];if(!D)return[new te(i,f,`unknown property "${g}"`)];let A;if("string"===Qn(f)&&Uo(D)&&!D.tokens&&(A=/^{([^}]+)}$/.exec(f)))return[new te(i,f,`"${g}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const P=[];return"symbol"===n.layerType&&("text-field"===g&&a&&!a.glyphs&&P.push(new te(i,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===g&&Ti(qe(f))&&"identity"===ke(f.type)&&P.push(new te(i,f,'"text-font" does not support identity functions'))),P.concat($i({key:n.key,value:f,valueSpec:D,style:a,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:g}))}function Mo(n){return Yi(n,"paint")}function ji(n){return Yi(n,"layout")}function rs(n){let e=[];const i=n.value,a=n.key,u=n.style,f=n.styleSpec;i.type||i.ref||e.push(new te(a,i,'either "type" or "ref" is required'));let g=ke(i.type);const x=ke(i.ref);if(i.id){const b=ke(i.id);for(let D=0;D<n.arrayIndex;D++){const A=u.layers[D];ke(A.id)===b&&e.push(new te(a,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let b;["type","source","source-layer","filter","layout"].forEach(D=>{D in i&&e.push(new te(a,i[D],`"${D}" is prohibited for ref layers`))}),u.layers.forEach(D=>{ke(D.id)===x&&(b=D)}),b?b.ref?e.push(new te(a,i.ref,"ref cannot reference another ref layer")):g=ke(b.type):e.push(new te(a,i.ref,`ref layer "${x}" not found`))}else if("background"!==g&&"sky"!==g)if(i.source){const b=u.sources&&u.sources[i.source],D=b&&ke(b.type);b?"vector"===D&&"raster"===g?e.push(new te(a,i.source,`layer "${i.id}" requires a raster source`)):"raster"===D&&"raster"!==g?e.push(new te(a,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==D||i["source-layer"]?"raster-dem"===D&&"hillshade"!==g?e.push(new te(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==g||!i.paint||!i.paint["line-gradient"]||"geojson"===D&&b.lineMetrics||e.push(new te(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new te(a,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new te(a,i.source,`source "${i.source}" not found`))}else e.push(new te(a,i,'missing required property "source"'));return e=e.concat(io({key:a,value:i,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$i({key:`${a}.type`,value:i.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,object:i,objectKey:"type"}),filter:b=>Vi(ae({layerType:g},b)),layout:b=>io({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":D=>ji(ae({layerType:g},D))}}),paint:b=>io({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":D=>Mo(ae({layerType:g},D))}})}})),e}function $o(n){const e=n.value,i=n.key,a=Qn(e);return"string"!==a?[new te(i,e,`string expected, ${a} found`)]:[]}const ul={promoteId:function({key:n,value:e}){if("string"===Qn(e))return $o({key:n,value:e});{const i=[];for(const a in e)i.push(...$o({key:`${n}.${a}`,value:e[a]}));return i}}};function jl(n){const e=n.value,i=n.key,a=n.styleSpec,u=n.style;if(!e.type)return[new te(i,e,'"type" is required')];const f=ke(e.type);let g;switch(f){case"vector":case"raster":case"raster-dem":return g=io({key:i,value:e,valueSpec:a[`source_${f.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:ul}),g;case"geojson":if(g=io({key:i,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:ul}),e.cluster)for(const x in e.clusterProperties){const[b,D]=e.clusterProperties[x],A="string"==typeof b?[b,["accumulated"],["get",x]]:b;g.push(...jo({key:`${i}.${x}.map`,value:D,expressionContext:"cluster-map"})),g.push(...jo({key:`${i}.${x}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return g;case"video":return io({key:i,value:e,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return io({key:i,value:e,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new te(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return pa({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:a})}}function _c(n){const e=n.value,i=n.styleSpec,a=i.light,u=n.style;let f=[];const g=Qn(e);if(void 0===e)return f;if("object"!==g)return f=f.concat([new te("light",e,`object expected, ${g} found`)]),f;for(const x in e){const b=x.match(/^(.*)-transition$/);f=f.concat(b&&a[b[1]]&&a[b[1]].transition?$i({key:x,value:e[x],valueSpec:i.transition,style:u,styleSpec:i}):a[x]?$i({key:x,value:e[x],valueSpec:a[x],style:u,styleSpec:i}):[new te(x,e[x],`unknown property "${x}"`)])}return f}function hl(n){const e=n.value,i=n.key,a=n.style,u=n.styleSpec,f=u.terrain;let g=[];const x=Qn(e);if(void 0===e)return g;if("object"!==x)return g=g.concat([new te("terrain",e,`object expected, ${x} found`)]),g;for(const b in e){const D=b.match(/^(.*)-transition$/);g=g.concat(D&&f[D[1]]&&f[D[1]].transition?$i({key:b,value:e[b],valueSpec:u.transition,style:a,styleSpec:u}):f[b]?$i({key:b,value:e[b],valueSpec:f[b],style:a,styleSpec:u}):[new te(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=a.sources&&a.sources[e.source],D=b&&ke(b.type);b?"raster-dem"!==D&&g.push(new te(i,e.source,`terrain cannot be used with a source of type ${D}, it only be used with a "raster-dem" source type`)):g.push(new te(i,e.source,`source "${e.source}" not found`))}else g.push(new te(i,e,'terrain is missing required property "source"'));return g}function yc(n){const e=n.value,i=n.style,a=n.styleSpec,u=a.fog;let f=[];const g=Qn(e);if(void 0===e)return f;if("object"!==g)return f=f.concat([new te("fog",e,`object expected, ${g} found`)]),f;for(const x in e){const b=x.match(/^(.*)-transition$/);f=f.concat(b&&u[b[1]]&&u[b[1]].transition?$i({key:x,value:e[x],valueSpec:a.transition,style:i,styleSpec:a}):u[x]?$i({key:x,value:e[x],valueSpec:u[x],style:i,styleSpec:a}):[new te(x,e[x],`unknown property "${x}"`)])}return f}const vs={"*":()=>[],array:fa,boolean:function(n){const e=n.value,i=n.key,a=Qn(e);return"boolean"!==a?[new te(i,e,`boolean expected, ${a} found`)]:[]},number:ll,color:function(n){const e=n.key,i=n.value,a=Qn(i);return"string"!==a?[new te(e,i,`color expected, ${a} found`)]:null===pi.parseCSSColor(i)?[new te(e,i,`color expected, "${i}" found`)]:[]},constants:ye,enum:pa,filter:Vi,function:Oa,layer:rs,object:io,source:jl,light:_c,terrain:hl,fog:yc,string:$o,formatted:function(n){return 0===$o(n).length?[]:jo(n)},resolvedImage:function(n){return 0===$o(n).length?[]:jo(n)},projection:function(n){const e=n.value,i=n.styleSpec,a=i.projection,u=n.style;let f=[];const g=Qn(e);if("object"===g)for(const x in e)f=f.concat($i({key:x,value:e[x],valueSpec:a[x],style:u,styleSpec:i}));else"string"!==g&&(f=f.concat([new te("projection",e,`object or string expected, ${g} found`)]));return f}};function $i(n){const e=n.value,i=n.valueSpec,a=n.styleSpec;return i.expression&&Ti(ke(e))?Oa(n):i.expression&&mo(qe(e))?jo(n):i.type&&vs[i.type]?vs[i.type](n):io(ae({},n,{valueSpec:i.type?a[i.type]:i}))}function xs(n){const e=n.value,i=n.key,a=$o(n);return a.length||(-1===e.indexOf("{fontstack}")&&a.push(new te(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&a.push(new te(i,e,'"glyphs" url must include a "{range}" token'))),a}function Ki(n,e=we){let i=[];return i=i.concat($i({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:xs,"*":()=>[]}})),n.constants&&(i=i.concat(ye({key:"constants",value:n.constants,style:n,styleSpec:e}))),$l(i)}function $l(n){return[].concat(n).sort((e,i)=>e.line-i.line)}function is(n){return function(...e){return $l(n.apply(this,e))}}Ki.source=is(jl),Ki.light=is(_c),Ki.terrain=is(hl),Ki.fog=is(yc),Ki.layer=is(rs),Ki.filter=is(Vi),Ki.paintProperty=is(Mo),Ki.layoutProperty=is(ji);const Ao=Ki,Xc=Ao.light,Ls=Ao.fog,_a=Ao.paintProperty,ya=Ao.layoutProperty;function Yc(n,e){let i=!1;if(e&&e.length)for(const a of e)n.fire(new tn(new Error(a.message))),i=!0;return i}var Js=Go;function Go(n,e,i){var a=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var u=new Int32Array(this.arrayBuffer);n=u[0],this.d=(e=u[1])+2*(i=u[2]);for(var f=0;f<this.d*this.d;f++){var g=u[3+f],x=u[3+f+1];a.push(g===x?null:u.subarray(g,x))}var b=u[3+a.length+1];this.keys=u.subarray(u[3+a.length],b),this.bboxes=u.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var D=0;D<this.d*this.d;D++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=i,this.scale=e/n,this.uid=0;var A=i/e*n;this.min=-A,this.max=n+A}Go.prototype.insert=function(n,e,i,a,u){this._forEachCell(e,i,a,u,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(u)},Go.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Go.prototype._insertCell=function(n,e,i,a,u,f){this.cells[u].push(f)},Go.prototype.query=function(n,e,i,a,u){var f=this.min,g=this.max;if(n<=f&&e<=f&&g<=i&&g<=a&&!u)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(n,e,i,a,this._queryCell,x,{},u),x},Go.prototype._queryCell=function(n,e,i,a,u,f,g,x){var b=this.cells[u];if(null!==b)for(var D=this.keys,A=this.bboxes,P=0;P<b.length;P++){var F=b[P];if(void 0===g[F]){var $=4*F;(x?x(A[$+0],A[$+1],A[$+2],A[$+3]):n<=A[$+2]&&e<=A[$+3]&&i>=A[$+0]&&a>=A[$+1])?(g[F]=!0,f.push(D[F])):g[F]=!1}}},Go.prototype._forEachCell=function(n,e,i,a,u,f,g,x){for(var b=this._convertToCellCoord(n),D=this._convertToCellCoord(e),A=this._convertToCellCoord(i),P=this._convertToCellCoord(a),F=b;F<=A;F++)for(var $=D;$<=P;$++){var Z=this.d*$+F;if((!x||x(this._convertFromCellCoord(F),this._convertFromCellCoord($),this._convertFromCellCoord(F+1),this._convertFromCellCoord($+1)))&&u.call(this,n,e,i,a,Z,f,g,x))return}},Go.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Go.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Go.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=3+this.cells.length+1+1,i=0,a=0;a<this.cells.length;a++)i+=this.cells[a].length;var u=new Int32Array(e+i+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,g=0;g<n.length;g++){var x=n[g];u[3+g]=f,u.set(x,f),f+=x.length}return u[3+n.length]=f,u.set(this.keys,f),u[3+n.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};const{ImageData:va,ImageBitmap:vc}=He,bs={};function Wt(n,e,i={}){Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),bs[n]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}Wt("Object",Object),Js.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.push(i),{buffer:i}},Js.deserialize=function(n){return new Js(n.buffer)},Wt("Grid",Js),Wt("Color",In),Wt("Error",Error),Wt("ResolvedImage",ti),Wt("StylePropertyFunction",Rs),Wt("StyleExpression",zl,{omit:["_evaluator"]}),Wt("ZoomDependentExpression",Ys),Wt("ZoomConstantExpression",gs),Wt("CompoundExpression",Ei,{omit:["_evaluate"]});for(const n in Ps)Ps[n]._classRegistryKey||Wt(`Expression_${n}`,Ps[n]);function dl(n){return n&&"undefined"!=typeof ArrayBuffer&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function Ba(n){return vc&&n instanceof vc}function M(n,e){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(dl(n)||Ba(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const i=n;return e&&e.push(i.buffer),i}if(n instanceof va)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const a of n)i.push(M(a,e));return i}if("object"==typeof n){const i=n.constructor,a=i._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");const u=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const f in n){if(!n.hasOwnProperty(f)||bs[a].omit.indexOf(f)>=0)continue;const g=n[f];u[f]=bs[a].shallow.indexOf(f)>=0?g:M(g,e)}n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==a&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof n)}function T(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||dl(n)||Ba(n)||ArrayBuffer.isView(n)||n instanceof va)return n;if(Array.isArray(n))return n.map(T);if("object"==typeof n){const e=n.$name||"Object",{klass:i}=bs[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const a=Object.create(i.prototype);for(const u of Object.keys(n)){if("$name"===u)continue;const f=n[u];a[u]=bs[e].shallow.indexOf(u)>=0?f:T(f)}return a}throw new Error("can't deserialize object of type "+typeof n)}class C{constructor(){this.first=!0}update(e,i){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const L=n=>n>=1536&&n<=1791,U=n=>n>=1872&&n<=1919,Y=n=>n>=2208&&n<=2303,_e=n=>n>=11904&&n<=12031,De=n=>n>=12032&&n<=12255,Je=n=>n>=12272&&n<=12287,Kt=n=>n>=12288&&n<=12351,Vn=n=>n>=12352&&n<=12447,un=n=>n>=12448&&n<=12543,sr=n=>n>=12544&&n<=12591,er=n=>n>=12704&&n<=12735,Ho=n=>n>=12736&&n<=12783,Zo=n=>n>=12784&&n<=12799,Ji=n=>n>=12800&&n<=13055,go=n=>n>=13056&&n<=13311,_o=n=>n>=13312&&n<=19903,Qi=n=>n>=19968&&n<=40959,qo=n=>n>=40960&&n<=42127,fl=n=>n>=42128&&n<=42191,Fs=n=>n>=44032&&n<=55215,Rh=n=>n>=63744&&n<=64255,xa=n=>n>=64336&&n<=65023,ri=n=>n>=65040&&n<=65055,Gl=n=>n>=65072&&n<=65103,Lh=n=>n>=65104&&n<=65135,Bu=n=>n>=65136&&n<=65279,Nu=n=>n>=65280&&n<=65519;function Na(n){for(const e of n)if(Ua(e.charCodeAt(0)))return!0;return!1}function Kc(n){for(const e of n)if(!xc(e.charCodeAt(0)))return!1;return!0}function xc(n){return!(L(n)||U(n)||Y(n)||xa(n)||Bu(n))}function Ua(n){return!(746!==n&&747!==n&&(n<4352||!(er(n)||sr(n)||Gl(n)&&!(n>=65097&&n<=65103)||Rh(n)||go(n)||_e(n)||Ho(n)||!(!Kt(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||_o(n)||Qi(n)||Ji(n)||(e=n,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(n)||(e=>e>=55216&&e<=55295)(n)||(e=>e>=4352&&e<=4607)(n)||Fs(n)||Vn(n)||Je(n)||(e=>e>=12688&&e<=12703)(n)||De(n)||Zo(n)||un(n)&&12540!==n||!(!Nu(n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!Lh(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(e=>e>=5120&&e<=5759)(n)||(e=>e>=6320&&e<=6399)(n)||ri(n)||(e=>e>=19904&&e<=19967)(n)||qo(n)||fl(n))));var e}function Uu(n){return!(Ua(n)||(e=n,(i=e)>=128&&i<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(i=>i>=8192&&i<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&9251!==e||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Kt(e)||un(e)||(i=>i>=57344&&i<=63743)(e)||Gl(e)||Lh(e)||Nu(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,i}function ei(n){return n>=1424&&n<=2303||xa(n)||Bu(n)}function Jc(n,e){return!(!e&&ei(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(i=n,i>=6016&&i<=6143));var i}function Hl(n){for(const e of n)if(ei(e.charCodeAt(0)))return!0;return!1}const Zl="deferred",d="loading",t="loaded";let l=null,p="unavailable",_=null;const v=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(p="error"),l&&l(n)};function E(){S.fire(new ct("pluginStateChange",{pluginStatus:p,pluginURL:_}))}const S=new St,R=function(){return p},O=function(){if(p!==Zl||!_)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");p=d,E(),_&&H({url:_},n=>{n?v(n):(p=t,E())})},N={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>p===t||null!=N.applyArabicShaping,isLoading:()=>p===d,setState(n){p=n.pluginStatus,_=n.pluginURL},isParsed:()=>null!=N.applyArabicShaping&&null!=N.processBidirectionalText&&null!=N.processStyledBidirectionalText,getPluginURL:()=>_};class V{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new C,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,a){for(const u of i)if(!Jc(u.charCodeAt(0),a))return!1;return!0}(e,N.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*i}}}class X{constructor(e,i){this.property=e,this.value=i,this.expression=function(a,u){if(Ti(a))return new Rs(a,u);if(mo(a)){const f=Wc(a,u);if("error"===f.result)throw new Error(f.value.map(g=>`${g.key}: ${g.message}`).join(", "));return f.value}{let f=a;return"string"==typeof a&&"color"===u.type&&(f=In.parse(a)),{kind:"constant",evaluate:()=>f}}}(void 0===i?e.specification.default:i,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,i,a){return this.property.possiblyEvaluate(this,e,i,a)}}class re{constructor(e){this.property=e,this.value=new X(e,void 0)}transitioned(e,i){return new ne(this.property,this.value,i,gn({},e.transition,this.transition),e.now)}untransitioned(){return new ne(this.property,this.value,null,{},0)}}class le{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Sn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new re(this._values[e].property)),this._values[e].value=new X(this._values[e].property,null===i?void 0:Sn(i))}getTransition(e){return Sn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new re(this._values[e].property)),this._values[e].transition=Sn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);void 0!==a&&(e[i]=a);const u=this.getTransition(i);void 0!==u&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const a=new fe(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,i._values[u]);return a}untransitioned(){const e=new fe(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class ne{constructor(e,i,a,u,f){const g=u.delay||0,x=u.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+g,this.end=this.begin+x,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const u=e.now||0,f=this.value.possiblyEvaluate(e,i,a),g=this.prior;if(g){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return g.possiblyEvaluate(e,i,a);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,a),f,Ot(x))}}return f}}class fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const u=new ge(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ie{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Sn(this._values[e].value)}setValue(e,i){this._values[e]=new X(this._values[e].property,null===i?void 0:Sn(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);void 0!==a&&(e[i]=a)}return e}possiblyEvaluate(e,i,a){const u=new ge(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,a);return u}}class me{constructor(e,i,a){this.property=e,this.value=i,this.parameters=a}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,i,a,u){return this.property.evaluate(this.value,this.parameters,e,i,a,u)}}class ge{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class se{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const u=Ms[this.specification.type];return u?u(e,i,a):e}}class ve{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,u){return new me(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(i,null,{},a,u)}:e.expression,i)}interpolate(e,i,a){if("constant"!==e.value.kind||"constant"!==i.value.kind)return e;if(void 0===e.value.value||void 0===i.value.value)return new me(this,{kind:"constant",value:void 0},e.parameters);const u=Ms[this.specification.type];return u?new me(this,{kind:"constant",value:u(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,u,f,g){return"constant"===e.kind?e.value:e.evaluate(i,a,u,f,g)}}class Te extends ve{possiblyEvaluate(e,i,a,u){if(void 0===e.value)return new me(this,{kind:"constant",value:void 0},i);if("constant"===e.expression.kind){const f=e.expression.evaluate(i,null,{},a,u),g="resolvedImage"===e.property.specification.type&&"string"!=typeof f?f.name:f,x=this._calculate(g,g,g,i);return new me(this,{kind:"constant",value:x},i)}if("camera"===e.expression.kind){const f=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new me(this,{kind:"constant",value:f},i)}return new me(this,e.expression,i)}evaluate(e,i,a,u,f,g){if("source"===e.kind){const x=e.evaluate(i,a,u,f,g);return this._calculate(x,x,x,i)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},a,u),e.evaluate({zoom:Math.floor(i.zoom)},a,u),e.evaluate({zoom:Math.floor(i.zoom)+1},a,u),i):e.value}_calculate(e,i,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i,other:a}:{from:a,to:i,other:e}}interpolate(e){return e}}class We{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,u){if(void 0!==e.value){if("constant"===e.expression.kind){const f=e.expression.evaluate(i,null,{},a,u);return this._calculate(f,f,f,i)}return this._calculate(e.expression.evaluate(new V(Math.floor(i.zoom-1),i)),e.expression.evaluate(new V(Math.floor(i.zoom),i)),e.expression.evaluate(new V(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:a,to:i}}interpolate(e){return e}}class Ze{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,u){return!!e.expression.evaluate(i,null,{},a,u)}interpolate(){return!1}}class at{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const a=e[i];a.specification.overridable&&this.overridableProperties.push(i);const u=this.defaultPropertyValues[i]=new X(a,void 0),f=this.defaultTransitionablePropertyValues[i]=new re(a);this.defaultTransitioningPropertyValues[i]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=u.possiblyEvaluate({})}}}function nt(n,e){return 256*(n=zt(Math.floor(n),0,255))+zt(Math.floor(e),0,255)}Wt("DataDrivenProperty",ve),Wt("DataConstantProperty",se),Wt("CrossFadedDataDrivenProperty",Te),Wt("CrossFadedProperty",We),Wt("ColorRampProperty",Ze);const It={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qe{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class kt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ge(n,e=1){let i=0,a=0;return{members:n.map(u=>{const f=It[u.type].BYTES_PER_ELEMENT,g=i=Ft(i,Math.max(e,f)),x=u.components||1;return a=Math.max(a,f),i+=f*x,{name:u.name,type:u.type,components:x,offset:g}}),size:Ft(i,Math.max(a,e)),alignment:e}}function Ft(n,e){return Math.ceil(n/e)*e}class Jt extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=a,e}}Jt.prototype.bytesPerElement=4,Wt("StructArrayLayout2i4",Jt);class wn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,u)}emplace(e,i,a,u,f){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=a,this.int16[g+2]=u,this.int16[g+3]=f,e}}wn.prototype.bytesPerElement=8,Wt("StructArrayLayout4i8",wn);class vn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,u,f,g,x)}emplace(e,i,a,u,f,g,x,b){const D=6*e,A=12*e,P=3*e;return this.int16[D+0]=i,this.int16[D+1]=a,this.uint8[A+4]=u,this.uint8[A+5]=f,this.uint8[A+6]=g,this.uint8[A+7]=x,this.float32[P+2]=b,e}}vn.prototype.bytesPerElement=12,Wt("StructArrayLayout2i4ub1f12",vn);class Mn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=a,this.float32[f+2]=u,e}}Mn.prototype.bytesPerElement=12,Wt("StructArrayLayout3f12",Mn);class An extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x,b,D,A){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,a,u,f,g,x,b,D,A)}emplace(e,i,a,u,f,g,x,b,D,A,P){const F=10*e;return this.uint16[F+0]=i,this.uint16[F+1]=a,this.uint16[F+2]=u,this.uint16[F+3]=f,this.uint16[F+4]=g,this.uint16[F+5]=x,this.uint16[F+6]=b,this.uint16[F+7]=D,this.uint16[F+8]=A,this.uint16[F+9]=P,e}}An.prototype.bytesPerElement=20,Wt("StructArrayLayout10ui20",An);class Qt extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x,b){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,a,u,f,g,x,b)}emplace(e,i,a,u,f,g,x,b,D){const A=8*e;return this.uint16[A+0]=i,this.uint16[A+1]=a,this.uint16[A+2]=u,this.uint16[A+3]=f,this.uint16[A+4]=g,this.uint16[A+5]=x,this.uint16[A+6]=b,this.uint16[A+7]=D,e}}Qt.prototype.bytesPerElement=16,Wt("StructArrayLayout8ui16",Qt);class zn extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x,b,D,A,P,F,$,Z,K,ce){const de=this.length;return this.resize(de+1),this.emplace(de,e,i,a,u,f,g,x,b,D,A,P,F,$,Z,K,ce)}emplace(e,i,a,u,f,g,x,b,D,A,P,F,$,Z,K,ce,de){const be=16*e;return this.int16[be+0]=i,this.int16[be+1]=a,this.int16[be+2]=u,this.int16[be+3]=f,this.uint16[be+4]=g,this.uint16[be+5]=x,this.uint16[be+6]=b,this.uint16[be+7]=D,this.int16[be+8]=A,this.int16[be+9]=P,this.int16[be+10]=F,this.int16[be+11]=$,this.int16[be+12]=Z,this.int16[be+13]=K,this.int16[be+14]=ce,this.int16[be+15]=de,e}}zn.prototype.bytesPerElement=32,Wt("StructArrayLayout4i4ui4i4i32",zn);class gr extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}gr.prototype.bytesPerElement=4,Wt("StructArrayLayout1ul4",gr);class ui extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x,b,D,A,P,F,$){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,i,a,u,f,g,x,b,D,A,P,F,$)}emplace(e,i,a,u,f,g,x,b,D,A,P,F,$,Z){const K=20*e,ce=10*e;return this.int16[K+0]=i,this.int16[K+1]=a,this.int16[K+2]=u,this.int16[K+3]=f,this.int16[K+4]=g,this.float32[ce+3]=x,this.float32[ce+4]=b,this.float32[ce+5]=D,this.float32[ce+6]=A,this.int16[K+14]=P,this.uint32[ce+8]=F,this.uint16[K+18]=$,this.uint16[K+19]=Z,e}}ui.prototype.bytesPerElement=40,Wt("StructArrayLayout5i4f1i1ul2ui40",ui);class gi extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,u,f,g,x)}emplace(e,i,a,u,f,g,x,b){const D=8*e;return this.int16[D+0]=i,this.int16[D+1]=a,this.int16[D+2]=u,this.int16[D+4]=f,this.int16[D+5]=g,this.int16[D+6]=x,this.int16[D+7]=b,e}}gi.prototype.bytesPerElement=16,Wt("StructArrayLayout3i2i2i16",gi);class oo extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,u,f)}emplace(e,i,a,u,f,g){const x=4*e,b=8*e;return this.float32[x+0]=i,this.float32[x+1]=a,this.float32[x+2]=u,this.int16[b+6]=f,this.int16[b+7]=g,e}}oo.prototype.bytesPerElement=16,Wt("StructArrayLayout2f1f2i16",oo);class yo extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,u)}emplace(e,i,a,u,f){const g=12*e,x=3*e;return this.uint8[g+0]=i,this.uint8[g+1]=a,this.float32[x+1]=u,this.float32[x+2]=f,e}}yo.prototype.bytesPerElement=12,Wt("StructArrayLayout2ub2f12",yo);class Si extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=a,this.uint16[f+2]=u,e}}Si.prototype.bytesPerElement=6,Wt("StructArrayLayout3ui6",Si);class Wo extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x,b,D,A,P,F,$,Z,K,ce,de,be,Me,Pe,Fe){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,e,i,a,u,f,g,x,b,D,A,P,F,$,Z,K,ce,de,be,Me,Pe,Fe)}emplace(e,i,a,u,f,g,x,b,D,A,P,F,$,Z,K,ce,de,be,Me,Pe,Fe,Ne){const et=30*e,Ke=15*e,Bt=60*e;return this.int16[et+0]=i,this.int16[et+1]=a,this.int16[et+2]=u,this.float32[Ke+2]=f,this.float32[Ke+3]=g,this.uint16[et+8]=x,this.uint16[et+9]=b,this.uint32[Ke+5]=D,this.uint32[Ke+6]=A,this.uint32[Ke+7]=P,this.uint16[et+16]=F,this.uint16[et+17]=$,this.uint16[et+18]=Z,this.float32[Ke+10]=K,this.float32[Ke+11]=ce,this.uint8[Bt+48]=de,this.uint8[Bt+49]=be,this.uint8[Bt+50]=Me,this.uint32[Ke+13]=Pe,this.int16[et+28]=Fe,this.uint8[Bt+58]=Ne,e}}Wo.prototype.bytesPerElement=60,Wt("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Wo);class so extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,g,x,b,D,A,P,F,$,Z,K,ce,de,be,Me,Pe,Fe,Ne,et,Ke,Bt,yt,rt,vt,Dt,ut){const jt=this.length;return this.resize(jt+1),this.emplace(jt,e,i,a,u,f,g,x,b,D,A,P,F,$,Z,K,ce,de,be,Me,Pe,Fe,Ne,et,Ke,Bt,yt,rt,vt,Dt,ut)}emplace(e,i,a,u,f,g,x,b,D,A,P,F,$,Z,K,ce,de,be,Me,Pe,Fe,Ne,et,Ke,Bt,yt,rt,vt,Dt,ut,jt){const Xt=38*e,Bn=19*e;return this.int16[Xt+0]=i,this.int16[Xt+1]=a,this.int16[Xt+2]=u,this.float32[Bn+2]=f,this.float32[Bn+3]=g,this.int16[Xt+8]=x,this.int16[Xt+9]=b,this.int16[Xt+10]=D,this.int16[Xt+11]=A,this.int16[Xt+12]=P,this.int16[Xt+13]=F,this.uint16[Xt+14]=$,this.uint16[Xt+15]=Z,this.uint16[Xt+16]=K,this.uint16[Xt+17]=ce,this.uint16[Xt+18]=de,this.uint16[Xt+19]=be,this.uint16[Xt+20]=Me,this.uint16[Xt+21]=Pe,this.uint16[Xt+22]=Fe,this.uint16[Xt+23]=Ne,this.uint16[Xt+24]=et,this.uint16[Xt+25]=Ke,this.uint16[Xt+26]=Bt,this.uint16[Xt+27]=yt,this.uint16[Xt+28]=rt,this.uint32[Bn+15]=vt,this.float32[Bn+16]=Dt,this.float32[Bn+17]=ut,this.float32[Bn+18]=jt,e}}so.prototype.bytesPerElement=76,Wt("StructArrayLayout3i2f6i15ui1ul3f76",so);class Pr extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Pr.prototype.bytesPerElement=4,Wt("StructArrayLayout1f4",Pr);class Or extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=a,this.int16[f+2]=u,e}}Or.prototype.bytesPerElement=6,Wt("StructArrayLayout3i6",Or);class ir extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,u)}emplace(e,i,a,u,f){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=a,this.uint16[g+3]=u,this.uint16[g+4]=f,e}}ir.prototype.bytesPerElement=12,Wt("StructArrayLayout1ul3ui12",ir);class zr extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=a,e}}zr.prototype.bytesPerElement=4,Wt("StructArrayLayout2ui4",zr);class Ri extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Ri.prototype.bytesPerElement=2,Wt("StructArrayLayout1ui2",Ri);class wr extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=a,e}}wr.prototype.bytesPerElement=8,Wt("StructArrayLayout2f8",wr);class Po extends kt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,u)}emplace(e,i,a,u,f){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=a,this.float32[g+2]=u,this.float32[g+3]=f,e}}Po.prototype.bytesPerElement=16,Wt("StructArrayLayout4f16",Po);class ql extends Qe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ql.prototype.size=40;class ko extends ui{get(e){return new ql(this,e)}}Wt("CollisionBoxArray",ko);class Xo extends Qe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Xo.prototype.size=60;class pl extends Wo{get(e){return new Xo(this,e)}}Wt("PlacedSymbolArray",pl);class bc extends Qe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}bc.prototype.size=76;class Wl extends so{get(e){return new bc(this,e)}}Wt("SymbolInstanceArray",Wl);class Qc extends Pr{getoffsetX(e){return this.float32[1*e+0]}}Wt("GlyphOffsetArray",Qc);class Xl extends Or{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Wt("SymbolLineVertexArray",Xl);class eu extends Qe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}eu.prototype.size=12;class lf extends ir{get(e){return new eu(this,e)}}Wt("FeatureIndexArray",lf);class cf extends Qe{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}cf.prototype.size=4;class uf extends zr{get(e){return new cf(this,e)}}Wt("FillExtrusionCentroidArray",uf);const Vu=Ge([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Fh=Ge([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Yl=Jo(function(n){n.exports=function(e,i){var a,u,f,g,x,b,D,A;for(u=e.length-(a=3&e.length),f=i,x=3432918353,b=461845907,A=0;A<u;)D=255&e.charCodeAt(A)|(255&e.charCodeAt(++A))<<8|(255&e.charCodeAt(++A))<<16|(255&e.charCodeAt(++A))<<24,++A,f=27492+(65535&(g=5*(65535&(f=(f^=D=(65535&(D=(D=(65535&D)*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*b+(((D>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(D=0,a){case 3:D^=(255&e.charCodeAt(A+2))<<16;case 2:D^=(255&e.charCodeAt(A+1))<<8;case 1:f^=D=(65535&(D=(D=(65535&(D^=255&e.charCodeAt(A)))*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*b+(((D>>>16)*b&65535)<<16)&4294967295}return f^=e.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),nm=Jo(function(n){n.exports=function(e,i){for(var a,u=e.length,f=i^u,g=0;u>=4;)a=1540483477*(65535&(a=255&e.charCodeAt(g)|(255&e.charCodeAt(++g))<<8|(255&e.charCodeAt(++g))<<16|(255&e.charCodeAt(++g))<<24))+((1540483477*(a>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++g;switch(u){case 3:f^=(255&e.charCodeAt(g+2))<<16;case 2:f^=(255&e.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&e.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),tu=Yl,o_=nm;tu.murmur3=Yl,tu.murmur2=o_;class Kl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,a,u){this.ids.push(ju(e)),this.positions.push(i,a,u)}getPositions(e){const i=ju(e);let a=0,u=this.ids.length-1;for(;a<u;){const g=a+u>>1;this.ids[g]>=i?u=g:a=g+1}const f=[];for(;this.ids[a]===i;)f.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return f}static serialize(e,i){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return $u(a,u,0,a.length-1),i&&i.push(a.buffer,u.buffer),{ids:a,positions:u}}static deserialize(e){const i=new Kl;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function ju(n){const e=+n;return!isNaN(e)&&e<=mt?e:tu(String(n))}function $u(n,e,i,a){for(;i<a;){const u=n[i+a>>1];let f=i-1,g=a+1;for(;;){do{f++}while(n[f]<u);do{g--}while(n[g]>u);if(f>=g)break;nu(n,f,g),nu(e,3*f,3*g),nu(e,3*f+1,3*g+1),nu(e,3*f+2,3*g+2)}g-i<a-g?($u(n,e,i,g),i=g+1):($u(n,e,g+1,a),a=g)}}function nu(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}Wt("FeaturePositionMap",Kl);class ba{constructor(e,i){this.gl=e.gl,this.location=i}}class ru extends ba{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class hf extends ba{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class df extends ba{constructor(e,i){super(e,i),this.current=In.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const rm=new Float32Array(16),im=new Float32Array(9),om=new Float32Array(4);function wa(n){return[nt(255*n.r,255*n.g),nt(255*n.b,255*n.a)]}class Va{constructor(e,i,a){this.value=e,this.uniformNames=i.map(u=>`u_${u}`),this.type=a}setUniform(e,i,a){e.set(a.constantOr(this.value))}getBinding(e,i,a){return"color"===this.type?new df(e,i):new ru(e,i)}}class wc{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tl.concat(i.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,i,a,u){const f="u_pattern_to"===u||"u_dash_to"===u?this.patternTo:"u_pattern_from"===u||"u_dash_from"===u?this.patternFrom:"u_pixel_ratio_to"===u?this.pixelRatioTo:"u_pixel_ratio_from"===u?this.pixelRatioFrom:null;f&&e.set(f)}getBinding(e,i,a){return"u_pattern_from"===a||"u_pattern_to"===a||"u_dash_from"===a||"u_dash_to"===a?new hf(e,i):new ru(e,i)}}class ml{constructor(e,i,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===a?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,a,u,f,g){const x=this.paintVertexArray.length,b=this.expression.evaluate(new V(0),i,{},f,u,g);this.paintVertexArray.resize(e),this._setPaintValue(x,e,b)}updatePaintArray(e,i,a,u,f){const g=this.expression.evaluate({zoom:0},a,u,void 0,f);this._setPaintValue(e,i,g)}_setPaintValue(e,i,a){if("color"===this.type){const u=wa(a);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ea{constructor(e,i,a,u,f,g){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===a?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,a,u,f,g){const x=this.expression.evaluate(new V(this.zoom),i,{},f,u,g),b=this.expression.evaluate(new V(this.zoom+1),i,{},f,u,g),D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,x,b)}updatePaintArray(e,i,a,u,f){const g=this.expression.evaluate({zoom:this.zoom},a,u,void 0,f),x=this.expression.evaluate({zoom:this.zoom+1},a,u,void 0,f);this._setPaintValue(e,i,g,x)}_setPaintValue(e,i,a,u){if("color"===this.type){const f=wa(a),g=wa(u);for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,f[0],f[1],g[0],g[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const a=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,u=zt(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,i,a){return new ru(e,i)}}class Jl{constructor(e,i,a,u,f,g,x){this.expression=e,this.type=a,this.useIntegerZoom=u,this.zoom=f,this.layerId=x,this.paintVertexAttributes=("array"===a?Fh:Vu).members;for(let b=0;b<i.length;++b);this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(e,i,a){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,u,f,g){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(e,i,a,u){if(!u||!a)return;const{min:f,mid:g,max:x}=a,b=u[f],D=u[g],A=u[x];if(b&&D&&A)for(let P=e;P<i;P++)this._setPaintValue(this.zoomInPaintVertexArray,P,D,b),this._setPaintValue(this.zoomOutPaintVertexArray,P,D,A)}_setPaintValue(e,i,a,u){e.emplace(i,a.tl[0],a.tl[1],a.br[0],a.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],a.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class gl{constructor(e,i,a=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!a(f))continue;const g=e.paint.get(f);if(!(g instanceof me&&Uo(g.property.specification)))continue;const x=sm(f,e.type),b=g.value,D=g.property.specification.type,A=g.property.useIntegerZoom,P=g.property.specification["property-type"],F="cross-faded"===P||"cross-faded-data-driven"===P,$="line-dasharray"===String(f)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==b.kind||$)if("source"===b.kind||$||F){const Z=pf(f,D,"source");this.binders[f]=F?new Jl(b,x,D,A,i,Z,e.id):new ml(b,x,D,Z),u.push(`/a_${f}`)}else{const Z=pf(f,D,"composite");this.binders[f]=new Ea(b,x,D,A,i,Z),u.push(`/z_${f}`)}else this.binders[f]=F?new wc(b.value,x):new Va(b.value,x,D),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof ml||i instanceof Ea?i.maxValue:0}populatePaintArrays(e,i,a,u,f,g){for(const x in this.binders){const b=this.binders[x];(b instanceof ml||b instanceof Ea||b instanceof Jl)&&b.populatePaintArray(e,i,a,u,f,g)}}setConstantPatternPositions(e,i){for(const a in this.binders){const u=this.binders[a];u instanceof wc&&u.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,a,u,f,g){let x=!1;for(const b in e){const D=i.getPositions(b);for(const A of D){const P=a.feature(A.index);for(const F in this.binders){const $=this.binders[F];if(($ instanceof ml||$ instanceof Ea||$ instanceof Jl)&&!0===$.expression.isStateDependent){const Z=u.paint.get(F);$.expression=Z.value,$.updatePaintArray(A.start,A.end,P,e[b],f,g),x=!0}}}}return x}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Va||a instanceof wc)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof ml||a instanceof Ea||a instanceof Jl)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Va||a instanceof wc||a instanceof Ea)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const a=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Va||f instanceof wc||f instanceof Ea)for(const g of f.uniformNames)if(i[g]){const x=f.getBinding(e,i[g],g);a.push({name:g,property:u,binding:x})}}return a}setUniforms(e,i,a,u){for(const{name:f,property:g,binding:x}of i)this.binders[g].setUniform(x,u,a.get(g),f)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const a=this.binders[i];if(e&&a instanceof Jl){const u=2===e.fromScale?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(a instanceof ml||a instanceof Ea)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof ml||a instanceof Ea||a instanceof Jl)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof ml||i instanceof Ea||i instanceof Jl)&&i.destroy()}}}class Ec{constructor(e,i,a=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new gl(u,i,a);this.needsUpload=!1,this._featureMap=new Kl,this._bufferOffset=0}populatePaintArrays(e,i,a,u,f,g,x){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,i,u,f,g,x);void 0!==i.id&&this._featureMap.add(i.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,u,f){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,i,g,u,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ff={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function sm(n,e){return ff[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const am={"line-pattern":{source:An,composite:An},"fill-pattern":{source:An,composite:An},"fill-extrusion-pattern":{source:An,composite:An},"line-dasharray":{source:Qt,composite:Qt}},lm={color:{source:wr,composite:Po},number:{source:Pr,composite:wr}};function pf(n,e,i){const a=am[n];return a&&a[i]||lm[e][i]}Wt("ConstantBinder",Va),Wt("CrossFadedConstantBinder",wc),Wt("SourceExpressionBinder",ml),Wt("CrossFadedCompositeBinder",Jl),Wt("CompositeExpressionBinder",Ea),Wt("ProgramConfiguration",gl,{omit:["_buffers"]}),Wt("ProgramConfigurationSet",Ec);const Oh="-transition";class Qs extends St{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new ie(i.layout)),i.paint)){this._transitionablePaint=new le(i.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ge(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,a={}){null!=i&&this._validate(ya,`layers.${this.id}.layout.${e}`,e,i,a)||("visibility"!==e?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return Pt(e,Oh)?this._transitionablePaint.getTransition(e.slice(0,-Oh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,a={}){if(null!=i&&this._validate(_a,`layers.${this.id}.paint.${e}`,e,i,a))return!1;if(Pt(e,Oh))return this._transitionablePaint.setTransition(e.slice(0,-Oh.length),i||void 0),!1;{const u=this._transitionablePaint._values[e],f="cross-faded-data-driven"===u.property.specification["property-type"],g=u.value.isDataDriven(),x=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||g||f||this._handleOverridablePaintPropertyUpdate(e,x,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Tt(e,(i,a)=>!(void 0===i||"layout"===a&&!Object.keys(i).length||"paint"===a&&!Object.keys(i).length))}_validate(e,i,a,u,f={}){return(!f||!1!==f.validate)&&Yc(this,e.call(Ao,{key:i,layerType:this.type,objectKey:a,value:u,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof me&&Uo(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Io(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Gu=Ge([{name:"a_pos",components:2,type:"Int16"}],4),{members:mf}=Gu;class Hr{constructor(e=[]){this.segments=e}prepareSegment(e,i,a,u){let f=this.segments[this.segments.length-1];return e>Hr.MAX_VERTEX_ARRAY_LENGTH&&nn(`Max vertices per segment is ${Hr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>Hr.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:i.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},void 0!==u&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,u){return new Hr([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}Hr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Wt("SegmentVector",Hr);var Kn=8192;class _l{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof vr?new vr(e.lng,e.lat):vr.convert(e),this}setSouthWest(e){return this._sw=e instanceof vr?new vr(e.lng,e.lat):vr.convert(e),this}extend(e){const i=this._sw,a=this._ne;let u,f;if(e instanceof vr)u=e,f=e;else{if(!(e instanceof _l))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(_l.convert(e)):this.extend(vr.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return i||a?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),a.lng=Math.max(f.lng,a.lng),a.lat=Math.max(f.lat,a.lat)):(this._sw=new vr(u.lng,u.lat),this._ne=new vr(f.lng,f.lat)),this}getCenter(){return new vr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new vr(this.getWest(),this.getNorth())}getSouthEast(){return new vr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=vr.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return!e||e instanceof _l?e:new _l(e)}}const zh=6371008.8;class vr{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new vr(gt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,u=e.lat*i,f=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return zh*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new _l(new vr(this.lng-a,this.lat-i),new vr(this.lng+a,this.lat+i))}static convert(e){if(e instanceof vr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new vr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new vr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const cm=2*Math.PI*zh;function um(n){return cm*Math.cos(n*Math.PI/180)}function gf(n){return(180+n)/360}function iu(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function ou(n,e){return n/um(e)}function ja(n){return 360*n-180}function $a(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function _f(n,e){return n*um($a(e))}const Ga=85.051129;class Hu{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=vr.convert(e);return new Hu(gf(a.lng),iu(a.lat),ou(i,a.lat))}toLngLat(){return new vr(ja(this.x),$a(this.y))}toAltitude(){return _f(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/cm*(e=$a(this.y),1/Math.cos(e*Math.PI/180));var e}}function Bh(n,e,i,a,u,f,g,x,b){const D=(e+a)/2,A=(i+u)/2,P=new je(D,A);x(P),function(F,$,Z,K,ce,de){const be=Z-ce,Me=K-de;return Math.abs((K-$)*be-(Z-F)*Me)/Math.hypot(be,Me)}(P.x,P.y,f.x,f.y,g.x,g.y)>=b?(Bh(n,e,i,D,A,f,P,x,b),Bh(n,D,A,a,u,P,g,x,b)):n.push(g)}function hm(n,e,i){const a=[];let u,f,g;for(const x of n){const{x:b,y:D}=x;e(x),g?Bh(a,u,f,b,D,g,x,e,i):a.push(x),u=b,f=D,g=x}return a}const Nh=Math.pow(2,14)-1,Uh=-Nh-1;function Zu(n,e){const i=Math.round(n.x*e),a=Math.round(n.y*e);return n.x=zt(i,Uh,Nh),n.y=zt(a,Uh,Nh),(i<n.x||i>n.x+1||a<n.y||a>n.y+1)&&nn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Ha(n,e,i){const a=n.loadGeometry(),u=n.extent,f=Kn/u;if(e&&i&&"mercator"!==i.projection.name){const g=1<<e.z,{scale:x,x:b,y:D,projection:A}=i,P=F=>{const $=ja((e.x+F.x/u)/g),Z=$a((e.y+F.y/u)/g),K=A.project($,Z);F.x=(K.x*x-b)*u,F.y=(K.y*x-D)*u};for(let F=0;F<a.length;F++)if(1!==n.type)a[F]=hm(a[F],P,1);else{const $=[];for(const Z of a[F])Z.x<0||Z.x>=u||Z.y<0||Z.y>=u||(P(Z),$.push(Z));a[F]=$}}for(const g of a)for(const x of g)Zu(x,f);return a}function Za(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Ha(n):[]}}function qu(n,e,i,a,u){n.emplaceBack(2*e+(a+1)/2,2*i+(u+1)/2)}class Ii{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Jt,this.indexArray=new Si,this.segments=new Hr,this.programConfigurations=new Ec(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a,u){const f=this.layers[0],g=[];let x=null;"circle"===f.type&&(x=f.layout.get("circle-sort-key"));for(const{feature:b,id:D,index:A,sourceLayerIndex:P}of e){const F=this.layers[0]._featureFilter.needGeometry,$=Za(b,F);if(!this.layers[0]._featureFilter.filter(new V(this.zoom),$,a))continue;const Z=x?x.evaluate($,{},a):void 0,K={id:D,properties:b.properties,type:b.type,sourceLayerIndex:P,index:A,geometry:F?$.geometry:Ha(b,a,u),patterns:{},sortKey:Z};g.push(K)}x&&g.sort((b,D)=>b.sortKey-D.sortKey);for(const b of g){const{geometry:D,index:A,sourceLayerIndex:P}=b,F=e[A].feature;this.addFeature(b,D,A,i.availableImages,a),i.featureIndex.insert(F,D,A,P,this.index)}}update(e,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,u,f){for(const g of i)for(const x of g){const b=x.x,D=x.y;if(b<0||b>=Kn||D<0||D>=Kn)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=A.vertexLength;qu(this.layoutVertexArray,b,D,-1,-1),qu(this.layoutVertexArray,b,D,1,-1),qu(this.layoutVertexArray,b,D,1,1),qu(this.layoutVertexArray,b,D,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,f)}}function yf(n,e){for(let i=0;i<n.length;i++)if(su(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(su(n,e[i]))return!0;return!!Vh(n,e)}function dm(n,e,i){return!!su(n,e)||!!jh(e,n,i)}function Wu(n,e){if(1===n.length)return bf(e,n[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let u=0;u<a.length;u++)if(su(n,a[u]))return!0}for(let i=0;i<n.length;i++)if(bf(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Vh(n,e[i]))return!0;return!1}function vf(n,e,i){if(n.length>1){if(Vh(n,e))return!0;for(let a=0;a<e.length;a++)if(jh(e[a],n,i))return!0}for(let a=0;a<n.length;a++)if(jh(n[a],e,i))return!0;return!1}function Vh(n,e){if(0===n.length||0===e.length)return!1;for(let i=0;i<n.length-1;i++){const a=n[i],u=n[i+1];for(let f=0;f<e.length-1;f++)if(fm(a,u,e[f],e[f+1]))return!0}return!1}function fm(n,e,i,a){return Wn(n,i,a)!==Wn(e,i,a)&&Wn(n,e,i)!==Wn(n,e,a)}function jh(n,e,i){const a=i*i;if(1===e.length)return n.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(xf(n,e[u-1],e[u])<a)return!0;return!1}function xf(n,e,i){const a=e.distSqr(i);if(0===a)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/a;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function bf(n,e){let i,a,u,f=!1;for(let g=0;g<n.length;g++){i=n[g];for(let x=0,b=i.length-1;x<i.length;b=x++)a=i[x],u=i[b],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(f=!f)}return f}function su(n,e){let i=!1;for(let a=0,u=n.length-1;a<n.length;u=a++){const f=n[a],g=n[u];f.y>e.y!=g.y>e.y&&e.x<(g.x-f.x)*(e.y-f.y)/(g.y-f.y)+f.x&&(i=!i)}return i}function pm(n,e,i,a,u){for(const g of n)if(e<=g.x&&i<=g.y&&a>=g.x&&u>=g.y)return!0;const f=[new je(e,i),new je(e,u),new je(a,u),new je(a,i)];if(n.length>2)for(const g of f)if(su(n,g))return!0;for(let g=0;g<n.length-1;g++)if(au(n[g],n[g+1],f))return!0;return!1}function au(n,e,i){const a=i[0],u=i[2];if(n.x<a.x&&e.x<a.x||n.x>u.x&&e.x>u.x||n.y<a.y&&e.y<a.y||n.y>u.y&&e.y>u.y)return!1;const f=Wn(n,e,i[0]);return f!==Wn(n,e,i[1])||f!==Wn(n,e,i[2])||f!==Wn(n,e,i[3])}function Gi(n,e,i){const a=e.paint.get(n).value;return"constant"===a.kind?a.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Dc(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function $h(n,e,i,a,u){if(!e[0]&&!e[1])return n;const f=je.convert(e)._mult(u);"viewport"===i&&f._rotate(-a);const g=[];for(let x=0;x<n.length;x++)g.push(n[x].sub(f));return g}function Gh(n,e,i,a){const u=je.convert(n)._mult(a);return"viewport"===e&&u._rotate(-i),u}Wt("CircleBucket",Ii,{omit:["layers"]});const Ro=new at({"circle-sort-key":new ve(we.layout_circle["circle-sort-key"])});var lu={paint:new at({"circle-radius":new ve(we.paint_circle["circle-radius"]),"circle-color":new ve(we.paint_circle["circle-color"]),"circle-blur":new ve(we.paint_circle["circle-blur"]),"circle-opacity":new ve(we.paint_circle["circle-opacity"]),"circle-translate":new se(we.paint_circle["circle-translate"]),"circle-translate-anchor":new se(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new se(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new se(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ve(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ve(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ve(we.paint_circle["circle-stroke-opacity"])}),layout:Ro},ao="undefined"!=typeof Float32Array?Float32Array:Array;function wf(){var n=new ao(9);return ao!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Hh(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Zh(n,e,i){var a=e[0],u=e[1],f=e[2],g=e[3],x=e[4],b=e[5],D=e[6],A=e[7],P=e[8],F=e[9],$=e[10],Z=e[11],K=e[12],ce=e[13],de=e[14],be=e[15],Me=i[0],Pe=i[1],Fe=i[2],Ne=i[3];return n[0]=Me*a+Pe*x+Fe*P+Ne*K,n[1]=Me*u+Pe*b+Fe*F+Ne*ce,n[2]=Me*f+Pe*D+Fe*$+Ne*de,n[3]=Me*g+Pe*A+Fe*Z+Ne*be,n[4]=(Me=i[4])*a+(Pe=i[5])*x+(Fe=i[6])*P+(Ne=i[7])*K,n[5]=Me*u+Pe*b+Fe*F+Ne*ce,n[6]=Me*f+Pe*D+Fe*$+Ne*de,n[7]=Me*g+Pe*A+Fe*Z+Ne*be,n[8]=(Me=i[8])*a+(Pe=i[9])*x+(Fe=i[10])*P+(Ne=i[11])*K,n[9]=Me*u+Pe*b+Fe*F+Ne*ce,n[10]=Me*f+Pe*D+Fe*$+Ne*de,n[11]=Me*g+Pe*A+Fe*Z+Ne*be,n[12]=(Me=i[12])*a+(Pe=i[13])*x+(Fe=i[14])*P+(Ne=i[15])*K,n[13]=Me*u+Pe*b+Fe*F+Ne*ce,n[14]=Me*f+Pe*D+Fe*$+Ne*de,n[15]=Me*g+Pe*A+Fe*Z+Ne*be,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var mm=Zh;function cu(){var n=new ao(3);return ao!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Ef(n){return Math.hypot(n[0],n[1],n[2])}function Ql(n,e,i){var a=new ao(3);return a[0]=n,a[1]=e,a[2]=i,a}function Df(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function Cf(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function Tf(n,e,i,a){return n[0]=e[0]+i[0]*a,n[1]=e[1]+i[1]*a,n[2]=e[2]+i[2]*a,n}function Xu(n,e){var i=e[0],a=e[1],u=e[2],f=i*i+a*a+u*u;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n}function Sf(n,e,i){var a=i[0],u=i[1],f=i[2],g=e[0],x=e[1],b=e[2],D=u*b-f*x,A=f*g-a*b,P=a*x-u*g,F=u*P-f*A,$=f*D-a*P,Z=a*A-u*D,K=2*i[3];return A*=K,P*=K,$*=2,Z*=2,n[0]=g+(D*=K)+(F*=2),n[1]=x+A+$,n[2]=b+P+Z,n}var uu,n,s_=Df,qh=Cf,gm=Ef;function hu(n,e,i){var a=e[0],u=e[1],f=e[2],g=e[3];return n[0]=i[0]*a+i[4]*u+i[8]*f+i[12]*g,n[1]=i[1]*a+i[5]*u+i[9]*f+i[13]*g,n[2]=i[2]*a+i[6]*u+i[10]*f+i[14]*g,n[3]=i[3]*a+i[7]*u+i[11]*f+i[15]*g,n}function ec(){var n=new ao(4);return ao!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function If(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Mf(n,e,i){i*=.5;var a=e[0],u=e[1],f=e[2],g=e[3],x=Math.sin(i),b=Math.cos(i);return n[0]=a*b+g*x,n[1]=u*b+f*x,n[2]=f*b-u*x,n[3]=g*b-a*x,n}function Af(n,e){return n[0]===e[0]&&n[1]===e[1]}function Pf(n,e,i,a,u,f,g,x,b){if(f&&n.queryGeometry.isAboveHorizon)return!1;f&&(b*=n.pixelToTileUnitsFactor);for(const D of e)for(const A of D){const P=A.add(x),F=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(P.x,P.y,!0):0,$=f?P:_m(P,F,a),Z=f?n.tilespaceRays.map(ce=>vm(ce,F)):n.queryGeometry.screenGeometry,K=hu([],[A.x,A.y,F,1],a);if(!g&&f?b*=K[3]/i.cameraToCenterDistance:g&&!f&&(b*=i.cameraToCenterDistance/K[3]),dm(Z,$,b))return!0}return!1}function _m(n,e,i){const a=hu([],[n.x,n.y,e,1],i);return new je(a[0]/a[3],a[1]/a[3])}cu(),uu=new ao(4),ao!=Float32Array&&(uu[0]=0,uu[1]=0,uu[2]=0,uu[3]=0),cu(),Ql(1,0,0),Ql(0,1,0),ec(),ec(),wf(),n=new ao(2),ao!=Float32Array&&(n[0]=0,n[1]=0);const Wh=Ql(0,0,0),ym=Ql(0,0,1);function vm(n,e){const i=cu();return Wh[2]=e,n.intersectsPlane(Wh,ym,i),new je(i[0],i[1])}class kf extends Ii{}function Xh(n,{width:e,height:i},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*a);return n.width=e,n.height=i,n.data=u,n}function Yh(n,{width:e,height:i},a){if(e===n.width&&i===n.height)return;const u=Xh({},{width:e,height:i},a);Kh(n,u,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,i)},a),n.width=e,n.height=i,n.data=u.data}function Kh(n,e,i,a,u,f){if(0===u.width||0===u.height)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,x=e.data;for(let b=0;b<u.height;b++){const D=((i.y+b)*n.width+i.x)*f,A=((a.y+b)*e.width+a.x)*f;for(let P=0;P<u.width*f;P++)x[A+P]=g[D+P]}return e}Wt("HeatmapBucket",kf,{omit:["layers"]});class yl{constructor(e,i){Xh(this,e,1,i)}resize(e){Yh(this,e,1)}clone(){return new yl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,u,f){Kh(e,i,a,u,f,1)}}class ws{constructor(e,i){Xh(this,e,4,i)}resize(e){Yh(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ws({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,u,f){Kh(e,i,a,u,f,4)}}Wt("AlphaImage",yl),Wt("RGBAImage",ws);var Cc={paint:new at({"heatmap-radius":new ve(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ve(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new se(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ze(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new se(we.paint_heatmap["heatmap-opacity"])})};function Os(n){const e={},i=n.resolution||256,a=n.clips?n.clips.length:1,u=n.image||new ws({width:i,height:a}),f=(g,x,b)=>{e[n.evaluationKey]=b;const D=n.expression.evaluate(e);u.data[g+x+0]=Math.floor(255*D.r/D.a),u.data[g+x+1]=Math.floor(255*D.g/D.a),u.data[g+x+2]=Math.floor(255*D.b/D.a),u.data[g+x+3]=Math.floor(255*D.a)};if(n.clips)for(let g=0,x=0;g<a;++g,x+=4*i)for(let b=0,D=0;b<i;b++,D+=4){const A=b/(i-1),{start:P,end:F}=n.clips[g];f(x,D,P*(1-A)+F*A)}else for(let g=0,x=0;g<i;g++,x+=4)f(0,x,g/(i-1));return u}var a_={paint:new at({"hillshade-illumination-direction":new se(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new se(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new se(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new se(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new se(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new se(we.paint_hillshade["hillshade-accent-color"])})};const l_=Ge([{name:"a_pos",components:2,type:"Int16"}],4),{members:Rf}=l_;var Jh=Tc,Da=Tc;function Tc(n,e,i){i=i||2;var a,u,f,g,x,b,D,A=e&&e.length,P=A?e[0]*i:n.length,F=Yu(n,0,P,i,!0),$=[];if(!F||F.next===F.prev)return $;if(A&&(F=function(K,ce,de,be){var Me,Pe,Fe,Ne=[];for(Me=0,Pe=ce.length;Me<Pe;Me++)(Fe=Yu(K,ce[Me]*be,Me<Pe-1?ce[Me+1]*be:K.length,be,!1))===Fe.next&&(Fe.steiner=!0),Ne.push(td(Fe));for(Ne.sort(ed),Me=0;Me<Ne.length;Me++)de=vl(de=Of(Ne[Me],de),de.next);return de}(n,e,F,i)),n.length>80*i){a=f=n[0],u=g=n[1];for(var Z=i;Z<P;Z+=i)(x=n[Z])<a&&(a=x),(b=n[Z+1])<u&&(u=b),x>f&&(f=x),b>g&&(g=b);D=0!==(D=Math.max(f-a,g-u))?1/D:0}return Sc(F,$,i,a,u,D),$}function Yu(n,e,i,a,u){var f,g;if(u===pu(n,e,i,a)>0)for(f=e;f<i;f+=a)g=nd(f,n[f],n[f+1],g);else for(f=i-a;f>=e;f-=a)g=nd(f,n[f],n[f+1],g);return g&&Ku(g,g.next)&&(nc(g),g=g.next),g}function vl(n,e){if(!n)return n;e||(e=n);var i,a=n;do{if(i=!1,a.steiner||!Ku(a,a.next)&&0!==ii(a.prev,a,a.next))a=a.next;else{if(nc(a),(a=e=a.prev)===a.next)break;i=!0}}while(i||a!==e);return e}function Sc(n,e,i,a,u,f,g){if(n){!g&&f&&function(A,P,F,$){var Z=A;do{null===Z.z&&(Z.z=xl(Z.x,Z.y,P,F,$)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next}while(Z!==A);Z.prevZ.nextZ=null,Z.prevZ=null,function(K){var ce,de,be,Me,Pe,Fe,Ne,et,Ke=1;do{for(de=K,K=null,Pe=null,Fe=0;de;){for(Fe++,be=de,Ne=0,ce=0;ce<Ke&&(Ne++,be=be.nextZ);ce++);for(et=Ke;Ne>0||et>0&&be;)0!==Ne&&(0===et||!be||de.z<=be.z)?(Me=de,de=de.nextZ,Ne--):(Me=be,be=be.nextZ,et--),Pe?Pe.nextZ=Me:K=Me,Me.prevZ=Pe,Pe=Me;de=be}Pe.nextZ=null,Ke*=2}while(Fe>1)}(Z)}(n,a,u,f);for(var x,b,D=n;n.prev!==n.next;)if(x=n.prev,b=n.next,f?Lf(n,a,u,f):du(n))e.push(x.i/i),e.push(n.i/i),e.push(b.i/i),nc(n),n=b.next,D=b.next;else if((n=b)===D){g?1===g?Sc(n=Ff(vl(n),e,i),e,i,a,u,f,2):2===g&&Qh(n,e,i,a,u,f):Sc(vl(n),e,i,a,u,f,1);break}}}function du(n){var e=n.prev,i=n,a=n.next;if(ii(e,i,a)>=0)return!1;for(var u=n.next.next;u!==n.prev;){if(tc(e.x,e.y,i.x,i.y,a.x,a.y,u.x,u.y)&&ii(u.prev,u,u.next)>=0)return!1;u=u.next}return!0}function Lf(n,e,i,a){var u=n.prev,f=n,g=n.next;if(ii(u,f,g)>=0)return!1;for(var x=u.x>f.x?u.x>g.x?u.x:g.x:f.x>g.x?f.x:g.x,b=u.y>f.y?u.y>g.y?u.y:g.y:f.y>g.y?f.y:g.y,D=xl(u.x<f.x?u.x<g.x?u.x:g.x:f.x<g.x?f.x:g.x,u.y<f.y?u.y<g.y?u.y:g.y:f.y<g.y?f.y:g.y,e,i,a),A=xl(x,b,e,i,a),P=n.prevZ,F=n.nextZ;P&&P.z>=D&&F&&F.z<=A;){if(P!==n.prev&&P!==n.next&&tc(u.x,u.y,f.x,f.y,g.x,g.y,P.x,P.y)&&ii(P.prev,P,P.next)>=0||(P=P.prevZ,F!==n.prev&&F!==n.next&&tc(u.x,u.y,f.x,f.y,g.x,g.y,F.x,F.y)&&ii(F.prev,F,F.next)>=0))return!1;F=F.nextZ}for(;P&&P.z>=D;){if(P!==n.prev&&P!==n.next&&tc(u.x,u.y,f.x,f.y,g.x,g.y,P.x,P.y)&&ii(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;F&&F.z<=A;){if(F!==n.prev&&F!==n.next&&tc(u.x,u.y,f.x,f.y,g.x,g.y,F.x,F.y)&&ii(F.prev,F,F.next)>=0)return!1;F=F.nextZ}return!0}function Ff(n,e,i){var a=n;do{var u=a.prev,f=a.next.next;!Ku(u,f)&&zf(u,a,a.next,f)&&fu(u,f)&&fu(f,u)&&(e.push(u.i/i),e.push(a.i/i),e.push(f.i/i),nc(a),nc(a.next),a=n=f),a=a.next}while(a!==n);return vl(a)}function Qh(n,e,i,a,u,f){var g=n;do{for(var x=g.next.next;x!==g.prev;){if(g.i!==x.i&&xm(g,x)){var b=Bf(g,x);return g=vl(g,g.next),b=vl(b,b.next),Sc(g,e,i,a,u,f),void Sc(b,e,i,a,u,f)}x=x.next}g=g.next}while(g!==n)}function ed(n,e){return n.x-e.x}function Of(n,e){var i=function(f,g){var x,b=g,D=f.x,A=f.y,P=-1/0;do{if(A<=b.y&&A>=b.next.y&&b.next.y!==b.y){var F=b.x+(A-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(F<=D&&F>P){if(P=F,F===D){if(A===b.y)return b;if(A===b.next.y)return b.next}x=b.x<b.next.x?b:b.next}}b=b.next}while(b!==g);if(!x)return null;if(D===P)return x;var $,Z=x,K=x.x,ce=x.y,de=1/0;b=x;do{D>=b.x&&b.x>=K&&D!==b.x&&tc(A<ce?D:P,A,K,ce,A<ce?P:D,A,b.x,b.y)&&($=Math.abs(A-b.y)/(D-b.x),fu(b,f)&&($<de||$===de&&(b.x>x.x||b.x===x.x&&c_(x,b)))&&(x=b,de=$)),b=b.next}while(b!==Z);return x}(n,e);if(!i)return e;var a=Bf(i,n),u=vl(i,i.next);return vl(a,a.next),e===i?u:e}function c_(n,e){return ii(n.prev,n,e.prev)<0&&ii(e.next,n,n.next)<0}function xl(n,e,i,a,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-i)*u)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)*u)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function td(n){var e=n,i=n;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==n);return i}function tc(n,e,i,a,u,f,g,x){return(u-g)*(e-x)-(n-g)*(f-x)>=0&&(n-g)*(a-x)-(i-g)*(e-x)>=0&&(i-g)*(f-x)-(u-g)*(a-x)>=0}function xm(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,a){var u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==a.i&&u.next.i!==a.i&&zf(u,u.next,i,a))return!0;u=u.next}while(u!==i);return!1}(n,e)&&(fu(n,e)&&fu(e,n)&&function(i,a){var u=i,f=!1,g=(i.x+a.x)/2,x=(i.y+a.y)/2;do{u.y>x!=u.next.y>x&&u.next.y!==u.y&&g<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next}while(u!==i);return f}(n,e)&&(ii(n.prev,n,e.prev)||ii(n,e.prev,e))||Ku(n,e)&&ii(n.prev,n,n.next)>0&&ii(e.prev,e,e.next)>0)}function ii(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Ku(n,e){return n.x===e.x&&n.y===e.y}function zf(n,e,i,a){var u=Qu(ii(n,e,i)),f=Qu(ii(n,e,a)),g=Qu(ii(i,a,n)),x=Qu(ii(i,a,e));return u!==f&&g!==x||!(0!==u||!Ju(n,i,e))||!(0!==f||!Ju(n,a,e))||!(0!==g||!Ju(i,n,a))||!(0!==x||!Ju(i,e,a))}function Ju(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Qu(n){return n>0?1:n<0?-1:0}function fu(n,e){return ii(n.prev,n,n.next)<0?ii(n,e,n.next)>=0&&ii(n,n.prev,e)>=0:ii(n,e,n.prev)<0||ii(n,n.next,e)<0}function Bf(n,e){var i=new eh(n.i,n.x,n.y),a=new eh(e.i,e.x,e.y),u=n.next,f=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,a.next=i,i.prev=a,f.next=a,a.prev=f,a}function nd(n,e,i,a){var u=new eh(n,e,i);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function nc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function eh(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function pu(n,e,i,a){for(var u=0,f=e,g=i-a;f<i;f+=a)u+=(n[g]-n[f])*(n[f+1]+n[g+1]),g=f;return u}function bm(n,e,i,a,u){Nf(n,e,i||0,a||n.length-1,u||Uf)}function Nf(n,e,i,a,u){for(;a>i;){if(a-i>600){var f=a-i+1,g=e-i+1,x=Math.log(f),b=.5*Math.exp(2*x/3),D=.5*Math.sqrt(x*b*(f-b)/f)*(g-f/2<0?-1:1);Nf(n,e,Math.max(i,Math.floor(e-g*b/f+D)),Math.min(a,Math.floor(e+(f-g)*b/f+D)),u)}var A=n[e],P=i,F=a;for(Ic(n,i,e),u(n[a],A)>0&&Ic(n,i,a);P<F;){for(Ic(n,P,F),P++,F--;u(n[P],A)<0;)P++;for(;u(n[F],A)>0;)F--}0===u(n[i],A)?Ic(n,i,F):Ic(n,++F,a),F<=e&&(i=F+1),e<=F&&(a=F-1)}}function Ic(n,e,i){var a=n[e];n[e]=n[i],n[i]=a}function Uf(n,e){return n<e?-1:n>e?1:0}function qa(n,e){const i=n.length;if(i<=1)return[n];const a=[];let u,f;for(let g=0;g<i;g++){const x=zi(n[g]);0!==x&&(n[g].area=Math.abs(x),void 0===f&&(f=x<0),f===x<0?(u&&a.push(u),u=[n[g]]):u.push(n[g]))}if(u&&a.push(u),e>1)for(let g=0;g<a.length;g++)a[g].length<=e||(bm(a[g],e,1,a[g].length-1,Vf),a[g]=a[g].slice(0,e));return a}function Vf(n,e){return e.area-n.area}function th(n,e,i){const a=i.patternDependencies;let u=!1;for(const f of e){const g=f.paint.get(`${n}-pattern`);g.isConstant()||(u=!0);const x=g.constantOr(null);x&&(u=!0,a[x.to]=!0,a[x.from]=!0)}return u}function rd(n,e,i,a,u){const f=u.patternDependencies;for(const g of e){const x=g.paint.get(`${n}-pattern`).value;if("constant"!==x.kind){let b=x.evaluate({zoom:a-1},i,{},u.availableImages),D=x.evaluate({zoom:a},i,{},u.availableImages),A=x.evaluate({zoom:a+1},i,{},u.availableImages);b=b&&b.name?b.name:b,D=D&&D.name?D.name:D,A=A&&A.name?A.name:A,f[b]=!0,f[D]=!0,f[A]=!0,i.patterns[g.id]={min:b,mid:D,max:A}}}return i}Tc.deviation=function(n,e,i,a){var u=e&&e.length,f=Math.abs(pu(n,0,u?e[0]*i:n.length,i));if(u)for(var g=0,x=e.length;g<x;g++)f-=Math.abs(pu(n,e[g]*i,g<x-1?e[g+1]*i:n.length,i));var b=0;for(g=0;g<a.length;g+=3){var D=a[g]*i,A=a[g+1]*i,P=a[g+2]*i;b+=Math.abs((n[D]-n[P])*(n[A+1]-n[D+1])-(n[D]-n[A])*(n[P+1]-n[D+1]))}return 0===f&&0===b?0:Math.abs((b-f)/f)},Tc.flatten=function(n){for(var e=n[0][0].length,i={vertices:[],holes:[],dimensions:e},a=0,u=0;u<n.length;u++){for(var f=0;f<n[u].length;f++)for(var g=0;g<e;g++)i.vertices.push(n[u][f][g]);u>0&&i.holes.push(a+=n[u-1].length)}return i},Jh.default=Da;class rc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Jt,this.indexArray=new Si,this.indexArray2=new zr,this.programConfigurations=new Ec(e.layers,e.zoom),this.segments=new Hr,this.segments2=new Hr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a,u){this.hasPattern=th("fill",this.layers,i);const f=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:x,id:b,index:D,sourceLayerIndex:A}of e){const P=this.layers[0]._featureFilter.needGeometry,F=Za(x,P);if(!this.layers[0]._featureFilter.filter(new V(this.zoom),F,a))continue;const $=f?f.evaluate(F,{},a,i.availableImages):void 0,Z={id:b,properties:x.properties,type:x.type,sourceLayerIndex:A,index:D,geometry:P?F.geometry:Ha(x,a,u),patterns:{},sortKey:$};g.push(Z)}f&&g.sort((x,b)=>x.sortKey-b.sortKey);for(const x of g){const{geometry:b,index:D,sourceLayerIndex:A}=x;if(this.hasPattern){const P=rd("fill",this.layers,x,this.zoom,i);this.patternFeatures.push(P)}else this.addFeature(x,b,D,a,{},i.availableImages);i.featureIndex.insert(e[D].feature,b,D,A,this.index)}}update(e,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,u)}addFeatures(e,i,a,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,a,u,f,g=[]){for(const x of qa(i,500)){let b=0;for(const Z of x)b+=Z.length;const D=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),A=D.vertexLength,P=[],F=[];for(const Z of x){if(0===Z.length)continue;Z!==x[0]&&F.push(P.length/2);const K=this.segments2.prepareSegment(Z.length,this.layoutVertexArray,this.indexArray2),ce=K.vertexLength;this.layoutVertexArray.emplaceBack(Z[0].x,Z[0].y),this.indexArray2.emplaceBack(ce+Z.length-1,ce),P.push(Z[0].x),P.push(Z[0].y);for(let de=1;de<Z.length;de++)this.layoutVertexArray.emplaceBack(Z[de].x,Z[de].y),this.indexArray2.emplaceBack(ce+de-1,ce+de),P.push(Z[de].x),P.push(Z[de].y);K.vertexLength+=Z.length,K.primitiveLength+=Z.length}const $=Jh(P,F);for(let Z=0;Z<$.length;Z+=3)this.indexArray.emplaceBack(A+$[Z],A+$[Z+1],A+$[Z+2]);D.vertexLength+=b,D.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,g,u)}}Wt("FillBucket",rc,{omit:["layers","patternFeatures"]});const wm=new at({"fill-sort-key":new ve(we.layout_fill["fill-sort-key"])});var jf={paint:new at({"fill-antialias":new se(we.paint_fill["fill-antialias"]),"fill-opacity":new ve(we.paint_fill["fill-opacity"]),"fill-color":new ve(we.paint_fill["fill-color"]),"fill-outline-color":new ve(we.paint_fill["fill-outline-color"]),"fill-translate":new se(we.paint_fill["fill-translate"]),"fill-translate-anchor":new se(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new Te(we.paint_fill["fill-pattern"])}),layout:wm};const $f=Ge([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Gf=Ge([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:id}=$f;var od=Wa;function Wa(n,e,i,a,u){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=u,n.readFields(nh,this,e)}function nh(n,e,i){1==n?e.id=i.readVarint():2==n?function(a,u){for(var f=a.readVarint()+a.pos;a.pos<f;){var g=u._keys[a.readVarint()],x=u._values[a.readVarint()];u.properties[g]=x}}(i,e):3==n?e.type=i.readVarint():4==n&&(e._geometry=i.pos)}function Hf(n){for(var e,i,a=0,u=0,f=n.length,g=f-1;u<f;g=u++)a+=((i=n[g]).x-(e=n[u]).x)*(e.y+i.y);return a}Wa.types=["Unknown","Point","LineString","Polygon"],Wa.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,i=n.readVarint()+n.pos,a=1,u=0,f=0,g=0,x=[];n.pos<i;){if(u<=0){var b=n.readVarint();a=7&b,u=b>>3}if(u--,1===a||2===a)f+=n.readSVarint(),g+=n.readSVarint(),1===a&&(e&&x.push(e),e=[]),e.push(new je(f,g));else{if(7!==a)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&x.push(e),x},Wa.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,i=1,a=0,u=0,f=0,g=1/0,x=-1/0,b=1/0,D=-1/0;n.pos<e;){if(a<=0){var A=n.readVarint();i=7&A,a=A>>3}if(a--,1===i||2===i)(u+=n.readSVarint())<g&&(g=u),u>x&&(x=u),(f+=n.readSVarint())<b&&(b=f),f>D&&(D=f);else if(7!==i)throw new Error("unknown command "+i)}return[g,b,x,D]},Wa.prototype.toGeoJSON=function(n,e,i){var a,u,f=this.extent*Math.pow(2,i),g=this.extent*n,x=this.extent*e,b=this.loadGeometry(),D=Wa.types[this.type];function A($){for(var Z=0;Z<$.length;Z++){var K=$[Z];$[Z]=[360*(K.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+x)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<b.length;a++)P[a]=b[a][0];A(b=P);break;case 2:for(a=0;a<b.length;a++)A(b[a]);break;case 3:for(b=function($){var Z=$.length;if(Z<=1)return[$];for(var K,ce,de=[],be=0;be<Z;be++){var Me=Hf($[be]);0!==Me&&(void 0===ce&&(ce=Me<0),ce===Me<0?(K&&de.push(K),K=[$[be]]):K.push($[be]))}return K&&de.push(K),de}(b),a=0;a<b.length;a++)for(u=0;u<b[a].length;u++)A(b[a][u])}1===b.length?b=b[0]:D="Multi"+D;var F={type:"Feature",geometry:{type:D,coordinates:b},properties:this.properties};return"id"in this&&(F.id=this.id),F};var rh=sd;function sd(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(ad,this,e),this.length=this._features.length}function ad(n,e,i){15===n?e.version=i.readVarint():1===n?e.name=i.readString():5===n?e.extent=i.readVarint():2===n?e._features.push(i.pos):3===n?e._keys.push(i.readString()):4===n&&e._values.push(function(a){for(var u=null,f=a.readVarint()+a.pos;a.pos<f;){var g=a.readVarint()>>3;u=1===g?a.readString():2===g?a.readFloat():3===g?a.readDouble():4===g?a.readVarint64():5===g?a.readVarint():6===g?a.readSVarint():7===g?a.readBoolean():null}return u}(i))}function mu(n,e,i){if(3===n){var a=new rh(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}sd.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new od(this._pbf,e,this.extent,this._keys,this._values)};var ic={VectorTile:function(n,e){this.layers=n.readFields(mu,{},e)},VectorTileFeature:od,VectorTileLayer:rh};const Zf=ic.VectorTileFeature.types,Em=Math.pow(2,13);function gu(n,e,i,a,u,f,g,x){n.emplaceBack((e<<1)+g,(i<<1)+f,(Math.floor(a*Em)<<1)+u,Math.round(x))}class ld{constructor(){this.acc=new je(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new je(e.x,e.y),this.max=new je(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);let a=!!this.borders;const u=this.min,f=this.max;e.x<u.x?(u.x=e.x,a=!0):e.x>f.x&&(f.x=e.x,a=!0),e.y<u.y?(u.y=e.y,a=!0):e.y>f.y&&(f.y=e.y,a=!0),((0===e.x||e.x===Kn)&&e.x===i.x)!=((0===e.y||e.y===Kn)&&e.y===i.y)&&this.processBorderOverlap(e,i),a&&this.checkBorderIntersection(e,i)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Jn(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Kn!=e.x>Kn&&this.addBorderIntersection(1,Jn(i.y,e.y,(Kn-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Jn(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Kn!=e.y>Kn&&this.addBorderIntersection(3,Jn(i.x,e.x,(Kn-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=0===e.x?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=0===e.y?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((i,a)=>i+a.edges,0);return 0!==e?this.acc.div(e)._round():new je(0,0)}span(){return new je(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class _u{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new wn,this.centroidVertexArray=new uf,this.indexArray=new Si,this.programConfigurations=new Ec(e.layers,e.zoom),this.segments=new Hr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,a,u){this.features=[],this.hasPattern=th("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(f){const g=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*g/(g*g+1)/Kn/(1<<f.z)}(a);for(const{feature:f,id:g,index:x,sourceLayerIndex:b}of e){const D=this.layers[0]._featureFilter.needGeometry,A=Za(f,D);if(!this.layers[0]._featureFilter.filter(new V(this.zoom),A,a))continue;const P={id:g,sourceLayerIndex:b,index:x,geometry:D?A.geometry:Ha(f,a,u),properties:f.properties,type:f.type,patterns:{}},F=this.layoutVertexArray.length;this.hasPattern?this.features.push(rd("fill-extrusion",this.layers,P,this.zoom,i)):this.addFeature(P,P.geometry,x,a,{},i.availableImages),i.featureIndex.insert(f,P.geometry,x,b,this.index,F)}this.sortBorders()}addFeatures(e,i,a,u){for(const f of this.features){const{geometry:g}=f;this.addFeature(f,g,f.index,i,a,u)}this.sortBorders()}update(e,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,id),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Gf.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,u,f,g){const x=this.enableTerrain?new ld:null;for(const D of qa(i,500)){let A=0,P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===D.length||(b=D[0]).every(ce=>ce.x<=0)||b.every(ce=>ce.x>=Kn)||b.every(ce=>ce.y<=0)||b.every(ce=>ce.y>=Kn))continue;for(let ce=0;ce<D.length;ce++){const de=D[ce];if(0===de.length)continue;A+=de.length;let be=0;x&&x.startRing(de[0]);for(let Me=0;Me<de.length;Me++){const Pe=de[Me];if(Me>=1){const Fe=de[Me-1];if(!qf(Pe,Fe)){x&&x.append(Pe,Fe),P.vertexLength+4>Hr.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ne=Pe.sub(Fe)._perp(),et=Ne.x/(Math.abs(Ne.x)+Math.abs(Ne.y)),Ke=Ne.y>0?1:0,Bt=Fe.dist(Pe);be+Bt>32768&&(be=0),gu(this.layoutVertexArray,Pe.x,Pe.y,et,Ke,0,0,be),gu(this.layoutVertexArray,Pe.x,Pe.y,et,Ke,0,1,be),be+=Bt,gu(this.layoutVertexArray,Fe.x,Fe.y,et,Ke,0,0,be),gu(this.layoutVertexArray,Fe.x,Fe.y,et,Ke,0,1,be);const yt=P.vertexLength;this.indexArray.emplaceBack(yt,yt+2,yt+1),this.indexArray.emplaceBack(yt+1,yt+2,yt+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+A>Hr.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray)),"Polygon"!==Zf[e.type])continue;const F=[],$=[],Z=P.vertexLength;for(let ce=0;ce<D.length;ce++){const de=D[ce];if(0!==de.length){de!==D[0]&&$.push(F.length/2);for(let be=0;be<de.length;be++){const Me=de[be];gu(this.layoutVertexArray,Me.x,Me.y,0,0,1,1,0),F.push(Me.x),F.push(Me.y),x&&x.currentPolyCount.top++}}}const K=Jh(F,$);for(let ce=0;ce<K.length;ce+=3)this.indexArray.emplaceBack(Z+K[ce],Z+K[ce+2],Z+K[ce+1]);P.primitiveLength+=K.length/3,P.vertexLength+=A}var b;if(x&&x.polyCount.length>0){if(x.borders){x.vertexArrayOffset=this.centroidVertexArray.length;const D=x.borders,A=this.featuresOnBorder.push(x)-1;for(let P=0;P<4;P++)D[P][0]!==Number.MAX_VALUE&&this.borders[P].push(A)}this.encodeCentroid(x.borders?void 0:x.centroid(),x)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,g,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,i,a=!0){let u,f;if(e)if(0!==e.y){const x=i.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else u=Math.ceil(7*(e.x+450)),f=0;else u=0,f=+a;let g=a?this.centroidVertexArray.length:i.vertexArrayOffset;for(const x of i.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let b=0;b<2*x.edges;b++)this.centroidVertexArray.emplace(g++,0,f),this.centroidVertexArray.emplace(g++,u,f);for(let b=0;b<x.top;b++)this.centroidVertexArray.emplace(g++,u,f)}}}function qf(n,e){return n.x===e.x&&(n.x<0||n.x>Kn)||n.y===e.y&&(n.y<0||n.y>Kn)}Wt("FillExtrusionBucket",_u,{omit:["layers","features"]}),Wt("PartMetadata",ld);var u_={paint:new at({"fill-extrusion-opacity":new se(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ve(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new se(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new se(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Te(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ve(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ve(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new se(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Mc(n,e){return n.x*e.x+n.y*e.y}function Wf(n,e){if(1===n.length){let i=0;const a=e[i++];let u;for(;!u||a.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const f=e[i],g=n[0],x=u.sub(a),b=f.sub(a),D=g.sub(a),A=Mc(x,x),P=Mc(x,b),F=Mc(b,b),$=Mc(D,x),Z=Mc(D,b),K=A*F-P*P,ce=(F*$-P*Z)/K,de=(A*Z-P*$)/K,be=a.z*(1-ce-de)+u.z*ce+f.z*de;if(isFinite(be))return be}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function cd(n){const e=new je(n[0],n[1]);return e.z=n[2],e}function Dm(n,e,i,a,u,f,g,x){const b=g*u.getElevationAt(n,e,!0,!0),D=0!==f[0],A=D?0===f[1]?g*(f[0]/7-450):g*function(P,F,$){const Z=Math.floor(F[0]/8),K=Math.floor(F[1]/8),ce=10*(F[0]-8*Z),de=10*(F[1]-8*K),be=P.getElevationAt(Z,K,!0,!0),Me=P.getMeterToDEM($),Pe=Math.floor(.5*(ce*Me-1)),Fe=Math.floor(.5*(de*Me-1)),Ne=P.tileCoordToPixel(Z,K),et=2*Pe+1,Ke=2*Fe+1,Bt=(Tr=et,Cn=Ke,[(jt=P).getElevationAtPixel(Xt=Ne.x-Pe,Bn=Ne.y-Fe,!0),jt.getElevationAtPixel(Xt+Cn,Bn,!0),jt.getElevationAtPixel(Xt,Bn+Cn,!0),jt.getElevationAtPixel(Xt+Tr,Bn+Cn,!0)]),yt=Math.abs(Bt[0]-Bt[1]),rt=Math.abs(Bt[2]-Bt[3]),vt=Math.abs(Bt[0]-Bt[2])+Math.abs(Bt[1]-Bt[3]),Dt=Math.min(.25,.5*Me*(yt+rt)/et),ut=Math.min(.25,.5*Me*vt/Ke);var jt,Xt,Bn,Tr,Cn;return be+Math.max(Dt*ce,ut*de)}(u,f,x):b;return{base:b+(0===i)?-1:i,top:D?Math.max(A+a,b+i+2):b+a}}const Cm=Ge([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ea}=Cm,Tm=Ge([{name:"a_packed",components:3,type:"Float32"}]),{members:Xf}=Tm,Sm=ic.VectorTileFeature.types,Im=Math.cos(Math.PI/180*37.5);class ih{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new vn,this.layoutVertexArray2=new Mn,this.indexArray=new Si,this.programConfigurations=new Ec(e.layers,e.zoom),this.segments=new Hr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a,u){this.hasPattern=th("line",this.layers,i);const f=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:A,id:P,index:F,sourceLayerIndex:$}of e){const Z=this.layers[0]._featureFilter.needGeometry,K=Za(A,Z);if(!this.layers[0]._featureFilter.filter(new V(this.zoom),K,a))continue;const ce=f?f.evaluate(K,{},a):void 0,de={id:P,properties:A.properties,type:A.type,sourceLayerIndex:$,index:F,geometry:Z?K.geometry:Ha(A,a,u),patterns:{},sortKey:ce};g.push(de)}f&&g.sort((A,P)=>A.sortKey-P.sortKey);const{lineAtlas:x,featureIndex:b}=i,D=this.addConstantDashes(x);for(const A of g){const{geometry:P,index:F,sourceLayerIndex:$}=A;if(D&&this.addFeatureDashes(A,x),this.hasPattern){const Z=rd("line",this.layers,A,this.zoom,i);this.patternFeatures.push(Z)}else this.addFeature(A,P,F,a,x.positions,i.availableImages);b.insert(e[F].feature,P,F,$,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,f=a.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==f.kind)i=!0;else{const g=f.value,x=u.value;if(!x)continue;e.addDash(x.from,g),e.addDash(x.to,g),x.other&&e.addDash(x.other,g)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===g.kind)continue;let x,b,D,A,P,F;if("constant"===f.kind){const ce=f.value;if(!ce)continue;x=ce.other||ce.to,b=ce.to,D=ce.from}else x=f.evaluate({zoom:a-1},e),b=f.evaluate({zoom:a},e),D=f.evaluate({zoom:a+1},e);"constant"===g.kind?A=P=F=g.value:(A=g.evaluate({zoom:a-1},e),P=g.evaluate({zoom:a},e),F=g.evaluate({zoom:a+1},e)),i.addDash(x,A),i.addDash(b,P),i.addDash(D,F);const $=i.getKey(x,A),Z=i.getKey(b,P),K=i.getKey(D,F);e.patterns[u.id]={min:$,mid:Z,max:K}}}update(e,i,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a,u)}addFeatures(e,i,a,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,a,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Xf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ea),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,a,u,f,g){const x=this.layers[0].layout,b=x.get("line-join").evaluate(e,{}),D=x.get("line-cap").evaluate(e,{}),A=x.get("line-miter-limit"),P=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of i)this.addLine(F,e,b,D,A,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,g,u)}addLine(e,i,a,u,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<e.length-1;de++)this.totalDistance+=e[de].dist(e[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===Sm[i.type];let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let D=0;for(;D<b-1&&e[D].equals(e[D+1]);)D++;if(b<(x?3:2))return;"bevel"===a&&(f=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let F,$,Z,K,ce;this.e1=this.e2=-1,x&&(F=e[b-2],ce=e[D].sub(F)._unit()._perp());for(let de=D;de<b;de++){if(Z=de===b-1?x?e[D+1]:void 0:e[de+1],Z&&e[de].equals(Z))continue;ce&&(K=ce),F&&($=F),F=e[de],ce=Z?Z.sub(F)._unit()._perp():K,K=K||ce;let be=K.add(ce);0===be.x&&0===be.y||be._unit();const Me=K.x*ce.x+K.y*ce.y,Pe=be.x*ce.x+be.y*ce.y,Fe=0!==Pe?1/Pe:1/0,Ne=2*Math.sqrt(2-2*Pe),et=Pe<Im&&$&&Z,Ke=K.x*ce.y-K.y*ce.x>0;if(et&&de>D){const rt=F.dist($);if(rt>2*A){const vt=F.sub(F.sub($)._mult(A/rt)._round());this.updateDistance($,vt),this.addCurrentVertex(vt,K,0,0,P),$=vt}}const Bt=$&&Z;let yt=Bt?a:x?"butt":u;if(Bt&&"round"===yt&&(Fe<g?yt="miter":Fe<=2&&(yt="fakeround")),"miter"===yt&&Fe>f&&(yt="bevel"),"bevel"===yt&&(Fe>2&&(yt="flipbevel"),Fe<f&&(yt="miter")),$&&this.updateDistance($,F),"miter"===yt)be._mult(Fe),this.addCurrentVertex(F,be,0,0,P);else if("flipbevel"===yt){if(Fe>100)be=ce.mult(-1);else{const rt=Fe*K.add(ce).mag()/K.sub(ce).mag();be._perp()._mult(rt*(Ke?-1:1))}this.addCurrentVertex(F,be,0,0,P),this.addCurrentVertex(F,be.mult(-1),0,0,P)}else if("bevel"===yt||"fakeround"===yt){const rt=-Math.sqrt(Fe*Fe-1),vt=Ke?rt:0,Dt=Ke?0:rt;if($&&this.addCurrentVertex(F,K,vt,Dt,P),"fakeround"===yt){const ut=Math.round(180*Ne/Math.PI/20);for(let jt=1;jt<ut;jt++){let Xt=jt/ut;if(.5!==Xt){const Tr=Xt-.5;Xt+=Xt*Tr*(Xt-1)*((1.0904+Me*(Me*(3.55645-1.43519*Me)-3.2452))*Tr*Tr+(.848013+Me*(.215638*Me-1.06021)))}const Bn=ce.sub(K)._mult(Xt)._add(K)._unit()._mult(Ke?-1:1);this.addHalfVertex(F,Bn.x,Bn.y,!1,Ke,0,P)}}Z&&this.addCurrentVertex(F,ce,-vt,-Dt,P)}else if("butt"===yt)this.addCurrentVertex(F,be,0,0,P);else if("square"===yt){const rt=$?1:-1;$||this.addCurrentVertex(F,be,rt,rt,P),this.addCurrentVertex(F,be,0,0,P),$&&this.addCurrentVertex(F,be,rt,rt,P)}else"round"===yt&&($&&(this.addCurrentVertex(F,K,0,0,P),this.addCurrentVertex(F,K,1,1,P,!0)),Z&&(this.addCurrentVertex(F,ce,-1,-1,P,!0),this.addCurrentVertex(F,ce,0,0,P)));if(et&&de<b-1){const rt=F.dist(Z);if(rt>2*A){const vt=F.add(Z.sub(F)._mult(A/rt)._round());this.updateDistance(F,vt),this.addCurrentVertex(vt,ce,0,0,P),F=vt}}}}addCurrentVertex(e,i,a,u,f,g=!1){const x=i.y*u-i.x,b=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*a,i.y-i.x*a,g,!1,a,f),this.addHalfVertex(e,x,b,g,!0,-u,f)}addHalfVertex({x:e,y:i},a,u,f,g,x,b){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const D=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),b.primitiveLength++),g?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Wt("LineBucket",ih,{omit:["layers","patternFeatures"]});const Mm=new at({"line-cap":new ve(we.layout_line["line-cap"]),"line-join":new ve(we.layout_line["line-join"]),"line-miter-limit":new se(we.layout_line["line-miter-limit"]),"line-round-limit":new se(we.layout_line["line-round-limit"]),"line-sort-key":new ve(we.layout_line["line-sort-key"])});var ud={paint:new at({"line-opacity":new ve(we.paint_line["line-opacity"]),"line-color":new ve(we.paint_line["line-color"]),"line-translate":new se(we.paint_line["line-translate"]),"line-translate-anchor":new se(we.paint_line["line-translate-anchor"]),"line-width":new ve(we.paint_line["line-width"]),"line-gap-width":new ve(we.paint_line["line-gap-width"]),"line-offset":new ve(we.paint_line["line-offset"]),"line-blur":new ve(we.paint_line["line-blur"]),"line-dasharray":new Te(we.paint_line["line-dasharray"]),"line-pattern":new Te(we.paint_line["line-pattern"]),"line-gradient":new Ze(we.paint_line["line-gradient"])}),layout:Mm};const Yf=new class extends ve{possiblyEvaluate(n,e){return e=new V(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,i,a){return e=gn({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,i,a)}}(ud.paint.properties["line-width"].specification);function Kf(n,e){return e>0?e+2*n:n}Yf.useIntegerZoom=!0;const Am=Ge([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),qn=Ge([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ge([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jf=Ge([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Qf=Ge([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ge([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const hd=Ge([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),oh=Ge([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ge([{name:"triangle",components:3,type:"Uint16"}]),Ge([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ge([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ge([{type:"Float32",name:"offsetX"}]),Ge([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ta=128;function dd(n,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new V(n+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:a,interpolationType:u}=i;let f=0;for(;f<a.length&&a[f]<=n;)f++;f=Math.max(0,f-1);let g=f;for(;g<a.length&&a[g]<n+1;)g++;g=Math.min(a.length-1,g);const x=a[f],b=a[g];return"composite"===i.kind?{kind:"composite",minZoom:x,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:b,minSize:i.evaluate(new V(x)),maxSize:i.evaluate(new V(b)),interpolationType:u}}}function Ac(n,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:u}){return"source"===n.kind?a/ta:"composite"===n.kind?Jn(a/ta,u/ta,i):e}function os(n,e){let i=0,a=0;if("constant"===n.kind)a=n.layoutSize;else if("source"!==n.kind){const{interpolationType:u,minZoom:f,maxZoom:g}=n,x=u?zt(Dn.interpolationFactor(u,e,f,g),0,1):0;"camera"===n.kind?a=Jn(n.minSize,n.maxSize,x):i=x}return{uSizeT:i,uSize:a}}var fd=Object.freeze({__proto__:null,getSizeData:dd,evaluateSizeForFeature:Ac,evaluateSizeForZoom:os,SIZE_PACK_FACTOR:ta});function ep(n,e,i){return n.sections.forEach(a=>{a.text=function(u,f,g){const x=f.layout.get("text-transform").evaluate(g,{});return"uppercase"===x?u=u.toLocaleUpperCase():"lowercase"===x&&(u=u.toLocaleLowerCase()),N.applyArabicShaping&&(u=N.applyArabicShaping(u)),u}(a.text,e,i)}),n}const oc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function h_(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function tp(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}var Pm=function(n,e,i,a,u){var f,g,x=8*u-a-1,b=(1<<x)-1,D=b>>1,A=-7,P=i?u-1:0,F=i?-1:1,$=n[e+P];for(P+=F,f=$&(1<<-A)-1,$>>=-A,A+=x;A>0;f=256*f+n[e+P],P+=F,A-=8);for(g=f&(1<<-A)-1,f>>=-A,A+=a;A>0;g=256*g+n[e+P],P+=F,A-=8);if(0===f)f=1-D;else{if(f===b)return g?NaN:1/0*($?-1:1);g+=Math.pow(2,a),f-=D}return($?-1:1)*g*Math.pow(2,f-a)},yu=function(n,e,i,a,u,f){var g,x,b,D=8*f-u-1,A=(1<<D)-1,P=A>>1,F=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,$=a?0:f-1,Z=a?1:-1,K=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,g=A):(g=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-g))<1&&(g--,b*=2),(e+=g+P>=1?F/b:F*Math.pow(2,1-P))*b>=2&&(g++,b/=2),g+P>=A?(x=0,g=A):g+P>=1?(x=(e*b-1)*Math.pow(2,u),g+=P):(x=e*Math.pow(2,P-1)*Math.pow(2,u),g=0));u>=8;n[i+$]=255&x,$+=Z,x/=256,u-=8);for(g=g<<u|x,D+=u;D>0;n[i+$]=255&g,$+=Z,g/=256,D-=8);n[i+$-Z]|=128*K},bl=xr;function xr(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}xr.Varint=0,xr.Fixed64=1,xr.Bytes=2,xr.Fixed32=5;var vu=4294967296,sh=1/vu,km="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Xa(n){return n.type===xr.Bytes?n.readVarint()+n.pos:n.pos+1}function np(n,e,i){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(var u=i.pos-1;u>=n;u--)i.buf[u+a]=i.buf[u]}function Rm(n,e){for(var i=0;i<n.length;i++)e.writeVarint(n[i])}function rp(n,e){for(var i=0;i<n.length;i++)e.writeSVarint(n[i])}function d_(n,e){for(var i=0;i<n.length;i++)e.writeFloat(n[i])}function Lm(n,e){for(var i=0;i<n.length;i++)e.writeDouble(n[i])}function f_(n,e){for(var i=0;i<n.length;i++)e.writeBoolean(n[i])}function ip(n,e){for(var i=0;i<n.length;i++)e.writeFixed32(n[i])}function op(n,e){for(var i=0;i<n.length;i++)e.writeSFixed32(n[i])}function Fm(n,e){for(var i=0;i<n.length;i++)e.writeFixed64(n[i])}function pd(n,e){for(var i=0;i<n.length;i++)e.writeSFixed64(n[i])}function md(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function xu(n,e,i){n[i]=e,n[i+1]=e>>>8,n[i+2]=e>>>16,n[i+3]=e>>>24}function Om(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function p_(n,e,i){e.glyphs=[],1===n&&i.readMessage(m_,e)}function m_(n,e,i){if(3===n){const{id:a,bitmap:u,width:f,height:g,left:x,top:b,advance:D}=i.readMessage(g_,{});e.glyphs.push({id:a,bitmap:new yl({width:f+6,height:g+6},u),metrics:{width:f,height:g,left:x,top:b,advance:D}})}else 4===n?e.ascender=i.readSVarint():5===n&&(e.descender=i.readSVarint())}function g_(n,e,i){1===n?e.id=i.readVarint():2===n?e.bitmap=i.readBytes():3===n?e.width=i.readVarint():4===n?e.height=i.readVarint():5===n?e.left=i.readSVarint():6===n?e.top=i.readSVarint():7===n&&(e.advance=i.readVarint())}function sp(n){let e=0,i=0;for(const g of n)e+=g.w*g.h,i=Math.max(i,g.w);n.sort((g,x)=>x.h-g.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,f=0;for(const g of n)for(let x=a.length-1;x>=0;x--){const b=a[x];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,f=Math.max(f,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===b.w&&g.h===b.h){const D=a.pop();x<a.length&&(a[x]=D)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(a.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}xr.prototype={destroy:function(){this.buf=null},readFields:function(n,e,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),u=a>>3,f=this.pos;this.type=7&a,n(u,e,this),this.pos===f&&this.skip(a)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=md(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Om(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=md(this.buf,this.pos)+md(this.buf,this.pos+4)*vu;return this.pos+=8,n},readSFixed64:function(){var n=md(this.buf,this.pos)+Om(this.buf,this.pos+4)*vu;return this.pos+=8,n},readFloat:function(){var n=Pm(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Pm(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,i,a=this.buf;return e=127&(i=a[this.pos++]),i<128?e:(e|=(127&(i=a[this.pos++]))<<7,i<128?e:(e|=(127&(i=a[this.pos++]))<<14,i<128?e:(e|=(127&(i=a[this.pos++]))<<21,i<128?e:function(u,f,g){var x,b,D=g.buf;if(x=(112&(b=D[g.pos++]))>>4,b<128||(x|=(127&(b=D[g.pos++]))<<3,b<128)||(x|=(127&(b=D[g.pos++]))<<10,b<128)||(x|=(127&(b=D[g.pos++]))<<17,b<128)||(x|=(127&(b=D[g.pos++]))<<24,b<128)||(x|=(1&(b=D[g.pos++]))<<31,b<128))return function(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}(u,x,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&km?km.decode(this.buf.subarray(e,n)):function(i,a,u){for(var f="",g=a;g<u;){var x,b,D,A=i[g],P=null,F=A>239?4:A>223?3:A>191?2:1;if(g+F>u)break;1===F?A<128&&(P=A):2===F?128==(192&(x=i[g+1]))&&(P=(31&A)<<6|63&x)<=127&&(P=null):3===F?(b=i[g+2],128==(192&(x=i[g+1]))&&128==(192&b)&&((P=(15&A)<<12|(63&x)<<6|63&b)<=2047||P>=55296&&P<=57343)&&(P=null)):4===F&&(b=i[g+2],D=i[g+3],128==(192&(x=i[g+1]))&&128==(192&b)&&128==(192&D)&&((P=(15&A)<<18|(63&x)<<12|(63&b)<<6|63&D)<=65535||P>=1114112)&&(P=null)),null===P?(P=65533,F=1):P>65535&&(P-=65536,f+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),f+=String.fromCharCode(P),g+=F}return f}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==xr.Bytes)return n.push(this.readVarint(e));var i=Xa(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==xr.Bytes)return n.push(this.readSVarint());var e=Xa(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==xr.Bytes)return n.push(this.readBoolean());var e=Xa(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==xr.Bytes)return n.push(this.readFloat());var e=Xa(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==xr.Bytes)return n.push(this.readDouble());var e=Xa(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==xr.Bytes)return n.push(this.readFixed32());var e=Xa(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==xr.Bytes)return n.push(this.readSFixed32());var e=Xa(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==xr.Bytes)return n.push(this.readFixed64());var e=Xa(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==xr.Bytes)return n.push(this.readSFixed64());var e=Xa(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===xr.Varint)for(;this.buf[this.pos++]>127;);else if(e===xr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===xr.Fixed32)this.pos+=4;else{if(e!==xr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),xu(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),xu(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),xu(this.buf,-1&n,this.pos),xu(this.buf,Math.floor(n*sh),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),xu(this.buf,-1&n,this.pos),xu(this.buf,Math.floor(n*sh),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,i){var a,u,f,x;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),f=a,(x=i).buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,x.buf[x.pos]=127&(f>>>=7),function(f,g){var x=(7&f)<<4;g.buf[g.pos++]|=x|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(u,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(a,u,f){for(var g,x,b=0;b<u.length;b++){if((g=u.charCodeAt(b))>55295&&g<57344){if(!x){g>56319||b+1===u.length?(a[f++]=239,a[f++]=191,a[f++]=189):x=g;continue}if(g<56320){a[f++]=239,a[f++]=191,a[f++]=189,x=g;continue}g=x-55296<<10|g-56320|65536,x=null}else x&&(a[f++]=239,a[f++]=191,a[f++]=189,x=null);g<128?a[f++]=g:(g<2048?a[f++]=g>>6|192:(g<65536?a[f++]=g>>12|224:(a[f++]=g>>18|240,a[f++]=g>>12&63|128),a[f++]=g>>6&63|128),a[f++]=63&g|128)}return f}(this.buf,n,this.pos);var i=this.pos-e;i>=128&&np(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),yu(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),yu(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,e){this.pos++;var i=this.pos;n(e,this);var a=this.pos-i;a>=128&&np(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,e,i){this.writeTag(n,xr.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,Rm,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,rp,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,f_,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,d_,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,Lm,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,ip,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,op,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,Fm,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,pd,e)},writeBytesField:function(n,e){this.writeTag(n,xr.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,xr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,xr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,xr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,xr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,xr.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,xr.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,xr.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,xr.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,xr.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,Boolean(e))}};class ap{constructor(e,{pixelRatio:i,version:a,stretchX:u,stretchY:f,content:g}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=f,this.content=g,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class zm{constructor(e,i){const a={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,a,f),this.addImages(i,u,f);const{w:g,h:x}=sp(f),b=new ws({width:g||1,height:x||1});for(const D in e){const A=e[D],P=a[D].paddedRect;ws.copy(A.data,b,{x:0,y:0},{x:P.x+1,y:P.y+1},A.data)}for(const D in i){const A=i[D],P=u[D].paddedRect,F=P.x+1,$=P.y+1,Z=A.data.width,K=A.data.height;ws.copy(A.data,b,{x:0,y:0},{x:F,y:$},A.data),ws.copy(A.data,b,{x:0,y:K-1},{x:F,y:$-1},{width:Z,height:1}),ws.copy(A.data,b,{x:0,y:0},{x:F,y:$+K},{width:Z,height:1}),ws.copy(A.data,b,{x:Z-1,y:0},{x:F-1,y:$},{width:1,height:K}),ws.copy(A.data,b,{x:0,y:0},{x:F+Z,y:$},{width:1,height:K})}this.image=b,this.iconPositions=a,this.patternPositions=u}addImages(e,i,a){for(const u in e){const f=e[u],g={x:0,y:0,w:f.data.width+2,h:f.data.height+2};a.push(g),i[u]=new ap(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),i)}patchUpdatedImage(e,i,a){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,f]=e.tl;a.update(i.data,void 0,{x:u,y:f})}}Wt("ImagePosition",ap),Wt("ImageAtlas",zm);const zs={horizontal:1,vertical:2,horizontalOnly:3};class Bs{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const a=new Bs;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new Bs;return i.imageName=e,i}}class wl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const a=new wl;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?a.addImageSection(f):a.addTextSection(f,i)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,a){let u="";for(let f=0;f<i.length;f++){const g=i.charCodeAt(f+1)||null,x=i.charCodeAt(f-1)||null;u+=!a&&(g&&Uu(g)&&!oc[i[f+1]]||x&&Uu(x)&&!oc[i[f-1]])||!oc[i[f]]?i[f]:oc[i[f]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&bu[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&bu[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new wl;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Bs.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){const i=e.image?e.image.name:"";if(0===i.length)return void nn("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Bs.forImage(i)),this.sectionIndex.push(this.sections.length-1)):nn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gd(n,e,i,a,u,f,g,x,b,D,A,P,F,$,Z,K){const ce=wl.fromFeature(n,u);let de;P===zs.vertical&&ce.verticalizePunctuation(F);const{processBidirectionalText:be,processStyledBidirectionalText:Me}=N;if(be&&1===ce.sections.length){de=[];const Ne=be(ce.toString(),xd(ce,D,f,e,a,$,Z));for(const et of Ne){const Ke=new wl;Ke.text=et,Ke.sections=ce.sections;for(let Bt=0;Bt<et.length;Bt++)Ke.sectionIndex.push(0);de.push(Ke)}}else if(Me){de=[];const Ne=Me(ce.text,ce.sectionIndex,xd(ce,D,f,e,a,$,Z));for(const et of Ne){const Ke=new wl;Ke.text=et[0],Ke.sectionIndex=et[1],Ke.sections=ce.sections,de.push(Ke)}}else de=function(Ne,et){const Ke=[],Bt=Ne.text;let yt=0;for(const rt of et)Ke.push(Ne.substring(yt,rt)),yt=rt;return yt<Bt.length&&Ke.push(Ne.substring(yt,Bt.length)),Ke}(ce,xd(ce,D,f,e,a,$,Z));const Pe=[],Fe={positionedLines:Pe,text:ce.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ne,et,Ke,Bt,yt,rt,vt,Dt,ut,jt,Xt,Bn){let Tr=0,Cn=0,dr=0;const $t="right"===Dt?1:"left"===Dt?0:.5;let Sr=!1;for(const br of yt){const fr=br.getSections();for(const Yr of fr){if(Yr.imageName)continue;const eo=et[Yr.fontStack];if(eo&&(Sr=void 0!==eo.ascender&&void 0!==eo.descender,!Sr))break}if(!Sr)break}let ar=0;for(const br of yt){br.trim();const fr=br.getMaxScale(),Yr=24*(fr-1),eo={positionedGlyphs:[],lineOffset:0};Ne.positionedLines[ar]=eo;const Ai=eo.positionedGlyphs;let Oi=0;if(!br.length()){Cn+=rt,++ar;continue}let lo=0,oi=0;for(let kr=0;kr<br.length();kr++){const hi=br.getSection(kr),di=br.getSectionIndex(kr),yi=br.getCharCode(kr);let vi=hi.scale,Zi=null,Br=null,xo=null,Vs=24,js=0;const $s=!(ut===zs.horizontal||!Xt&&!Ua(yi)||Xt&&(bu[yi]||(Mi=yi,L(Mi)||U(Mi)||Y(Mi)||xa(Mi)||Bu(Mi))));if(hi.imageName){const co=Bt[hi.imageName];if(!co)continue;xo=hi.imageName,Ne.iconsInText=Ne.iconsInText||!0,Br=co.paddedRect;const bo=co.displaySize;vi=24*vi/Bn,Zi={width:bo[0],height:bo[1],left:1,top:-3,advance:$s?bo[1]:bo[0],localGlyph:!1},js=Sr?-Zi.height*vi:24*fr-17-bo[1]*vi,Vs=Zi.advance;const Ma=($s?bo[0]:bo[1])*vi-24*fr;Ma>0&&Ma>Oi&&(Oi=Ma)}else{const co=Ke[hi.fontStack];if(!co)continue;co[yi]&&(Br=co[yi]);const bo=et[hi.fontStack];if(!bo)continue;const Ma=bo.glyphs[yi];if(!Ma)continue;if(Zi=Ma.metrics,Vs=8203!==yi?24:0,Sr){const jc=void 0!==bo.ascender?Math.abs(bo.ascender):0,uc=void 0!==bo.descender?Math.abs(bo.descender):0,el=(jc+uc)*vi;lo<el&&(lo=el,oi=(jc-uc)/2*vi),js=-jc*vi}else js=24*(fr-vi)-17}$s?(Ne.verticalizable=!0,Ai.push({glyph:yi,imageName:xo,x:Tr,y:Cn+js,vertical:$s,scale:vi,localGlyph:Zi.localGlyph,fontStack:hi.fontStack,sectionIndex:di,metrics:Zi,rect:Br}),Tr+=Vs*vi+jt):(Ai.push({glyph:yi,imageName:xo,x:Tr,y:Cn+js,vertical:$s,scale:vi,localGlyph:Zi.localGlyph,fontStack:hi.fontStack,sectionIndex:di,metrics:Zi,rect:Br}),Tr+=Zi.advance*vi+jt)}0!==Ai.length&&(dr=Math.max(Tr-jt,dr),Sr?lp(Ai,$t,Oi,oi,rt*fr/2):lp(Ai,$t,Oi,0,rt/2)),Tr=0;const ss=rt*fr+Oi;eo.lineOffset=Math.max(Oi,Yr),Cn+=ss,++ar}var Mi;const _i=Cn,{horizontalAlign:Fi,verticalAlign:Hi}=wu(vt);(function(br,fr,Yr,eo,Ai,Oi){const lo=(fr-Yr)*Ai,oi=-Oi*eo;for(const ss of br)for(const kr of ss.positionedGlyphs)kr.x+=lo,kr.y+=oi})(Ne.positionedLines,$t,Fi,Hi,dr,_i),Ne.top+=-Hi*_i,Ne.bottom=Ne.top+_i,Ne.left+=-Fi*dr,Ne.right=Ne.left+dr,Ne.hasBaseline=Sr}(Fe,e,i,a,de,g,x,b,P,D,F,K),!function(Ne){for(const et of Ne)if(0!==et.positionedGlyphs.length)return!1;return!0}(Pe)&&Fe}const bu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_d={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function yd(n,e,i,a,u,f){if(e.imageName){const g=a[e.imageName];return g?g.displaySize[0]*e.scale*24/f+u:0}{const g=i[e.fontStack],x=g&&g.glyphs[n];return x?x.metrics.advance*e.scale+u:0}}function ah(n,e,i,a){const u=Math.pow(n-e,2);return a?n<e?u/2:2*u:u+Math.abs(i)*i}function Bm(n,e,i){let a=0;return 10===n&&(a-=1e4),i&&(a+=150),40!==n&&65288!==n||(a+=50),41!==e&&65289!==e||(a+=50),a}function Ya(n,e,i,a,u,f){let g=null,x=ah(e,i,u,f);for(const b of a){const D=ah(e-b.x,i,u,f)+b.badness;D<=x&&(g=b,x=D)}return{index:n,x:e,priorBreak:g,badness:x}}function vd(n){return n?vd(n.priorBreak).concat(n.index):[]}function xd(n,e,i,a,u,f,g){if("point"!==f)return[];if(!n)return[];const x=[],b=function(F,$,Z,K,ce,de){let be=0;for(let Me=0;Me<F.length();Me++){const Pe=F.getSection(Me);be+=yd(F.getCharCode(Me),Pe,K,ce,$,de)}return be/Math.max(1,Math.ceil(be/Z))}(n,e,i,a,u,g),D=n.text.indexOf("\u200b")>=0;let A=0;for(let F=0;F<n.length();F++){const $=n.getSection(F),Z=n.getCharCode(F);if(bu[Z]||(A+=yd(Z,$,a,u,e,g)),F<n.length()-1){const K=!((P=Z)<11904||!(er(P)||sr(P)||Gl(P)||Rh(P)||go(P)||_e(P)||Ho(P)||Kt(P)||_o(P)||Qi(P)||Ji(P)||Nu(P)||Vn(P)||Je(P)||De(P)||Zo(P)||un(P)||ri(P)||fl(P)||qo(P)));(_d[Z]||K||$.imageName)&&x.push(Ya(F+1,A,b,x,Bm(Z,n.getCharCode(F+1),K&&D),!1))}}var P;return vd(Ya(n.length(),A,b,x,0,!0))}function wu(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function lp(n,e,i,a,u){if(!(e||i||a||u))return;const f=n.length-1,g=n[f],x=(g.x+g.metrics.advance*g.scale)*e;for(let b=0;b<=f;b++)n[b].x-=x,n[b].y+=i+a+u}function cp(n,e,i){const{horizontalAlign:a,verticalAlign:u}=wu(i),f=e[0]-n.displaySize[0]*a,g=e[1]-n.displaySize[1]*u;return{image:n,top:g,bottom:g+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function up(n,e,i,a,u,f){const g=n.image;let x;if(g.content){const ce=g.content,de=g.pixelRatio||1;x=[ce[0]/de,ce[1]/de,g.displaySize[0]-ce[2]/de,g.displaySize[1]-ce[3]/de]}const b=e.left*f,D=e.right*f;let A,P,F,$;"width"===i||"both"===i?($=u[0]+b-a[3],P=u[0]+D+a[1]):($=u[0]+(b+D-g.displaySize[0])/2,P=$+g.displaySize[0]);const Z=e.top*f,K=e.bottom*f;return"height"===i||"both"===i?(A=u[1]+Z-a[0],F=u[1]+K+a[2]):(A=u[1]+(Z+K-g.displaySize[1])/2,F=A+g.displaySize[1]),{image:g,top:A,right:P,bottom:F,left:$,collisionPadding:x}}class El extends je{constructor(e,i,a,u,f){super(e,i),this.angle=u,this.z=a,void 0!==f&&(this.segment=f)}clone(){return new El(this.x,this.y,this.z,this.angle,this.segment)}}function kc(n,e,i,a,u){if(void 0===e.segment)return!0;let f=e,g=e.segment+1,x=0;for(;x>-i/2;){if(g--,g<0)return!1;x-=n[g].dist(f),f=n[g]}x+=n[g].dist(n[g+1]),g++;const b=[];let D=0;for(;x<i/2;){const A=n[g],P=n[g+1];if(!P)return!1;let F=n[g-1].angleTo(A)-A.angleTo(P);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:x,angleDelta:F}),D+=F;x-b[0].distance>a;)D-=b.shift().angleDelta;if(D>u)return!1;g++,x+=A.dist(P)}return!0}function sc(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function lh(n,e,i){return n?.6*e*i:0}function ac(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Eu(n,e,i,a,u,f){const g=lh(i,u,f),x=ac(i,a)*f;let b=0;const D=sc(n)/2;for(let A=0;A<n.length-1;A++){const P=n[A],F=n[A+1],$=P.dist(F);if(b+$>D){const Z=(D-b)/$,K=Jn(P.x,F.x,Z),ce=Jn(P.y,F.y,Z),de=new El(K,ce,0,F.angleTo(P),A);return!g||kc(n,de,x,g,e)?de:void 0}b+=$}}function Rc(n,e,i,a,u,f,g,x,b){const D=lh(a,f,g),A=ac(a,u),P=A*g,F=0===n[0].x||n[0].x===b||0===n[0].y||n[0].y===b;return e-P<e/4&&(e=P+e/4),hp(n,F?e/2*x%e:(A/2+2*f)*g*x%e,e,D,i,P,F,!1,b)}function hp(n,e,i,a,u,f,g,x,b){const D=f/2,A=sc(n);let P=0,F=e-i,$=[];for(let Z=0;Z<n.length-1;Z++){const K=n[Z],ce=n[Z+1],de=K.dist(ce),be=ce.angleTo(K);for(;F+i<P+de;){F+=i;const Me=(F-P)/de,Pe=Jn(K.x,ce.x,Me),Fe=Jn(K.y,ce.y,Me);if(Pe>=0&&Pe<b&&Fe>=0&&Fe<b&&F-D>=0&&F+D<=A){const Ne=new El(Pe,Fe,0,be,Z);Ne._round(),a&&!kc(n,Ne,f,a,u)||$.push(Ne)}}P+=de}return x||$.length||g||($=hp(n,P/2,i,a,u,f,g,!0,b)),$}function bd(n,e,i,a,u){const f=[];for(let g=0;g<n.length;g++){const x=n[g];let b;for(let D=0;D<x.length-1;D++){let A=x[D],P=x[D+1];A.x<e&&P.x<e||(A.x<e?A=new je(e,A.y+(e-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x<e&&(P=new je(e,A.y+(e-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y<i&&P.y<i||(A.y<i?A=new je(A.x+(i-A.y)/(P.y-A.y)*(P.x-A.x),i)._round():P.y<i&&(P=new je(A.x+(i-A.y)/(P.y-A.y)*(P.x-A.x),i)._round()),A.x>=a&&P.x>=a||(A.x>=a?A=new je(a,A.y+(a-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x>=a&&(P=new je(a,A.y+(a-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y>=u&&P.y>=u||(A.y>=u?A=new je(A.x+(u-A.y)/(P.y-A.y)*(P.x-A.x),u)._round():P.y>=u&&(P=new je(A.x+(u-A.y)/(P.y-A.y)*(P.x-A.x),u)._round()),b&&A.equals(b[b.length-1])||(b=[A],f.push(b)),b.push(P)))))}}return f}Wt("Anchor",El);const Lc=1e20;function ch(n,e,i,a,u,f,g,x,b){for(let D=e;D<e+a;D++)uh(n,i*f+D,f,u,g,x,b);for(let D=i;D<i+u;D++)uh(n,D*f+e,1,a,g,x,b)}function uh(n,e,i,a,u,f,g){f[0]=0,g[0]=-Lc,g[1]=Lc,u[0]=n[e];for(let x=1,b=0,D=0;x<a;x++){u[x]=n[e+x*i];const A=x*x;do{const P=f[b];D=(u[x]-u[P]+A-P*P)/(x-P)/2}while(D<=g[b]&&--b>-1);b++,f[b]=x,g[b]=D,g[b+1]=Lc}for(let x=0,b=0;x<a;x++){for(;g[b+1]<x;)b++;const D=f[b],A=x-D;n[e+x*i]=u[D]+A*A}}const hh={none:0,ideographs:1,all:2};class Ka{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const a=[];for(const u in e)for(const f of e[u])a.push({stack:u,id:f});mn(a,({stack:u,id:f},g)=>{let x=this.entries[u];x||(x=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=x.glyphs[f];if(void 0!==b)return void g(null,{stack:u,id:f,glyph:b});if(b=this._tinySDF(x,u,f),b)return x.glyphs[f]=b,void g(null,{stack:u,id:f,glyph:b});const D=Math.floor(f/256);if(256*D>65535)return void g(new Error("glyphs > 65535 not supported"));if(x.ranges[D])return void g(null,{stack:u,id:f,glyph:b});let A=x.requests[D];A||(A=x.requests[D]=[],Ka.loadGlyphRange(u,D,this.url,this.requestManager,(P,F)=>{if(F){x.ascender=F.ascender,x.descender=F.descender;for(const $ in F.glyphs)this._doesCharSupportLocalGlyph(+$)||(x.glyphs[+$]=F.glyphs[+$]);x.ranges[D]=!0}for(const $ of A)$(P,F);delete x.requests[D]})),A.push((P,F)=>{P?g(P):F&&g(null,{stack:u,id:f,glyph:F.glyphs[f]||null})})},(u,f)=>{if(u)i(u);else if(f){const g={};for(const{stack:x,id:b,glyph:D}of f)void 0===g[x]&&(g[x]={}),void 0===g[x].glyphs&&(g[x].glyphs={}),g[x].glyphs[b]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},g[x].ascender=this.entries[x].ascender,g[x].descender=this.entries[x].descender;i(null,g)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==hh.none&&(this.localGlyphMode===hh.all?!!this.localFontFamily:!!this.localFontFamily&&(Qi(e)||Fs(e)||Vn(e)||un(e))||Kt(e))}_tinySDF(e,i,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let f=e.tinySDF;if(!f){let K="400";/bold/i.test(i)?K="900":/medium/i.test(i)?K="500":/light/i.test(i)&&(K="200"),f=e.tinySDF=new Ka.TinySDF({fontFamily:u,fontWeight:K,fontSize:48,buffer:6,radius:16}),f.fontWeight=K}if(this.localGlyphs[f.fontWeight][a])return this.localGlyphs[f.fontWeight][a];const g=String.fromCharCode(a),{data:x,width:b,height:D,glyphWidth:A,glyphHeight:P,glyphLeft:F,glyphTop:$,glyphAdvance:Z}=f.draw(g);return this.localGlyphs[f.fontWeight][a]={id:a,bitmap:new yl({width:b,height:D},x),metrics:{width:A/2,height:P/2,left:F/2,top:$/2-27,advance:Z/2,localGlyph:!0}}}}function dp(n,e,i,a){const u=[],f=n.image,g=f.pixelRatio,x=f.paddedRect.w-2,b=f.paddedRect.h-2,D=n.right-n.left,A=n.bottom-n.top,P=f.stretchX||[[0,x]],F=f.stretchY||[[0,b]],$=(rt,vt)=>rt+vt[1]-vt[0],Z=P.reduce($,0),K=F.reduce($,0),ce=x-Z,de=b-K;let be=0,Me=Z,Pe=0,Fe=K,Ne=0,et=ce,Ke=0,Bt=de;if(f.content&&a){const rt=f.content;be=Du(P,0,rt[0]),Pe=Du(F,0,rt[1]),Me=Du(P,rt[0],rt[2]),Fe=Du(F,rt[1],rt[3]),Ne=rt[0]-be,Ke=rt[1]-Pe,et=rt[2]-rt[0]-Me,Bt=rt[3]-rt[1]-Fe}const yt=(rt,vt,Dt,ut)=>{const jt=Cu(rt.stretch-be,Me,D,n.left),Xt=Tu(rt.fixed-Ne,et,rt.stretch,Z),Bn=Cu(vt.stretch-Pe,Fe,A,n.top),Tr=Tu(vt.fixed-Ke,Bt,vt.stretch,K),Cn=Cu(Dt.stretch-be,Me,D,n.left),dr=Tu(Dt.fixed-Ne,et,Dt.stretch,Z),$t=Cu(ut.stretch-Pe,Fe,A,n.top),Sr=Tu(ut.fixed-Ke,Bt,ut.stretch,K),ar=new je(jt,Bn),Mi=new je(Cn,Bn),_i=new je(Cn,$t),Fi=new je(jt,$t),Hi=new je(Xt/g,Tr/g),br=new je(dr/g,Sr/g),fr=e*Math.PI/180;if(fr){const Ai=Math.sin(fr),Oi=Math.cos(fr),lo=[Oi,-Ai,Ai,Oi];ar._matMult(lo),Mi._matMult(lo),Fi._matMult(lo),_i._matMult(lo)}const Yr=rt.stretch+rt.fixed,eo=vt.stretch+vt.fixed;return{tl:ar,tr:Mi,bl:Fi,br:_i,tex:{x:f.paddedRect.x+1+Yr,y:f.paddedRect.y+1+eo,w:Dt.stretch+Dt.fixed-Yr,h:ut.stretch+ut.fixed-eo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Hi,pixelOffsetBR:br,minFontScaleX:et/g/D,minFontScaleY:Bt/g/A,isSDF:i}};if(a&&(f.stretchX||f.stretchY)){const rt=Nm(P,ce,Z),vt=Nm(F,de,K);for(let Dt=0;Dt<rt.length-1;Dt++){const ut=rt[Dt],jt=rt[Dt+1];for(let Xt=0;Xt<vt.length-1;Xt++)u.push(yt(ut,vt[Xt],jt,vt[Xt+1]))}}else u.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:b+1}));return u}function Du(n,e,i){let a=0;for(const u of n)a+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return a}function Nm(n,e,i){const a=[{fixed:-1,stretch:0}];for(const[u,f]of n){const g=a[a.length-1];a.push({fixed:u-g.stretch,stretch:g.stretch}),a.push({fixed:u-g.stretch,stretch:g.stretch+(f-u)})}return a.push({fixed:e+1,stretch:i}),a}function Cu(n,e,i,a){return n/e*i+a}function Tu(n,e,i,a){return n-e*i/a}function Um(n,e,i,a){const u=e+n.positionedLines[a].lineOffset;return 0===a?i+u/2:i+(u+(e+n.positionedLines[a-1].lineOffset))/2}Ka.loadGlyphRange=function(n,e,i,a,u){const f=256*e,g=f+255,x=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${f}-${g}`),Fo.Glyphs);H(x,(b,D)=>{if(b)u(b);else if(D){const A={},P=new bl(D).readFields(p_,{});for(const F of P.glyphs)A[F.id]=F;u(null,{glyphs:A,ascender:P.ascender,descender:P.descender})}})},Ka.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:g="normal"}){this.buffer=e,this.cutoff=a,this.radius=i;const x=this.size=n+4*e,b=this._createCanvas(x),D=this.ctx=b.getContext("2d",{willReadFrequently:!0});D.font=`${g} ${f} ${n}px ${u}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(n),g=Math.floor(i),x=Math.min(this.size-this.buffer,Math.ceil(f-u)),b=Math.min(this.size-this.buffer,Math.ceil(i)+Math.ceil(a)),D=x+2*this.buffer,A=b+2*this.buffer,P=D*A,F=new Uint8ClampedArray(P),$={data:F,width:D,height:A,glyphWidth:x,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(0===x||0===b)return $;const{ctx:Z,buffer:K,gridInner:ce,gridOuter:de}=this;Z.clearRect(K,K,x,b),Z.fillText(n,K,K+g+1);const be=Z.getImageData(K,K,x,b);de.fill(Lc,0,P),ce.fill(0,0,P);for(let Me=0;Me<b;Me++)for(let Pe=0;Pe<x;Pe++){const Fe=be.data[4*(Me*x+Pe)+3]/255;if(0===Fe)continue;const Ne=(Me+K)*D+Pe+K;if(1===Fe)de[Ne]=0,ce[Ne]=Lc;else{const et=.5-Fe;de[Ne]=et>0?et*et:0,ce[Ne]=et<0?et*et:0}}ch(de,0,0,D,A,D,this.f,this.v,this.z),ch(ce,K,K,x,b,D,this.f,this.v,this.z);for(let Me=0;Me<P;Me++){const Pe=Math.sqrt(de[Me])-Math.sqrt(ce[Me]);F[Me]=Math.round(255-255*(Pe/this.radius+this.cutoff))}return $}};class fp{constructor(e=[],i=Vm){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,u=i[e];for(;e>0;){const f=e-1>>1,g=i[f];if(a(u,g)>=0)break;i[e]=g,e=f}i[e]=u}_down(e){const{data:i,compare:a}=this,u=this.length>>1,f=i[e];for(;e<u;){let g=1+(e<<1),x=i[g];const b=g+1;if(b<this.length&&a(i[b],x)<0&&(g=b,x=i[b]),a(x,f)>=0)break;i[e]=x,e=g}i[e]=f}}function Vm(n,e){return n<e?-1:n>e?1:0}function jm(n,e=1,i=!1){let a=1/0,u=1/0,f=-1/0,g=-1/0;const x=n[0];for(let $=0;$<x.length;$++){const Z=x[$];(!$||Z.x<a)&&(a=Z.x),(!$||Z.y<u)&&(u=Z.y),(!$||Z.x>f)&&(f=Z.x),(!$||Z.y>g)&&(g=Z.y)}const b=Math.min(f-a,g-u);let D=b/2;const A=new fp([],Es);if(0===b)return new je(a,u);for(let $=a;$<f;$+=b)for(let Z=u;Z<g;Z+=b)A.push(new Fc($+D,Z+D,D,n));let P=function($){let Z=0,K=0,ce=0;const de=$[0];for(let be=0,Me=de.length,Pe=Me-1;be<Me;Pe=be++){const Fe=de[be],Ne=de[Pe],et=Fe.x*Ne.y-Ne.x*Fe.y;K+=(Fe.x+Ne.x)*et,ce+=(Fe.y+Ne.y)*et,Z+=3*et}return new Fc(K/Z,ce/Z,0,$)}(n),F=A.length;for(;A.length;){const $=A.pop();($.d>P.d||!P.d)&&(P=$,i&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,F)),$.max-P.d<=e||(D=$.h/2,A.push(new Fc($.p.x-D,$.p.y-D,D,n)),A.push(new Fc($.p.x+D,$.p.y-D,D,n)),A.push(new Fc($.p.x-D,$.p.y+D,D,n)),A.push(new Fc($.p.x+D,$.p.y+D,D,n)),F+=4)}return i&&(console.log(`num probes: ${F}`),console.log(`best distance: ${P.d}`)),P.p}function Es(n,e){return e.max-n.max}function Fc(n,e,i,a){this.p=new je(n,e),this.h=i,this.d=function(u,f){let g=!1,x=1/0;for(let b=0;b<f.length;b++){const D=f[b];for(let A=0,P=D.length,F=P-1;A<P;F=A++){const $=D[A],Z=D[F];$.y>u.y!=Z.y>u.y&&u.x<(Z.x-$.x)*(u.y-$.y)/(Z.y-$.y)+$.x&&(g=!g),x=Math.min(x,xf(u,$,Z))}}return(g?1:-1)*Math.sqrt(x)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const wd=Number.POSITIVE_INFINITY,__=Math.sqrt(2);function $m(n,e){return e[1]!==wd?function(i,a,u){let f=0,g=0;switch(a=Math.abs(a),u=Math.abs(u),i){case"top-right":case"top-left":case"top":g=u-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-u}switch(i){case"top-right":case"bottom-right":case"right":f=-a;break;case"top-left":case"bottom-left":case"left":f=a}return[f,g]}(n,e[0],e[1]):function(i,a){let u=0,f=0;a<0&&(a=0);const g=a/__;switch(i){case"top-right":case"top-left":f=g-7;break;case"bottom-right":case"bottom-left":f=7-g;break;case"bottom":f=7-a;break;case"top":f=a-7}switch(i){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=a;break;case"right":u=-a}return[u,f]}(n,e[0])}function pp(n,e,i,a,u,f,g,x,b){n.createArrays(),n.tilePixelRatio=Kn/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const D=n.layers[0].layout,A=n.layers[0]._unevaluatedLayout._values,P={};if("composite"===n.textSizeData.kind){const{minZoom:Z,maxZoom:K}=n.textSizeData;P.compositeTextSizes=[A["text-size"].possiblyEvaluate(new V(Z),x),A["text-size"].possiblyEvaluate(new V(K),x)]}if("composite"===n.iconSizeData.kind){const{minZoom:Z,maxZoom:K}=n.iconSizeData;P.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new V(Z),x),A["icon-size"].possiblyEvaluate(new V(K),x)]}P.layoutTextSize=A["text-size"].possiblyEvaluate(new V(b+1),x),P.layoutIconSize=A["icon-size"].possiblyEvaluate(new V(b+1),x),P.textMaxSize=A["text-size"].possiblyEvaluate(new V(18),x);const F="map"===D.get("text-rotation-alignment")&&"point"!==D.get("symbol-placement"),$=D.get("text-size");for(const Z of n.features){const K=D.get("text-font").evaluate(Z,{},x).join(","),ce=$.evaluate(Z,{},x),de=P.layoutTextSize.evaluate(Z,{},x),be=(P.layoutIconSize.evaluate(Z,{},x),{horizontal:{},vertical:void 0}),Me=Z.text;let Pe,Fe=[0,0];if(Me){const Ke=Me.toString(),Bt=24*D.get("text-letter-spacing").evaluate(Z,{},x),yt=24*D.get("text-line-height").evaluate(Z,{},x),rt=Kc(Ke)?Bt:0,vt=D.get("text-anchor").evaluate(Z,{},x),Dt=D.get("text-variable-anchor");if(!Dt){const Cn=D.get("text-radial-offset").evaluate(Z,{},x);Fe=Cn?$m(vt,[24*Cn,wd]):D.get("text-offset").evaluate(Z,{},x).map(dr=>24*dr)}let ut=F?"center":D.get("text-justify").evaluate(Z,{},x);const jt=D.get("symbol-placement"),Xt="point"===jt,Bn="point"===jt?24*D.get("text-max-width").evaluate(Z,{},x):0,Tr=Cn=>{n.allowVerticalPlacement&&Na(Ke)&&(be.vertical=gd(Me,e,i,u,K,Bn,yt,vt,Cn,rt,Fe,zs.vertical,!0,jt,de,ce))};if(!F&&Dt){const Cn="auto"===ut?Dt.map($t=>mp($t)):[ut];let dr=!1;for(let $t=0;$t<Cn.length;$t++){const Sr=Cn[$t];if(!be.horizontal[Sr])if(dr)be.horizontal[Sr]=be.horizontal[0];else{const ar=gd(Me,e,i,u,K,Bn,yt,"center",Sr,rt,Fe,zs.horizontal,!1,jt,de,ce);ar&&(be.horizontal[Sr]=ar,dr=1===ar.positionedLines.length)}}Tr("left")}else{if("auto"===ut&&(ut=mp(vt)),Xt||D.get("text-writing-mode").indexOf("horizontal")>=0||!Na(Ke)){const Cn=gd(Me,e,i,u,K,Bn,yt,vt,ut,rt,Fe,zs.horizontal,!1,jt,de,ce);Cn&&(be.horizontal[ut]=Cn)}Tr("point"===jt?"left":ut)}}let Ne=!1;if(Z.icon&&Z.icon.name){const Ke=a[Z.icon.name];Ke&&(Pe=cp(u[Z.icon.name],D.get("icon-offset").evaluate(Z,{},x),D.get("icon-anchor").evaluate(Z,{},x)),Ne=Ke.sdf,void 0===n.sdfIcons?n.sdfIcons=Ke.sdf:n.sdfIcons!==Ke.sdf&&nn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ke.pixelRatio!==n.pixelRatio||0!==D.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const et=gp(be.horizontal)||be.vertical;n.iconsInText||(n.iconsInText=!!et&&et.iconsInText),(et||Pe)&&Gm(n,Z,be,Pe,a,P,de,0,Fe,Ne,g,x)}f&&n.generateCollisionDebugBuffers(b,n.collisionBoxArray)}function mp(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gm(n,e,i,a,u,f,g,x,b,D,A,P){let F=f.textMaxSize.evaluate(e,{},P);void 0===F&&(F=g);const $=n.layers[0].layout,Z=$.get("icon-offset").evaluate(e,{},P),K=gp(i.horizontal)||i.vertical,ce=g/24,de=n.tilePixelRatio*F/24,be=n.tilePixelRatio*$.get("symbol-spacing"),Me=$.get("text-padding")*n.tilePixelRatio,Pe=$.get("icon-padding")*n.tilePixelRatio,Fe=it($.get("text-max-angle")),Ne="map"===$.get("text-rotation-alignment")&&"point"!==$.get("symbol-placement"),et="map"===$.get("icon-rotation-alignment")&&"point"!==$.get("symbol-placement"),Ke=$.get("symbol-placement"),Bt=be/2,yt=$.get("icon-text-fit");let rt;a&&"none"!==yt&&(n.allowVerticalPlacement&&i.vertical&&(rt=up(a,i.vertical,yt,$.get("icon-text-fit-padding"),Z,ce)),K&&(a=up(a,K,yt,$.get("icon-text-fit-padding"),Z,ce)));const vt=(Dt,ut)=>{ut.x<0||ut.x>=Kn||ut.y<0||ut.y>=Kn||function(jt,Xt,Bn,Tr,Cn,dr,$t,Sr,ar,Mi,_i,Fi,Hi,br,fr,Yr,eo,Ai,Oi,lo,oi,ss,kr,hi,di){const yi=jt.addToLineVertexArray(Xt,Tr);let vi,Zi,Br,xo,Vs,js,$s,co=0,bo=0,Ma=0,jc=0,uc=-1,el=-1;const Aa={};let $d=tu(""),Gd=0,Hd=0;if(void 0===ar._unevaluatedLayout.getValue("text-radial-offset")?[Gd,Hd]=ar.layout.get("text-offset").evaluate(oi,{},di).map(Yo=>24*Yo):(Gd=24*ar.layout.get("text-radial-offset").evaluate(oi,{},di),Hd=wd),jt.allowVerticalPlacement&&Cn.vertical){const Yo=Cn.vertical;if(fr)js=Dd(Yo),Sr&&($s=Dd(Sr));else{const as=ar.layout.get("text-rotate").evaluate(oi,{},di)+90;Br=dh(Mi,Bn,Xt,_i,Fi,Hi,Yo,br,as,Yr),Sr&&(xo=dh(Mi,Bn,Xt,_i,Fi,Hi,Sr,Ai,as))}}if(dr){const Yo=ar.layout.get("icon-rotate").evaluate(oi,{},di),as="none"!==ar.layout.get("icon-text-fit"),$c=dp(dr,Yo,kr,as),Eh=Sr?dp(Sr,Yo,kr,as):void 0;Zi=dh(Mi,Bn,Xt,_i,Fi,Hi,dr,Ai,Yo),co=4*$c.length;const Dh=jt.iconSizeData;let Gc=null;"source"===Dh.kind?(Gc=[ta*ar.layout.get("icon-size").evaluate(oi,{},di)],Gc[0]>Ca&&nn(`${jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Dh.kind&&(Gc=[ta*ss.compositeIconSizes[0].evaluate(oi,{},di),ta*ss.compositeIconSizes[1].evaluate(oi,{},di)],(Gc[0]>Ca||Gc[1]>Ca)&&nn(`${jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,$c,Gc,lo,Oi,oi,!1,Bn,Xt,yi.lineStartIndex,yi.lineLength,-1,hi,di),uc=jt.icon.placedSymbolArray.length-1,Eh&&(bo=4*Eh.length,jt.addSymbols(jt.icon,Eh,Gc,lo,Oi,oi,zs.vertical,Bn,Xt,yi.lineStartIndex,yi.lineLength,-1,hi,di),el=jt.icon.placedSymbolArray.length-1)}for(const Yo in Cn.horizontal){const as=Cn.horizontal[Yo];vi||($d=tu(as.text),fr?Vs=Dd(as):vi=dh(Mi,Bn,Xt,_i,Fi,Hi,as,br,ar.layout.get("text-rotate").evaluate(oi,{},di),Yr));const $c=1===as.positionedLines.length;if(Ma+=Ed(jt,Bn,Xt,as,$t,ar,fr,oi,Yr,yi,Cn.vertical?zs.horizontal:zs.horizontalOnly,$c?Object.keys(Cn.horizontal):[Yo],Aa,uc,ss,hi,di),$c)break}Cn.vertical&&(jc+=Ed(jt,Bn,Xt,Cn.vertical,$t,ar,fr,oi,Yr,yi,zs.vertical,["vertical"],Aa,el,ss,hi,di));let Sl=-1;const Zd=(Yo,as)=>Yo?Math.max(Yo,as):as;Sl=Zd(Vs,Sl),Sl=Zd(js,Sl),Sl=Zd($s,Sl);const ng=Sl>-1?1:0;jt.glyphOffsetArray.length>=vo.MAX_GLYPHS&&nn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==oi.sortKey&&jt.addToSortKeyRanges(jt.symbolInstances.length,oi.sortKey),jt.symbolInstances.emplaceBack(Bn.x,Bn.y,Bn.z,Xt.x,Xt.y,Aa.right>=0?Aa.right:-1,Aa.center>=0?Aa.center:-1,Aa.left>=0?Aa.left:-1,Aa.vertical>=0?Aa.vertical:-1,uc,el,$d,void 0!==vi?vi:jt.collisionBoxArray.length,void 0!==vi?vi+1:jt.collisionBoxArray.length,void 0!==Br?Br:jt.collisionBoxArray.length,void 0!==Br?Br+1:jt.collisionBoxArray.length,void 0!==Zi?Zi:jt.collisionBoxArray.length,void 0!==Zi?Zi+1:jt.collisionBoxArray.length,xo||jt.collisionBoxArray.length,xo?xo+1:jt.collisionBoxArray.length,_i,Ma,jc,co,bo,ng,0,Gd,Hd,Sl)}(n,ut,ut,Dt,i,a,u,rt,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Me,Ne,b,0,Pe,et,Z,e,f,D,A,P)};if("line"===Ke)for(const Dt of bd(e.geometry,0,0,Kn,Kn)){const ut=Rc(Dt,be,Fe,i.vertical||K,a,24,de,n.overscaling,Kn);for(const jt of ut){const Xt=K;Xt&&_p(n,Xt.text,Bt,jt)||vt(Dt,jt)}}else if("line-center"===Ke){for(const Dt of e.geometry)if(Dt.length>1){const ut=Eu(Dt,Fe,i.vertical||K,a,24,de);ut&&vt(Dt,ut)}}else if("Polygon"===e.type)for(const Dt of qa(e.geometry,0)){const ut=jm(Dt,16);vt(Dt[0],new El(ut.x,ut.y,0,0,void 0))}else if("LineString"===e.type)for(const Dt of e.geometry)vt(Dt,new El(Dt[0].x,Dt[0].y,0,0,void 0));else if("Point"===e.type)for(const Dt of e.geometry)for(const ut of Dt)vt([ut],new El(ut.x,ut.y,0,0,void 0))}const Ca=32640;function Ed(n,e,i,a,u,f,g,x,b,D,A,P,F,$,Z,K,ce){const de=function(Pe,Fe,Ne,et,Ke,Bt,yt,rt){const vt=[];if(0===Fe.positionedLines.length)return vt;const Dt=et.layout.get("text-rotate").evaluate(Bt,{})*Math.PI/180,ut=function(Cn){const dr=Cn[0],$t=Cn[1],Sr=dr*$t;return Sr>0?[dr,-$t]:Sr<0?[-dr,$t]:0===dr?[$t,dr]:[$t,-dr]}(Ne);let jt=Math.abs(Fe.top-Fe.bottom);for(const Cn of Fe.positionedLines)jt-=Cn.lineOffset;const Xt=Fe.positionedLines.length,Bn=jt/Xt;let Tr=Fe.top-Ne[1];for(let Cn=0;Cn<Xt;++Cn){const dr=Fe.positionedLines[Cn];Tr=Um(Fe,Bn,Tr,Cn);for(const $t of dr.positionedGlyphs){if(!$t.rect)continue;const Sr=$t.rect||{};let ar=4,Mi=!0,_i=1,Fi=0;if($t.imageName){const Br=yt[$t.imageName];if(!Br)continue;if(Br.sdf){nn("SDF images are not supported in formatted text and will be ignored.");continue}Mi=!1,_i=Br.pixelRatio,ar=1/_i}const Hi=(Ke||rt)&&$t.vertical,br=$t.metrics.advance*$t.scale/2,fr=$t.metrics,Yr=$t.rect;if(null===Yr)continue;rt&&Fe.verticalizable&&(Fi=$t.imageName?br-$t.metrics.width*$t.scale/2:0);const eo=Ke?[$t.x+br,$t.y]:[0,0];let Ai=[0,0],Oi=[0,0],lo=!1;Ke||(Hi?(Oi=[$t.x+br+ut[0],$t.y+ut[1]-Fi],lo=!0):Ai=[$t.x+br+Ne[0],$t.y+Ne[1]-Fi]);const oi=Yr.w*$t.scale/(_i*($t.localGlyph?2:1)),ss=Yr.h*$t.scale/(_i*($t.localGlyph?2:1));let kr,hi,di,yi;if(Hi){const Br=$t.y-Tr,xo=new je(-br,br-Br),Vs=-Math.PI/2,js=new je(...Oi);kr=new je(-br+Ai[0],Ai[1]),kr._rotateAround(Vs,xo)._add(js),kr.x+=-Br+br,kr.y-=(fr.left-ar)*$t.scale;const $s=$t.imageName?fr.advance*$t.scale:24*$t.scale,co=String.fromCharCode($t.glyph);h_(co)?kr.x+=(1-ar)*$t.scale:tp(co)?kr.x+=$s-fr.height*$t.scale+(-ar-1)*$t.scale:kr.x+=$t.imageName||fr.width+2*ar===Yr.w&&fr.height+2*ar===Yr.h?($s-ss)/2:($s-(fr.height+2*ar)*$t.scale)/2,hi=new je(kr.x,kr.y-oi),di=new je(kr.x+ss,kr.y),yi=new je(kr.x+ss,kr.y-oi)}else{const Br=(fr.left-ar)*$t.scale-br+Ai[0],xo=(-fr.top-ar)*$t.scale+Ai[1],Vs=Br+oi,js=xo+ss;kr=new je(Br,xo),hi=new je(Vs,xo),di=new je(Br,js),yi=new je(Vs,js)}if(Dt){let Br;Br=Ke?new je(0,0):lo?new je(ut[0],ut[1]):new je(Ne[0],Ne[1]),kr._rotateAround(Dt,Br),hi._rotateAround(Dt,Br),di._rotateAround(Dt,Br),yi._rotateAround(Dt,Br)}const vi=new je(0,0),Zi=new je(0,0);vt.push({tl:kr,tr:hi,bl:di,br:yi,tex:Sr,writingMode:Fe.writingMode,glyphOffset:eo,sectionIndex:$t.sectionIndex,isSDF:Mi,pixelOffsetTL:vi,pixelOffsetBR:Zi,minFontScaleX:0,minFontScaleY:0})}}return vt}(0,a,b,f,g,x,u,n.allowVerticalPlacement),be=n.textSizeData;let Me=null;"source"===be.kind?(Me=[ta*f.layout.get("text-size").evaluate(x,{},ce)],Me[0]>Ca&&nn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===be.kind&&(Me=[ta*Z.compositeTextSizes[0].evaluate(x,{},ce),ta*Z.compositeTextSizes[1].evaluate(x,{},ce)],(Me[0]>Ca||Me[1]>Ca)&&nn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,de,Me,b,g,x,A,e,i,D.lineStartIndex,D.lineLength,$,K,ce);for(const Pe of P)F[Pe]=n.text.placedSymbolArray.length-1;return 4*de.length}function gp(n){for(const e in n)return n[e];return null}function dh(n,e,i,a,u,f,g,x,b,D){let A=g.top,P=g.bottom,F=g.left,$=g.right;const Z=g.collisionPadding;if(Z&&(F-=Z[0],A-=Z[1],$+=Z[2],P+=Z[3]),b){const K=new je(F,A),ce=new je($,A),de=new je(F,P),be=new je($,P),Me=it(b);let Pe=new je(0,0);D&&(Pe=new je(D[0],D[1])),K._rotateAround(Me,Pe),ce._rotateAround(Me,Pe),de._rotateAround(Me,Pe),be._rotateAround(Me,Pe),F=Math.min(K.x,ce.x,de.x,be.x),$=Math.max(K.x,ce.x,de.x,be.x),A=Math.min(K.y,ce.y,de.y,be.y),P=Math.max(K.y,ce.y,de.y,be.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,F,A,$,P,x,a,u,f),n.length-1}function Dd(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function _p(n,e,i,a){const u=n.compareText;if(e in u){const f=u[e];for(let g=f.length-1;g>=0;g--)if(a.dist(f[g])<i)return!0}else u[e]=[];return u[e].push(a),!1}const Hm=ic.VectorTileFeature.types,yp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fh(n,e,i,a,u,f,g,x,b,D,A,P,F,$,Z,K){const ce=A?Math.min(Ca,Math.round(A[0])):0,de=A?Math.min(Ca,Math.round(A[1])):0;n.emplaceBack(e,i,Math.round(32*g),Math.round(32*x),b,D,(ce<<1)+(P?1:0),de,16*F,16*$,256*Z,256*K,a,u,f,0)}function Cd(n,e,i){n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i)}function vp(n){for(const e of n.sections)if(Hl(e.text))return!0;return!1}class ph{constructor(e){this.layoutVertexArray=new zn,this.indexArray=new Si,this.programConfigurations=e,this.segments=new Hr,this.dynamicLayoutVertexArray=new Mn,this.opacityVertexArray=new gr,this.placedSymbolArray=new pl}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,i,a,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Am.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,qn.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,yp,!0),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Wt("SymbolBuffers",ph);class Td{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new Hr,this.collisionVertexArray=new yo,this.collisionVertexArrayExt=new Mn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Jf.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Qf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Wt("CollisionBuffers",Td);class vo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Hh([]),this.placementViewportMatrix=Hh([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dd(this.zoom,i["text-size"]),this.iconSizeData=dd(this.zoom,i["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),f=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(g=>zs[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new ph(new Ec(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ph(new Ec(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Qc,this.lineVertexArray=new Xl,this.symbolInstances=new Wl}calculateGlyphDependencies(e,i,a,u,f){for(let g=0;g<e.length;g++)if(i[e.charCodeAt(g)]=!0,u&&f){const x=oc[e.charAt(g)];x&&(i[x.charCodeAt(0)]=!0)}}populate(e,i,a,u){const f=this.layers[0],g=f.layout,x=g.get("text-font"),b=g.get("text-field"),D=g.get("icon-image"),A=("constant"!==b.value.kind||b.value.value instanceof Ar&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),P="constant"!==D.value.kind||!!D.value.value||Object.keys(D.parameters).length>0,F=g.get("symbol-sort-key");if(this.features=[],!A&&!P)return;const $=i.iconDependencies,Z=i.glyphDependencies,K=i.availableImages,ce=new V(this.zoom);for(const{feature:de,id:be,index:Me,sourceLayerIndex:Pe}of e){const Fe=f._featureFilter.needGeometry,Ne=Za(de,Fe);if(!f._featureFilter.filter(ce,Ne,a))continue;let et,Ke;if(Fe||(Ne.geometry=Ha(de,a,u)),A){const yt=f.getValueAndResolveTokens("text-field",Ne,a,K),rt=Ar.factory(yt);vp(rt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===R()||this.hasRTLText&&N.isParsed())&&(et=ep(rt,f,Ne))}if(P){const yt=f.getValueAndResolveTokens("icon-image",Ne,a,K);Ke=yt instanceof ti?yt:ti.fromString(yt)}if(!et&&!Ke)continue;const Bt=this.sortFeaturesByKey?F.evaluate(Ne,{},a):void 0;if(this.features.push({id:be,text:et,icon:Ke,index:Me,sourceLayerIndex:Pe,geometry:Ne.geometry,properties:de.properties,type:Hm[de.type],sortKey:Bt}),Ke&&($[Ke.name]=!0),et){const yt=x.evaluate(Ne,{},a).join(","),rt="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zs.vertical)>=0;for(const vt of et.sections)if(vt.image)$[vt.image.name]=!0;else{const Dt=Na(et.toString()),ut=vt.fontStack||yt,jt=Z[ut]=Z[ut]||{};this.calculateGlyphDependencies(vt.text,jt,rt,this.allowVerticalPlacement,Dt)}}}"line"===g.get("symbol-placement")&&(this.features=function(de){const be={},Me={},Pe=[];let Fe=0;function Ne(yt){Pe.push(de[yt]),Fe++}function et(yt,rt,vt){const Dt=Me[yt];return delete Me[yt],Me[rt]=Dt,Pe[Dt].geometry[0].pop(),Pe[Dt].geometry[0]=Pe[Dt].geometry[0].concat(vt[0]),Dt}function Ke(yt,rt,vt){const Dt=be[rt];return delete be[rt],be[yt]=Dt,Pe[Dt].geometry[0].shift(),Pe[Dt].geometry[0]=vt[0].concat(Pe[Dt].geometry[0]),Dt}function Bt(yt,rt,vt){const Dt=vt?rt[0][rt[0].length-1]:rt[0][0];return`${yt}:${Dt.x}:${Dt.y}`}for(let yt=0;yt<de.length;yt++){const rt=de[yt],vt=rt.geometry,Dt=rt.text?rt.text.toString():null;if(!Dt){Ne(yt);continue}const ut=Bt(Dt,vt),jt=Bt(Dt,vt,!0);if(ut in Me&&jt in be&&Me[ut]!==be[jt]){const Xt=Ke(ut,jt,vt),Bn=et(ut,jt,Pe[Xt].geometry);delete be[ut],delete Me[jt],Me[Bt(Dt,Pe[Bn].geometry,!0)]=Bn,Pe[Xt].geometry=null}else ut in Me?et(ut,jt,vt):jt in be?Ke(ut,jt,vt):(Ne(yt),be[ut]=Fe-1,Me[jt]=Fe-1)}return Pe.filter(yt=>yt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((de,be)=>de.sortKey-be.sortKey)}update(e,i,a,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,a,u),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,a,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(void 0!==e.segment){let u=e.dist(i[e.segment+1]),f=e.dist(i[e.segment]);const g={};for(let x=e.segment+1;x<i.length;x++)g[x]={x:i[x].x,y:i[x].y,tileUnitDistanceFromAnchor:u},x<i.length-1&&(u+=i[x+1].dist(i[x]));for(let x=e.segment||0;x>=0;x--)g[x]={x:i[x].x,y:i[x].y,tileUnitDistanceFromAnchor:f},x>0&&(f+=i[x-1].dist(i[x]));for(let x=0;x<i.length;x++){const b=g[x];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,u,f,g,x,b,D,A,P,F,$,Z){const K=e.indexArray,ce=e.layoutVertexArray,de=e.segments.prepareSegment(4*i.length,ce,K,this.canOverlap?g.sortKey:void 0),be=this.glyphOffsetArray.length,Me=de.vertexLength,Pe=this.allowVerticalPlacement&&x===zs.vertical?Math.PI/2:0,Fe=g.text&&g.text.sections;for(let Ne=0;Ne<i.length;Ne++){const{tl:et,tr:Ke,bl:Bt,br:yt,tex:rt,pixelOffsetTL:vt,pixelOffsetBR:Dt,minFontScaleX:ut,minFontScaleY:jt,glyphOffset:Xt,isSDF:Bn,sectionIndex:Tr}=i[Ne],Cn=de.vertexLength,dr=Xt[1];fh(ce,b.x,b.y,b.z,D.x,D.y,et.x,dr+et.y,rt.x,rt.y,a,Bn,vt.x,vt.y,ut,jt),fh(ce,b.x,b.y,b.z,D.x,D.y,Ke.x,dr+Ke.y,rt.x+rt.w,rt.y,a,Bn,Dt.x,vt.y,ut,jt),fh(ce,b.x,b.y,b.z,D.x,D.y,Bt.x,dr+Bt.y,rt.x,rt.y+rt.h,a,Bn,vt.x,Dt.y,ut,jt),fh(ce,b.x,b.y,b.z,D.x,D.y,yt.x,dr+yt.y,rt.x+rt.w,rt.y+rt.h,a,Bn,Dt.x,Dt.y,ut,jt),Cd(e.dynamicLayoutVertexArray,b,Pe),K.emplaceBack(Cn,Cn+1,Cn+2),K.emplaceBack(Cn+1,Cn+2,Cn+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xt[0]),Ne!==i.length-1&&Tr===i[Ne+1].sectionIndex||e.programConfigurations.populatePaintArrays(ce.length,g,g.index,{},$,Z,Fe&&Fe[Tr])}e.placedSymbolArray.emplaceBack(b.x,b.y,b.z,D.x,D.y,be,this.glyphOffsetArray.length-be,Me,A,P,D.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],x,0,!1,0,F,0)}_commitLayoutVertex(e,i,a,u,f,g,x){e.emplaceBack(i,a,u,f,g,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,a,u,f,g,x){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),D=b.vertexLength,A=x.tileAnchorX,P=x.tileAnchorY;for(let $=0;$<4;$++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,u,f,g,A,P,new je(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,f,g,A,P,new je(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,f,g,A,P,new je(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,f,g,A,P,new je(e.x1,e.y2)),b.vertexLength+=4;const F=a.indexArray;F.emplaceBack(D,D+1),F.emplaceBack(D+1,D+2),F.emplaceBack(D+2,D+3),F.emplaceBack(D+3,D),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,u,f,g){for(let x=u;x<f;x++){const b=a.get(x),D=this.getSymbolInstanceTextSize(e,g,i,x);this._addCollisionDebugVertices(b,D,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,a,u,f,g){for(let x=u;x<f;x++){const b=a.get(x),D=this.getSymbolInstanceIconSize(e,i,x);this._addCollisionDebugVertices(b,D,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Td(gi,hd.members,zr),this.iconCollisionBox=new Td(gi,hd.members,zr);const a=os(this.iconSizeData,e),u=os(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(u,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,a,u){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),g=Ac(this.textSizeData,e,f)/24;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,a){const u=this.icon.placedSymbolArray.get(a),f=Ac(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,a){e.emplaceBack(i,-a,-a),e.emplaceBack(i,a,-a),e.emplaceBack(i,a,a),e.emplaceBack(i,-a,a)}_updateTextDebugCollisionBoxes(e,i,a,u,f,g){for(let x=u;x<f;x++){const b=a.get(x),D=this.getSymbolInstanceTextSize(e,g,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,b.padding)}}_updateIconDebugCollisionBoxes(e,i,a,u,f){for(let g=u;g<f;g++){const x=a.get(g),b=this.getSymbolInstanceIconSize(e,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,x.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=os(this.iconSizeData,e),u=os(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(u,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(a,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(a,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,u,f,g,x,b,D){const A={};for(let P=i;P<a;P++){const F=e.get(P);A.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,padding:F.padding,projectedAnchorX:F.projectedAnchorX,projectedAnchorY:F.projectedAnchorY,projectedAnchorZ:F.projectedAnchorZ,tileAnchorX:F.tileAnchorX,tileAnchorY:F.tileAnchorY},A.textFeatureIndex=F.featureIndex;break}for(let P=u;P<f;P++){const F=e.get(P);A.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,padding:F.padding,projectedAnchorX:F.projectedAnchorX,projectedAnchorY:F.projectedAnchorY,projectedAnchorZ:F.projectedAnchorZ,tileAnchorX:F.tileAnchorX,tileAnchorY:F.tileAnchorY},A.verticalTextFeatureIndex=F.featureIndex;break}for(let P=g;P<x;P++){const F=e.get(P);A.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,padding:F.padding,projectedAnchorX:F.projectedAnchorX,projectedAnchorY:F.projectedAnchorY,projectedAnchorZ:F.projectedAnchorZ,tileAnchorX:F.tileAnchorX,tileAnchorY:F.tileAnchorY},A.iconFeatureIndex=F.featureIndex;break}for(let P=b;P<D;P++){const F=e.get(P);A.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,padding:F.padding,projectedAnchorX:F.projectedAnchorX,projectedAnchorY:F.projectedAnchorY,projectedAnchorZ:F.projectedAnchorZ,tileAnchorX:F.tileAnchorX,tileAnchorY:F.tileAnchorY},A.verticalIconFeatureIndex=F.featureIndex;break}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),u=a.vertexStartIndex+4*a.numGlyphs;for(let f=a.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),u=[],f=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const b=this.symbolInstances.get(x);u.push(0|Math.round(i*b.tileAnchorX+a*b.tileAnchorY)),f.push(b.featureIndex)}return g.sort((x,b)=>u[x]-u[b]||f[b]-f[x]),g}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((u,f,g)=>{u>=0&&g.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Wt("SymbolBucket",vo,{omit:["layers","collisionBoxArray","features","compareText"]}),vo.MAX_GLYPHS=65535,vo.addDynamicAttributes=Cd;const Sd=new at({"symbol-placement":new se(we.layout_symbol["symbol-placement"]),"symbol-spacing":new se(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new se(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ve(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new se(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new se(we.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new se(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new se(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new se(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new ve(we.layout_symbol["icon-size"]),"icon-text-fit":new se(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new se(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new ve(we.layout_symbol["icon-image"]),"icon-rotate":new ve(we.layout_symbol["icon-rotate"]),"icon-padding":new se(we.layout_symbol["icon-padding"]),"icon-keep-upright":new se(we.layout_symbol["icon-keep-upright"]),"icon-offset":new ve(we.layout_symbol["icon-offset"]),"icon-anchor":new ve(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new se(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new se(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new se(we.layout_symbol["text-rotation-alignment"]),"text-field":new ve(we.layout_symbol["text-field"]),"text-font":new ve(we.layout_symbol["text-font"]),"text-size":new ve(we.layout_symbol["text-size"]),"text-max-width":new ve(we.layout_symbol["text-max-width"]),"text-line-height":new ve(we.layout_symbol["text-line-height"]),"text-letter-spacing":new ve(we.layout_symbol["text-letter-spacing"]),"text-justify":new ve(we.layout_symbol["text-justify"]),"text-radial-offset":new ve(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new se(we.layout_symbol["text-variable-anchor"]),"text-anchor":new ve(we.layout_symbol["text-anchor"]),"text-max-angle":new se(we.layout_symbol["text-max-angle"]),"text-writing-mode":new se(we.layout_symbol["text-writing-mode"]),"text-rotate":new ve(we.layout_symbol["text-rotate"]),"text-padding":new se(we.layout_symbol["text-padding"]),"text-keep-upright":new se(we.layout_symbol["text-keep-upright"]),"text-transform":new ve(we.layout_symbol["text-transform"]),"text-offset":new ve(we.layout_symbol["text-offset"]),"text-allow-overlap":new se(we.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new se(we.layout_symbol["text-ignore-placement"]),"text-optional":new se(we.layout_symbol["text-optional"])});var Id={paint:new at({"icon-opacity":new ve(we.paint_symbol["icon-opacity"]),"icon-color":new ve(we.paint_symbol["icon-color"]),"icon-halo-color":new ve(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new ve(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ve(we.paint_symbol["icon-halo-blur"]),"icon-translate":new se(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new se(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new ve(we.paint_symbol["text-opacity"]),"text-color":new ve(we.paint_symbol["text-color"],{runtimeType:cr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new ve(we.paint_symbol["text-halo-color"]),"text-halo-width":new ve(we.paint_symbol["text-halo-width"]),"text-halo-blur":new ve(we.paint_symbol["text-halo-blur"]),"text-translate":new se(we.paint_symbol["text-translate"]),"text-translate-anchor":new se(we.paint_symbol["text-translate-anchor"])}),layout:Sd};class xp{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Mt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Wt("FormatSectionOverride",xp,{omit:["defaultValue"]});class Md extends Qs{constructor(e){super(e,Id)}recalculate(e,i){super.recalculate(e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const f of a)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,a,u){const f=this.layout.get(e).evaluate(i,{},a,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||mo(g.value)||!f?f:(x=i.properties,f.replace(/{([^{}]+)}/g,(D,A)=>A in x?String(x[A]):""));var x}createBucket(e){return new vo(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Id.paint.overridableProperties){if(!Md.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new xp(i),u=new zl(a,i.property.specification);let f=null;f="constant"===i.value.kind||"source"===i.value.kind?new gs("source",u):new Ys("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new me(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&Md.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),u=Id.paint.properties[i];let f=!1;const g=x=>{for(const b of x)if(u.overrides&&u.overrides.hasOverride(b))return void(f=!0)};if("constant"===a.value.kind&&a.value.value instanceof Ar)g(a.value.value.sections);else if("source"===a.value.kind){const x=D=>{f||(D instanceof jr&&Cr(D.value)===ho?g(D.value.sections):D instanceof Bo?g(D.sections):D.eachChild(x))},b=a.value;b._styleExpression&&x(b._styleExpression.expression)}return f}getProgramConfiguration(e){return new gl(this,e)}}var bp={paint:new at({"background-color":new se(we.paint_background["background-color"]),"background-pattern":new We(we.paint_background["background-pattern"]),"background-opacity":new se(we.paint_background["background-opacity"])})},Zm={paint:new at({"raster-opacity":new se(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new se(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new se(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new se(we.paint_raster["raster-brightness-max"]),"raster-saturation":new se(we.paint_raster["raster-saturation"]),"raster-contrast":new se(we.paint_raster["raster-contrast"]),"raster-resampling":new se(we.paint_raster["raster-resampling"]),"raster-fade-duration":new se(we.paint_raster["raster-fade-duration"])})};class qm extends Qs{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Wm={paint:new at({"sky-type":new se(we.paint_sky["sky-type"]),"sky-atmosphere-sun":new se(we.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new se(we.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new se(we.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new se(we.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ze(we.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new se(we.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new se(we.paint_sky["sky-atmosphere-color"]),"sky-opacity":new se(we.paint_sky["sky-opacity"])})};function Su(n,e,i){const a=Ql(0,0,1),u=If(ec());return function(f,g,x){x*=.5;var b=g[0],D=g[1],A=g[2],P=g[3],F=Math.sin(x),$=Math.cos(x);f[0]=b*$-A*F,f[1]=D*$+P*F,f[2]=A*$+b*F,f[3]=P*$-D*F}(u,u,i?-it(n)+Math.PI:it(n)),Mf(u,u,-it(e)),Sf(a,a,u),Xu(a,a)}const Xm={circle:class extends Qs{constructor(n){super(n,lu)}createBucket(n){return new Ii(n)}queryRadius(n){const e=n;return Gi("circle-radius",this,e)+Gi("circle-stroke-width",this,e)+Dc(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,a,u,f,g,x){const b=Gh(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Pf(n,a,f,g,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),b,D)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new gl(this,n)}},heatmap:class extends Qs{createBucket(n){return new kf(n)}constructor(n){super(n,Cc),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Os({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Gi("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,a,u,f,g,x){const b=this.paint.get("heatmap-radius").evaluate(e,i);return Pf(n,a,f,g,x,!0,!0,new je(0,0),b)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new gl(this,n)}},hillshade:class extends Qs{constructor(n){super(n,a_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(n){return new gl(this,n)}},fill:class extends Qs{constructor(n){super(n,jf)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(n){return new gl(this,n)}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new rc(n)}queryRadius(){return Dc(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,a,u,f){return!n.queryGeometry.isAboveHorizon&&Wu($h(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends Qs{constructor(n){super(n,u_)}createBucket(n){return new _u(n)}queryRadius(){return Dc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new gl(this,n)}queryIntersectsFeature(n,e,i,a,u,f,g,x,b){const D=Gh(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,i),P=this.paint.get("fill-extrusion-base").evaluate(e,i),F=[0,0],$=x&&f.elevation,Z=f.elevation?f.elevation.exaggeration():1;if($){const de=n.tile.getBucket(this).centroidVertexArray,be=b+1;if(be<de.length){const Me=de.get(be);F[0]=Me.a_centroid_pos0,F[1]=Me.a_centroid_pos1}}if(0===F[0]&&1===F[1])return!1;const K=(de=a,be=P,Me=A,Pe=D,Fe=g,(Ne=$?x:null)?function(yt,rt,vt,Dt,ut,jt,Xt,Bn,Tr){const Cn=[],dr=[],$t=[0,0,0,1];for(const Sr of yt){const ar=[],Mi=[];for(const _i of Sr){const Fi=_i.x+Dt.x,Hi=_i.y+Dt.y,br=Dm(Fi,Hi,rt,vt,jt,Xt,Bn,Tr);$t[0]=Fi,$t[1]=Hi,$t[2]=br.base,$t[3]=1,hu($t,$t,ut),$t[3]=Math.max($t[3],1e-5);const fr=cd([$t[0]/$t[3],$t[1]/$t[3],$t[2]/$t[3]]);$t[0]=Fi,$t[1]=Hi,$t[2]=br.top,$t[3]=1,hu($t,$t,ut),$t[3]=Math.max($t[3],1e-5);const Yr=cd([$t[0]/$t[3],$t[1]/$t[3],$t[2]/$t[3]]);ar.push(fr),Mi.push(Yr)}Cn.push(ar),dr.push(Mi)}return[Cn,dr]}(de,be,Me,Pe,Fe,Ne,F,Z,f.center.lat):function(yt,rt,vt,Dt,ut){const jt=[],Xt=[],Bn=ut[8]*rt,Tr=ut[9]*rt,Cn=ut[10]*rt,dr=ut[11]*rt,$t=ut[8]*vt,Sr=ut[9]*vt,ar=ut[10]*vt,Mi=ut[11]*vt;for(const _i of yt){const Fi=[],Hi=[];for(const br of _i){const fr=br.x+Dt.x,Yr=br.y+Dt.y,eo=ut[0]*fr+ut[4]*Yr+ut[12],Ai=ut[1]*fr+ut[5]*Yr+ut[13],Oi=ut[2]*fr+ut[6]*Yr+ut[14],lo=ut[3]*fr+ut[7]*Yr+ut[15],oi=eo+Bn,ss=Ai+Tr,kr=Oi+Cn,hi=Math.max(lo+dr,1e-5),di=eo+$t,yi=Ai+Sr,vi=Oi+ar,Zi=Math.max(lo+Mi,1e-5),Br=new je(oi/hi,ss/hi);Br.z=kr/hi,Fi.push(Br);const xo=new je(di/Zi,yi/Zi);xo.z=vi/Zi,Hi.push(xo)}jt.push(Fi),Xt.push(Hi)}return[jt,Xt]}(de,be,Me,Pe,Fe)),ce=n.queryGeometry;var de,be,Me,Pe,Fe,Ne;return function(de,be,Me){let Pe=1/0;Wu(Me,be)&&(Pe=Wf(Me,be[0]));for(let Fe=0;Fe<be.length;Fe++){const Ne=be[Fe],et=de[Fe];for(let Ke=0;Ke<Ne.length-1;Ke++){const Bt=Ne[Ke],yt=[Bt,Ne[Ke+1],et[Ke+1],et[Ke],Bt];yf(Me,yt)&&(Pe=Math.min(Pe,Wf(Me,yt)))}}return Pe!==1/0&&Pe}(K[0],K[1],ce.isPointQuery()?ce.screenBounds:ce.screenGeometry)}},line:class extends Qs{constructor(n){super(n,ud),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Co,this.gradientVersion=(this.gradientVersion+1)%mt}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=Yf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new ih(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new gl(this,n)}queryRadius(n){const e=n,i=Kf(Gi("line-width",this,e),Gi("line-gap-width",this,e)),a=Gi("line-offset",this,e);return i/2+Math.abs(a)+Dc(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,a,u,f){if(n.queryGeometry.isAboveHorizon)return!1;const g=$h(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),x=n.pixelToTileUnitsFactor/2*Kf(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),b=this.paint.get("line-offset").evaluate(e,i);return b&&(a=function(D,A){const P=[],F=new je(0,0);for(let $=0;$<D.length;$++){const Z=D[$],K=[];for(let ce=0;ce<Z.length;ce++){const de=Z[ce-1],be=Z[ce],Me=Z[ce+1],Pe=0===ce?F:be.sub(de)._unit()._perp(),Fe=ce===Z.length-1?F:Me.sub(be)._unit()._perp(),Ne=Pe._add(Fe)._unit();Ne._mult(1/(Ne.x*Fe.x+Ne.y*Fe.y)),K.push(Ne._mult(A)._add(be))}P.push(K)}return P}(a,b*n.pixelToTileUnitsFactor)),function(D,A,P){for(let F=0;F<A.length;F++){const $=A[F];if(D.length>=3)for(let Z=0;Z<$.length;Z++)if(su(D,$[Z]))return!0;if(vf(D,$,P))return!0}return!1}(g,a,x)}isTileClipped(){return!0}},symbol:Md,background:class extends Qs{constructor(n){super(n,bp)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Qs{constructor(n){super(n,Zm)}getProgramIds(){return["raster"]}},sky:class extends Qs{constructor(n){super(n,Wm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Os({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(n,e){const i=this.paint.get("sky-type");if("atmosphere"===i){const a=this.paint.get("sky-atmosphere-sun"),u=!a,f=n.style.light,g=f.properties.get("position");return u&&"viewport"===f.properties.get("anchor")&&nn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Su(g.azimuthal,90-g.polar,e):Su(a[0],90-a[1],e)}if("gradient"===i){const a=this.paint.get("sky-gradient-center");return Su(a[0],90-a[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}}},{HTMLImageElement:wp,HTMLCanvasElement:Iu,HTMLVideoElement:mh,ImageData:Ep,ImageBitmap:Oc}=He;class zc{constructor(e,i,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,a){const{width:u,height:f}=e,{context:g}=this,{gl:x}=g;if(x.bindTexture(x.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||!1!==i.premultiply)),a||this.size&&this.size[0]===u&&this.size[1]===f){const{x:b,y:D}=a||{x:0,y:0};e instanceof wp||e instanceof Iu||e instanceof mh||e instanceof Ep||Oc&&e instanceof Oc?x.texSubImage2D(x.TEXTURE_2D,0,b,D,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,b,D,u,f,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[u,f],e instanceof wp||e instanceof Iu||e instanceof mh||e instanceof Ep||Oc&&e instanceof Oc?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,f,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,i){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class gh{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new yl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=$e(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const u=[];let f=e.length%2==1?-e[e.length-1]*a:0,g=e[0]*a,x=!0;u.push({left:f,right:g,isDash:x,zeroLength:0===e[0]});let b=e[0];for(let D=1;D<e.length;D++){x=!x;const A=e[D];f=b*a,b+=A,g=b*a,u.push({left:f,right:g,isDash:x,zeroLength:0===A})}return u}addRoundDash(e,i,a){const u=i/2;for(let f=-a;f<=a;f++){const g=this.width*(this.nextRow+a+f);let x=0,b=e[x];for(let D=0;D<this.width;D++){D/b.right>1&&(b=e[++x]);const A=Math.abs(D-b.left),P=Math.abs(D-b.right),F=Math.min(A,P);let $;const Z=f/a*(u+1);if(b.isDash){const K=u-Math.abs(Z);$=Math.sqrt(F*F+K*K)}else $=u-Math.sqrt(F*F+Z*Z);this.image.data[g+D]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(e,i){for(let b=e.length-1;b>=0;--b){const D=e[b],A=e[b+1];D.zeroLength?e.splice(b,1):A&&A.isDash===D.isDash&&(A.left=D.left,e.splice(b,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const f=this.width*this.nextRow;let g=0,x=e[g];for(let b=0;b<this.width;b++){b/x.right>1&&(x=e[++g]);const D=Math.abs(b-x.left),A=Math.abs(b-x.right),P=Math.min(D,A);this.image.data[f+b]=Math.max(0,Math.min(255,(x.isDash?P:-P)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const u="round"===i,f=u?7:0,g=2*f+1;if(this.nextRow+g>this.height)return nn("LineAtlas out of space"),null;0===e.length&&e.push(1);let x=0;for(let A=0;A<e.length;A++)e[A]<0&&(nn("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),x+=e[A];if(0!==x){const A=this.width/x,P=this.getDashRanges(e,this.width,A);u?this.addRoundDash(P,A,f):this.addRegularDash(P,"square"===i?.5*A:0)}const b=this.nextRow+f;this.nextRow+=g;const D={tl:[b,f],br:[x,0]};return this.positions[a]=D,D}}Wt("LineAtlas",gh);class Ym{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Km=He.performance;function _h(n){const e=n?n.url.toString():void 0;return Km.getEntriesByName(e)}class y_{constructor(){this.tasks={},this.taskQueue=[],lt(["process"],this),this.invoker=new Ym(this.process),this.nextId=0}add(e,i){const a=this.nextId++,u=function({type:f,isSymbolTile:g,zoom:x}){return x=x||0,"message"===f?0:"maybePrepare"!==f||g?"parseTile"!==f||g?"parseTile"===f&&g?300-x:"maybePrepare"===f&&g?400-x:500:200-x:100-x}(i);if(0===u){lr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:i,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){lr();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<i&&(i=f.priority,e=u)}if(null===e)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}function yh(n,e){const i=Math.pow(2,-n.z),a=n.x*i,u=(n.x+1)*i,f=n.y*i,g=(n.y+1)*i;if("mercator"===e.name)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const x=ja(a),b=ja(u),D=$a(f),A=$a(g),P=e.project(x,D),F=e.project(b,D),$=e.project(b,A),Z=e.project(x,A);let K=Math.min(P.x,F.x,$.x,Z.x),ce=Math.min(P.y,F.y,$.y,Z.y),de=Math.max(P.x,F.x,$.x,Z.x),be=Math.max(P.y,F.y,$.y,Z.y);const Me=i/16;function Pe(Ne,et,Ke,Bt,yt,rt){const vt=(Ke+yt)/2,Dt=(Bt+rt)/2,ut=e.project(ja(vt),$a(Dt)),jt=Math.max(0,K-ut.x,ce-ut.y,ut.x-de,ut.y-be);K=Math.min(K,ut.x),de=Math.max(de,ut.x),ce=Math.min(ce,ut.y),be=Math.max(be,ut.y),jt>Me&&(Pe(Ne,ut,Ke,Bt,vt,Dt),Pe(ut,et,vt,Dt,yt,rt))}Pe(P,F,a,f,u,f),Pe(F,$,u,f,u,g),Pe($,Z,u,g,a,g),Pe(Z,P,a,g,a,f),K-=Me,ce-=Me,de+=Me,be+=Me;const Fe=1/Math.max(de-K,be-ce);return{scale:Fe,x:K*Fe,y:ce*Fe,x2:de*Fe,y2:be*Fe,projection:e}}function Ad(n,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class vh{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=Bc(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const a=(f=this.y,g=this.z,x=Ad(256*(u=this.x),256*(f=Math.pow(2,g)-f-1),g),b=Ad(256*(u+1),256*(f+1),g),x[0]+","+x[1]+","+b[0]+","+b[1]);var u,f,g,x,b;const D=function(A,P,F){let $,Z="";for(let K=A;K>0;K--)$=1<<K-1,Z+=(P&$?1:0)+(F&$?2:0);return Z}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pd{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Bc(e,i.z,i.z,i.x,i.y)}}class Lo{constructor(e,i,a,u,f){this.overscaledZ=e,this.wrap=i,this.canonical=new vh(a,+u,+f),this.key=0===i&&e===a?this.canonical.key:Bc(i,e,a,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Lo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Lo(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Bc(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Bc(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Lo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new Lo(i,this.wrap,i,a,u),new Lo(i,this.wrap,i,a+1,u),new Lo(i,this.wrap,i,a,u+1),new Lo(i,this.wrap,i,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Lo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Lo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Bc(n,e,i,a,u){const f=1<<Math.min(i,22);let g=f*(u%f)+a%f;return n&&i<22&&(g+=f*f*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}Wt("CanonicalTileID",vh),Wt("OverscaledTileID",Lo,{omit:["projMatrix"]});class Ta{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Mu{constructor(e,i,a,u,f){this.type="Feature",this._vectorTileFeature=e,e._z=i,e._x=a,e._y=u,this.properties=e.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)"_geometry"!==i&&"_vectorTileFeature"!==i&&(e[i]=this[i]);return e}}var Jm=Ge([{name:"a_pos",type:"Int16",components:2}]);const Sa=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,i=0,a=0,u=0,f=0,g=0,x=0;for(1&e?u=f=g=32:i=a=x=32;(e>>=1)>1;){const D=i+u>>1,A=a+f>>1;1&e?(u=i,f=a,i=g,a=x):(i=u,a=f,u=g,f=x),g=D,x=A}const b=4*n;Sa[b+0]=i,Sa[b+1]=a,Sa[b+2]=u,Sa[b+3]=f}const na=new Uint16Array(2178),Ia=new Uint8Array(1089),Dl=new Uint16Array(1089);function Dp(n){return 0===n?-.03125:32===n?.03125:0}var Au=Ge([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const kd={type:2,extent:Kn,loadGeometry:()=>[[new je(0,0),new je(8193,0),new je(8193,8193),new je(0,8193),new je(0,0)]]};class Rd{constructor(e,i,a,u,f){this.tileID=e,this.uid=Ht(),this.uses=0,this.tileSize=i,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<On.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=yh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const g={};if(!f)return g;for(const x of u){const b=x.layerIds.map(D=>f.getLayer(D)).filter(Boolean);if(0!==b.length){x.layers=b,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(D=>b.filter(A=>A.id===D)[0]));for(const D of b)g[D.id]=x}}return g}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof vo){if(this.hasSymbolBuckets=!0,!a)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof vo&&f.hasRTLText){this.hasRTLText=!0,N.isLoading()||N.isLoaded()||"deferred"!==R()||O();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ko}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const u=this.buckets[a];u.uploadPending()&&u.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new zc(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new zc(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new zc(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,a,u,f,g,x,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:x,transform:g,params:f,tileTransform:this.tileTransform},e,i,a):{}}querySourceFeatures(e,i){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),f=i?i.sourceLayer:"",g=u._geojsonTileLayer||u[f];if(!g)return;const x=Io(i&&i.filter),{z:b,x:D,y:A}=this.tileID.canonical,P={z:b,x:D,y:A};for(let F=0;F<g.length;F++){const $=g.feature(F);if(x.needGeometry){const ce=Za($,!0);if(!x.filter(new V(this.tileID.overscaledZ),ce,this.tileID.canonical))continue}else if(!x.filter(new V(this.tileID.overscaledZ),$))continue;const Z=a.getId($,f),K=new Mu($,b,D,A,Z);K.tile=P,e.push(K)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const a=Nr(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{const f=this.expirationTime-i;f?this.expirationTime=a+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!i)return;const a=this.latestFeatureIndex.loadVTLayers(),u=i.style.listImages();for(const f in this.buckets){if(!i.style.hasLayer(f))continue;const g=this.buckets[f],x=g.layers[0].sourceLayer||"_geojsonTileLayer",b=a[x],D=e[x];if(!b||!D||0===Object.keys(D).length)continue;if(g.update(D,b,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof ih||g instanceof rc){const P=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&P&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(P.id,this.tileID)}const A=i&&i.style&&i.style.getLayer(f);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(g)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<On.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=On.now()+e}setDependencies(e,i){const a={};for(const u of i)a[u]=!0;this.dependencies[e]=a}hasDependency(e,i){for(const a of e){const u=this.dependencies[a];if(u)for(const f of i)if(u[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const a=Ha(kd,this.tileID.canonical,this.tileTransform)[0],u=new Jt,f=new Ri;for(let g=0;g<a.length;g++){const{x,y:b}=a[g];u.emplaceBack(x,b),f.emplaceBack(g)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,Au.members),this._tileDebugSegments=Hr.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const a=Ha(kd,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const g=function(x,b){const D=yh(x,b),A=Math.pow(2,x.z);for(let ce=0;ce<33;ce++)for(let de=0;de<33;de++){const be=ja((x.x+(de+Dp(de))/32)/A),Me=$a((x.y+(ce+Dp(ce))/32)/A),Pe=b.project(be,Me),Fe=33*ce+de;na[2*Fe+0]=Math.round((Pe.x*D.scale-D.x)*Kn),na[2*Fe+1]=Math.round((Pe.y*D.scale-D.y)*Kn)}Ia.fill(0),Dl.fill(0);for(let ce=2045;ce>=0;ce--){const de=4*ce,be=Sa[de+0],Me=Sa[de+1],Pe=Sa[de+2],Fe=Sa[de+3],Ne=be+Pe>>1,et=Me+Fe>>1,Ke=Ne+et-Me,Bt=et+be-Ne,yt=33*Me+be,rt=33*Fe+Pe,vt=33*et+Ne,Dt=Math.hypot((na[2*yt+0]+na[2*rt+0])/2-na[2*vt+0],(na[2*yt+1]+na[2*rt+1])/2-na[2*vt+1])>=16;if(Ia[vt]=Ia[vt]||(Dt?1:0),ce<1022){const ut=33*(Me+Bt>>1)+(be+Ke>>1),jt=33*(Fe+Bt>>1)+(Pe+Ke>>1);Ia[vt]=Ia[vt]||Ia[ut]||Ia[jt]}}const P=new wn,F=new Si;let $=0;function Z(ce,de){const be=33*de+ce;return 0===Dl[be]&&(P.emplaceBack(na[2*be+0],na[2*be+1],ce*Kn/32,de*Kn/32),Dl[be]=++$),Dl[be]-1}function K(ce,de,be,Me,Pe,Fe){const Ne=ce+be>>1,et=de+Me>>1;if(Math.abs(ce-Pe)+Math.abs(de-Fe)>1&&Ia[33*et+Ne])K(Pe,Fe,ce,de,Ne,et),K(be,Me,Pe,Fe,Ne,et);else{const Ke=Z(ce,de),Bt=Z(be,Me),yt=Z(Pe,Fe);F.emplaceBack(Ke,Bt,yt)}}return K(0,0,32,32,32,0),K(32,32,0,0,0,32),{vertices:P,indices:F}}(this.tileID.canonical,i);u=g.vertices,f=g.indices}else{u=new wn,f=new Si;for(const{x,y:b}of a)u.emplaceBack(x,b,0,0);const g=Jh(u.int16,void 0,4);for(let x=0;x<g.length;x+=3)f.emplaceBack(g[x],g[x+1],g[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,Au.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=Hr.simpleSegment(0,0,u.length,f.length)}}class Cp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,a){const u=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},gn(this.stateChanges[e][u],a),null===this.deletedStates[e]){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const f in this.state[e][u])a[f]||(this.deletedStates[e][u][f]=null)}else for(const f in a)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][f]&&delete this.deletedStates[e][u][f]}removeFeatureState(e,i,a){if(null===this.deletedStates[e])return;const u=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&void 0!==i)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(void 0!==i)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,i){const a=String(i),u=gn({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const f=this.deletedStates[e][i];if(null===f)return{};for(const g in f)delete u[g]}return u}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),gn(this.state[u][g],this.stateChanges[u][g]),f[g]=this.state[u][g];a[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(null===this.deletedStates[u])for(const g in this.state[u])f[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(null===this.deletedStates[u][g])this.state[u][g]={};else for(const x of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][x];f[g]=this.state[u][g]}a[u]=a[u]||{},gn(a[u],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(a).length)for(const u in e)e[u].setFeatureState(a,i)}}class Tp{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function xh(n,e,i,a){let u=0,f=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(a[g])<1e-15){if(i[g]<n[g]||i[g]>e[g])return null}else{const x=1/a[g];let b=(n[g]-i[g])*x,D=(e[g]-i[g])*x;if(b>D){const A=b;b=D,D=A}if(b>u&&(u=b),D<f&&(f=D),u>f)return null}return u}function Sp(n,e,i,a,u,f,g,x,b,D,A){const P=a-n,F=u-e,$=f-i,Z=g-n,K=x-e,ce=b-i,de=A[1]*ce-A[2]*K,be=A[2]*Z-A[0]*ce,Me=A[0]*K-A[1]*Z,Pe=P*de+F*be+$*Me;if(Math.abs(Pe)<1e-15)return null;const Fe=1/Pe,Ne=D[0]-n,et=D[1]-e,Ke=D[2]-i,Bt=(Ne*de+et*be+Ke*Me)*Fe;if(Bt<0||Bt>1)return null;const yt=et*$-Ke*F,rt=Ke*P-Ne*$,vt=Ne*F-et*P,Dt=(A[0]*yt+A[1]*rt+A[2]*vt)*Fe;return Dt<0||Bt+Dt>1?null:(Z*yt+K*rt+ce*vt)*Fe}function Ip(n,e,i){return(n-e)/(i-e)}function Ld(n,e,i,a,u,f,g,x,b){const D=1<<i,A=f-a,P=g-u,F=(n+1)/D*A+a,$=(e+0)/D*P+u,Z=(e+1)/D*P+u;x[0]=(n+0)/D*A+a,x[1]=$,b[0]=F,b[1]=Z}class lc{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const g=Math.ceil(Math.log2(f.dim/8)),x=[];let b=Math.ceil(Math.pow(2,g));const D=1/b,A=($,Z,K,ce,de)=>{const be=ce?1:0,Me=($+1)*K-be,Pe=Z*K,Fe=(Z+1)*K-be;de[0]=$*K,de[1]=Pe,de[2]=Me,de[3]=Fe};let P=new Tp(b);const F=[];for(let $=0;$<b*b;$++){A($%b,Math.floor($/b),D,!1,F);const Z=Cl(F[0],F[1],f),K=Cl(F[2],F[1],f),ce=Cl(F[2],F[3],f),de=Cl(F[0],F[3],f);P.minimums.push(Math.min(Z,K,ce,de)),P.maximums.push(Math.max(Z,K,ce,de)),P.leaves.push(1)}for(x.push(P),b/=2;b>=1;b/=2){const $=x[x.length-1];P=new Tp(b);for(let Z=0;Z<b*b;Z++){A(Z%b,Math.floor(Z/b),2,!0,F);const K=$.getElevation(F[0],F[1]),ce=$.getElevation(F[2],F[1]),de=$.getElevation(F[2],F[3]),be=$.getElevation(F[0],F[3]),Me=$.isLeaf(F[0],F[1]),Pe=$.isLeaf(F[2],F[1]),Fe=$.isLeaf(F[2],F[3]),Ne=$.isLeaf(F[0],F[3]),et=Math.min(K.min,ce.min,de.min,be.min),Ke=Math.max(K.max,ce.max,de.max,be.max),Bt=Me&&Pe&&Fe&&Ne;P.maximums.push(Ke),P.minimums.push(et),P.leaves.push(Ke-et<=5&&Bt?1:0)}x.push(P)}return x}(this.dem),a=i.length-1,u=i[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,u,f,g,x=1){return xh([e,i,-100],[a,u,this.maximums[0]*x],f,g)}raycast(e,i,a,u,f,g,x=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,i,a,u,f,g,x);if(null==b)return null;const D=[],A=[],P=[],F=[],$=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;$.length>0;){const{idx:Z,t:K,nodex:ce,nodey:de,depth:be}=$.pop();if(this.leaves[Z]){Ld(ce,de,be,e,i,a,u,P,F);const Pe=1<<be,Fe=(ce+0)/Pe,Ne=(ce+1)/Pe,et=(de+0)/Pe,Ke=(de+1)/Pe,Bt=Cl(Fe,et,this.dem)*x,yt=Cl(Ne,et,this.dem)*x,rt=Cl(Ne,Ke,this.dem)*x,vt=Cl(Fe,Ke,this.dem)*x,Dt=Sp(P[0],P[1],Bt,F[0],P[1],yt,F[0],F[1],rt,f,g),ut=Sp(F[0],F[1],rt,P[0],F[1],vt,P[0],P[1],Bt,f,g),jt=Math.min(null!==Dt?Dt:Number.MAX_VALUE,null!==ut?ut:Number.MAX_VALUE);if(jt!==Number.MAX_VALUE)return jt;{const Xt=Tf([],f,g,K);if(Fd(Bt,yt,vt,rt,Ip(Xt[0],P[0],F[0]),Ip(Xt[1],P[1],F[1]))>=Xt[2])return K}continue}let Me=0;for(let Pe=0;Pe<this._siblingOffset.length;Pe++){Ld((ce<<1)+this._siblingOffset[Pe][0],(de<<1)+this._siblingOffset[Pe][1],be+1,e,i,a,u,P,F),P[2]=-100,F[2]=this.maximums[this.childOffsets[Z]+Pe]*x;const Fe=xh(P,F,f,g);if(null!=Fe){const Ne=Fe;D[Pe]=Ne;let et=!1;for(let Ke=0;Ke<Me&&!et;Ke++)Ne>=D[A[Ke]]&&(A.splice(Ke,0,Pe),et=!0);et||(A[Me]=Pe),Me++}}for(let Pe=0;Pe<Me;Pe++){const Fe=A[Pe];$.push({idx:this.childOffsets[Z]+Fe,t:D[Fe],nodex:(ce<<1)+this._siblingOffset[Fe][0],nodey:(de<<1)+this._siblingOffset[Fe][1],depth:be+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,u,f){if(1===e[u].isLeaf(i,a))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const g=u-1,x=e[g];let b,D=0;for(let A=0;A<this._siblingOffset.length;A++){const P=2*i+this._siblingOffset[A][0],F=2*a+this._siblingOffset[A][1],$=x.getElevation(P,F),Z=x.isLeaf(P,F),K=this._addNode($.min,$.max,Z);Z&&(D|=1<<A),b||(b=K)}for(let A=0;A<this._siblingOffset.length;A++)D&1<<A||this._construct(e,2*i+this._siblingOffset[A][0],2*a+this._siblingOffset[A][1],g,b+A)}}function Fd(n,e,i,a,u,f){return Jn(Jn(n,i,f),Jn(e,a,f),u)}function Cl(n,e,i){const a=i.dim,u=zt(n*a-.5,0,a-1),f=zt(e*a-.5,0,a-1),g=Math.floor(u),x=Math.floor(f),b=Math.min(g+1,a-1),D=Math.min(x+1,a-1);return Fd(i.get(g,x),i.get(b,x),i.get(g,D),i.get(b,D),u-g,f-x)}const Mp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Qa{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,u=!1,f=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&"mapbox"!==a&&"terrarium"!==a)return nn(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2;if(this.data=new Uint32Array(i.data.buffer),this.encoding=a||"mapbox",this.borderReady=u,!u){for(let x=0;x<g;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(g,x)]=this.data[this._idx(g-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,g)]=this.data[this._idx(x,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new lc(this)}get(e,i,a=!1){const u=new Uint8Array(this.data.buffer);a&&(e=zt(e,-1,this.dim),i=zt(i,-1,this.dim));const f=4*this._idx(e,i);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(u[f],u[f+1],u[f+2])}static getUnpackVector(e){return Mp[e]}get unpackVector(){return Mp[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,a){return(256*e*256+256*i+a)/10-1e4}_unpackTerrarium(e,i,a){return 256*e+i+a/256-32768}static pack(e,i){const a=[0,0,0,0],u=Qa.getUnpackVector(i);let f=Math.floor((e+u[3])/u[2]);return a[2]=f%256,f=Math.floor(f/256),a[1]=f%256,f=Math.floor(f/256),a[0]=f,a}getPixels(){return new ws({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,g=a*this.dim,x=a*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(a){case-1:g=x-1;break;case 1:x=g+1}const b=-i*this.dim,D=-a*this.dim;for(let A=g;A<x;A++)for(let P=u;P<f;P++)this.data[this._idx(P,A)]=e.data[this._idx(P+b,A+D)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Wt("DEMData",Qa),Wt("DemMinMaxQuadTree",lc,{omit:["dem"]});class Qm{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,a){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const f={value:i,timeout:void 0};if(void 0!==a&&(f.timeout=setTimeout(()=>{this.remove(e,f)},a)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const a=e.wrapped().key,u=void 0===i?0:this.data[a].indexOf(i),f=this.data[a][u];return this.data[a].splice(u,1),f.timeout&&clearTimeout(f.timeout),0===this.data[a].length&&delete this.data[a],this.onRemove(f.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const a in this.data)for(const u of this.data[a])e(u.value)||i.push(u);for(const a of i)this.remove(a.value.tileID,a)}}class Nc{constructor(e,i,a){this.func=e,this.mask=i,this.range=a}}Nc.ReadOnly=!1,Nc.ReadWrite=!0,Nc.disabled=new Nc(519,Nc.ReadOnly,[0,1]);class zd{constructor(e,i,a,u,f,g){this.test=e,this.ref=i,this.mask=a,this.fail=u,this.depthFail=f,this.pass=g}}zd.disabled=new zd({func:519,mask:0},0,0,7680,7680,7680);class Li{constructor(e,i,a){this.blendFunction=e,this.blendColor=i,this.mask=a}}Li.Replace=[1,0],Li.disabled=new Li(Li.Replace,In.transparent,[!1,!1,!1,!1]),Li.unblended=new Li(Li.Replace,In.transparent,[!0,!0,!0,!0]),Li.alphaBlended=new Li([1,771],In.transparent,[!0,!0,!0,!0]);class Us{constructor(e,i,a){this.enable=e,this.mode=i,this.frontFace=a}}Us.disabled=new Us(!1,1029,2305),Us.backCCW=new Us(!0,1029,2305),Us.backCW=new Us(!0,1029,2304),Us.frontCW=new Us(!0,1028,2304),Us.frontCCW=new Us(!0,1028,2305);class Tl extends St{constructor(e,i,a){super(),this.id=e,this._onlySymbols=a,i.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new Qm(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Cp}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const a=this._tiles[i];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Fn(this._tiles).map(e=>e.tileID).sort(Bd).map(e=>e.key)}getRenderableIds(e){const i=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&i.push(this._tiles[a]);return e?i.sort((a,u)=>{const f=a.tileID,g=u.tileID,x=new je(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),b=new je(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-g.overscaledZ||b.y-x.y||b.x-x.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(Bd).map(a=>a.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const a=this._tiles[e];a&&("loading"!==a.state&&(a.state=i),this._loadTile(a,this._tileLoaded.bind(this,a,e,i)))}_tileLoaded(e,i,a,u){if(u)return e.state="errored",void(404!==u.status?this._source.fire(new tn(u,{tile:e})):this.update(this.transform));e.timeAdded=On.now(),"expired"===a&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ct("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let u=0;u<i.length;u++){const f=i[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const g=this.getTileByID(f);a(e,g),a(g,e)}}function a(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let g=f.tileID.canonical.x-u.tileID.canonical.x;const x=f.tileID.canonical.y-u.tileID.canonical.y,b=Math.pow(2,u.tileID.canonical.z),D=f.tileID.key;0===g&&0===x||Math.abs(x)>1||(Math.abs(g)>1&&(1===Math.abs(g+b)?g+=b:1===Math.abs(g-b)&&(g-=b)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,g,x),u.neighboringTiles&&u.neighboringTiles[D]&&(u.neighboringTiles[D].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,a,u){for(const f in this._tiles){let g=this._tiles[f];if(u[f]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>a)continue;let x=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const D=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[D.key],g&&g.hasData()&&(x=D)}let b=x;for(;b.overscaledZ>i;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){u[x.key]=x;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=i?a:null}for(let a=e.overscaledZ-1;a>=i;a--){const u=e.scaledTo(a),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const a=Math.ceil(e.width/i)+1,u=Math.ceil(e.height/i)+1,f=Math.floor(a*u*5),g="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(g)}handleWrapJump(e){const i=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,i){const a={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+i),a[f.tileID.key]=f}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,i,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let u;this.updateCacheSize(e,i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Lo(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(u=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(x=>this._source.hasTile(x)))):u=[];const f=this._updateRetainedTiles(u);if(Ap(this._source.type)&&0!==u.length){const x={},b={},D=Object.keys(f);for(const P of D){const F=f[P],$=this._tiles[P];if(!$||$.fadeEndTime&&$.fadeEndTime<=On.now())continue;const Z=this.findLoadedParent(F,Math.max(F.overscaledZ-Tl.maxOverzooming,this._source.minzoom));Z&&(this._addTile(Z.tileID),x[Z.tileID.key]=Z.tileID),b[P]=F}const A=u[u.length-1].overscaledZ;for(const P in this._tiles){const F=this._tiles[P];if(f[P]||!F.hasData())continue;let $=F.tileID;for(;$.overscaledZ>A;){$=$.scaledTo($.overscaledZ-1);const Z=this._tiles[$.key];if(Z&&Z.hasData()&&b[$.key]){f[P]=F.tileID;break}}}for(const P in x)f[P]||(this._coveredTiles[P]=!0,f[P]=x[P])}for(const x in f)this._tiles[x].clearFadeHold();const g=function(x,b){const D=[];for(const A in x)A in b||D.push(A);return D}(this._tiles,f);for(const x of g){const b=this._tiles[x];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(0===e.length)return i;const a={},u=e.reduce((D,A)=>Math.min(D,A.overscaledZ),1/0),f=e[0].overscaledZ,g=Math.max(f-Tl.maxOverzooming,this._source.minzoom),x=Math.max(f+Tl.maxUnderzooming,this._source.minzoom),b={};for(const D of e){const A=this._addTile(D);i[D.key]=D,A.hasData()||u<this._source.maxzoom&&(b[D.key]=D)}this._retainLoadedChildren(b,u,x,i);for(const D of e){let A=this._tiles[D.key];if(A.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const F=D.children(this._source.maxzoom)[0],$=this.getTile(F);if($&&$.hasData()){i[F.key]=F;continue}}else{const F=D.children(this._source.maxzoom);if(i[F[0].key]&&i[F[1].key]&&i[F[2].key]&&i[F[3].key])continue}let P=A.wasRequested();for(let F=D.overscaledZ-1;F>=g;--F){const $=D.scaledTo(F);if(a[$.key]||(a[$.key]=!0,A=this.getTile($),!A&&P&&(A=this._addTile($)),A&&(i[$.key]=$,P=A.wasRequested(),A.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}i.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(f),a)break;u=f}for(const f of i)this._loadedParentTiles[f]=a}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const a=Boolean(i);if(!a){const u=this.map?this.map.painter:null;i=new Rd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,"raster"===this._source.type||"raster-dem"===this._source.type),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,a||this._source.fire(new ct("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=i.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,i,a){const u=[],f=this.transform;if(!f)return u;for(const g in this._tiles){const x=this._tiles[g];if(a&&x.clearQueryDebugViz(),x.holdingForFade())continue;const b=e.containsTile(x,f,i);b&&u.push(b)}return u}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of i)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(Ap(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=On.now())return!0}return!1}setFeatureState(e,i,a){this._state.updateState(e=e||"_geojsonTileLayer",i,a)}removeFeatureState(e,i,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,a)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,a){const u=this._tiles[e];u&&u.setDependencies(i,a)}reloadTilesForDependencies(e,i){for(const a in this._tiles)this._tiles[a].hasDependency(e,i)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,i))}}function Bd(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||a-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function Ap(n){return"raster"===n||"image"===n||"video"===n}Tl.maxOverzooming=10,Tl.maxUnderzooming=3;class wh{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const u=a||e.findDEMTileFor(i);if(!u||!u.dem)return;const f=u.dem,g=u.tileID,x=1<<i.canonical.z-g.canonical.z;return new wh(u,u.tileSize/Kn/x,[(i.canonical.x/x-g.canonical.x)*f.dim,(i.canonical.y/x-g.canonical.y)*f.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(a);return new je(u,f)}getElevationAt(e,i,a,u){const f=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],x=Math.floor(f),b=Math.floor(g),D=this._dem;return u=!!u,a?Jn(Jn(D.get(x,b,u),D.get(x,b+1,u),g-b),Jn(D.get(x+1,b,u),D.get(x+1,b+1,u),g-b),f-x):D.get(x,b,u)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ou(1,e)*this._dem.stride}}class Pp{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Js(Kn,16,0),this.featureIndexArray=new lf,this.promoteId=i}insert(e,i,a,u,f,g=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,f,g);const b=this.grid;for(let D=0;D<i.length;D++){const A=i[D],P=[1/0,1/0,-1/0,-1/0];for(let F=0;F<A.length;F++){const $=A[F];P[0]=Math.min(P[0],$.x),P[1]=Math.min(P[1],$.y),P[2]=Math.max(P[2],$.x),P[3]=Math.max(P[3],$.y)}P[0]<Kn&&P[1]<Kn&&P[2]>=0&&P[3]>=0&&b.insert(x,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ic.VectorTile(new bl(this.rawTileData)).layers,this.sourceLayerCoder=new Ta(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,a,u){this.loadVTLayers();const f=e.params||{},g=Io(f.filter),x=e.tileResult,b=e.transform,D=x.bufferedTilespaceBounds,A=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(Z,K,ce,de)=>pm(x.bufferedTilespaceGeometry,Z,K,ce,de));A.sort(Rp);let P=null;b.elevation&&A.length>0&&(P=wh.create(b.elevation,this.tileID));const F={};let $;for(let Z=0;Z<A.length;Z++){const K=A[Z];if(K===$)continue;$=K;const ce=this.featureIndexArray.get(K);let de=null;this.loadMatchingFeature(F,ce,g,f.layers,f.availableImages,i,a,u,(be,Me,Pe,Fe=0)=>(de||(de=Ha(be,this.tileID.canonical,e.tileTransform)),Me.queryIntersectsFeature(x,be,Pe,de,this.z,e.transform,e.pixelPosMatrix,P,Fe)))}return F}loadMatchingFeature(e,i,a,u,f,g,x,b,D){const{featureIndex:A,bucketIndex:P,sourceLayerIndex:F,layoutVertexArrayOffset:$}=i,Z=this.bucketLayerIDs[P];if(u&&!function(be,Me){for(let Pe=0;Pe<be.length;Pe++)if(Me.indexOf(be[Pe])>=0)return!0;return!1}(u,Z))return;const K=this.sourceLayerCoder.decode(F),ce=this.vtLayers[K].feature(A);if(a.needGeometry){const be=Za(ce,!0);if(!a.filter(new V(this.tileID.overscaledZ),be,this.tileID.canonical))return}else if(!a.filter(new V(this.tileID.overscaledZ),ce))return;const de=this.getId(ce,K);for(let be=0;be<Z.length;be++){const Me=Z[be];if(u&&u.indexOf(Me)<0)continue;const Pe=g[Me];if(!Pe)continue;let Fe={};void 0!==de&&b&&(Fe=b.getState(Pe.sourceLayer||"_geojsonTileLayer",de));const Ne=gn({},x[Me]);Ne.paint=kp(Ne.paint,Pe.paint,ce,Fe,f),Ne.layout=kp(Ne.layout,Pe.layout,ce,Fe,f);const et=!D||D(ce,Pe,Fe,$);if(!et)continue;const Ke=new Mu(ce,this.z,this.x,this.y,de);Ke.layer=Ne;let Bt=e[Me];void 0===Bt&&(Bt=e[Me]=[]),Bt.push({featureIndex:A,feature:Ke,intersectionZ:et})}}lookupSymbolFeatures(e,i,a,u,f,g,x,b){const D={};this.loadVTLayers();const A=Io(f);for(const P of e)this.loadMatchingFeature(D,{bucketIndex:a,sourceLayerIndex:u,featureIndex:P,layoutVertexArrayOffset:0},A,g,x,b,i);return D}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),f=this.vtFeatures[u];if(f[i])return f[i];const g=this.vtLayers[u].feature(i);return f[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;return this.promoteId&&(a=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[i]],"boolean"==typeof a&&(a=Number(a))),a}}function kp(n,e,i,a,u){return Ye(n,(f,g)=>{const x=e instanceof ge?e.get(g):null;return x&&x.evaluate?x.evaluate(i,a,u):x})}function Rp(n,e){return e-n}Wt("FeatureIndex",Pp,{omit:["rawTileData","sourceLayerCoder"]});class eg{constructor(e){const i={},a=[];for(const x in e){const b=e[x],D=i[x]={};for(const A in b.glyphs){const P=b.glyphs[+A];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const F=P.metrics.localGlyph?2:1,$={x:0,y:0,w:P.bitmap.width+2*F,h:P.bitmap.height+2*F};a.push($),D[A]=$}}const{w:u,h:f}=sp(a),g=new yl({width:u||1,height:f||1});for(const x in e){const b=e[x];for(const D in b.glyphs){const A=b.glyphs[+D];if(!A||0===A.bitmap.width||0===A.bitmap.height)continue;const P=i[x][D],F=A.metrics.localGlyph?2:1;yl.copy(A.bitmap,g,{x:0,y:0},{x:P.x+F,y:P.y+F},A.bitmap)}}this.image=g,this.positions=i}}Wt("GlyphAtlas",eg);class Lp{constructor(e){this.tileID=new Lo(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,e.projection&&(this.tileTransform=yh(e.tileID.canonical,e.projection))}parse(e,i,a,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new ko;const g=new Ta(Object.keys(e.layers).sort()),x=new Pp(this.tileID,this.promoteId);x.bucketLayerIDs=[];const b={},D=new gh(256,256),A={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:a},P=i.familiesBySource[this.source];for(const Fe in P){const Ne=e.layers[Fe];if(!Ne)continue;let et=!1,Ke=!1;for(const rt of P[Fe])"symbol"===rt[0].type?et=!0:Ke=!0;if(!0===this.isSymbolTile&&!et||!1===this.isSymbolTile&&!Ke)continue;1===Ne.version&&nn(`Vector tile source "${this.source}" layer "${Fe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bt=g.encode(Fe),yt=[];for(let rt=0;rt<Ne.length;rt++){const vt=Ne.feature(rt),Dt=x.getId(vt,Fe);yt.push({feature:vt,id:Dt,index:rt,sourceLayerIndex:Bt})}for(const rt of P[Fe]){const vt=rt[0];void 0!==this.isSymbolTile&&"symbol"===vt.type!==this.isSymbolTile||vt.minzoom&&this.zoom<Math.floor(vt.minzoom)||vt.maxzoom&&this.zoom>=vt.maxzoom||"none"!==vt.visibility&&(Nd(rt,this.zoom,a),(b[vt.id]=vt.createBucket({index:x.bucketLayerIDs.length,layers:rt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bt,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:a})).populate(yt,A,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(rt.map(Dt=>Dt.id)))}}let F,$,Z,K;D.trim();const ce={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},de=Ye(A.glyphDependencies,Fe=>Object.keys(Fe).map(Number));Object.keys(de).length?u.send("getGlyphs",{uid:this.uid,stacks:de},(Fe,Ne)=>{F||(F=Fe,$=Ne,Pe.call(this))},void 0,!1,ce):$={};const be=Object.keys(A.iconDependencies);be.length?u.send("getImages",{icons:be,source:this.source,tileID:this.tileID,type:"icons"},(Fe,Ne)=>{F||(F=Fe,Z=Ne,Pe.call(this))},void 0,!1,ce):Z={};const Me=Object.keys(A.patternDependencies);function Pe(){if(F)return f(F);if($&&Z&&K){const Fe=new eg($),Ne=new zm(Z,K);for(const et in b){const Ke=b[et];Ke instanceof vo?(Nd(Ke.layers,this.zoom,a),pp(Ke,$,Fe.positions,Z,Ne.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom)):Ke.hasPattern&&(Ke instanceof ih||Ke instanceof rc||Ke instanceof _u)&&(Nd(Ke.layers,this.zoom,a),Ke.addFeatures(A,this.tileID.canonical,Ne.patternPositions,a))}this.status="done",f(null,{buckets:Fn(b).filter(et=>!et.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Fe.image,lineAtlas:D,imageAtlas:Ne,glyphMap:this.returnDependencies?$:null,iconMap:this.returnDependencies?Z:null,glyphPositions:this.returnDependencies?Fe.positions:null})}}Me.length?u.send("getImages",{icons:Me,source:this.source,tileID:this.tileID,type:"patterns"},(Fe,Ne)=>{F||(F=Fe,K=Ne,Pe.call(this))},void 0,!1,ce):K={},Pe.call(this)}}function Nd(n,e,i){const a=new V(e);for(const u of n)u.recalculate(a,i)}class Fp{constructor(e){this.entries={},this.scheduler=e}request(e,i,a,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[g,x]=f.result;return this.scheduler?this.scheduler.add(()=>{u(g,x)},i):u(g,x),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=a((g,x)=>{f.result=[g,x];for(const b of f.callbacks)this.scheduler?this.scheduler.add(()=>{b(g,x)},i):b(g,x);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(g=>g!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function tg(n,e,i){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},u=>{const f=H(n.request,(g,x,b,D)=>{g?u(g):x&&u(null,{vectorTile:i?void 0:new ic.VectorTile(new bl(x)),rawData:x,cacheControl:b,expires:D})});return()=>{f.cancel(),u()}},e)}var v_={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],conic:!0,initializeConstants(){if(this.constants&&Af(this.parallels,this.constants.parallels))return;const n=Math.sin(it(this.parallels[0])),e=(n+Math.sin(it(this.parallels[1])))/2,i=1+n*(2*e-n),a=Math.sqrt(i)/e;this.constants={n:e,c:i,r0:a,parallels:this.parallels}},project(n,e){this.initializeConstants();const i=it(n-this.center[0]),a=it(e),{n:u,c:f,r0:g}=this.constants,x=Math.sqrt(f-2*u*Math.sin(a))/u;return{x:x*Math.sin(i*u),y:x*Math.cos(i*u)-g}},unproject(n,e){this.initializeConstants();const{n:i,c:a,r0:u}=this.constants,f=u+e;let g=Math.atan2(n,Math.abs(f))*Math.sign(f);f*i<0&&(g-=Math.PI*Math.sign(n)*Math.sign(f));const x=it(this.center[0])*i;g=gt(g,-Math.PI-x,Math.PI-x);const b=Ut(g/i)+this.center[0],D=Math.asin(zt((a-(n*n+f*f)*i*i)/(2*i),-1,1)),A=zt(Ut(D),-85.051129,Ga);return new vr(b,A)}};const cc=1.340264,ku=-.081106,Uc=893e-6,Vc=.003796,Ud=Math.sqrt(3)/2;var ra={name:"equalEarth",center:[0,0],range:[3.5,7],project(n,e){e=e/180*Math.PI,n=n/180*Math.PI;const i=Math.asin(Ud*Math.sin(e)),a=i*i,u=a*a*a;return{x:.5*(n*Math.cos(i)/(Ud*(cc+3*ku*a+u*(7*Uc+9*Vc*a)))/Math.PI+.5),y:1-.5*(i*(cc+ku*a+u*(Uc+Vc*a))/Math.PI+1)}},unproject(n,e){n=(2*n-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,a=i*i,u=a*a*a;for(let D,A,P,F=0;F<12&&(A=i*(cc+ku*a+u*(Uc+Vc*a))-e,P=cc+3*ku*a+u*(7*Uc+9*Vc*a),D=A/P,i=zt(i-D,-Math.PI/3,Math.PI/3),a=i*i,u=a*a*a,!(Math.abs(D)<1e-12));++F);const f=Ud*n*(cc+3*ku*a+u*(7*Uc+9*Vc*a))/Math.cos(i),g=Math.asin(Math.sin(i)/Ud),x=zt(180*f/Math.PI,-180,180),b=zt(180*g/Math.PI,-85.051129,Ga);return new vr(x,b)}},x_={name:"equirectangular",wrap:!0,center:[0,0],range:[3.5,7],project:(n,e)=>({x:.5+n/360,y:.5-e/360}),unproject(n,e){const i=360*(n-.5),a=zt(360*(.5-e),-85.051129,Ga);return new vr(i,a)}};const Ru=Math.PI/2;function Lu(n){return Math.tan((Ru+n)/2)}var Op={name:"lambertConformalConic",range:[3.5,7],center:[0,30],parallels:[30,30],conic:!0,initializeConstants(){if(this.constants&&Af(this.parallels,this.constants.parallels))return;const n=it(this.parallels[0]),e=it(this.parallels[1]),i=Math.cos(n),a=n===e?Math.sin(n):Math.log(i/Math.cos(e))/Math.log(Lu(e)/Lu(n)),u=i*Math.pow(Lu(n),a)/a;this.constants={n:a,f:u,parallels:this.parallels}},project(n,e){this.initializeConstants(),e=it(e),n=it(n-this.center[0]);const i=1e-6,{n:a,f:u}=this.constants;u>0?e<-Ru+i&&(e=-Ru+i):e>Ru-i&&(e=Ru-i);const f=u/Math.pow(Lu(e),a),g=f*Math.sin(a*n),x=u-f*Math.cos(a*n);return{x:.5*(g/Math.PI+.5),y:1-.5*(x/Math.PI+.5)}},unproject(n,e){this.initializeConstants(),n=(2*n-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:i,f:a}=this.constants,u=a-e,f=Math.sign(u),g=Math.sign(i)*Math.sqrt(n*n+u*u);let x=Math.atan2(n,Math.abs(u))*f;u*i<0&&(x-=Math.PI*Math.sign(n)*f);const b=zt(Ut(x/i)+this.center[0],-180,180),D=zt(Ut(2*Math.atan(Math.pow(a/g,1/i))-Ru),-85.051129,Ga);return new vr(b,D)}},zp={name:"mercator",wrap:!0,center:[0,0],project:(n,e)=>({x:gf(n),y:iu(e)}),unproject(n,e){const i=ja(n),a=$a(e);return new vr(i,a)}};const Bp=it(Ga);var b_={name:"naturalEarth",center:[0,0],range:[3.5,7],project(n,e){const i=(e=it(e))*e,a=i*i;return{x:.5*((n=it(n))*(.8707-.131979*i+a*(a*(.003971*i-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+i*(.015085+a*(.028874*i-.044475-.005916*a)))/Math.PI+1)}},unproject(n,e){n=(2*n-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,a=25,u=0,f=i*i;do{f=i*i;const b=f*f;u=(i*(1.007226+f*(.015085+b*(.028874*f-.044475-.005916*b)))-e)/(1.007226+f*(.045255+b*(.259866*f-.311325-.005916*11*b))),i=zt(i-u,-Bp,Bp)}while(Math.abs(u)>1e-6&&--a>0);f=i*i;const g=zt(Ut(n/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=Ut(i);return new vr(g,x)}};const Vd=it(Ga),jd={albers:v_,equalEarth:ra,equirectangular:x_,lambertConformalConic:Op,mercator:zp,naturalEarth:b_,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],project(n,e){e=it(e),n=it(n);const i=Math.cos(e),a=2/Math.PI,u=Math.acos(i*Math.cos(n/2)),f=Math.sin(u)/u,g=.5*(n*a+2*i*Math.sin(n/2)/f)||0,x=.5*(e+Math.sin(e)/f)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(x/Math.PI+1)}},unproject(n,e){let i=n=(2*n-.5)*Math.PI,a=e=(2*(1-e)-1)*Math.PI,u=25;const f=1e-6;let g=0,x=0;do{const b=Math.cos(a),D=Math.sin(a),A=2*D*b,P=D*D,F=b*b,$=Math.cos(i/2),Z=Math.sin(i/2),K=2*$*Z,ce=Z*Z,de=1-F*$*$,be=de?1/de:0,Me=de?Math.acos(b*$)*Math.sqrt(1/de):0,Pe=.5*(2*Me*b*Z+2*i/Math.PI)-n,Fe=.5*(Me*D+a)-e,Ne=.5*be*(F*ce+Me*b*$*P)+1/Math.PI,et=be*(K*A/4-Me*D*Z),Ke=.125*be*(A*Z-Me*D*F*K),Bt=.5*be*(P*$+Me*ce*b)+.5,yt=et*Ke-Bt*Ne;g=(Fe*et-Pe*Bt)/yt,x=(Pe*Ke-Fe*Ne)/yt,i=zt(i-g,-Math.PI,Math.PI),a=zt(a-x,-Vd,Vd)}while((Math.abs(g)>f||Math.abs(x)>f)&&--u>0);return new vr(Ut(i),Ut(a))}}};c.ARRAY_TYPE=ao,c.AUTH_ERR_MSG=Eo,c.Actor=class{constructor(n,e,i){this.target=n,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},lt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=lr()?n:He,this.scheduler=new y_}send(n,e,i,a,u=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=f,this.callbacks[g]=i);const x=to(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:n,hasCallback:!!i,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:M(e,x)},x),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(n){const e=n.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const a=this.cancelCallbacks[i];delete this.cancelCallbacks[i],a&&a.cancel()}else if(e.mustQueue||lr()){const a=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),a&&a.metadata||{type:"message"})}else this.processTask(i,e)}processTask(n,e){if("<response>"===e.type){const i=this.callbacks[n];delete this.callbacks[n],i&&(e.error?i(T(e.error)):i(null,T(e.data)))}else{const i=to(this.globalScope)?void 0:[],a=e.hasCallback?(f,g)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:f?M(f):null,data:M(g,i)},i)}:f=>{},u=T(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,a);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],u.source)[f[1]](u,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.CanonicalTileID=vh,c.Color=In,c.ColorMode=Li,c.CullFaceMode=Us,c.DEMData=Qa,c.DataConstantProperty=se,c.DedupedRequest=Fp,c.DepthMode=Nc,c.EXTENT=Kn,c.Elevation=class{getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){null==e&&(e=null);const a=this._source();if(!a||n.y<0||n.y>1)return e;const u=a.getSource().maxzoom,f=1<<u,g=Math.floor(n.x),x=n.x-g,b=new Lo(u,g,u,Math.floor(x*f),Math.floor(n.y*f)),D=this.findDEMTileFor(b);if(!D||!D.dem)return e;const A=D.dem,P=1<<D.tileID.canonical.z,F=(x*P-D.tileID.canonical.x)*A.dim,$=(n.y*P-D.tileID.canonical.y)*A.dim,Z=Math.floor(F),K=Math.floor($);return(i?this.exaggeration():1)*Jn(Jn(A.get(Z,K),A.get(Z,K+1),$-K),Jn(A.get(Z+1,K),A.get(Z+1,K+1),$-K),F-Z)}getAtTileOffset(n,e,i){const a=1<<n.canonical.z;return this.getAtPointOrZero(new Hu(n.wrap+(n.canonical.x+e/Kn)/a,(n.canonical.y+i/Kn)/a))}getForTilePoints(n,e,i,a){const u=wh.create(this,n,a);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(n){const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,u=1<<n.canonical.z-a.canonical.z;let f=n.canonical.x/u-a.canonical.x,g=n.canonical.y/u-a.canonical.y,x=0;for(let b=0;b<n.canonical.z-a.canonical.z&&!i.leaves[x];b++){f*=2,g*=2;const D=2*Math.floor(g)+Math.floor(f);x=i.childOffsets[x]+D,f%=1,g%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},c.ErrorEvent=tn,c.EvaluationParameters=V,c.Event=ct,c.Evented=St,c.GlyphManager=Ka,c.ImagePosition=ap,c.LineAtlas=gh,c.LngLat=vr,c.LngLatBounds=_l,c.LocalGlyphMode=hh,c.MAX_MERCATOR_LATITUDE=Ga,c.MAX_SAFE_INTEGER=mt,c.MercatorCoordinate=Hu,c.ONE_EM=24,c.OverscaledTileID=Lo,c.Properties=at,c.RGBAImage=ws,c.RequestManager=class{constructor(n,e,i){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Pi,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!dt(n))return n;const i=bt(n);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!dt(n))return n;const i=bt(n);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(n,e){if(!dt(n))return n;const i=bt(n);return i.path=`/v4/${i.authority}.json`,i.params.push("secure"),this._makeAPIURL(i,this._customAccessToken||e)}normalizeSpriteURL(n,e,i,a){const u=bt(n);return dt(n)?(u.path=`/styles/v1${u.path}/sprite${e}${i}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${e}${i}`,pt(u))}normalizeTileURL(n,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!dt(n))return n;const a=bt(n);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==a.authority&&512===i?"@2x":""}${xi.supported?".webp":"$1"}`),"raster"===a.authority?a.path=`/${jn.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${jn.TILE_URL_VERSION}${a.path}`);const u=this._customAccessToken||function(f){for(const g of f){const x=g.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(a.params)||jn.ACCESS_TOKEN;return jn.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(n,e){const i=bt(n);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return n;let a="mapbox://";i.path.match(/^\/raster\/v1\//)?a+=`raster/${i.path.replace(`/${jn.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${i.path.replace(`/${jn.TILE_URL_VERSION}/`,"")}`;let u=i.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(n,e){const i=!!e&&dt(e),a=[];for(const u of n.tiles||[])Ae(u)?a.push(this.canonicalizeTileURL(u,i)):a.push(u);return a}_makeAPIURL(n,e){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",a=bt(jn.API_URL);if(n.protocol=a.protocol,n.authority=a.authority,"http"===n.protocol){const u=n.params.indexOf("secure");u>=0&&n.params.splice(u,1)}if("/"!==a.path&&(n.path=`${a.path}${n.path}`),!jn.REQUIRE_ACCESS_TOKEN)return pt(n);if(e=e||jn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return n.params=n.params.filter(u=>-1===u.indexOf("access_token")),n.params.push(`access_token=${e||""}`),pt(n)}},c.ResourceType=Fo,c.SegmentVector=Hr,c.SourceCache=Tl,c.StencilMode=zd,c.StructArrayLayout1ui2=Ri,c.StructArrayLayout2f1f2i16=oo,c.StructArrayLayout2i4=Jt,c.StructArrayLayout2ui4=zr,c.StructArrayLayout3f12=Mn,c.StructArrayLayout3ui6=Si,c.StructArrayLayout4i8=wn,c.Texture=zc,c.Tile=Rd,c.Transitionable=le,c.Uniform1f=ru,c.Uniform1i=class extends ba{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},c.Uniform2f=class extends ba{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},c.Uniform3f=class extends ba{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},c.Uniform4f=hf,c.UniformColor=df,c.UniformMatrix2f=class extends ba{constructor(n,e){super(n,e),this.current=om}set(n){for(let e=0;e<4;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},c.UniformMatrix3f=class extends ba{constructor(n,e){super(n,e),this.current=im}set(n){for(let e=0;e<9;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},c.UniformMatrix4f=class extends ba{constructor(n,e){super(n,e),this.current=rm}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},c.UnwrappedTileID=Pd,c.ValidationError=te,c.VectorTileWorkerSource=class extends St{constructor(n,e,i,a,u){super(),this.actor=n,this.layerIndex=e,this.availableImages=i,this.loadVectorData=u||tg,this.loading={},this.loaded={},this.deduped=new Fp(n.scheduler),this.isSpriteLoaded=a,this.scheduler=n.scheduler}loadTile(n,e){const i=n.uid,a=n&&n.request,u=a&&a.collectResourceTiming,f=this.loading[i]=new Lp(n);f.abort=this.loadVectorData(n,(g,x)=>{const b=!this.loading[i];if(delete this.loading[i],b||g||!x)return f.status="done",b||(this.loaded[i]=f),e(g);const D=x.rawData,A={};x.expires&&(A.expires=x.expires),x.cacheControl&&(A.cacheControl=x.cacheControl),f.vectorTile=x.vectorTile||new ic.VectorTile(new bl(D));const P=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(F,$)=>{if(F||!$)return e(F);const Z={};if(u){const K=_h(a);K.length>0&&(Z.resourceTiming=JSON.parse(JSON.stringify(K)))}e(null,gn({rawTileData:D.slice(0)},$,A,Z))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[i]=f})}reloadTile(n,e){const i=this.loaded,a=n.uid,u=this;if(i&&i[a]){const f=i[a];f.showCollisionBoxes=n.showCollisionBoxes,f.enableTerrain=!!n.enableTerrain;const g=(x,b)=>{const D=f.reloadCallback;D&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,D)),e(x,b)};"parsing"===f.status?f.reloadCallback=g:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(n,e){const i=n.uid,a=this.loading[i];a&&(a.abort&&a.abort(),delete this.loading[i]),e()}removeTile(n,e){const i=this.loaded,a=n.uid;i&&i[a]&&delete i[a],e()}},c.WritingMode=zs,c.ZoomHistory=C,c.add=function(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n},c.addDynamicAttributes=Cd,c.altitudeFromMercatorZ=_f,c.asyncAll=mn,c.bezier=pn,c.bindAll=lt,c.boundsAttributes=Au,c.bufferConvexPolygon=function(n,e){const i=[];for(let a=0;a<n.length;a++){const u=gt(a-1,-1,n.length-1),f=gt(a+1,-1,n.length-1),g=n[a],x=n[f],b=n[u].sub(g).unit(),D=x.sub(g).unit(),A=D.angleWithSep(b.x,b.y),P=b.add(D).unit().mult(-1*e/Math.sin(A/2));i.push(g.add(P))}return i},c.cacheEntryPossiblyAdded=function(n){Ni++,Ni>bi&&(n.getActor().send("enforceCacheSizeLimit",Vr),Ni=0)},c.clamp=zt,c.clearTileCache=function(n){const e=He.caches.delete(Rn);n&&e.catch(n).then(()=>n())},c.clipLine=bd,c.clone=function(n){var e=new ao(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},c.clone$1=function(n){var e=new ao(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},c.clone$2=Sn,c.collisionCircleLayout=oh,c.config=jn,c.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},c.copy=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},c.create=cu,c.create$1=function(){var n=new ao(16);return ao!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},c.create$2=wf,c.createExpression=ks,c.createLayout=Ge,c.createStyleLayer=function(n){return"custom"===n.type?new qm(n):new Xm[n.type](n)},c.cross=function(n,e,i){var a=e[0],u=e[1],f=e[2],g=i[0],x=i[1],b=i[2];return n[0]=u*b-f*x,n[1]=f*g-a*b,n[2]=a*x-u*g,n},c.degToRad=it,c.div=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},c.dot=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},c.dot$1=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]},c.ease=on,c.easeCubicInOut=Ot,c.emitValidationErrors=Yc,c.endsWith=Pt,c.enforceCacheSizeLimit=function(n){uo(),tr&&tr.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-n;a++)e.delete(i[a])})})},c.evaluateSizeForFeature=Ac,c.evaluateSizeForZoom=os,c.evaluateVariableOffset=$m,c.evented=S,c.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},c.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},c.exported=On,c.exported$1=xi,c.extend=gn,c.filterObject=Tt,c.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},c.fromQuat=function(n,e){var i=e[0],a=e[1],u=e[2],f=e[3],g=i+i,x=a+a,b=u+u,D=i*g,A=a*g,P=a*x,F=u*g,$=u*x,Z=u*b,K=f*g,ce=f*x,de=f*b;return n[0]=1-P-Z,n[1]=A+de,n[2]=F-ce,n[3]=0,n[4]=A-de,n[5]=1-D-Z,n[6]=$+K,n[7]=0,n[8]=F+ce,n[9]=$-K,n[10]=1-D-P,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},c.fromRotation=function(n,e){var i=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=i,n[2]=0,n[3]=-i,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},c.fromScaling=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},c.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return hn[e]},c.getAABBPointSquareDist=function(n,e,i){let a=0;for(let u=0;u<2;++u){const f=i?i[u]:0;n[u]>f&&(a+=(n[u]-f)*(n[u]-f)),e[u]<f&&(a+=(f-e[u])*(f-e[u]))}return a},c.getAnchorAlignment=wu,c.getAnchorJustification=mp,c.getBounds=function(n){let e=1/0,i=1/0,a=-1/0,u=-1/0;for(const f of n)e=Math.min(e,f.x),i=Math.min(i,f.y),a=Math.max(a,f.x),u=Math.max(u,f.y);return{min:new je(e,i),max:new je(a,u)}},c.getImage=Ue,c.getJSON=function(n,e){return j(gn(n,{type:"json"}),e)},c.getMapSessionAPI=Xn,c.getPerformanceMeasurement=_h,c.getProjection=function(n){const e=jd[n.name];if(!e)throw new Error(`Invalid projection name: ${n.name}`);return e.conic?function(i,a){if(a.parallels&&Math.abs(a.parallels[0]+a.parallels[1])<.01){let u=function(f){const g=Math.max(.01,Math.cos(it(f))),x=1/(2*Math.max(Math.PI*g,1/g));return{wrap:!0,project(b,D){const A=it(b)*g,P=Math.sin(it(D))/g;return{x:A*x+.5,y:-P*x+.5}},unproject(b,D){const A=-(D-.5)/x,P=zt(Ut((b-.5)/x)/g,-180,180),F=Math.asin(zt(A*g,-1,1)),$=zt(Ut(F),-85.051129,Ga);return new vr(P,$)}}}(a.parallels[0]);if("lambertConformalConic"===a.name){const{project:f,unproject:g}=jd.mercator;u={wrap:!0,project:f,unproject:g}}return gn({},i,a,u)}return gn({},i,a)}(e,n):e},c.getRTLTextPluginStatus=R,c.getReferrer=Q,c.getTilePoint=function(n,{x:e,y:i},a=0){return new je(((e-a)*n.scale-n.x)*Kn,(i*n.scale-n.y)*Kn)},c.getTileVec3=function(n,e,i=0){return Ql(((e.x-i)*n.scale-n.x)*Kn,(e.y*n.scale-n.y)*Kn,_f(e.z,e.y))},c.getVideo=function(n,e){const i=He.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<n.length;a++){const u=He.document.createElement("source");Ee(n[a])||(i.crossOrigin="Anonymous"),u.src=n[a],i.appendChild(u)}return{cancel:()=>{}}},c.identity=Hh,c.identity$1=If,c.invert=function(n,e){var i=e[0],a=e[1],u=e[2],f=e[3],g=e[4],x=e[5],b=e[6],D=e[7],A=e[8],P=e[9],F=e[10],$=e[11],Z=e[12],K=e[13],ce=e[14],de=e[15],be=i*x-a*g,Me=i*b-u*g,Pe=i*D-f*g,Fe=a*b-u*x,Ne=a*D-f*x,et=u*D-f*b,Ke=A*K-P*Z,Bt=A*ce-F*Z,yt=A*de-$*Z,rt=P*ce-F*K,vt=P*de-$*K,Dt=F*de-$*ce,ut=be*Dt-Me*vt+Pe*rt+Fe*yt-Ne*Bt+et*Ke;return ut?(n[0]=(x*Dt-b*vt+D*rt)*(ut=1/ut),n[1]=(u*vt-a*Dt-f*rt)*ut,n[2]=(K*et-ce*Ne+de*Fe)*ut,n[3]=(F*Ne-P*et-$*Fe)*ut,n[4]=(b*yt-g*Dt-D*Bt)*ut,n[5]=(i*Dt-u*yt+f*Bt)*ut,n[6]=(ce*Pe-Z*et-de*Me)*ut,n[7]=(A*et-F*Pe+$*Me)*ut,n[8]=(g*vt-x*yt+D*Ke)*ut,n[9]=(a*yt-i*vt-f*Ke)*ut,n[10]=(Z*Ne-K*Pe+de*be)*ut,n[11]=(P*Pe-A*Ne-$*be)*ut,n[12]=(x*Bt-g*rt-b*Ke)*ut,n[13]=(i*rt-a*Bt+u*Ke)*ut,n[14]=(K*Me-Z*Fe-ce*be)*ut,n[15]=(A*Fe-P*Me+F*be)*ut,n):null},c.isMapAuthenticated=function(n){return qt.has(n)},c.isMapboxURL=dt,c.latFromMercatorY=$a,c.len=gm,c.length=Ef,c.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},c.loadVectorTile=tg,c.makeRequest=j,c.mercatorXfromLng=gf,c.mercatorYfromLat=iu,c.mercatorZfromAltitude=ou,c.mul=function(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n[3]=e[3]*i[3],n},c.mul$1=mm,c.mul$2=qh,c.multiply=Zh,c.multiply$1=Cf,c.nextPowerOfTwo=$e,c.normalize=Xu,c.normalize$1=function(n,e){var i=e[0],a=e[1],u=e[2],f=e[3],g=i*i+a*a+u*u+f*f;return g>0&&(g=1/Math.sqrt(g)),n[0]=i*g,n[1]=a*g,n[2]=u*g,n[3]=f*g,n},c.number=Jn,c.ortho=function(n,e,i,a,u,f,g){var x=1/(e-i),b=1/(a-u),D=1/(f-g);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*D,n[11]=0,n[12]=(e+i)*x,n[13]=(u+a)*b,n[14]=(g+f)*D,n[15]=1,n},c.pbf=bl,c.perspective=function(n,e,i,a,u){var f,g=1/Math.tan(e/2);return n[0]=g/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=u&&u!==1/0?(n[10]=(u+a)*(f=1/(a-u)),n[14]=2*u*a*f):(n[10]=-1,n[14]=-2*a),n},c.pick=function(n,e){const i={};for(let a=0;a<e.length;a++){const u=e[a];u in n&&(i[u]=n[u])}return i},c.plugin=N,c.pointGeometry=je,c.polygonIntersectsBox=pm,c.polygonIntersectsPolygon=yf,c.polygonizeBounds=function(n,e,i=0,a=!0){const u=new je(i,i),f=n.sub(u),g=e.add(u),x=[f,new je(g.x,f.y),g,new je(f.x,g.y)];return a&&x.push(f),x},c.posAttributes=Jm,c.postMapLoadEvent=fi,c.postTurnstileEvent=En,c.potpack=sp,c.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},c.radToDeg=Ut,c.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.registerForPluginStateChange=function(n){return n({pluginStatus:p,pluginURL:_}),S.on("pluginStateChange",n),n},c.removeAuthState=function(n){qt.delete(n)},c.renderColorRamp=Os,c.rotateX=function(n,e,i){var a=Math.sin(i),u=Math.cos(i),f=e[4],g=e[5],x=e[6],b=e[7],D=e[8],A=e[9],P=e[10],F=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*u+D*a,n[5]=g*u+A*a,n[6]=x*u+P*a,n[7]=b*u+F*a,n[8]=D*u-f*a,n[9]=A*u-g*a,n[10]=P*u-x*a,n[11]=F*u-b*a,n},c.rotateX$1=Mf,c.rotateY=function(n,e,i){var a=Math.sin(i),u=Math.cos(i),f=e[0],g=e[1],x=e[2],b=e[3],D=e[8],A=e[9],P=e[10],F=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u-D*a,n[1]=g*u-A*a,n[2]=x*u-P*a,n[3]=b*u-F*a,n[8]=f*a+D*u,n[9]=g*a+A*u,n[10]=x*a+P*u,n[11]=b*a+F*u,n},c.rotateZ=function(n,e,i){var a=Math.sin(i),u=Math.cos(i),f=e[0],g=e[1],x=e[2],b=e[3],D=e[4],A=e[5],P=e[6],F=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u+D*a,n[1]=g*u+A*a,n[2]=x*u+P*a,n[3]=b*u+F*a,n[4]=D*u-f*a,n[5]=A*u-g*a,n[6]=P*u-x*a,n[7]=F*u-b*a,n},c.rotateZ$1=function(n,e,i){i*=.5;var a=e[0],u=e[1],f=e[2],g=e[3],x=Math.sin(i),b=Math.cos(i);return n[0]=a*b+u*x,n[1]=u*b-a*x,n[2]=f*b+g*x,n[3]=g*b-f*x,n},c.scale=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n},c.scale$1=function(n,e,i){var a=i[0],u=i[1],f=i[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},c.scale$2=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n},c.scaleAndAdd=Tf,c.setCacheLimits=function(n,e){Vr=n,bi=e},c.setRTLTextPlugin=function(n,e,i=!1){if(p===Zl||p===d||p===t)throw new Error("setRTLTextPlugin cannot be called multiple times.");_=On.resolveURL(n),p=Zl,l=e,E(),i||O()},c.smoothstep=function(n,e,i){return(i=zt((i-n)/(e-n),0,1))*i*(3-2*i)},c.spec=we,c.storeAuthState=function(n,e){e?qt.add(n):qt.delete(n)},c.sub=s_,c.subtract=Df,c.symbolSize=fd,c.tileTransform=yh,c.transformMat3=function(n,e,i){var a=e[0],u=e[1],f=e[2];return n[0]=a*i[0]+u*i[3]+f*i[6],n[1]=a*i[1]+u*i[4]+f*i[7],n[2]=a*i[2]+u*i[5]+f*i[8],n},c.transformMat4=hu,c.transformMat4$1=function(n,e,i){var a=e[0],u=e[1],f=e[2],g=i[3]*a+i[7]*u+i[11]*f+i[15];return n[0]=(i[0]*a+i[4]*u+i[8]*f+i[12])/(g=g||1),n[1]=(i[1]*a+i[5]*u+i[9]*f+i[13])/g,n[2]=(i[2]*a+i[6]*u+i[10]*f+i[14])/g,n},c.transformQuat=Sf,c.translate=function(n,e,i){var a,u,f,g,x,b,D,A,P,F,$,Z,K=i[0],ce=i[1],de=i[2];return e===n?(n[12]=e[0]*K+e[4]*ce+e[8]*de+e[12],n[13]=e[1]*K+e[5]*ce+e[9]*de+e[13],n[14]=e[2]*K+e[6]*ce+e[10]*de+e[14],n[15]=e[3]*K+e[7]*ce+e[11]*de+e[15]):(u=e[1],f=e[2],g=e[3],x=e[4],b=e[5],D=e[6],A=e[7],P=e[8],F=e[9],$=e[10],Z=e[11],n[0]=a=e[0],n[1]=u,n[2]=f,n[3]=g,n[4]=x,n[5]=b,n[6]=D,n[7]=A,n[8]=P,n[9]=F,n[10]=$,n[11]=Z,n[12]=a*K+x*ce+P*de+e[12],n[13]=u*K+b*ce+F*de+e[13],n[14]=f*K+D*ce+$*de+e[14],n[15]=g*K+A*ce+Z*de+e[15]),n},c.triggerPluginCompletionEvent=v,c.uniqueId=Ht,c.validateCustomStyleLayer=function(n){const e=[],i=n.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===n.render&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},c.validateFog=Ls,c.validateLight=Xc,c.validateStyle=Ao,c.values=Fn,c.vectorTile=ic,c.version="2.6.1",c.warnOnce=nn,c.window=He,c.wrap=gt}),oe(0,function(c){function Et(Q){const j=typeof Q;if("number"===j||"boolean"===j||"string"===j||null==Q)return JSON.stringify(Q);if(Array.isArray(Q)){let pe="[";for(const Ee of Q)pe+=`${Et(Ee)},`;return`${pe}]`}const H=Object.keys(Q).sort();let ee="{";for(let pe=0;pe<H.length;pe++)ee+=`${JSON.stringify(H[pe])}:${Et(Q[H[pe]])},`;return`${ee}}`}function an(Q){let j="";for(const H of c.refProperties)j+=`/${Et(Q[H])}`;return j}class Gt{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,H){for(const pe of j)this._layerConfigs[pe.id]=pe,(this._layers[pe.id]=c.createStyleLayer(pe)).compileFilter(),this.keyCache[pe.id]&&delete this.keyCache[pe.id];for(const pe of H)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const ee=function(pe,Ee){const Le={};for(let Ce=0;Ce<pe.length;Ce++){const Ue=Ee&&Ee[pe[Ce].id]||an(pe[Ce]);Ee&&(Ee[pe[Ce].id]=Ue);let st=Le[Ue];st||(st=Le[Ue]=[]),st.push(pe[Ce])}const Be=[];for(const Ce in Le)Be.push(Le[Ce]);return Be}(c.values(this._layerConfigs),this.keyCache);for(const pe of ee){const Ee=pe.map(At=>this._layers[At.id]),Le=Ee[0];if("none"===Le.visibility)continue;const Be=Le.source||"";let Ce=this.familiesBySource[Be];Ce||(Ce=this.familiesBySource[Be]={});const Ue=Le.sourceLayer||"_geojsonTileLayer";let st=Ce[Ue];st||(st=Ce[Ue]=[]),st.push(Ee)}}}const{ImageBitmap:je}=c.window;class ze{loadTile(j,H){const{uid:ee,encoding:pe,rawImageData:Ee,padding:Le,buildQuadTree:Be}=j,Ce=je&&Ee instanceof je?this.getImageData(Ee,Le):Ee;H(null,new c.DEMData(ee,Ce,pe,Le<1,Be))}getImageData(j,H){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(j.width,j.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=j.width,this.offscreenCanvas.height=j.height,this.offscreenCanvasContext.drawImage(j,0,0,j.width,j.height);const ee=this.offscreenCanvasContext.getImageData(-H,-H,j.width+2*H,j.height+2*H);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new c.RGBAImage({width:ee.width,height:ee.height},ee.data)}}var He=function Q(j,H){var ee,pe=j&&j.type;if("FeatureCollection"===pe)for(ee=0;ee<j.features.length;ee++)Q(j.features[ee],H);else if("GeometryCollection"===pe)for(ee=0;ee<j.geometries.length;ee++)Q(j.geometries[ee],H);else if("Feature"===pe)Q(j.geometry,H);else if("Polygon"===pe)mt(j.coordinates,H);else if("MultiPolygon"===pe)for(ee=0;ee<j.coordinates.length;ee++)mt(j.coordinates[ee],H);return j};function mt(Q,j){if(0!==Q.length){Zt(Q[0],j);for(var H=1;H<Q.length;H++)Zt(Q[H],!j)}}function Zt(Q,j){for(var H=0,ee=0,pe=0,Ee=Q.length,Le=Ee-1;pe<Ee;Le=pe++){var Be=(Q[pe][0]-Q[Le][0])*(Q[Le][1]+Q[pe][1]),Ce=H+Be;ee+=Math.abs(H)>=Math.abs(Be)?H-Ce+Be:Be-Ce+H,H=Ce}H+ee>=0!=!!j&&Q.reverse()}const Tn=c.vectorTile.VectorTileFeature.prototype.toGeoJSON;class it{constructor(j){this._feature=j,this.extent=c.EXTENT,this.type=j.type,this.properties=j.tags,"id"in j&&!isNaN(j.id)&&(this.id=parseInt(j.id,10))}loadGeometry(){if(1===this._feature.type){const j=[];for(const H of this._feature.geometry)j.push([new c.pointGeometry(H[0],H[1])]);return j}{const j=[];for(const H of this._feature.geometry){const ee=[];for(const pe of H)ee.push(new c.pointGeometry(pe[0],pe[1]));j.push(ee)}return j}}toGeoJSON(j,H,ee){return Tn.call(this,j,H,ee)}}class Ut{constructor(j){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.EXTENT,this.length=j.length,this._features=j}feature(j){return new it(this._features[j])}}var hn=c.vectorTile.VectorTileFeature,Ot=pn;function pn(Q,j){this.options=j||{},this.features=Q,this.length=Q.length}function on(Q,j){this.id="number"==typeof Q.id?Q.id:void 0,this.type=Q.type,this.rawGeometry=1===Q.type?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=j||4096}pn.prototype.feature=function(Q){return new on(this.features[Q],this.options.extent)},on.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var j=0;j<Q.length;j++){for(var H=Q[j],ee=[],pe=0;pe<H.length;pe++)ee.push(new c.pointGeometry(H[pe][0],H[pe][1]));this.geometry.push(ee)}return this.geometry},on.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,j=1/0,H=-1/0,ee=1/0,pe=-1/0,Ee=0;Ee<Q.length;Ee++)for(var Le=Q[Ee],Be=0;Be<Le.length;Be++){var Ce=Le[Be];j=Math.min(j,Ce.x),H=Math.max(H,Ce.x),ee=Math.min(ee,Ce.y),pe=Math.max(pe,Ce.y)}return[j,ee,H,pe]},on.prototype.toGeoJSON=hn.prototype.toGeoJSON;var zt=mn,gt=Ot;function mn(Q){var j=new c.pbf;return function(H,ee){for(var pe in H.layers)ee.writeMessage(3,Fn,H.layers[pe])}(Q,j),j.finish()}function Fn(Q,j){var H;j.writeVarintField(15,Q.version||1),j.writeStringField(1,Q.name||""),j.writeVarintField(5,Q.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(H=0;H<Q.length;H++)ee.feature=Q.feature(H),j.writeMessage(2,gn,ee);var pe=ee.keys;for(H=0;H<pe.length;H++)j.writeStringField(3,pe[H]);var Ee=ee.values;for(H=0;H<Ee.length;H++)j.writeMessage(4,tt,Ee[H])}function gn(Q,j){var H=Q.feature;void 0!==H.id&&j.writeVarintField(1,H.id),j.writeMessage(2,dn,Q),j.writeVarintField(3,H.type),j.writeMessage(4,$e,H)}function dn(Q,j){var H=Q.feature,ee=Q.keys,pe=Q.values,Ee=Q.keycache,Le=Q.valuecache;for(var Be in H.properties){var Ce=H.properties[Be],Ue=Ee[Be];if(null!==Ce){void 0===Ue&&(ee.push(Be),Ee[Be]=Ue=ee.length-1),j.writeVarint(Ue);var st=typeof Ce;"string"!==st&&"boolean"!==st&&"number"!==st&&(Ce=JSON.stringify(Ce));var At=st+":"+Ce,ct=Le[At];void 0===ct&&(pe.push(Ce),Le[At]=ct=pe.length-1),j.writeVarint(ct)}}}function Ht(Q,j){return(j<<3)+(7&Q)}function Re(Q){return Q<<1^Q>>31}function $e(Q,j){for(var H=Q.loadGeometry(),ee=Q.type,pe=0,Ee=0,Le=H.length,Be=0;Be<Le;Be++){var Ce=H[Be],Ue=1;1===ee&&(Ue=Ce.length),j.writeVarint(Ht(1,Ue));for(var st=3===ee?Ce.length-1:Ce.length,At=0;At<st;At++){1===At&&1!==ee&&j.writeVarint(Ht(2,st-1));var ct=Ce[At].x-pe,tn=Ce[At].y-Ee;j.writeVarint(Re(ct)),j.writeVarint(Re(tn)),pe+=ct,Ee+=tn}3===ee&&j.writeVarint(Ht(7,1))}}function tt(Q,j){var H=typeof Q;"string"===H?j.writeStringField(1,Q):"boolean"===H?j.writeBooleanField(7,Q):"number"===H&&(Q%1!=0?j.writeDoubleField(3,Q):Q<0?j.writeSVarintField(6,Q):j.writeVarintField(5,Q))}function lt(Q,j,H,ee,pe,Ee){if(pe-ee<=H)return;const Le=ee+pe>>1;Pt(Q,j,Le,ee,pe,Ee%2),lt(Q,j,H,ee,Le-1,Ee+1),lt(Q,j,H,Le+1,pe,Ee+1)}function Pt(Q,j,H,ee,pe,Ee){for(;pe>ee;){if(pe-ee>600){const Ue=pe-ee+1,st=H-ee+1,At=Math.log(Ue),ct=.5*Math.exp(2*At/3),tn=.5*Math.sqrt(At*ct*(Ue-ct)/Ue)*(st-Ue/2<0?-1:1);Pt(Q,j,H,Math.max(ee,Math.floor(H-st*ct/Ue+tn)),Math.min(pe,Math.floor(H+(Ue-st)*ct/Ue+tn)),Ee)}const Le=j[2*H+Ee];let Be=ee,Ce=pe;for(Ye(Q,j,ee,H),j[2*pe+Ee]>Le&&Ye(Q,j,ee,pe);Be<Ce;){for(Ye(Q,j,Be,Ce),Be++,Ce--;j[2*Be+Ee]<Le;)Be++;for(;j[2*Ce+Ee]>Le;)Ce--}j[2*ee+Ee]===Le?Ye(Q,j,ee,Ce):(Ce++,Ye(Q,j,Ce,pe)),Ce<=H&&(ee=Ce+1),H<=Ce&&(pe=Ce-1)}}function Ye(Q,j,H,ee){Tt(Q,H,ee),Tt(j,2*H,2*ee),Tt(j,2*H+1,2*ee+1)}function Tt(Q,j,H){const ee=Q[j];Q[j]=Q[H],Q[H]=ee}function Sn(Q,j,H,ee){const pe=Q-H,Ee=j-ee;return pe*pe+Ee*Ee}zt.fromVectorTileJs=mn,zt.fromGeojsonVt=function(Q,j){j=j||{};var H={};for(var ee in Q)H[ee]=new Ot(Q[ee].features,j),H[ee].name=ee,H[ee].version=j.version,H[ee].extent=j.extent;return mn({layers:H})},zt.GeoJSONWrapper=gt;const Er=Q=>Q[0],nn=Q=>Q[1];class Wn{constructor(j,H=Er,ee=nn,pe=64,Ee=Float64Array){this.nodeSize=pe,this.points=j;const Le=j.length<65536?Uint16Array:Uint32Array,Be=this.ids=new Le(j.length),Ce=this.coords=new Ee(2*j.length);for(let Ue=0;Ue<j.length;Ue++)Be[Ue]=Ue,Ce[2*Ue]=H(j[Ue]),Ce[2*Ue+1]=ee(j[Ue]);lt(Be,Ce,pe,0,Be.length-1,0)}range(j,H,ee,pe){return function(Ee,Le,Be,Ce,Ue,st,At){const ct=[0,Ee.length-1,0],tn=[];let St,we;for(;ct.length;){const te=ct.pop(),ye=ct.pop(),ae=ct.pop();if(ye-ae<=At){for(let Rt=ae;Rt<=ye;Rt++)St=Le[2*Rt],we=Le[2*Rt+1],St>=Be&&St<=Ue&&we>=Ce&&we<=st&&tn.push(Ee[Rt]);continue}const ke=Math.floor((ae+ye)/2);St=Le[2*ke],we=Le[2*ke+1],St>=Be&&St<=Ue&&we>=Ce&&we<=st&&tn.push(Ee[ke]);const qe=(te+1)%2;(0===te?Be<=St:Ce<=we)&&(ct.push(ae),ct.push(ke-1),ct.push(qe)),(0===te?Ue>=St:st>=we)&&(ct.push(ke+1),ct.push(ye),ct.push(qe))}return tn}(this.ids,this.coords,j,H,ee,pe,this.nodeSize)}within(j,H,ee){return function(pe,Ee,Le,Be,Ce,Ue){const st=[0,pe.length-1,0],At=[],ct=Ce*Ce;for(;st.length;){const tn=st.pop(),St=st.pop(),we=st.pop();if(St-we<=Ue){for(let qe=we;qe<=St;qe++)Sn(Ee[2*qe],Ee[2*qe+1],Le,Be)<=ct&&At.push(pe[qe]);continue}const te=Math.floor((we+St)/2),ye=Ee[2*te],ae=Ee[2*te+1];Sn(ye,ae,Le,Be)<=ct&&At.push(pe[te]);const ke=(tn+1)%2;(0===tn?Le-Ce<=ye:Be-Ce<=ae)&&(st.push(we),st.push(te-1),st.push(ke)),(0===tn?Le+Ce>=ye:Be+Ce>=ae)&&(st.push(te+1),st.push(St),st.push(ke))}return At}(this.ids,this.coords,j,H,ee,this.nodeSize)}}const zi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},lr=Math.fround||(Nr=new Float32Array(1),Q=>(Nr[0]=+Q,Nr[0]));var Nr;class Wr{constructor(j){this.options=jn(Object.create(zi),j),this.trees=new Array(this.options.maxZoom+1)}load(j){const{log:H,minZoom:ee,maxZoom:pe,nodeSize:Ee}=this.options;H&&console.time("total time");const Le=`prepare ${j.length} points`;H&&console.time(Le),this.points=j;let Be=[];for(let Ce=0;Ce<j.length;Ce++)j[Ce].geometry&&Be.push(Wi(j[Ce],Ce));this.trees[pe+1]=new Wn(Be,xi,$n,Ee,Float32Array),H&&console.timeEnd(Le);for(let Ce=pe;Ce>=ee;Ce--){const Ue=+Date.now();Be=this._cluster(Be,Ce),this.trees[Ce]=new Wn(Be,xi,$n,Ee,Float32Array),H&&console.log("z%d: %d clusters in %dms",Ce,Be.length,+Date.now()-Ue)}return H&&console.timeEnd("total time"),this}getClusters(j,H){let ee=((j[0]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,j[1]));let Ee=180===j[2]?180:((j[2]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)ee=-180,Ee=180;else if(ee>Ee){const st=this.getClusters([ee,pe,180,Le],H),At=this.getClusters([-180,pe,Ee,Le],H);return st.concat(At)}const Be=this.trees[this._limitZoom(H)],Ce=Be.range(Ir(ee),On(Le),Ir(Ee),On(pe)),Ue=[];for(const st of Ce){const At=Be.points[st];Ue.push(At.numPoints?Xr(At):this.points[At.index])}return Ue}getChildren(j){const H=this._getOriginId(j),ee=this._getOriginZoom(j),pe="No cluster with the specified id.",Ee=this.trees[ee];if(!Ee)throw new Error(pe);const Le=Ee.points[H];if(!Le)throw new Error(pe);const Be=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),Ce=Ee.within(Le.x,Le.y,Be),Ue=[];for(const st of Ce){const At=Ee.points[st];At.parentId===j&&Ue.push(At.numPoints?Xr(At):this.points[At.index])}if(0===Ue.length)throw new Error(pe);return Ue}getLeaves(j,H,ee){const pe=[];return this._appendLeaves(pe,j,H=H||10,ee=ee||0,0),pe}getTile(j,H,ee){const pe=this.trees[this._limitZoom(j)],Ee=Math.pow(2,j),{extent:Le,radius:Be}=this.options,Ce=Be/Le,Ue=(ee-Ce)/Ee,st=(ee+1+Ce)/Ee,At={features:[]};return this._addTileFeatures(pe.range((H-Ce)/Ee,Ue,(H+1+Ce)/Ee,st),pe.points,H,ee,Ee,At),0===H&&this._addTileFeatures(pe.range(1-Ce/Ee,Ue,1,st),pe.points,Ee,ee,Ee,At),H===Ee-1&&this._addTileFeatures(pe.range(0,Ue,Ce/Ee,st),pe.points,-1,ee,Ee,At),At.features.length?At:null}getClusterExpansionZoom(j){let H=this._getOriginZoom(j)-1;for(;H<=this.options.maxZoom;){const ee=this.getChildren(j);if(H++,1!==ee.length)break;j=ee[0].properties.cluster_id}return H}_appendLeaves(j,H,ee,pe,Ee){const Le=this.getChildren(H);for(const Be of Le){const Ce=Be.properties;if(Ce&&Ce.cluster?Ee+Ce.point_count<=pe?Ee+=Ce.point_count:Ee=this._appendLeaves(j,Ce.cluster_id,ee,pe,Ee):Ee<pe?Ee++:j.push(Be),j.length===ee)break}return Ee}_addTileFeatures(j,H,ee,pe,Ee,Le){for(const Be of j){const Ce=H[Be],Ue=Ce.numPoints;let st,At,ct;if(Ue)st=to(Ce),At=Ce.x,ct=Ce.y;else{const we=this.points[Ce.index];st=we.properties,At=Ir(we.geometry.coordinates[0]),ct=On(we.geometry.coordinates[1])}const tn={type:1,geometry:[[Math.round(this.options.extent*(At*Ee-ee)),Math.round(this.options.extent*(ct*Ee-pe))]],tags:st};let St;Ue?St=Ce.id:this.options.generateId?St=Ce.index:this.points[Ce.index].id&&(St=this.points[Ce.index].id),void 0!==St&&(tn.id=St),Le.features.push(tn)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(+j,this.options.maxZoom+1))}_cluster(j,H){const ee=[],{radius:pe,extent:Ee,reduce:Le,minPoints:Be}=this.options,Ce=pe/(Ee*Math.pow(2,H));for(let Ue=0;Ue<j.length;Ue++){const st=j[Ue];if(st.zoom<=H)continue;st.zoom=H;const At=this.trees[H+1],ct=At.within(st.x,st.y,Ce),tn=st.numPoints||1;let St=tn;for(const we of ct){const te=At.points[we];te.zoom>H&&(St+=te.numPoints||1)}if(St>tn&&St>=Be){let we=st.x*tn,te=st.y*tn,ye=Le&&tn>1?this._map(st,!0):null;const ae=(Ue<<5)+(H+1)+this.points.length;for(const ke of ct){const qe=At.points[ke];if(qe.zoom<=H)continue;qe.zoom=H;const Rt=qe.numPoints||1;we+=qe.x*Rt,te+=qe.y*Rt,qe.parentId=ae,Le&&(ye||(ye=this._map(st,!0)),Le(ye,this._map(qe)))}st.parentId=ae,ee.push(kn(we/St,te/St,ae,St,ye))}else if(ee.push(st),St>1)for(const we of ct){const te=At.points[we];te.zoom<=H||(te.zoom=H,ee.push(te))}}return ee}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,H){if(j.numPoints)return H?jn({},j.properties):j.properties;const ee=this.points[j.index].properties,pe=this.options.map(ee);return H&&pe===ee?jn({},pe):pe}}function kn(Q,j,H,ee,pe){return{x:lr(Q),y:lr(j),zoom:1/0,id:H,parentId:-1,numPoints:ee,properties:pe}}function Wi(Q,j){const[H,ee]=Q.geometry.coordinates;return{x:lr(Ir(H)),y:lr(On(ee)),zoom:1/0,index:j,parentId:-1}}function Xr(Q){return{type:"Feature",id:Q.id,properties:to(Q),geometry:{type:"Point",coordinates:[(j=Q.x,360*(j-.5)),Bi(Q.y)]}};var j}function to(Q){const j=Q.numPoints,H=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j;return jn(jn({},Q.properties),{cluster:!0,cluster_id:Q.id,point_count:j,point_count_abbreviated:H})}function Ir(Q){return Q/360+.5}function On(Q){const j=Math.sin(Q*Math.PI/180),H=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return H<0?0:H>1?1:H}function Bi(Q){const j=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function jn(Q,j){for(const H in j)Q[H]=j[H];return Q}function xi(Q){return Q.x}function $n(Q){return Q.y}function Rr(Q,j,H,ee){for(var pe,Ee=ee,Le=H-j>>1,Be=H-j,Ce=Q[j],Ue=Q[j+1],st=Q[H],At=Q[H+1],ct=j+3;ct<H;ct+=3){var tn=Xi(Q[ct],Q[ct+1],Ce,Ue,st,At);if(tn>Ee)pe=ct,Ee=tn;else if(tn===Ee){var St=Math.abs(ct-Le);St<Be&&(pe=ct,Be=St)}}Ee>ee&&(pe-j>3&&Rr(Q,j,pe,ee),Q[pe+2]=Ee,H-pe>3&&Rr(Q,pe,H,ee))}function Xi(Q,j,H,ee,pe,Ee){var Le=pe-H,Be=Ee-ee;if(0!==Le||0!==Be){var Ce=((Q-H)*Le+(j-ee)*Be)/(Le*Le+Be*Be);Ce>1?(H=pe,ee=Ee):Ce>0&&(H+=Le*Ce,ee+=Be*Ce)}return(Le=Q-H)*Le+(Be=j-ee)*Be}function Kr(Q,j,H,ee){var pe={id:void 0===Q?null:Q,type:j,geometry:H,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ee){var Le=Ee.geometry,Be=Ee.type;if("Point"===Be||"MultiPoint"===Be||"LineString"===Be)Lr(Ee,Le);else if("Polygon"===Be||"MultiLineString"===Be)for(var Ce=0;Ce<Le.length;Ce++)Lr(Ee,Le[Ce]);else if("MultiPolygon"===Be)for(Ce=0;Ce<Le.length;Ce++)for(var Ue=0;Ue<Le[Ce].length;Ue++)Lr(Ee,Le[Ce][Ue])}(pe),pe}function Lr(Q,j){for(var H=0;H<j.length;H+=3)Q.minX=Math.min(Q.minX,j[H]),Q.minY=Math.min(Q.minY,j[H+1]),Q.maxX=Math.max(Q.maxX,j[H]),Q.maxY=Math.max(Q.maxY,j[H+1])}function Pi(Q,j,H,ee){if(j.geometry){var pe=j.geometry.coordinates,Ee=j.geometry.type,Le=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2),Be=[],Ce=j.id;if(H.promoteId?Ce=j.properties[H.promoteId]:H.generateId&&(Ce=ee||0),"Point"===Ee)Eo(pe,Be);else if("MultiPoint"===Ee)for(var Ue=0;Ue<pe.length;Ue++)Eo(pe[Ue],Be);else if("LineString"===Ee)dt(pe,Be,Le,!1);else if("MultiLineString"===Ee){if(H.lineMetrics){for(Ue=0;Ue<pe.length;Ue++)dt(pe[Ue],Be=[],Le,!1),Q.push(Kr(Ce,"LineString",Be,j.properties));return}Ae(pe,Be,Le,!1)}else if("Polygon"===Ee)Ae(pe,Be,Le,!0);else{if("MultiPolygon"!==Ee){if("GeometryCollection"===Ee){for(Ue=0;Ue<j.geometry.geometries.length;Ue++)Pi(Q,{id:Ce,geometry:j.geometry.geometries[Ue],properties:j.properties},H,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ue=0;Ue<pe.length;Ue++){var st=[];Ae(pe[Ue],st,Le,!0),Be.push(st)}}Q.push(Kr(Ce,Ee,Be,j.properties))}}function Eo(Q,j){j.push(Oe(Q[0])),j.push(bt(Q[1])),j.push(0)}function dt(Q,j,H,ee){for(var pe,Ee,Le=0,Be=0;Be<Q.length;Be++){var Ce=Oe(Q[Be][0]),Ue=bt(Q[Be][1]);j.push(Ce),j.push(Ue),j.push(0),Be>0&&(Le+=ee?(pe*Ue-Ce*Ee)/2:Math.sqrt(Math.pow(Ce-pe,2)+Math.pow(Ue-Ee,2))),pe=Ce,Ee=Ue}var st=j.length-3;j[2]=1,Rr(j,0,st,H),j[st+2]=1,j.size=Math.abs(Le),j.start=0,j.end=j.size}function Ae(Q,j,H,ee){for(var pe=0;pe<Q.length;pe++){var Ee=[];dt(Q[pe],Ee,H,ee),j.push(Ee)}}function Oe(Q){return Q/360+.5}function bt(Q){var j=Math.sin(Q*Math.PI/180),H=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return H<0?0:H>1?1:H}function pt(Q,j,H,ee,pe,Ee,Le,Be){if(ee/=j,Ee>=(H/=j)&&Le<ee)return Q;if(Le<H||Ee>=ee)return null;for(var Ce=[],Ue=0;Ue<Q.length;Ue++){var st=Q[Ue],At=st.geometry,ct=st.type,tn=0===pe?st.minX:st.minY,St=0===pe?st.maxX:st.maxY;if(tn>=H&&St<ee)Ce.push(st);else if(!(St<H||tn>=ee)){var we=[];if("Point"===ct||"MultiPoint"===ct)_t(At,we,H,ee,pe);else if("LineString"===ct)Vt(At,we,H,ee,pe,!1,Be.lineMetrics);else if("MultiLineString"===ct)En(At,we,H,ee,pe,!1);else if("Polygon"===ct)En(At,we,H,ee,pe,!0);else if("MultiPolygon"===ct)for(var te=0;te<At.length;te++){var ye=[];En(At[te],ye,H,ee,pe,!0),ye.length&&we.push(ye)}if(we.length){if(Be.lineMetrics&&"LineString"===ct){for(te=0;te<we.length;te++)Ce.push(Kr(st.id,ct,we[te],st.tags));continue}"LineString"!==ct&&"MultiLineString"!==ct||(1===we.length?(ct="LineString",we=we[0]):ct="MultiLineString"),"Point"!==ct&&"MultiPoint"!==ct||(ct=3===we.length?"Point":"MultiPoint"),Ce.push(Kr(st.id,ct,we,st.tags))}}}return Ce.length?Ce:null}function _t(Q,j,H,ee,pe){for(var Ee=0;Ee<Q.length;Ee+=3){var Le=Q[Ee+pe];Le>=H&&Le<=ee&&(j.push(Q[Ee]),j.push(Q[Ee+1]),j.push(Q[Ee+2]))}}function Vt(Q,j,H,ee,pe,Ee,Le){for(var Be,Ce,Ue=en(Q),st=0===pe?fi:Ur,At=Q.start,ct=0;ct<Q.length-3;ct+=3){var tn=Q[ct],St=Q[ct+1],we=Q[ct+2],te=Q[ct+3],ye=Q[ct+4],ae=0===pe?tn:St,ke=0===pe?te:ye,qe=!1;Le&&(Be=Math.sqrt(Math.pow(tn-te,2)+Math.pow(St-ye,2))),ae<H?ke>H&&(Ce=st(Ue,tn,St,te,ye,H),Le&&(Ue.start=At+Be*Ce)):ae>ee?ke<ee&&(Ce=st(Ue,tn,St,te,ye,ee),Le&&(Ue.start=At+Be*Ce)):_r(Ue,tn,St,we),ke<H&&ae>=H&&(Ce=st(Ue,tn,St,te,ye,H),qe=!0),ke>ee&&ae<=ee&&(Ce=st(Ue,tn,St,te,ye,ee),qe=!0),!Ee&&qe&&(Le&&(Ue.end=At+Be*Ce),j.push(Ue),Ue=en(Q)),Le&&(At+=Be)}var Rt=Q.length-3;tn=Q[Rt],St=Q[Rt+1],we=Q[Rt+2],(ae=0===pe?tn:St)>=H&&ae<=ee&&_r(Ue,tn,St,we),Rt=Ue.length-3,Ee&&Rt>=3&&(Ue[Rt]!==Ue[0]||Ue[Rt+1]!==Ue[1])&&_r(Ue,Ue[0],Ue[1],Ue[2]),Ue.length&&j.push(Ue)}function en(Q){var j=[];return j.size=Q.size,j.start=Q.start,j.end=Q.end,j}function En(Q,j,H,ee,pe,Ee){for(var Le=0;Le<Q.length;Le++)Vt(Q[Le],j,H,ee,pe,Ee,!1)}function _r(Q,j,H,ee){Q.push(j),Q.push(H),Q.push(ee)}function fi(Q,j,H,ee,pe,Ee){var Le=(Ee-j)/(ee-j);return Q.push(Ee),Q.push(H+(pe-H)*Le),Q.push(1),Le}function Ur(Q,j,H,ee,pe,Ee){var Le=(Ee-H)/(pe-H);return Q.push(j+(ee-j)*Le),Q.push(Ee),Q.push(1),Le}function Xn(Q,j){for(var H=[],ee=0;ee<Q.length;ee++){var pe,Ee=Q[ee],Le=Ee.type;if("Point"===Le||"MultiPoint"===Le||"LineString"===Le)pe=qt(Ee.geometry,j);else if("MultiLineString"===Le||"Polygon"===Le){pe=[];for(var Be=0;Be<Ee.geometry.length;Be++)pe.push(qt(Ee.geometry[Be],j))}else if("MultiPolygon"===Le)for(pe=[],Be=0;Be<Ee.geometry.length;Be++){for(var Ce=[],Ue=0;Ue<Ee.geometry[Be].length;Ue++)Ce.push(qt(Ee.geometry[Be][Ue],j));pe.push(Ce)}H.push(Kr(Ee.id,Le,pe,Ee.tags))}return H}function qt(Q,j){var H=[];H.size=Q.size,void 0!==Q.start&&(H.start=Q.start,H.end=Q.end);for(var ee=0;ee<Q.length;ee+=3)H.push(Q[ee]+j,Q[ee+1],Q[ee+2]);return H}function Rn(Q,j){if(Q.transformed)return Q;var H,ee,pe,Ee=1<<Q.z,Le=Q.x,Be=Q.y;for(H=0;H<Q.features.length;H++){var Ce=Q.features[H],Ue=Ce.geometry,st=Ce.type;if(Ce.geometry=[],1===st)for(ee=0;ee<Ue.length;ee+=2)Ce.geometry.push(tr(Ue[ee],Ue[ee+1],j,Ee,Le,Be));else for(ee=0;ee<Ue.length;ee++){var At=[];for(pe=0;pe<Ue[ee].length;pe+=2)At.push(tr(Ue[ee][pe],Ue[ee][pe+1],j,Ee,Le,Be));Ce.geometry.push(At)}}return Q.transformed=!0,Q}function tr(Q,j,H,ee,pe,Ee){return[Math.round(H*(Q*ee-pe)),Math.round(H*(j*ee-Ee))]}function Gn(Q,j,H,ee,pe){for(var Ee=j===pe.maxZoom?0:pe.tolerance/((1<<j)*pe.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:H,y:ee,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Be=0;Be<Q.length;Be++){Le.numFeatures++,Vr(Le,Q[Be],Ee,pe);var Ce=Q[Be].minX,Ue=Q[Be].minY,st=Q[Be].maxX,At=Q[Be].maxY;Ce<Le.minX&&(Le.minX=Ce),Ue<Le.minY&&(Le.minY=Ue),st>Le.maxX&&(Le.maxX=st),At>Le.maxY&&(Le.maxY=At)}return Le}function Vr(Q,j,H,ee){var pe=j.geometry,Ee=j.type,Le=[];if("Point"===Ee||"MultiPoint"===Ee)for(var Be=0;Be<pe.length;Be+=3)Le.push(pe[Be]),Le.push(pe[Be+1]),Q.numPoints++,Q.numSimplified++;else if("LineString"===Ee)bi(Le,pe,Q,H,!1,!1);else if("MultiLineString"===Ee||"Polygon"===Ee)for(Be=0;Be<pe.length;Be++)bi(Le,pe[Be],Q,H,"Polygon"===Ee,0===Be);else if("MultiPolygon"===Ee)for(var Ce=0;Ce<pe.length;Ce++){var Ue=pe[Ce];for(Be=0;Be<Ue.length;Be++)bi(Le,Ue[Be],Q,H,!0,0===Be)}if(Le.length){var st=j.tags||null;if("LineString"===Ee&&ee.lineMetrics){for(var At in st={},j.tags)st[At]=j.tags[At];st.mapbox_clip_start=pe.start/pe.size,st.mapbox_clip_end=pe.end/pe.size}var ct={geometry:Le,type:"Polygon"===Ee||"MultiPolygon"===Ee?3:"LineString"===Ee||"MultiLineString"===Ee?2:1,tags:st};null!==j.id&&(ct.id=j.id),Q.features.push(ct)}}function bi(Q,j,H,ee,pe,Ee){var Le=ee*ee;if(ee>0&&j.size<(pe?Le:ee))H.numPoints+=j.length/3;else{for(var Be=[],Ce=0;Ce<j.length;Ce+=3)(0===ee||j[Ce+2]>Le)&&(H.numSimplified++,Be.push(j[Ce]),Be.push(j[Ce+1])),H.numPoints++;pe&&function(Ue,st){for(var At=0,ct=0,tn=Ue.length,St=tn-2;ct<tn;St=ct,ct+=2)At+=(Ue[ct]-Ue[St])*(Ue[ct+1]+Ue[St+1]);if(At>0===st)for(ct=0,tn=Ue.length;ct<tn/2;ct+=2){var we=Ue[ct],te=Ue[ct+1];Ue[ct]=Ue[tn-2-ct],Ue[ct+1]=Ue[tn-1-ct],Ue[tn-2-ct]=we,Ue[tn-1-ct]=te}}(Be,Ee),Q.push(Be)}}function uo(Q,j){var H=(j=this.options=function(pe,Ee){for(var Le in Ee)pe[Le]=Ee[Le];return pe}(Object.create(this.options),j)).debug;if(H&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");var pe,Ee,Le,Be,Ce,Ue,ee=function(pe,Ee){var Le=[];if("FeatureCollection"===pe.type)for(var Be=0;Be<pe.features.length;Be++)Pi(Le,pe.features[Be],Ee,Be);else Pi(Le,"Feature"===pe.type?pe:{geometry:pe},Ee);return Le}(Q,j);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(pe=ee,Ee=j,Le=Ee.buffer/Ee.extent,Be=pe,Ce=pt(pe,1,-1-Le,Le,0,-1,2,Ee),Ue=pt(pe,1,1-Le,2+Le,0,-1,2,Ee),(Ce||Ue)&&(Be=pt(pe,1,-Le,1+Le,0,-1,2,Ee)||[],Ce&&(Be=Xn(Ce,1).concat(Be)),Ue&&(Be=Be.concat(Xn(Ue,-1)))),ee=Be).length&&this.splitTile(ee,0,0,0),H&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function nr(Q,j,H){return 32*((1<<Q)*H+j)+Q}function Ni(Q,j){const H=Q.tileID.canonical;if(!this._geoJSONIndex)return j(null,null);const ee=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!ee)return j(null,null);const pe=new Ut(ee.features);let Ee=zt(pe);0===Ee.byteOffset&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),j(null,{vectorTile:pe,rawData:Ee.buffer})}uo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},uo.prototype.splitTile=function(Q,j,H,ee,pe,Ee,Le){for(var Be=[Q,j,H,ee],Ce=this.options,Ue=Ce.debug;Be.length;){ee=Be.pop(),H=Be.pop(),j=Be.pop(),Q=Be.pop();var st=1<<j,At=nr(j,H,ee),ct=this.tiles[At];if(!ct&&(Ue>1&&console.time("creation"),ct=this.tiles[At]=Gn(Q,j,H,ee,Ce),this.tileCoords.push({z:j,x:H,y:ee}),Ue)){Ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,H,ee,ct.numFeatures,ct.numPoints,ct.numSimplified),console.timeEnd("creation"));var tn="z"+j;this.stats[tn]=(this.stats[tn]||0)+1,this.total++}if(ct.source=Q,pe){if(j===Ce.maxZoom||j===pe)continue;var St=1<<pe-j;if(H!==Math.floor(Ee/St)||ee!==Math.floor(Le/St))continue}else if(j===Ce.indexMaxZoom||ct.numPoints<=Ce.indexMaxPoints)continue;if(ct.source=null,0!==Q.length){Ue>1&&console.time("clipping");var we,te,ye,ae,ke,qe,Rt=.5*Ce.buffer/Ce.extent,xn=.5-Rt,Mt=.5+Rt,Xe=1+Rt;we=te=ye=ae=null,ke=pt(Q,st,H-Rt,H+Mt,0,ct.minX,ct.maxX,Ce),qe=pt(Q,st,H+xn,H+Xe,0,ct.minX,ct.maxX,Ce),Q=null,ke&&(we=pt(ke,st,ee-Rt,ee+Mt,1,ct.minY,ct.maxY,Ce),te=pt(ke,st,ee+xn,ee+Xe,1,ct.minY,ct.maxY,Ce),ke=null),qe&&(ye=pt(qe,st,ee-Rt,ee+Mt,1,ct.minY,ct.maxY,Ce),ae=pt(qe,st,ee+xn,ee+Xe,1,ct.minY,ct.maxY,Ce),qe=null),Ue>1&&console.timeEnd("clipping"),Be.push(we||[],j+1,2*H,2*ee),Be.push(te||[],j+1,2*H,2*ee+1),Be.push(ye||[],j+1,2*H+1,2*ee),Be.push(ae||[],j+1,2*H+1,2*ee+1)}}},uo.prototype.getTile=function(Q,j,H){var ee=this.options,pe=ee.extent,Ee=ee.debug;if(Q<0||Q>24)return null;var Le=1<<Q,Be=nr(Q,j=(j%Le+Le)%Le,H);if(this.tiles[Be])return Rn(this.tiles[Be],pe);Ee>1&&console.log("drilling down to z%d-%d-%d",Q,j,H);for(var Ce,Ue=Q,st=j,At=H;!Ce&&Ue>0;)Ue--,st=Math.floor(st/2),At=Math.floor(At/2),Ce=this.tiles[nr(Ue,st,At)];return Ce&&Ce.source?(Ee>1&&console.log("found parent tile z%d-%d-%d",Ue,st,At),Ee>1&&console.time("drilling down"),this.splitTile(Ce.source,Ue,st,At,Q,j,H),Ee>1&&console.timeEnd("drilling down"),this.tiles[Be]?Rn(this.tiles[Be],pe):null):null};class Fo extends c.VectorTileWorkerSource{constructor(j,H,ee,pe,Ee){super(j,H,ee,pe,Ni),Ee&&(this.loadGeoJSON=Ee)}loadData(j,H){const ee=j&&j.request,pe=ee&&ee.collectResourceTiming;this.loadGeoJSON(j,(Ee,Le)=>{if(Ee||!Le)return H(Ee);if("object"!=typeof Le)return H(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));{He(Le,!0);try{if(j.filter){const Ce=c.createExpression(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ce.result)throw new Error(Ce.value.map(st=>`${st.key}: ${st.message}`).join(", "));const Ue=Le.features.filter(st=>Ce.value.evaluate({zoom:0},st));Le={type:"FeatureCollection",features:Ue}}this._geoJSONIndex=j.cluster?new Wr(function({superclusterOptions:Ce,clusterProperties:Ue}){if(!Ue||!Ce)return Ce;const st={},At={},ct={accumulated:null,zoom:0},tn={properties:null},St=Object.keys(Ue);for(const we of St){const[te,ye]=Ue[we],ae=c.createExpression(ye),ke=c.createExpression("string"==typeof te?[te,["accumulated"],["get",we]]:te);st[we]=ae.value,At[we]=ke.value}return Ce.map=we=>{tn.properties=we;const te={};for(const ye of St)te[ye]=st[ye].evaluate(ct,tn);return te},Ce.reduce=(we,te)=>{tn.properties=te;for(const ye of St)ct.accumulated=we[ye],we[ye]=At[ye].evaluate(ct,tn)},Ce}(j)).load(Le.features):new uo(Ce=Le,j.geojsonVtOptions)}catch(Ce){return H(Ce)}this.loaded={};const Be={};if(pe){const Ce=c.getPerformanceMeasurement(ee);Ce&&(Be.resourceTiming={},Be.resourceTiming[j.source]=JSON.parse(JSON.stringify(Ce)))}H(null,Be)}var Ce})}reloadTile(j,H){const ee=this.loaded;return ee&&ee[j.uid]?super.reloadTile(j,H):this.loadTile(j,H)}loadGeoJSON(j,H){if(j.request)c.getJSON(j.request,H);else{if("string"!=typeof j.data)return H(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));try{return H(null,JSON.parse(j.data))}catch(ee){return H(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(j,H){try{H(null,this._geoJSONIndex.getClusterExpansionZoom(j.clusterId))}catch(ee){H(ee)}}getClusterChildren(j,H){try{H(null,this._geoJSONIndex.getChildren(j.clusterId))}catch(ee){H(ee)}}getClusterLeaves(j,H){try{H(null,this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset))}catch(ee){H(ee)}}}class wi{constructor(j){this.self=j,this.actor=new c.Actor(j,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=c.getProjection({name:"mercator"}),this.workerSourceTypes={vector:c.VectorTileWorkerSource,geojson:Fo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(H,ee)=>{if(this.workerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.workerSourceTypes[H]=ee},this.self.registerRTLTextPlugin=H=>{if(c.plugin.isParsed())throw new Error("RTL text plugin already registered.");c.plugin.applyArabicShaping=H.applyArabicShaping,c.plugin.processBidirectionalText=H.processBidirectionalText,c.plugin.processStyledBidirectionalText=H.processStyledBidirectionalText}}clearCaches(j,H,ee){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j],ee()}checkIfReady(j,H,ee){ee()}setReferrer(j,H){this.referrer=H}spriteLoaded(j,H){this.isSpriteLoaded[j]=H;for(const ee in this.workerSources[j]){const pe=this.workerSources[j][ee];for(const Ee in pe)pe[Ee]instanceof c.VectorTileWorkerSource&&(pe[Ee].isSpriteLoaded=H,pe[Ee].fire(new c.Event("isSpriteLoaded")))}}setImages(j,H,ee){this.availableImages[j]=H;for(const pe in this.workerSources[j]){const Ee=this.workerSources[j][pe];for(const Le in Ee)Ee[Le].availableImages=H}ee()}enableTerrain(j,H,ee){this.terrain=H,ee()}setProjection(j,H){this.projections[j]=c.getProjection(H)}setLayers(j,H,ee){this.getLayerIndex(j).replace(H),ee()}updateLayers(j,H,ee){this.getLayerIndex(j).update(H.layers,H.removedIds),ee()}loadTile(j,H,ee){const pe=this.enableTerrain?c.extend({enableTerrain:this.terrain},H):H;pe.projection=this.projections[j]||this.defaultProjection,this.getWorkerSource(j,H.type,H.source).loadTile(pe,ee)}loadDEMTile(j,H,ee){const pe=this.enableTerrain?c.extend({buildQuadTree:this.terrain},H):H;this.getDEMWorkerSource(j,H.source).loadTile(pe,ee)}reloadTile(j,H,ee){const pe=this.enableTerrain?c.extend({enableTerrain:this.terrain},H):H;pe.projection=this.projections[j]||this.defaultProjection,this.getWorkerSource(j,H.type,H.source).reloadTile(pe,ee)}abortTile(j,H,ee){this.getWorkerSource(j,H.type,H.source).abortTile(H,ee)}removeTile(j,H,ee){this.getWorkerSource(j,H.type,H.source).removeTile(H,ee)}removeSource(j,H,ee){if(!this.workerSources[j]||!this.workerSources[j][H.type]||!this.workerSources[j][H.type][H.source])return;const pe=this.workerSources[j][H.type][H.source];delete this.workerSources[j][H.type][H.source],void 0!==pe.removeSource?pe.removeSource(H,ee):ee()}loadWorkerSource(j,H,ee){try{this.self.importScripts(H.url),ee()}catch(pe){ee(pe.toString())}}syncRTLPluginState(j,H,ee){try{c.plugin.setState(H);const pe=c.plugin.getPluginURL();if(c.plugin.isLoaded()&&!c.plugin.isParsed()&&null!=pe){this.self.importScripts(pe);const Ee=c.plugin.isParsed();ee(Ee?void 0:new Error(`RTL Text Plugin failed to import scripts from ${pe}`),Ee)}}catch(pe){ee(pe.toString())}}getAvailableImages(j){let H=this.availableImages[j];return H||(H=[]),H}getLayerIndex(j){let H=this.layerIndexes[j];return H||(H=this.layerIndexes[j]=new Gt),H}getWorkerSource(j,H,ee){return this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][H]||(this.workerSources[j][H]={}),this.workerSources[j][H][ee]||(this.workerSources[j][H][ee]=new this.workerSourceTypes[H]({send:(pe,Ee,Le,Be,Ce,Ue)=>{this.actor.send(pe,Ee,Le,j,Ce,Ue)},scheduler:this.actor.scheduler},this.getLayerIndex(j),this.getAvailableImages(j),this.isSpriteLoaded[j])),this.workerSources[j][H][ee]}getDEMWorkerSource(j,H){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][H]||(this.demWorkerSources[j][H]=new ze),this.demWorkerSources[j][H]}enforceCacheSizeLimit(j,H){c.enforceCacheSizeLimit(H)}getWorkerPerformanceMetrics(j,H,ee){ee(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new wi(self)),wi}),oe(0,function(c){var Et=an;function an(d){return t=d,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,v=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(v);try{_=new Worker(E),p=!0}catch(S){p=!1}return _&&_.terminate(),URL.revokeObjectURL(E),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===p.width}()||(void 0===Gt[l=t&&t.failIfMajorPerformanceCaveat]&&(Gt[l]=function(p){var _,E,S,R,v=(E=p,S=document.createElement("canvas"),(R=Object.create(an.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,S.getContext("webgl",R)||S.getContext("experimental-webgl",R));if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch(E){return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),!0===v.getShaderParameter(_,v.COMPILE_STATUS))}(l)),!Gt[l]||document.documentMode));var t,l}var Gt={};function je(d,t){if(Array.isArray(d)){if(!Array.isArray(t)||d.length!==t.length)return!1;for(let l=0;l<d.length;l++)if(!je(d[l],t[l]))return!1;return!0}if("object"==typeof d&&null!==d&&null!==t){if("object"!=typeof t||Object.keys(d).length!==Object.keys(t).length)return!1;for(const l in d)if(!je(d[l],t[l]))return!1;return!0}return d===t}an.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ze={create:function(d,t,l){const p=c.window.document.createElement(d);return void 0!==t&&(p.className=t),l&&l.appendChild(p),p},createNS:function(d,t){return c.window.document.createElementNS(d,t)}},He=c.window.document&&c.window.document.documentElement.style,mt=He&&void 0!==He.userSelect?"userSelect":"WebkitUserSelect";let Zt;ze.disableDrag=function(){He&&mt&&(Zt=He[mt],He[mt]="none")},ze.enableDrag=function(){He&&mt&&(He[mt]=Zt)},ze.setTransform=function(d,t){d.style.transform=t};let Tn=!1;try{const d=Object.defineProperty({},"passive",{get(){Tn=!0}});c.window.addEventListener("test",d,d),c.window.removeEventListener("test",d,d)}catch(d){Tn=!1}ze.addEventListener=function(d,t,l,p={}){d.addEventListener(t,l,"passive"in p&&Tn?p:p.capture)},ze.removeEventListener=function(d,t,l,p={}){d.removeEventListener(t,l,"passive"in p&&Tn?p:p.capture)};const it=function(d){d.preventDefault(),d.stopPropagation(),c.window.removeEventListener("click",it,!0)};function Ut(d,t,l){const p=d.offsetWidth===t.width?1:d.offsetWidth/t.width;return new c.pointGeometry((l.clientX-t.left)*p,(l.clientY-t.top)*p)}function hn(d,t){var l=t[0],p=t[1],_=t[2],v=t[3],E=l*v-_*p;return E?(d[0]=v*(E=1/E),d[1]=-p*E,d[2]=-_*E,d[3]=l*E,d):null}ze.suppressClick=function(){c.window.addEventListener("click",it,!0),c.window.setTimeout(()=>{c.window.removeEventListener("click",it,!0)},0)},ze.mousePos=function(d,t){const l=d.getBoundingClientRect();return Ut(d,l,t)},ze.touchPos=function(d,t){const l=d.getBoundingClientRect(),p=[];for(let _=0;_<t.length;_++)p.push(Ut(d,l,t[_]));return p},ze.mouseButton=function(d){return void 0!==c.window.InstallTrigger&&2===d.button&&d.ctrlKey&&c.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button},ze.remove=function(d){d.parentNode&&d.parentNode.removeChild(d)};class Ot{constructor(t,l){this.pos=t,this.dir=l}intersectsPlane(t,l,p){const _=c.dot(l,this.dir);if(Math.abs(_)<1e-6)return!1;const v=c.dot(c.sub(c.create(),t,this.pos),l)/_,E=c.scaleAndAdd(c.create(),this.pos,this.dir,v);return c.copy(p,E),!0}}class pn{constructor(t,l){this.points=t,this.planes=l}static fromInvProjectionMatrix(t,l,p){const _=Math.pow(2,p),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const R=c.transformMat4([],S,t),O=1/R[3]/l*_;return c.mul(R,R,[O,O,1/R[3],O])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const R=c.sub([],v[S[0]],v[S[1]]),O=c.sub([],v[S[2]],v[S[1]]),N=c.normalize([],c.cross([],R,O)),V=-c.dot(N,v[S[1]]);return N.concat(V)});return new pn(v,E)}}class on{constructor(t,l){this.min=t,this.max=l,this.center=c.scale([],c.add([],this.min,this.max),.5)}quadrant(t){const l=[t%2==0,t<2],p=c.clone(this.min),_=c.clone(this.max);for(let v=0;v<l.length;v++)p[v]=l[v]?this.min[v]:this.center[v],_[v]=l[v]?this.center[v]:this.max[v];return _[2]=this.max[2],new on(p,_)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}intersects(t){const l=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let _=0;_<t.planes.length;_++){const v=t.planes[_];let E=0;for(let S=0;S<l.length;S++)E+=c.dot$1(v,l[S])>=0;if(0===E)return 0;E!==l.length&&(p=!1)}if(p)return 2;for(let _=0;_<3;_++){let v=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let S=0;S<t.points.length;S++){const R=t.points[S][_]-this.min[_];v=Math.min(v,R),E=Math.max(E,R)}if(E<0||v>this.max[_]-this.min[_])return 0}return 1}}function zt(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class gt extends c.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,l){this._validate(t,l)&&(this.images[t]=l)}_validate(t,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new c.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new c.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new c.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),p=!1),p}_validateStretch(t,l){if(!t)return!0;let p=0;for(const _ of t){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(t,l){return!(t&&(4!==t.length||t[0]<0||l.data.width<t[0]||t[1]<0||l.data.height<t[1]||t[2]<0||l.data.width<t[2]||t[3]<0||l.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,l){l.version=this.images[t].version+1,this.images[t]=l,this.updatedImages[t]=!0}removeImage(t){const l=this.images[t];delete this.images[t],delete this.patterns[t],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,l){let p=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(t,l):this.requestors.push({ids:t,callback:l})}_notify(t,l){const p={};for(const _ of t){this.images[_]||this.fire(new c.Event("styleimagemissing",{id:_}));const v=this.images[_];v?p[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:c.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:t,height:l}=this.atlasImage;return{width:t,height:l}}getPattern(t){const l=this.patterns[t],p=this.getImage(t);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new c.ImagePosition(_,p);this.patterns[t]={bin:_,position:v}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const l=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.Texture(t,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const v in this.patterns)t.push(this.patterns[v].bin);const{w:l,h:p}=c.potpack(t),_=this.atlasImage;_.resize({width:l||1,height:p||1});for(const v in this.patterns){const{bin:E}=this.patterns[v],S=E.x+1,R=E.y+1,O=this.images[v].data,N=O.width,V=O.height;c.RGBAImage.copy(O,_,{x:0,y:0},{x:S,y:R},{width:N,height:V}),c.RGBAImage.copy(O,_,{x:0,y:V-1},{x:S,y:R-1},{width:N,height:1}),c.RGBAImage.copy(O,_,{x:0,y:0},{x:S,y:R+V},{width:N,height:1}),c.RGBAImage.copy(O,_,{x:N-1,y:0},{x:S-1,y:R},{width:1,height:V}),c.RGBAImage.copy(O,_,{x:0,y:0},{x:S+N,y:R},{width:1,height:V})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const l of t){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];zt(p)&&this.updateImage(l,p)}}}const mn=new c.Properties({anchor:new c.DataConstantProperty(c.spec.light.anchor),position:new class{constructor(){this.specification=c.spec.light.position}possiblyEvaluate(d,t){return function([l,p,_]){const v=c.degToRad(p+90),E=c.degToRad(_);return{x:l*Math.cos(v)*Math.sin(E),y:l*Math.sin(v)*Math.sin(E),z:l*Math.cos(E),azimuthal:p,polar:_}}(d.expression.evaluate(t))}interpolate(d,t,l){return{x:c.number(d.x,t.x,l),y:c.number(d.y,t.y,l),z:c.number(d.z,t.z,l),azimuthal:c.number(d.azimuthal,t.azimuthal,l),polar:c.number(d.polar,t.polar,l)}}},color:new c.DataConstantProperty(c.spec.light.color),intensity:new c.DataConstantProperty(c.spec.light.intensity)}),Fn="-transition";class gn extends c.Evented{constructor(t){super(),this._transitionable=new c.Transitionable(mn),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,l={}){if(!this._validate(c.validateLight,t,l))for(const p in t){const _=t[p];c.endsWith(p,Fn)?this._transitionable.setTransition(p.slice(0,-Fn.length),_):this._transitionable.setValue(p,_)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,p){return(!p||!1!==p.validate)&&c.emitValidationErrors(this,t.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}const dn=new c.Properties({source:new c.DataConstantProperty(c.spec.terrain.source),exaggeration:new c.DataConstantProperty(c.spec.terrain.exaggeration)}),Ht="-transition";class Re extends c.Evented{constructor(t){super(),this._transitionable=new c.Transitionable(dn),this.set(t),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(t){for(const l in t){const p=t[l];c.endsWith(l,Ht)?this._transitionable.setTransition(l.slice(0,-Ht.length),p):this._transitionable.setValue(l,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function $e(d,t,l,p){const _=c.smoothstep(45,65,l),[v,E]=tt(d,p),S=c.length(t);let R=1-Math.min(1,Math.exp((S-v)/(E-v)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*_*d.alpha}function tt(d,t){const l=.5/Math.tan(.5*t);return[d.range[0]+l,d.range[1]+l]}const lt=new c.Properties({range:new c.DataConstantProperty(c.spec.fog.range),color:new c.DataConstantProperty(c.spec.fog.color),"horizon-blend":new c.DataConstantProperty(c.spec.fog["horizon-blend"])}),Pt="-transition";class Ye extends c.Evented{constructor(t,l){super(),this._transitionable=new c.Transitionable(lt),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=l}isSoftDisabled(){return"mercator"!==this._transform.projection.name}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,l={}){if(!this._validate(c.validateFog,t,l))for(const p in t){const _=t[p];c.endsWith(p,Pt)?this._transitionable.setTransition(p.slice(0,-Pt.length),_):this._transitionable.setValue(p,_)}}getOpacity(t){if(this.isSoftDisabled())return 0;const l=this.properties&&this.properties.get("color")||1;return c.smoothstep(45,65,t)*l.a}getOpacityAtLatLng(t,l){return this.isSoftDisabled()?0:function(p,_,v){const E=c.MercatorCoordinate.fromLngLat(_),S=v.elevation?v.elevation.getAtPointOrZero(E):0,R=[E.x,E.y,S];return c.transformMat4$1(R,R,v.mercatorFogMatrix),$e(p,R,v.pitch,v._fov)}(this.state,t,l)}getFovAdjustedRange(t){return this.isSoftDisabled()?[0,1]:tt(this.state,t)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,p){return(!p||!1!==p.validate)&&c.emitValidationErrors(this,t.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}class Tt{constructor(t,l){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=c.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const v=new Tt.Actor(p[_],l,this.id);v.name=`Worker ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,l,p){c.asyncAll(this.actors,(_,v)=>{_.send(t,l,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Sn(d,t,l){return t*(c.EXTENT/(d.tileSize*Math.pow(2,l-d.tileID.overscaledZ)))}Tt.Actor=c.Actor;class Er{constructor(t,l,p,_){this.screenBounds=t,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(v=>_.pointCoordinate3D(v)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,l){let p,_;if(t instanceof c.pointGeometry||"number"==typeof t[0]){const v=c.pointGeometry.convert(t);p=[c.pointGeometry.convert(t)],_=l.isPointAboveHorizon(v)}else{const v=c.pointGeometry.convert(t[0]),E=c.pointGeometry.convert(t[1]);p=[v,E],_=c.polygonizeBounds(v,E).every(S=>l.isPointAboveHorizon(S))}return new Er(p,l.getCameraPoint(),_,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return c.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],_=c.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),c.bufferConvexPolygon(_,t)}containsTile(t,l,p){const _=t.queryPadding+1,v=t.tileID.wrap,E=p?this._bufferedCameraMercator(_,l).map(le=>c.getTilePoint(t.tileTransform,le,v)):this._bufferedScreenMercator(_,l).map(le=>c.getTilePoint(t.tileTransform,le,v)),S=this.screenGeometryMercator.map(le=>c.getTileVec3(t.tileTransform,le,v)),R=S.map(le=>new c.pointGeometry(le[0],le[1])),O=l.getFreeCameraOptions().position||new c.MercatorCoordinate(0,0,0),N=c.getTileVec3(t.tileTransform,O,v),V=S.map(le=>{const ne=c.sub(le,le,N);return c.normalize(ne,ne),new Ot(N,ne)}),X=Sn(t,1,l.zoom);if(c.polygonIntersectsBox(E,0,0,c.EXTENT,c.EXTENT))return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:V,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(re=c.getBounds(E),re.min.x=c.clamp(re.min.x,0,c.EXTENT),re.min.y=c.clamp(re.min.y,0,c.EXTENT),re.max.x=c.clamp(re.max.x,0,c.EXTENT),re.max.y=c.clamp(re.max.y,0,c.EXTENT),re),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:X};var re}_bufferedScreenMercator(t,l){const p=nn(t);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{const _=this.bufferedScreenGeometry(t).map(v=>l.pointCoordinate3D(v));return this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(t,l){const p=nn(t);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{const _=this.bufferedCameraGeometry(t).map(v=>l.pointCoordinate3D(v));return this._cameraRaycastCache[p]=_,_}}}function nn(d){return 100*d|0}function Wn(d,t,l){const p=function(_,v){if(_)return l(_);if(v){const E=c.pick(c.extend(v,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(E.vectorLayers=v.vector_layers,E.vectorLayerIds=E.vectorLayers.map(S=>S.id)),E.tiles=t.canonicalizeTileset(E,d.url),l(null,E)}};return d.url?c.getJSON(t.transformRequest(t.normalizeSourceURL(d.url),c.ResourceType.Source),p):c.exported.frame(()=>p(null,d))}class zi{constructor(t,l,p){this.bounds=c.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const l=Math.pow(2,t.z),p=Math.floor(c.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(c.mercatorYfromLat(this.bounds.getNorth())*l),v=Math.ceil(c.mercatorXfromLng(this.bounds.getEast())*l),E=Math.ceil(c.mercatorYfromLat(this.bounds.getSouth())*l);return t.x>=p&&t.x<v&&t.y>=_&&t.y<E}}class lr{constructor(t,l,p){this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Nr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Wr{constructor(t,l,p,_){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),t.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,l){for(let p=0;p<this.attributes.length;p++){const _=l.attributes[this.attributes[p].name];void 0!==_&&t.enableVertexAttribArray(_)}}setVertexAttribPointers(t,l,p){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],E=l.attributes[v.name];void 0!==E&&t.vertexAttribPointer(E,v.components,t[Nr[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class kn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Wi extends kn{getDefault(){return c.Color.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Xr extends kn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class to extends kn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ir extends kn{getDefault(){return[!0,!0,!0,!0]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class On extends kn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Bi extends kn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class jn extends kn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const l=this.current;(t.func!==l.func||t.ref!==l.ref||t.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class xi extends kn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class $n extends kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=t,this.dirty=!1}}class Rr extends kn{getDefault(){return[0,1]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Xi extends kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=t,this.dirty=!1}}class Kr extends kn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Lr extends kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.BLEND):l.disable(l.BLEND),this.current=t,this.dirty=!1}}class Pi extends kn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Eo extends kn{getDefault(){return c.Color.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class dt extends kn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ae extends kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=t,this.dirty=!1}}class Oe extends kn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class bt extends kn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class pt extends kn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class _t extends kn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Vt extends kn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class en extends kn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class En extends kn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class _r extends kn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class fi extends kn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ur extends kn{getDefault(){return null}set(t){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Xn extends kn{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class qt extends kn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Rn extends kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class tr extends kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Gn extends kn{constructor(t,l){super(t),this.context=t,this.parent=l}getDefault(){return null}}class Vr extends Gn{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class bi extends Gn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class uo extends bi{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class nr{constructor(t,l,p,_){this.context=t,this.width=l,this.height=p;const v=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Vr(t,v),_&&(this.depthAttachment=new bi(t,v))}destroy(){const t=this.context.gl,l=this.colorAttachment.get();if(l&&t.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&t.deleteRenderbuffer(p)}t.deleteFramebuffer(this.framebuffer)}}class Ni{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Wi(this),this.clearDepth=new Xr(this),this.clearStencil=new to(this),this.colorMask=new Ir(this),this.depthMask=new On(this),this.stencilMask=new Bi(this),this.stencilFunc=new jn(this),this.stencilOp=new xi(this),this.stencilTest=new $n(this),this.depthRange=new Rr(this),this.depthTest=new Xi(this),this.depthFunc=new Kr(this),this.blend=new Lr(this),this.blendFunc=new Pi(this),this.blendColor=new Eo(this),this.blendEquation=new dt(this),this.cullFace=new Ae(this),this.cullFaceSide=new Oe(this),this.frontFace=new bt(this),this.program=new pt(this),this.activeTexture=new _t(this),this.viewport=new Vt(this),this.bindFramebuffer=new en(this),this.bindRenderbuffer=new En(this),this.bindTexture=new _r(this),this.bindVertexBuffer=new fi(this),this.bindElementBuffer=new Ur(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Xn(this),this.pixelStoreUnpack=new qt(this),this.pixelStoreUnpackPremultiplyAlpha=new Rn(this),this.pixelStoreUnpackFlipY=new tr(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,l){return new lr(this,t,l)}createVertexBuffer(t,l,p){return new Wr(this,t,l,p)}createRenderbuffer(t,l,p){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,t,l,p),this.bindRenderbuffer.set(null),v}createFramebuffer(t,l,p){return new nr(this,t,l,p)}clear({color:t,depth:l,stencil:p}){const _=this.gl;let v=0;t&&(v|=_.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(v|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==p&&(v|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(v)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){je(t.blendFunction,c.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Fo extends c.Evented{constructor(t,l,p,_){super(),this.id=t,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.extend({type:"raster"},l),c.extend(this,c.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Wn(this._options,this.map._requestManager,(t,l)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new c.ErrorEvent(t)):l&&(c.extend(this,l),l.bounds&&(this.tileBounds=new zi(l.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(l.tiles),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,l){const p=c.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);t.request=c.getImage(this.map._requestManager.transformRequest(_,c.ResourceType.Tile),(v,E,S,R)=>{if(delete t.request,t.aborted)t.state="unloaded",l(null);else if(v)t.state="errored",l(v);else if(E){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:R});const O=this.map.painter.context,N=O.gl;t.texture=this.map.painter.getTileTexture(E.width),t.texture?t.texture.update(E,{useMipmap:!0}):(t.texture=new c.Texture(O,E,N.RGBA,{useMipmap:!0}),t.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE),O.extTextureFilterAnisotropic&&N.texParameterf(N.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax)),t.state="loaded",c.cacheEntryPossiblyAdded(this.dispatcher),l(null)}})}abortTile(t,l){t.request&&(t.request.cancel(),delete t.request),l()}unloadTile(t,l){t.texture&&this.map.painter.saveTileTexture(t.texture),l()}hasTransition(){return!1}}let wi;class Q extends c.Evented{constructor(t,l,p,_){super(),this.id=t,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l}load(t,l){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this.url=this.options.url,c.getImage(this.map._requestManager.transformRequest(this.url,c.ResourceType.Image),(p,_)=>{this._loaded=!0,p?this.fire(new c.ErrorEvent(p)):_&&(this.image=c.exported.getImageData(_),t&&(this.coordinates=t),l&&l(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t,delete this._boundsArray;const l=t.map(c.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,v=1/0,E=-1/0,S=-1/0;for(const V of p)_=Math.min(_,V.x),v=Math.min(v,V.y),E=Math.max(E,V.x),S=Math.max(S,V.y);const R=Math.max(E-_,S-v),O=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),N=Math.pow(2,O);return new c.CanonicalTileID(O,Math.floor((_+E)/2*N),Math.floor((v+S)/2*N))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const t=c.tileTransform(this.tileID,this.map.transform.projection),l=this.coordinates.map(p=>{const _=t.projection.project(p[0],p[1]);return c.getTilePoint(t,_)._round()});return this._boundsArray=new c.StructArrayLayout4i8,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,c.EXTENT,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,c.EXTENT),this._boundsArray.emplaceBack(l[2].x,l[2].y,c.EXTENT,c.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,l=t.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,c.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new c.Texture(t,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];"loaded"!==_.state&&(_.state="loaded",_.texture=this.texture)}}loadTile(t,l){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},l(null)):(t.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const j={vector:class extends c.Evented{constructor(d,t,l,p){if(super(),this.id=d,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.extend(this,c.pick(t,["url","scheme","tileSize","promoteId"])),this._options=c.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new c.DedupedRequest}load(){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Wn(this._options,this.map._requestManager,(d,t)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new c.ErrorEvent(d)):t&&(c.extend(this,t),t.bounds&&(this.tileBounds=new zi(t.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(t.tiles,this.map._requestManager._customAccessToken),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}setSourceProperty(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d();const t=this.map.style._getSourceCaches(this.id);for(const l of t)l.clearTiles();this.load()}setTiles(d){return this.setSourceProperty(()=>{this._options.tiles=d}),this}setUrl(d){return this.setSourceProperty(()=>{this.url=d,this._options.url=d}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}loadTile(d,t){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,c.ResourceType.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:d.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,d.actor&&"expired"!==d.state)"loading"===d.state?d.reloadCallback=t:d.request=d.actor.send("reloadTile",p,_.bind(this));else if(d.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)d.request=d.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const v=c.loadVectorTile.call({deduped:this._deduped},p,(E,S)=>{E||!S?_.call(this,E):(p.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},d.actor&&d.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);d.request={cancel:v}}function _(v,E){return delete d.request,d.aborted?t(null):v&&404!==v.status?t(v):(E&&E.resourceTiming&&(d.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&d.setExpiryData(E),d.loadVectorData(E,this.map.painter),c.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id})}unloadTile(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Fo,"raster-dem":class extends Fo{constructor(d,t,l,p){super(d,t,l,p),this.type="raster-dem",this.maxzoom=22,this._options=c.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(d,t){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,v){_&&(d.state="errored",t(_)),v&&(d.dem=v,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",t(null))}d.request=c.getImage(this.map._requestManager.transformRequest(l,c.ResourceType.Tile),function(_,v,E,S){if(delete d.request,d.aborted)d.state="unloaded",t(null);else if(_)d.state="errored",t(_);else if(v){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:E,expires:S});const R=c.window.ImageBitmap&&v instanceof c.window.ImageBitmap&&(null==wi&&(wi=c.window.OffscreenCanvas&&new c.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof c.window.createImageBitmap),wi),O=1-(v.width-c.prevPowerOfTwo(v.width))/2;O<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const N=R?v:c.exported.getImageData(v,O),V={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:N,encoding:this.encoding,padding:O};d.actor&&"expired"!==d.state||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",V,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){const t=d.canonical,l=Math.pow(2,t.z),p=(t.x-1+l)%l,_=0===t.x?d.wrap-1:d.wrap,v=(t.x+1+l)%l,E=t.x+1===l?d.wrap+1:d.wrap,S={};return S[new c.OverscaledTileID(d.overscaledZ,_,t.z,p,t.y).key]={backfilled:!1},S[new c.OverscaledTileID(d.overscaledZ,E,t.z,v,t.y).key]={backfilled:!1},t.y>0&&(S[new c.OverscaledTileID(d.overscaledZ,_,t.z,p,t.y-1).key]={backfilled:!1},S[new c.OverscaledTileID(d.overscaledZ,d.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},S[new c.OverscaledTileID(d.overscaledZ,E,t.z,v,t.y-1).key]={backfilled:!1}),t.y+1<l&&(S[new c.OverscaledTileID(d.overscaledZ,_,t.z,p,t.y+1).key]={backfilled:!1},S[new c.OverscaledTileID(d.overscaledZ,d.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},S[new c.OverscaledTileID(d.overscaledZ,E,t.z,v,t.y+1).key]={backfilled:!1}),S}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends c.Evented{constructor(d,t,l,p){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=t.data,this._options=c.extend({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const _=c.EXTENT/this.tileSize;this.workerOptions=c.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*_,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*_,extent:c.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:c.EXTENT,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*_,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},t),this}getClusterChildren(d,t){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},t),this}getClusterLeaves(d,t,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:t,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=c.extend({},this.workerOptions),t=this._data;"string"==typeof t?(d.request=this.map._requestManager.transformRequest(c.exported.resolveURL(t),c.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new c.ErrorEvent(l));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new c.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,t){const l=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(l,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete d.request,d.unloadVectorData(),d.aborted?t(null):p?t(p):(d.loadVectorData(_,this.map.painter,"reloadTile"===l),t(null))),void 0,"loadTile"===l)}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return c.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Q{constructor(d,t,l,p){super(d,t,l,p),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const t of d.urls)this.urls.push(this.map._requestManager.transformRequest(t,c.ResourceType.Source).url);c.getVideo(this.urls,(t,l)=>{this._loaded=!0,t?this.fire(new c.ErrorEvent(t)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const t=this.video.seekable;d<t.start(0)||d>t.end(0)?this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const d=this.map.painter.context,t=d.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,c.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new c.Texture(d,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE));for(const l in this.tiles){const p=this.tiles[l];"loaded"!==p.state&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Q,canvas:class extends Q{constructor(d,t,l,p){super(d,t,l,p),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(_=>!Array.isArray(_)||2!==_.length||_.some(v=>"number"!=typeof v))||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof c.window.HTMLCanvasElement||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof c.window.HTMLCanvasElement?this.options.canvas:c.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const t=this.map.painter.context,l=t.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,c.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.Texture(t,this.canvas,l.RGBA,{premultiply:!0});for(const p in this.tiles){const _=this.tiles[p];"loaded"!==_.state&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}}},H=function(d,t,l,p){const _=new j[t.type](d,t,l,p);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return c.bindAll(["load","abort","unload","serialize","prepare"],_),_};function ee(d,t){const l=c.identity([]);return c.scale$1(l,l,[.5*d.width,.5*-d.height,1]),c.translate(l,l,[1,-1,0]),c.multiply(l,l,d.calculateProjMatrix(t.toUnwrapped()))}function pe(d,t,l,p,_,v,E,S=!1){const R=d.tilesIn(p,E,S);R.sort(Le);const O=[];for(const V of R)O.push({wrappedTileID:V.tile.tileID.wrapped().key,queryResults:V.tile.queryRenderedFeatures(t,l,d._state,V,_,v,ee(d.transform,V.tile.tileID),S)});const N=function(V){const X={},re={};for(const le of V){const ne=le.queryResults,fe=le.wrappedTileID,ie=re[fe]=re[fe]||{};for(const me in ne){const ge=ne[me],se=ie[me]=ie[me]||{},ve=X[me]=X[me]||[];for(const Te of ge)se[Te.featureIndex]||(se[Te.featureIndex]=!0,ve.push(Te))}}return X}(O);for(const V in N)N[V].forEach(X=>{const re=X.feature,le=d.getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=le});return N}function Ee(d,t){const l=d.getRenderableIds().map(v=>d.getTileByID(v)),p=[],_={};for(let v=0;v<l.length;v++){const E=l[v],S=E.tileID.canonical.key;_[S]||(_[S]=!0,E.querySourceFeatures(p,t))}return p}function Le(d,t){const l=d.tileID,p=t.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function Be(){return null!=Zl.workerClass?new Zl.workerClass:new c.window.Worker(Zl.workerUrl)}const Ce="mapboxgl_preloaded_worker_pool";class Ue{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ue.workerCount;)this.workers.push(new Be);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ce]}numActive(){return Object.keys(this.active).length}}let st;function At(){return st||(st=new Ue),st}function ct(d,t){const l={};for(const p in d)"ref"!==p&&(l[p]=d[p]);return c.refProperties.forEach(p=>{p in t&&(l[p]=t[p])}),l}function tn(d){d=d.slice();const t=Object.create(null);for(let l=0;l<d.length;l++)t[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=ct(d[l],t[d[l].ref]));return d}Ue.workerCount=2;const St={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function we(d,t,l){l.push({command:St.addSource,args:[d,t[d]]})}function te(d,t,l){t.push({command:St.removeSource,args:[d]}),l[d]=!0}function ye(d,t,l,p){te(d,l,p),we(d,t,l)}function ae(d,t,l){let p;for(p in d[l])if(d[l].hasOwnProperty(p)&&"data"!==p&&!je(d[l][p],t[l][p]))return!1;for(p in t[l])if(t[l].hasOwnProperty(p)&&"data"!==p&&!je(d[l][p],t[l][p]))return!1;return!0}function ke(d,t,l,p,_,v){let E;for(E in t=t||{},d=d||{})d.hasOwnProperty(E)&&(je(d[E],t[E])||l.push({command:v,args:[p,E,t[E],_]}));for(E in t)t.hasOwnProperty(E)&&!d.hasOwnProperty(E)&&(je(d[E],t[E])||l.push({command:v,args:[p,E,t[E],_]}))}function qe(d){return d.id}function Rt(d,t){return d[t.id]=t,d}class xn{constructor(t,l){this.reset(t,l)}reset(t,l){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=c.clamp(t,0,1);let l=1,p=this._distances[l];const _=t*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];const v=l-1,E=this._distances[v],S=p-E,R=S>0?(_-E)/S:0;return this.points[v].mult(1-R).add(this.points[l].mult(R))}}class Mt{constructor(t,l,p){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(l/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=l,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,l,p,_,v){this._forEachCell(l,p,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(t,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(t,l,p,_,v,E){this.boxCells[v].push(E)}_insertCircleCell(t,l,p,_,v,E){this.circleCells[v].push(E)}_query(t,l,p,_,v,E){if(p<0||t>this.width||_<0||l>this.height)return!v&&[];const S=[];if(t<=0&&l<=0&&this.width<=p&&this.height<=_){if(v)return!0;for(let R=0;R<this.boxKeys.length;R++)S.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const O=this.circles[3*R],N=this.circles[3*R+1],V=this.circles[3*R+2];S.push({key:this.circleKeys[R],x1:O-V,y1:N-V,x2:O+V,y2:N+V})}return E?S.filter(E):S}return this._forEachCell(t,l,p,_,this._queryCell,S,{hitTest:v,seenUids:{box:{},circle:{}}},E),v?S.length>0:S}_queryCircle(t,l,p,_,v){const E=t-p,S=t+p,R=l-p,O=l+p;if(S<0||E>this.width||O<0||R>this.height)return!_&&[];const N=[];return this._forEachCell(E,R,S,O,this._queryCellCircle,N,{hitTest:_,circle:{x:t,y:l,radius:p},seenUids:{box:{},circle:{}}},v),_?N.length>0:N}query(t,l,p,_,v){return this._query(t,l,p,_,!1,v)}hitTest(t,l,p,_,v){return this._query(t,l,p,_,!0,v)}hitTestCircle(t,l,p,_){return this._queryCircle(t,l,p,!0,_)}_queryCell(t,l,p,_,v,E,S,R){const O=S.seenUids,N=this.boxCells[v];if(null!==N){const X=this.bboxes;for(const re of N)if(!O.box[re]){O.box[re]=!0;const le=4*re;if(t<=X[le+2]&&l<=X[le+3]&&p>=X[le+0]&&_>=X[le+1]&&(!R||R(this.boxKeys[re]))){if(S.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[re],x1:X[le],y1:X[le+1],x2:X[le+2],y2:X[le+3]})}}}const V=this.circleCells[v];if(null!==V){const X=this.circles;for(const re of V)if(!O.circle[re]){O.circle[re]=!0;const le=3*re;if(this._circleAndRectCollide(X[le],X[le+1],X[le+2],t,l,p,_)&&(!R||R(this.circleKeys[re]))){if(S.hitTest)return E.push(!0),!0;{const ne=X[le],fe=X[le+1],ie=X[le+2];E.push({key:this.circleKeys[re],x1:ne-ie,y1:fe-ie,x2:ne+ie,y2:fe+ie})}}}}}_queryCellCircle(t,l,p,_,v,E,S,R){const O=S.circle,N=S.seenUids,V=this.boxCells[v];if(null!==V){const re=this.bboxes;for(const le of V)if(!N.box[le]){N.box[le]=!0;const ne=4*le;if(this._circleAndRectCollide(O.x,O.y,O.radius,re[ne+0],re[ne+1],re[ne+2],re[ne+3])&&(!R||R(this.boxKeys[le])))return E.push(!0),!0}}const X=this.circleCells[v];if(null!==X){const re=this.circles;for(const le of X)if(!N.circle[le]){N.circle[le]=!0;const ne=3*le;if(this._circlesCollide(re[ne],re[ne+1],re[ne+2],O.x,O.y,O.radius)&&(!R||R(this.circleKeys[le])))return E.push(!0),!0}}}_forEachCell(t,l,p,_,v,E,S,R){const O=this._convertToXCellCoord(t),N=this._convertToYCellCoord(l),V=this._convertToXCellCoord(p),X=this._convertToYCellCoord(_);for(let re=O;re<=V;re++)for(let le=N;le<=X;le++)if(v.call(this,t,l,p,_,this.xCellCount*le+re,E,S,R))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,l,p,_,v,E){const S=_-t,R=v-l,O=p+E;return O*O>S*S+R*R}_circleAndRectCollide(t,l,p,_,v,E,S){const R=(E-_)/2,O=Math.abs(t-(_+R));if(O>R+p)return!1;const N=(S-v)/2,V=Math.abs(l-(v+N));if(V>N+p)return!1;if(O<=R||V<=N)return!0;const X=O-R,re=V-N;return X*X+re*re<=p*p}}const Xe=Math.tan(85*Math.PI/180);function rn(d,t,l,p,_){const v=c.create$1();if(t){const E=hn([],_);v[0]=E[0],v[1]=E[1],v[4]=E[2],v[5]=E[3],l||c.rotateZ(v,v,p.angle)}else c.multiply(v,p.labelPlaneMatrix,d);return v}function ln(d,t,l,p,_){if(t){const v=c.clone$1(d),E=c.identity([]);return E[0]=_[0],E[1]=_[1],E[4]=_[2],E[5]=_[3],c.multiply(v,v,E),l||c.rotateZ(v,v,-p.angle),v}return p.glCoordMatrix}function cr(d,t,l=0){const p=[d.x,d.y,l,1];l?c.transformMat4(p,p,t):Jo(p,p,t);const _=p[3];return{point:new c.pointGeometry(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function yr(d,t){return Math.min(.5+d/t*.5,1.5)}function bn(d,t){const l=d[0]/d[3],p=d[1]/d[3];return l>=-t[0]&&l<=t[0]&&p>=-t[1]&&p<=t[1]}function Mr(d,t,l,p,_,v,E,S,R){const O=p?d.textSizeData:d.iconSizeData,N=c.evaluateSizeForZoom(O,l.transform.zoom),V=[256/l.width*2+1,256/l.height*2+1],X=p?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;X.clear();const re=d.lineVertexArray,le=p?d.text.placedSymbolArray:d.icon.placedSymbolArray,ne=l.transform.width/l.transform.height;let fe=!1;for(let ie=0;ie<le.length;ie++){const me=le.get(ie);if(me.writingMode!==c.WritingMode.vertical||fe||0!==ie&&le.get(ie-1).writingMode===c.WritingMode.horizontal||(fe=!0),me.hidden||me.writingMode===c.WritingMode.vertical&&!fe){Dr(me.numGlyphs,X);continue}fe=!1;const ge=new c.pointGeometry(me.tileAnchorX,me.tileAnchorY),se=R?R(ge):0,ve=[ge.x,ge.y,se],Te=[...ve,1];if(c.transformMat4(Te,Te,t),!bn(Te,V)){Dr(me.numGlyphs,X);continue}const We=yr(l.transform.cameraToCenterDistance,Te[3]),Ze=c.evaluateSizeForFeature(O,N,me),at=E?Ze/We:Ze*We,nt=cr(new c.pointGeometry(ve[0],ve[1]),_,ve[2]);if(nt.signedDistanceFromCamera<=0){Dr(me.numGlyphs,X);continue}let It={};const Qe=E?null:R,kt=_n(me,at,!1,S,t,_,v,d.glyphOffsetArray,re,X,nt.point,ge,It,ne,Qe);fe=kt.useVertical,Qe&&kt.needsFlipping&&(It={}),(kt.notEnoughRoom||fe||kt.needsFlipping&&_n(me,at,!0,S,t,_,v,d.glyphOffsetArray,re,X,nt.point,ge,It,ne,Qe).notEnoughRoom)&&Dr(me.numGlyphs,X)}p?d.text.dynamicLayoutVertexBuffer.updateData(X):d.icon.dynamicLayoutVertexBuffer.updateData(X)}function ho(d,t,l,p,_,v,E,S,R,O,N,V,X){const re=S.glyphStartIndex+S.numGlyphs,le=S.lineStartIndex,ne=S.lineStartIndex+S.lineLength,fe=t.getoffsetX(S.glyphStartIndex),ie=t.getoffsetX(re-1),me=po(d*fe,l,p,_,v,E,S.segment,le,ne,R,O,N,V,X,!0);if(!me)return null;const ge=po(d*ie,l,p,_,v,E,S.segment,le,ne,R,O,N,V,X,!0);return ge?{first:me,last:ge}:null}function no(d,t,l,p){return d.writingMode===c.WritingMode.horizontal&&Math.abs(l.y-t.y)>Math.abs(l.x-t.x)*p?{useVertical:!0}:d.writingMode===c.WritingMode.vertical?t.y<l.y?{needsFlipping:!0}:null:0!==d.flipState&&function(_,v,E){const S=(v.x-_.x)*E;return 0===S||Math.abs((v.y-_.y)/S)>Xe}(t,l,p)?1===d.flipState?{needsFlipping:!0}:null:t.x>l.x?{needsFlipping:!0}:null}function _n(d,t,l,p,_,v,E,S,R,O,N,V,X,re,le){const ne=t/24,fe=d.lineOffsetX*ne,ie=d.lineOffsetY*ne;let me;if(d.numGlyphs>1){const ge=d.glyphStartIndex+d.numGlyphs,se=d.lineStartIndex,ve=d.lineStartIndex+d.lineLength,Te=ho(ne,S,fe,ie,l,N,V,d,R,v,X,le,!1);if(!Te)return{notEnoughRoom:!0};const We=cr(Te.first.point,E).point,Ze=cr(Te.last.point,E).point;if(p&&!l){const at=no(d,We,Ze,re);if(d.flipState=at&&at.needsFlipping?1:2,at)return at}me=[Te.first];for(let at=d.glyphStartIndex+1;at<ge-1;at++)me.push(po(ne*S.getoffsetX(at),fe,ie,l,N,V,d.segment,se,ve,R,v,X,le,!1,!1));me.push(Te.last)}else{if(p&&!l){const se=cr(V,_).point,ve=d.lineStartIndex+d.segment+1,Te=new c.pointGeometry(R.getx(ve),R.gety(ve)),We=cr(Te,_),Ze=no(d,se,We.signedDistanceFromCamera>0?We.point:fo(V,Te,se,1,_,void 0),re);if(d.flipState=Ze&&Ze.needsFlipping?1:2,Ze)return Ze}const ge=po(ne*S.getoffsetX(d.glyphStartIndex),fe,ie,l,N,V,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,R,v,X,le,!1,!1);if(!ge)return{notEnoughRoom:!0};me=[ge]}for(const ge of me)c.addDynamicAttributes(O,ge.point,ge.angle);return{}}function mr(d,t,l){const p={x:d.x,y:d.y,z:0};if(!l)return cr(p,t,p.z);const _=l(d);return cr(new c.pointGeometry(p.x,p.y),t,p.z+_)}function fo(d,t,l,p,_,v){const E=mr(d.add(d.sub(t)._unit()),_,v).point,S=l.sub(E);return l.add(S._mult(p/S.mag()))}function po(d,t,l,p,_,v,E,S,R,O,N,V,X,re,le){const ne=p?d-t:d+t;let fe=ne>0?1:-1,ie=0;p&&(fe*=-1,ie=Math.PI),fe<0&&(ie+=Math.PI);let me=fe>0?S+E:S+E+1,ge=_,se=_,ve=0,Te=0;const We=Math.abs(ne),Ze=[],at=[];let nt=v;const It=()=>{const wn=me-fe;return 0===ve?v:new c.pointGeometry(O.getx(wn),O.gety(wn))},Qe=()=>fo(It(),nt,se,We-ve+1,N,X);for(;ve+Te<=We;){if(me+=fe,me<S||me>=R)return null;if(se=ge,Ze.push(ge),re&&at.push(nt||It()),ge=V[me],void 0===ge){nt=new c.pointGeometry(O.getx(me),O.gety(me));const wn=mr(nt,N,X);ge=wn.signedDistanceFromCamera>0?V[me]=wn.point:Qe()}else nt=null;ve+=Te,Te=se.dist(ge)}le&&X&&(nt=nt||new c.pointGeometry(O.getx(me),O.gety(me)),V[me]=ge=void 0===V[me]?ge:Qe(),Te=se.dist(ge));const kt=(We-ve)/Te,Ge=ge.sub(se),Ft=Ge.mult(kt)._add(se);l&&Ft._add(Ge._unit()._perp()._mult(l*fe));const Jt=ie+Math.atan2(ge.y-se.y,ge.x-se.x);return Ze.push(Ft),re&&(nt=nt||new c.pointGeometry(O.getx(me),O.gety(me)),at.push(function(wn,vn,Mn){const An=1-Mn;return new c.pointGeometry(wn.x*An+vn.x*Mn,wn.y*An+vn.y*Mn)}(at.length>0?at[at.length-1]:nt,nt,kt))),{point:Ft,angle:Jt,path:Ze,tilePath:at}}const Ko=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Dr(d,t){for(let l=0;l<d;l++){const p=t.length;t.resize(p+4),t.float32.set(Ko,3*p)}}function Jo(d,t,l){const p=t[0],_=t[1];return d[0]=l[0]*p+l[4]*_+l[12],d[1]=l[1]*p+l[5]*_+l[13],d[3]=l[3]*p+l[7]*_+l[15],d}const pi=100;class In{constructor(t,l,p=new Mt(t.width+200,t.height+200,25),_=new Mt(t.width+200,t.height+200,25)){this.transform=t,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+pi,this.screenBottomBoundary=t.height+pi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=l}placeCollisionBox(t,l,p,_,v,E,S){let R=l.projectedAnchorZ;l.elevation&&(R+=l.elevation);const O=this.projectAndGetPerspectiveRatio(E,l.projectedAnchorX,l.projectedAnchorY,R,l.tileID),N=v*O.perspectiveRatio,V=(l.x1*t+p.x-l.padding)*N+O.point.x,X=(l.y1*t+p.y-l.padding)*N+O.point.y,re=(l.x2*t+p.x+l.padding)*N+O.point.x,le=(l.y2*t+p.y+l.padding)*N+O.point.y,ne=O.perspectiveRatio<=.55||O.aboveHorizon;return!this.isInsideGrid(V,X,re,le)||!_&&this.grid.hitTest(V,X,re,le,S)||ne?{box:[],offscreen:!1}:{box:[V,X,re,le],offscreen:this.isOffscreen(V,X,re,le)}}placeCollisionCircles(t,l,p,_,v,E,S,R,O,N,V,X,re,le){const ne=[],fe=this.transform.elevation,ie=fe?Qe=>fe.getAtTileOffset(le,Qe.x,Qe.y):Qe=>0,me=new c.pointGeometry(l.tileAnchorX,l.tileAnchorY),ge=ie(me),se=this.projectAndGetPerspectiveRatio(E,me.x,me.y,ge,le),{perspectiveRatio:ve}=se,Te=(N?v/ve:v*ve)/c.ONE_EM,We=cr(me,S,ge).point,Ze=se.signedDistanceFromCamera>0?ho(Te,_,l.lineOffsetX*Te,l.lineOffsetY*Te,!1,We,me,l,p,S,{},fe&&!N?ie:null,N&&!!fe):null;let at=!1,nt=!1,It=!0;if(Ze&&!se.aboveHorizon){const Qe=.5*X*ve+re,kt=new c.pointGeometry(-100,-100),Ge=new c.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ft=new xn,Jt=Ze.first,wn=Ze.last;let vn=[];for(let Qt=Jt.path.length-1;Qt>=1;Qt--)vn.push(Jt.path[Qt]);for(let Qt=1;Qt<wn.path.length;Qt++)vn.push(wn.path[Qt]);const Mn=2.5*Qe;if(R){const Qt=vn.map(fe?(zn,gr)=>{const ui=ie(gr<Jt.path.length-1?Jt.tilePath[Jt.path.length-1-gr]:wn.tilePath[gr-Jt.path.length+2]);return cr(zn,R,ui)}:zn=>cr(zn,R));vn=Qt.some(zn=>zn.signedDistanceFromCamera<=0)?[]:Qt.map(zn=>zn.point)}let An=[];if(vn.length>0){const Qt=vn[0].clone(),zn=vn[0].clone();for(let gr=1;gr<vn.length;gr++)Qt.x=Math.min(Qt.x,vn[gr].x),Qt.y=Math.min(Qt.y,vn[gr].y),zn.x=Math.max(zn.x,vn[gr].x),zn.y=Math.max(zn.y,vn[gr].y);An=Qt.x>=kt.x&&zn.x<=Ge.x&&Qt.y>=kt.y&&zn.y<=Ge.y?[vn]:zn.x<kt.x||Qt.x>Ge.x||zn.y<kt.y||Qt.y>Ge.y?[]:c.clipLine([vn],kt.x,kt.y,Ge.x,Ge.y)}for(const Qt of An){Ft.reset(Qt,.25*Qe);let zn=0;zn=Ft.length<=.5*Qe?1:Math.ceil(Ft.paddedLength/Mn)+1;for(let gr=0;gr<zn;gr++){const ui=gr/Math.max(zn-1,1),gi=Ft.lerp(ui),oo=gi.x+pi,yo=gi.y+pi;ne.push(oo,yo,Qe,0);const Si=oo-Qe,Wo=yo-Qe,so=oo+Qe,Pr=yo+Qe;if(It=It&&this.isOffscreen(Si,Wo,so,Pr),nt=nt||this.isInsideGrid(Si,Wo,so,Pr),!t&&this.grid.hitTestCircle(oo,yo,Qe,V)&&(at=!0,!O))return{circles:[],offscreen:!1,collisionDetected:at}}}}return{circles:!O&&at||!nt?[]:ne,offscreen:It,collisionDetected:at}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let p=1/0,_=1/0,v=-1/0,E=-1/0;for(const N of t){const V=new c.pointGeometry(N.x+pi,N.y+pi);p=Math.min(p,V.x),_=Math.min(_,V.y),v=Math.max(v,V.x),E=Math.max(E,V.y),l.push(V)}const S=this.grid.query(p,_,v,E).concat(this.ignoredGrid.query(p,_,v,E)),R={},O={};for(const N of S){const V=N.key;if(void 0===R[V.bucketInstanceId]&&(R[V.bucketInstanceId]={}),R[V.bucketInstanceId][V.featureIndex])continue;const X=[new c.pointGeometry(N.x1,N.y1),new c.pointGeometry(N.x2,N.y1),new c.pointGeometry(N.x2,N.y2),new c.pointGeometry(N.x1,N.y2)];c.polygonIntersectsPolygon(l,X)&&(R[V.bucketInstanceId][V.featureIndex]=!0,void 0===O[V.bucketInstanceId]&&(O[V.bucketInstanceId]=[]),O[V.bucketInstanceId].push(V.featureIndex))}return O}insertCollisionBox(t,l,p,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:v},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,l,p,_,v){const E=l?this.ignoredGrid:this.grid,S={bucketInstanceId:p,featureIndex:_,collisionGroupID:v};for(let R=0;R<t.length;R+=4)E.insertCircle(S,t[R],t[R+1],t[R+2])}projectAndGetPerspectiveRatio(t,l,p,_,v){const E=[l,p,_||0,1];let S=!1;if(_||this.transform.pitch>0){c.transformMat4(E,E,t);let R=!1;this.fogState&&v&&(R=function(O,N,V,X,re,le){const ne=le.calculateFogTileMatrix(re),fe=[N,V,X];return c.transformMat4$1(fe,fe,ne),$e(O,fe,le.pitch,le._fov)}(this.fogState,l,p,_||0,v.toUnwrapped(),this.transform)>.9),S=E[2]>E[3]||R}else Jo(E,E,t);return{point:new c.pointGeometry((E[0]/E[3]+1)/2*this.transform.width+pi,(-E[1]/E[3]+1)/2*this.transform.height+pi),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/E[3]*.5,1.5),signedDistanceFromCamera:E[3],aboveHorizon:S}}isOffscreen(t,l,p,_){return p<pi||t>=this.screenRightBoundary||_<pi||l>this.screenBottomBoundary}isInsideGrid(t,l,p,_){return p>=0&&t<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const t=c.identity([]);return c.translate(t,t,[-100,-100,0]),t}}class rr{constructor(t,l,p,_){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class Oo{constructor(t,l,p,_,v,E=!1){this.text=new rr(t?t.text:null,l,p,v),this.icon=new rr(t?t.icon:null,l,_,v),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ar{constructor(t,l,p,_=!1){this.text=t,this.icon=l,this.skipFade=p,this.clipped=_}}class ti{constructor(){this.invProjMatrix=c.create$1(),this.viewportMatrix=c.create$1(),this.circles=[]}}class Cs{constructor(t,l,p,_,v){this.bucketInstanceId=t,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=v}}class zo{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const l=++this.maxGroupID;this.collisionGroups[t]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[t]}}function Cr(d,t,l,p,_){const{horizontalAlign:v,verticalAlign:E}=c.getAnchorAlignment(d),S=-(v-.5)*t,R=-(E-.5)*l,O=c.evaluateVariableOffset(d,p);return new c.pointGeometry(S+O[0]*_,R+O[1]*_)}function si(d,t,l,p,_){const v=new c.pointGeometry(d,t);return l&&v._rotate(p?_:-_),v}class jr{constructor(t,l,p,_,v){this.transform=t.clone(),this.collisionIndex=new In(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new zo(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,l,p,_){const v=p.getBucket(l),E=p.latestFeatureIndex;if(!v||!E||l.id!==v.layerIds[0])return;const S=v.layers[0].layout,R=p.collisionBoxArray,O=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),N=p.tileSize/c.EXTENT,V=p.tileID.toUnwrapped(),X=this.transform.calculateProjMatrix(V),re="map"===S.get("text-pitch-alignment"),le="map"===S.get("text-rotation-alignment");l.compileFilter();const ne=l.dynamicFilter(),fe=l.dynamicFilterNeedsFeature(),ie=this.transform.calculatePixelsToTileUnitsMatrix(p),me=rn(X,re,le,this.transform,ie);let ge=null;if(re){const Te=ln(X,re,le,this.transform,ie);ge=c.multiply([],this.transform.labelPlaneMatrix,Te)}let se=null;ne&&p.latestFeatureIndex&&(se={unwrappedTileID:V,dynamicFilter:ne,dynamicFilterNeedsFeature:fe,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new Cs(v.bucketInstanceId,E,v.sourceLayerIndex,v.index,p.tileID);const ve={bucket:v,layout:S,posMatrix:X,textLabelPlaneMatrix:me,labelToScreenMatrix:ge,clippingData:se,scale:O,textPixelRatio:N,holdingForFade:p.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:c.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:c.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(const Te of v.sortKeyRanges){const{sortKey:We,symbolInstanceStart:Ze,symbolInstanceEnd:at}=Te;t.push({sortKey:We,symbolInstanceStart:Ze,symbolInstanceEnd:at,parameters:ve})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ve})}attemptAnchorPlacement(t,l,p,_,v,E,S,R,O,N,V,X,re,le,ne,fe,ie,me){const ge=[X.textOffset0,X.textOffset1],se=Cr(t,p,_,ge,v),ve=this.collisionIndex.placeCollisionBox(v,l,si(se.x,se.y,E,S,this.transform.angle),V,R,O,N.predicate);if((!fe||0!==this.collisionIndex.placeCollisionBox(le.getSymbolInstanceIconSize(me,this.transform.zoom,re),fe,si(se.x,se.y,E,S,this.transform.angle),V,R,O,N.predicate).box.length)&&ve.box.length>0){let Te;return this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(Te=this.prevPlacement.variableOffsets[X.crossTileID].anchor),this.variableOffsets[X.crossTileID]={textOffset:ge,width:p,height:_,anchor:t,textScale:v,prevAnchor:Te},this.markUsedJustification(le,t,X,ne),le.allowVerticalPlacement&&(this.markUsedOrientation(le,ne,X),this.placedOrientations[X.crossTileID]=ne),{shift:se,placedGlyphBoxes:ve}}}placeLayerBucketPart(t,l,p,_){const{bucket:v,layout:E,posMatrix:S,textLabelPlaneMatrix:R,labelToScreenMatrix:O,clippingData:N,textPixelRatio:V,holdingForFade:X,collisionBoxArray:re,partiallyEvaluatedTextSize:le,partiallyEvaluatedIconSize:ne,collisionGroup:fe}=t.parameters,ie=E.get("text-optional"),me=E.get("icon-optional"),ge=E.get("text-allow-overlap"),se=E.get("icon-allow-overlap"),ve="map"===E.get("text-rotation-alignment"),Te="map"===E.get("text-pitch-alignment"),We="none"!==E.get("icon-text-fit"),Ze="viewport-y"===E.get("symbol-z-order"),at=ge&&(se||!v.hasIconData()||me),nt=se&&(ge||!v.hasTextData()||ie);!v.collisionArrays&&re&&v.deserializeCollisionBoxes(re),p&&_&&v.updateCollisionDebugBuffers(this.transform.zoom,re);const It=(Qe,kt,Ge)=>{if(N){const Pr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Or=null;if(N.dynamicFilterNeedsFeature){const ir=this.retainedQueryData[v.bucketInstanceId];Or=N.featureIndex.loadFeature({featureIndex:Qe.featureIndex,bucketIndex:ir.bucketIndex,sourceLayerIndex:ir.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,N.dynamicFilter)(Pr,Or,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new c.pointGeometry(Qe.tileAnchorX,Qe.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[Qe.crossTileID]=new Ar(!1,!1,!1,!0),void(l[Qe.crossTileID]=!0)}if(l[Qe.crossTileID])return;if(X)return void(this.placements[Qe.crossTileID]=new Ar(!1,!1,!1));let Ft=!1,Jt=!1,wn=!0,vn=null,Mn={box:null,offscreen:null},An={box:null,offscreen:null},Qt=null,zn=null,gr=null,ui=0,gi=0,oo=0;Ge.textFeatureIndex?ui=Ge.textFeatureIndex:Qe.useRuntimeCollisionCircles&&(ui=Qe.featureIndex),Ge.verticalTextFeatureIndex&&(gi=Ge.verticalTextFeatureIndex);const yo=Pr=>{Pr.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||Pr.elevation)&&(Pr.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,Pr.tileAnchorX,Pr.tileAnchorY):0)},Si=Ge.textBox;if(Si){yo(Si);const Pr=ir=>{let zr=c.WritingMode.horizontal;if(v.allowVerticalPlacement&&!ir&&this.prevPlacement){const Ri=this.prevPlacement.placedOrientations[Qe.crossTileID];Ri&&(this.placedOrientations[Qe.crossTileID]=Ri,zr=Ri,this.markUsedOrientation(v,zr,Qe))}return zr},Or=(ir,zr)=>{if(v.allowVerticalPlacement&&Qe.numVerticalGlyphVertices>0&&Ge.verticalTextBox){for(const Ri of v.writingModes)if(Ri===c.WritingMode.vertical?(Mn=zr(),An=Mn):Mn=ir(),Mn&&Mn.box&&Mn.box.length)break}else Mn=ir()};if(E.get("text-variable-anchor")){let ir=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Qe.crossTileID]){const wr=this.prevPlacement.variableOffsets[Qe.crossTileID];ir.indexOf(wr.anchor)>0&&(ir=ir.filter(Po=>Po!==wr.anchor),ir.unshift(wr.anchor))}const zr=(wr,Po,ql)=>{const ko=v.getSymbolInstanceTextSize(le,Qe,this.transform.zoom,kt),Xo=(wr.x2-wr.x1)*ko+2*wr.padding,pl=(wr.y2-wr.y1)*ko+2*wr.padding,bc=We&&!se?Po:null;bc&&yo(bc);let Wl={box:[],offscreen:!1};const Qc=ge?2*ir.length:ir.length;for(let Xl=0;Xl<Qc;++Xl){const eu=this.attemptAnchorPlacement(ir[Xl%ir.length],wr,Xo,pl,ko,ve,Te,V,S,fe,Xl>=ir.length,Qe,kt,v,ql,bc,le,ne);if(eu&&(Wl=eu.placedGlyphBoxes,Wl&&Wl.box&&Wl.box.length)){Ft=!0,vn=eu.shift;break}}return Wl};Or(()=>zr(Si,Ge.iconBox,c.WritingMode.horizontal),()=>{const wr=Ge.verticalTextBox;return wr&&yo(wr),v.allowVerticalPlacement&&!(Mn&&Mn.box&&Mn.box.length)&&Qe.numVerticalGlyphVertices>0&&wr?zr(wr,Ge.verticalIconBox,c.WritingMode.vertical):{box:null,offscreen:null}}),Mn&&(Ft=Mn.box,wn=Mn.offscreen);const Ri=Pr(Mn&&Mn.box);if(!Ft&&this.prevPlacement){const wr=this.prevPlacement.variableOffsets[Qe.crossTileID];wr&&(this.variableOffsets[Qe.crossTileID]=wr,this.markUsedJustification(v,wr.anchor,Qe,Ri))}}else{const ir=(zr,Ri)=>{const wr=v.getSymbolInstanceTextSize(le,Qe,this.transform.zoom,kt),Po=this.collisionIndex.placeCollisionBox(wr,zr,new c.pointGeometry(0,0),ge,V,S,fe.predicate);return Po&&Po.box&&Po.box.length&&(this.markUsedOrientation(v,Ri,Qe),this.placedOrientations[Qe.crossTileID]=Ri),Po};Or(()=>ir(Si,c.WritingMode.horizontal),()=>{const zr=Ge.verticalTextBox;return v.allowVerticalPlacement&&Qe.numVerticalGlyphVertices>0&&zr?(yo(zr),ir(zr,c.WritingMode.vertical)):{box:null,offscreen:null}}),Pr(Mn&&Mn.box&&Mn.box.length)}}if(Qt=Mn,Ft=Qt&&Qt.box&&Qt.box.length>0,wn=Qt&&Qt.offscreen,Qe.useRuntimeCollisionCircles){const Pr=v.text.placedSymbolArray.get(Qe.centerJustifiedTextSymbolIndex>=0?Qe.centerJustifiedTextSymbolIndex:Qe.verticalPlacedTextSymbolIndex),Or=c.evaluateSizeForFeature(v.textSizeData,le,Pr),ir=E.get("text-padding");zn=this.collisionIndex.placeCollisionCircles(ge,Pr,v.lineVertexArray,v.glyphOffsetArray,Or,S,R,O,p,Te,fe.predicate,Qe.collisionCircleDiameter*Or/c.ONE_EM,ir,this.retainedQueryData[v.bucketInstanceId].tileID),Ft=ge||zn.circles.length>0&&!zn.collisionDetected,wn=wn&&zn.offscreen}if(Ge.iconFeatureIndex&&(oo=Ge.iconFeatureIndex),Ge.iconBox){const Pr=Or=>{yo(Or);const ir=We&&vn?si(vn.x,vn.y,ve,Te,this.transform.angle):new c.pointGeometry(0,0),zr=v.getSymbolInstanceIconSize(ne,this.transform.zoom,kt);return this.collisionIndex.placeCollisionBox(zr,Or,ir,se,V,S,fe.predicate)};An&&An.box&&An.box.length&&Ge.verticalIconBox?(gr=Pr(Ge.verticalIconBox),Jt=gr.box.length>0):(gr=Pr(Ge.iconBox),Jt=gr.box.length>0),wn=wn&&gr.offscreen}const Wo=ie||0===Qe.numHorizontalGlyphVertices&&0===Qe.numVerticalGlyphVertices,so=me||0===Qe.numIconVertices;if(Wo||so?so?Wo||(Jt=Jt&&Ft):Ft=Jt&&Ft:Jt=Ft=Jt&&Ft,Ft&&Qt&&Qt.box&&this.collisionIndex.insertCollisionBox(Qt.box,E.get("text-ignore-placement"),v.bucketInstanceId,An&&An.box&&gi?gi:ui,fe.ID),Jt&&gr&&this.collisionIndex.insertCollisionBox(gr.box,E.get("icon-ignore-placement"),v.bucketInstanceId,oo,fe.ID),zn&&(Ft&&this.collisionIndex.insertCollisionCircles(zn.circles,E.get("text-ignore-placement"),v.bucketInstanceId,ui,fe.ID),p)){const Pr=v.bucketInstanceId;let Or=this.collisionCircleArrays[Pr];void 0===Or&&(Or=this.collisionCircleArrays[Pr]=new ti);for(let ir=0;ir<zn.circles.length;ir+=4)Or.circles.push(zn.circles[ir+0]),Or.circles.push(zn.circles[ir+1]),Or.circles.push(zn.circles[ir+2]),Or.circles.push(zn.collisionDetected?1:0)}this.placements[Qe.crossTileID]=new Ar(Ft||at,Jt||nt,wn||v.justReloaded),l[Qe.crossTileID]=!0};if(Ze){const Qe=v.getSortedSymbolIndexes(this.transform.angle);for(let kt=Qe.length-1;kt>=0;--kt){const Ge=Qe[kt];It(v.symbolInstances.get(Ge),Ge,v.collisionArrays[Ge])}}else for(let Qe=t.symbolInstanceStart;Qe<t.symbolInstanceEnd;Qe++)It(v.symbolInstances.get(Qe),Qe,v.collisionArrays[Qe]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){const Qe=this.collisionCircleArrays[v.bucketInstanceId];c.invert(Qe.invProjMatrix,S),Qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(t,l,p,_){let v;v=_===c.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[c.getAnchorJustification(l)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const S of E)S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=v>=0&&S!==v?0:p.crossTileID)}markUsedOrientation(t,l,p){const _=l===c.WritingMode.horizontal||l===c.WritingMode.horizontalOnly?l:0,v=l===c.WritingMode.vertical?l:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const S of E)t.text.placedSymbolArray.get(S).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(t):1,v=l?l.opacities:{},E=l?l.variableOffsets:{},S=l?l.placedOrientations:{};for(const R in this.placements){const O=this.placements[R],N=v[R];N?(this.opacities[R]=new Oo(N,_,O.text,O.icon,null,O.clipped),p=p||O.text!==N.text.placed||O.icon!==N.icon.placed):(this.opacities[R]=new Oo(null,_,O.text,O.icon,O.skipFade,O.clipped),p=p||O.text||O.icon)}for(const R in v){const O=v[R];if(!this.opacities[R]){const N=new Oo(O,_,!1,!1);N.isHidden()||(this.opacities[R]=N,p=p||O.text.placed||O.icon.placed)}}for(const R in E)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=E[R]);for(const R in S)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=S[R]);p?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:t)}updateLayerOpacities(t,l){const p={};for(const _ of l){const v=_.getBucket(t);v&&_.latestFeatureIndex&&t.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,_.collisionBoxArray)}}updateBucketOpacities(t,l,p){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0].layout,v=!!t.layers[0].dynamicFilter(),E=new Oo(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),R=_.get("icon-allow-overlap"),O=_.get("text-variable-anchor"),N="map"===_.get("text-rotation-alignment"),V="map"===_.get("text-pitch-alignment"),X="none"!==_.get("icon-text-fit"),re=new Oo(null,0,S&&(R||!t.hasIconData()||_.get("icon-optional")),R&&(S||!t.hasTextData()||_.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const le=(ne,fe,ie)=>{for(let me=0;me<fe/4;me++)ne.opacityVertexArray.emplaceBack(ie)};for(let ne=0;ne<t.symbolInstances.length;ne++){const fe=t.symbolInstances.get(ne),{numHorizontalGlyphVertices:ie,numVerticalGlyphVertices:me,crossTileID:ge}=fe;let se=this.opacities[ge];l[ge]?se=E:se||(se=re,this.opacities[ge]=se),l[ge]=!0;const ve=fe.numIconVertices>0,Te=this.placedOrientations[fe.crossTileID],We=Te===c.WritingMode.vertical,Ze=Te===c.WritingMode.horizontal||Te===c.WritingMode.horizontalOnly;if(ie>0||me>0){const at=Ss(se.text);le(t.text,ie,We?Ei:at),le(t.text,me,Ze?Ei:at);const nt=se.text.isHidden();[fe.rightJustifiedTextSymbolIndex,fe.centerJustifiedTextSymbolIndex,fe.leftJustifiedTextSymbolIndex].forEach(kt=>{kt>=0&&(t.text.placedSymbolArray.get(kt).hidden=nt||We?1:0)}),fe.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(fe.verticalPlacedTextSymbolIndex).hidden=nt||Ze?1:0);const It=this.variableOffsets[fe.crossTileID];It&&this.markUsedJustification(t,It.anchor,fe,Te);const Qe=this.placedOrientations[fe.crossTileID];Qe&&(this.markUsedJustification(t,"left",fe,Qe),this.markUsedOrientation(t,Qe,fe))}if(ve){const at=Ss(se.icon);fe.placedIconSymbolIndex>=0&&(le(t.icon,fe.numIconVertices,We?Ei:at),t.icon.placedSymbolArray.get(fe.placedIconSymbolIndex).hidden=se.icon.isHidden()),fe.verticalPlacedIconSymbolIndex>=0&&(le(t.icon,fe.numVerticalIconVertices,Ze?Ei:at),t.icon.placedSymbolArray.get(fe.verticalPlacedIconSymbolIndex).hidden=se.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const at=t.collisionArrays[ne];if(at){let nt=new c.pointGeometry(0,0),It=!0;if(at.textBox||at.verticalTextBox){if(O){const kt=this.variableOffsets[ge];kt?(nt=Cr(kt.anchor,kt.width,kt.height,kt.textOffset,kt.textScale),N&&nt._rotate(V?this.transform.angle:-this.transform.angle)):It=!1}v&&(It=!se.clipped),at.textBox&&ur(t.textCollisionBox.collisionVertexArray,se.text.placed,!It||We,nt.x,nt.y),at.verticalTextBox&&ur(t.textCollisionBox.collisionVertexArray,se.text.placed,!It||Ze,nt.x,nt.y)}const Qe=It&&Boolean(!Ze&&at.verticalIconBox);at.iconBox&&ur(t.iconCollisionBox.collisionVertexArray,se.icon.placed,Qe,X?nt.x:0,X?nt.y:0),at.verticalIconBox&&ur(t.iconCollisionBox.collisionVertexArray,se.icon.placed,!Qe,X?nt.x:0,X?nt.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ne=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ne.invProjMatrix,t.placementViewportMatrix=ne.viewportMatrix,t.collisionCircleArray=ne.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function ur(d,t,l,p,_){d.emplaceBack(t?1:0,l?1:0,p||0,_||0),d.emplaceBack(t?1:0,l?1:0,p||0,_||0),d.emplaceBack(t?1:0,l?1:0,p||0,_||0),d.emplaceBack(t?1:0,l?1:0,p||0,_||0)}const ki=Math.pow(2,25),$r=Math.pow(2,24),Bo=Math.pow(2,17),Qo=Math.pow(2,16),Ts=Math.pow(2,9),Jr=Math.pow(2,8),Pl=Math.pow(2,1);function Ss(d){if(0===d.opacity&&!d.placed)return 0;if(1===d.opacity&&d.placed)return 4294967295;const t=d.placed?1:0,l=Math.floor(127*d.opacity);return l*ki+t*$r+l*Bo+t*Qo+l*Ts+t*Jr+l*Pl+t}const Ei=0;class sa{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,l,p,_,v){const E=this._bucketParts;for(;this._currentTileIndex<t.length;)if(l.getBucketParts(E,_,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((S,R)=>S.sortKey-R.sortKey));this._currentPartIndex<E.length;){const S=E[this._currentPartIndex];if(l.placeLayerBucketPart(S,this._seenCrossTileIDs,p,0===S.symbolInstanceStart),this._currentPartIndex++,v())return!0}return!1}}class ls{constructor(t,l,p,_,v,E,S,R){this.placement=new jr(t,v,E,S,R),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,l,p){const _=c.exported.now(),v=()=>{const E=c.exported.now()-_;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=l[t[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=S)&&(!E.maxzoom||E.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new sa(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Hs=512/c.EXTENT/2;class cs{constructor(t,l,p){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<l.length;_++){const v=l.get(_),E=v.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,t)})}}getScaledCoordinates(t,l){const p=Hs/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*c.EXTENT+t.tileAnchorX)*p),y:Math.floor((l.canonical.y*c.EXTENT+t.tileAnchorY)*p)}}findMatches(t,l,p){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let v=0;v<t.length;v++){const E=t.get(v);if(E.crossTileID)continue;const S=this.indexedSymbolInstances[E.key];if(!S)continue;const R=this.getScaledCoordinates(E,l);for(const O of S)if(Math.abs(O.coord.x-R.x)<=_&&Math.abs(O.coord.y-R.y)<=_&&!p[O.crossTileID]){p[O.crossTileID]=!0,E.crossTileID=O.crossTileID;break}}}}class il{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class kl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const l=Math.round((t-this.lng)/360);if(0!==l)for(const p in this.indexes){const _=this.indexes[p],v={};for(const E in _){const S=_[E];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+l),v[S.tileID.key]=S}this.indexes[p]=v}this.lng=t}addBucket(t,l,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const _=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const E=this.indexes[v];if(Number(v)>t.overscaledZ)for(const S in E){const R=E[S];R.tileID.isChildOf(t)&&R.findMatches(l.symbolInstances,t,_)}else{const S=E[t.scaledTo(Number(v)).key];S&&S.findMatches(l.symbolInstances,t,_)}}for(let v=0;v<l.symbolInstances.length;v++){const E=l.symbolInstances.get(v);E.crossTileID||(E.crossTileID=p.generate(),_[E.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new cs(t,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(t,l){for(const p in l.indexedSymbolInstances)for(const _ of l.indexedSymbolInstances[p])delete this.usedCrossTileIDs[t][_.crossTileID]}removeStaleBuckets(t){let l=!1;for(const p in this.indexes){const _=this.indexes[p];for(const v in _)t[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[v]),delete _[v],l=!0)}return l}}class aa{constructor(){this.layerIndexes={},this.crossTileIDs=new il,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,l,p){let _=this.layerIndexes[t.id];void 0===_&&(_=this.layerIndexes[t.id]=new kl);let v=!1;const E={};_.handleWrapJump(p);for(const S of l){const R=S.getBucket(t);R&&t.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(S.tileID,R,this.crossTileIDs)&&(v=!0),E[R.bucketInstanceId]=!0)}return _.removeStaleBuckets(E)&&(v=!0),v}pruneUnusedLayers(t){const l={};t.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const Pa=(d,t)=>c.emitValidationErrors(d,t&&t.filter(l=>"source.canvas"!==l.identifier)),la=c.pick(St,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Rl=c.pick(St,["setCenter","setZoom","setBearing","setPitch"]),Ll=function(){const d={},t=c.spec.$version;for(const l in c.spec.$root){const p=c.spec.$root[l];if(p.required){let _=null;_="version"===l?t:"array"===p.type?[]:{},null!=_&&(d[l]=_)}}return d}(),hc={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ui extends c.Evented{constructor(t,l={}){super(),this.map=t,this.dispatcher=new Tt(At(),this),this.imageManager=new gt,this.imageManager.setEventedParent(this),this.glyphManager=new c.GlyphManager(t._requestManager,l.localFontFamily?c.LocalGlyphMode.all:l.localIdeographFontFamily?c.LocalGlyphMode.ideographs:c.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.lineAtlas=new c.LineAtlas(256,512),this.crossTileSymbolIndex=new aa,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new c.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.getReferrer());const p=this;this._rtlTextPluginCallback=Ui.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,E)=>{if(c.triggerPluginCompletionEvent(v),E&&E.every(S=>S))for(const S in p._sourceCaches){const R=p._sourceCaches[S],O=R.getSource().type;"vector"!==O&&"geojson"!==O||R.reload()}})}),this.on("data",_=>{if("source"!==_.dataType||"metadata"!==_.sourceDataType)return;const v=this.getSource(_.sourceId);if(v&&v.vectorLayerIds)for(const E in this._layers){const S=this._layers[E];S.source===v.id&&this._validateLayer(S)}})}loadURL(t,l={}){this.fire(new c.Event("dataloading",{dataType:"style"}));const p="boolean"==typeof l.validate?l.validate:!c.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,l.accessToken);const _=this.map._requestManager.transformRequest(t,c.ResourceType.Style);this._request=c.getJSON(_,(v,E)=>{this._request=null,v?this.fire(new c.ErrorEvent(v)):E&&this._load(E,p)})}loadJSON(t,l={}){this.fire(new c.Event("dataloading",{dataType:"style"})),this._request=c.exported.frame(()=>{this._request=null,this._load(t,!1!==l.validate)})}loadEmpty(){this.fire(new c.Event("dataloading",{dataType:"style"})),this._load(Ll,!1)}_updateLayerCount(t,l){const p=l?1:-1;t.is3D()&&(this._num3DLayers+=p),"circle"===t.type&&(this._numCircleLayers+=p),"symbol"===t.type&&(this._numSymbolLayers+=p)}_load(t,l){if(l&&Pa(this,c.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t,this.updateProjection();for(const _ in t.sources)this.addSource(_,t.sources[_],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const p=tn(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=c.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new gn(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new c.Event("data",{dataType:"style"})),this.fire(new c.Event("style.load"))}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const t=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0));if(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),t){this.map.painter.clearBackgroundTiles();for(const l in this._sourceCaches)this._sourceCaches[l].clearTiles();this.map._update(!0)}}_loadSprite(t){this._spriteRequest=function(l,p,_){let v,E,S;const R=c.exported.devicePixelRatio>1?"@2x":"";let O=c.getJSON(p.transformRequest(p.normalizeSpriteURL(l,R,".json"),c.ResourceType.SpriteJSON),(X,re)=>{O=null,S||(S=X,v=re,V())}),N=c.getImage(p.transformRequest(p.normalizeSpriteURL(l,R,".png"),c.ResourceType.SpriteImage),(X,re)=>{N=null,S||(S=X,E=re,V())});function V(){if(S)_(S);else if(v&&E){const X=c.exported.getImageData(E),re={};for(const le in v){const{width:ne,height:fe,x:ie,y:me,sdf:ge,pixelRatio:se,stretchX:ve,stretchY:Te,content:We}=v[le],Ze=new c.RGBAImage({width:ne,height:fe});c.RGBAImage.copy(X,Ze,{x:ie,y:me},{x:0,y:0},{width:ne,height:fe}),re[le]={data:Ze,pixelRatio:se,sdf:ge,stretchX:ve,stretchY:Te,content:We}}_(null,re)}}return{cancel(){O&&(O.cancel(),O=null),N&&(N.cancel(),N=null)}}}(t,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new c.ErrorEvent(l));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new c.Event("data",{dataType:"style"}))})}_validateLayer(t){const l=this.getSource(t.source);if(!l)return;const p=t.sourceLayer;p&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(p))&&this.fire(new c.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const l=[];for(const p of t){const _=this._layers[p];"custom"!==_.type&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&hc[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const l=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(_.length||v.length)&&this._updateWorkerLayers(_,v);for(const E in this._updatedSources){const S=this._updatedSources[E];"reload"===S?this._reloadSource(E):"clear"===S&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const p={};for(const _ in this._sourceCaches){const v=this._sourceCaches[_];p[_]=v.used,v.used=!1}for(const _ of this._order){const v=this._layers[_];if(v.recalculate(t,this._availableImages),!v.isHidden(t.zoom)){const S=this._getLayerSourceCache(v);S&&(S.used=!0)}const E=this.map.painter;if(E){const S=v.getProgramIds();if(!S)continue;const R=v.getProgramConfiguration(t.zoom);for(const O of S)E.useProgram(O,R)}}for(const _ in p){const v=this._sourceCaches[_];p[_]!==v.used&&v.getSource().fire(new c.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new c.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),Pa(this,c.validateStyle(t)))return!1;(t=c.clone$2(t)).layers=tn(t.layers);const l=function(_,v){if(!_)return[{command:St.setStyle,args:[v]}];let E=[];try{if(!je(_.version,v.version))return[{command:St.setStyle,args:[v]}];je(_.center,v.center)||E.push({command:St.setCenter,args:[v.center]}),je(_.zoom,v.zoom)||E.push({command:St.setZoom,args:[v.zoom]}),je(_.bearing,v.bearing)||E.push({command:St.setBearing,args:[v.bearing]}),je(_.pitch,v.pitch)||E.push({command:St.setPitch,args:[v.pitch]}),je(_.sprite,v.sprite)||E.push({command:St.setSprite,args:[v.sprite]}),je(_.glyphs,v.glyphs)||E.push({command:St.setGlyphs,args:[v.glyphs]}),je(_.transition,v.transition)||E.push({command:St.setTransition,args:[v.transition]}),je(_.light,v.light)||E.push({command:St.setLight,args:[v.light]}),je(_.fog,v.fog)||E.push({command:St.setFog,args:[v.fog]}),je(_.projection,v.projection)||E.push({command:St.setProjection,args:[v.projection]});const S={},R=[];!function(V,X,re,le){let ne;for(ne in X=X||{},V=V||{})V.hasOwnProperty(ne)&&(X.hasOwnProperty(ne)||te(ne,re,le));for(ne in X)X.hasOwnProperty(ne)&&(V.hasOwnProperty(ne)?je(V[ne],X[ne])||("geojson"===V[ne].type&&"geojson"===X[ne].type&&ae(V,X,ne)?re.push({command:St.setGeoJSONSourceData,args:[ne,X[ne].data]}):ye(ne,X,re,le)):we(ne,X,re))}(_.sources,v.sources,R,S);const O=[];_.layers&&_.layers.forEach(V=>{S[V.source]?E.push({command:St.removeLayer,args:[V.id]}):O.push(V)});let N=_.terrain;N&&S[N.source]&&(E.push({command:St.setTerrain,args:[void 0]}),N=void 0),E=E.concat(R),je(N,v.terrain)||E.push({command:St.setTerrain,args:[v.terrain]}),function(V,X,re){X=X||[];const le=(V=V||[]).map(qe),ne=X.map(qe),fe=V.reduce(Rt,{}),ie=X.reduce(Rt,{}),me=le.slice(),ge=Object.create(null);let se,ve,Te,We,Ze,at,nt;for(se=0,ve=0;se<le.length;se++)Te=le[se],ie.hasOwnProperty(Te)?ve++:(re.push({command:St.removeLayer,args:[Te]}),me.splice(me.indexOf(Te,ve),1));for(se=0,ve=0;se<ne.length;se++)Te=ne[ne.length-1-se],me[me.length-1-se]!==Te&&(fe.hasOwnProperty(Te)?(re.push({command:St.removeLayer,args:[Te]}),me.splice(me.lastIndexOf(Te,me.length-ve),1)):ve++,at=me[me.length-se],re.push({command:St.addLayer,args:[ie[Te],at]}),me.splice(me.length-se,0,Te),ge[Te]=!0);for(se=0;se<ne.length;se++)if(Te=ne[se],We=fe[Te],Ze=ie[Te],!ge[Te]&&!je(We,Ze))if(je(We.source,Ze.source)&&je(We["source-layer"],Ze["source-layer"])&&je(We.type,Ze.type)){for(nt in ke(We.layout,Ze.layout,re,Te,null,St.setLayoutProperty),ke(We.paint,Ze.paint,re,Te,null,St.setPaintProperty),je(We.filter,Ze.filter)||re.push({command:St.setFilter,args:[Te,Ze.filter]}),je(We.minzoom,Ze.minzoom)&&je(We.maxzoom,Ze.maxzoom)||re.push({command:St.setLayerZoomRange,args:[Te,Ze.minzoom,Ze.maxzoom]}),We)We.hasOwnProperty(nt)&&"layout"!==nt&&"paint"!==nt&&"filter"!==nt&&"metadata"!==nt&&"minzoom"!==nt&&"maxzoom"!==nt&&(0===nt.indexOf("paint.")?ke(We[nt],Ze[nt],re,Te,nt.slice(6),St.setPaintProperty):je(We[nt],Ze[nt])||re.push({command:St.setLayerProperty,args:[Te,nt,Ze[nt]]}));for(nt in Ze)Ze.hasOwnProperty(nt)&&!We.hasOwnProperty(nt)&&"layout"!==nt&&"paint"!==nt&&"filter"!==nt&&"metadata"!==nt&&"minzoom"!==nt&&"maxzoom"!==nt&&(0===nt.indexOf("paint.")?ke(We[nt],Ze[nt],re,Te,nt.slice(6),St.setPaintProperty):je(We[nt],Ze[nt])||re.push({command:St.setLayerProperty,args:[Te,nt,Ze[nt]]}))}else re.push({command:St.removeLayer,args:[Te]}),at=me[me.lastIndexOf(Te)+1],re.push({command:St.addLayer,args:[Ze,at]})}(O,v.layers,E)}catch(S){console.warn("Unable to compute style diff:",S),E=[{command:St.setStyle,args:[v]}]}return E}(this.serialize(),t).filter(_=>!(_.command in Rl));if(0===l.length)return!1;const p=l.filter(_=>!(_.command in la));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{"setTransition"!==_.command&&this[_.command].apply(this,_.args)}),this.stylesheet=t,!0}addImage(t,l){if(this.getImage(t))return this.fire(new c.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,l),this._afterImageUpdated(t)}updateImage(t,l){this.imageManager.updateImage(t,l)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new c.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,l,p={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(c.validateStyle.source,`sources.${t}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=H(t,l,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:t}));const v=E=>{const S=(E?"symbol:":"other:")+t,R=this._sourceCaches[S]=new c.SourceCache(S,_,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[t]=R,R.style=this,R.onAdd(this.map)};v(!1),"vector"!==l.type&&"geojson"!==l.type||v(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const l=this.getSource(t);if(void 0===l)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new c.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new c.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(t);for(const _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new c.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,l){this._checkLoaded(),this.getSource(t).setData(l),this._changed=!0}getSource(t){const l=this._getSourceCache(t);return l&&l.getSource()}addLayer(t,l,p={}){this._checkLoaded();const _=t.id;if(this.getLayer(_))return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let v;if("custom"===t.type){if(Pa(this,c.validateCustomStyleLayer(t)))return;v=c.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(_,t.source),t=c.clone$2(t),t=c.extend(t,{source:_})),this._validate(c.validateStyle.layer,`layers.${_}`,t,{arrayIndex:-1},p))return;v=c.createStyleLayer(t),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const E=l?this._order.indexOf(l):this._order.length;if(l&&-1===E)return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=v;const S=this._getLayerSourceCache(v);if(this._removedLayers[_]&&v.source&&S&&"custom"!==v.type){const R=this._removedLayers[_];delete this._removedLayers[_],R.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",S.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,l){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===l)return;const p=this._order.indexOf(t);this._order.splice(p,1);const _=l?this._order.indexOf(l):this._order.length;l&&-1===_?this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(_,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const l=this._layers[t];if(!l)return void this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(t);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=l,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const l in this._layers)if(this._layers[l].type===t)return!0;return!1}setLayerZoomRange(t,l,p){this._checkLoaded();const _=this.getLayer(t);_?_.minzoom===l&&_.maxzoom===p||(null!=l&&(_.minzoom=l),null!=p&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,l,p={}){this._checkLoaded();const _=this.getLayer(t);if(_){if(!je(_.filter,l))return null==l?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(c.validateStyle.filter,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=c.clone$2(l),this._updateLayer(_)))}else this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){return c.clone$2(this.getLayer(t).filter)}setLayoutProperty(t,l,p,_={}){this._checkLoaded();const v=this.getLayer(t);v?je(v.getLayoutProperty(l),p)||(v.setLayoutProperty(l,p,_),this._updateLayer(v)):this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,l){const p=this.getLayer(t);if(p)return p.getLayoutProperty(l);this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,l,p,_={}){this._checkLoaded();const v=this.getLayer(t);v?je(v.getPaintProperty(l),p)||(v.setPaintProperty(l,p,_)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new c.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,l){return this.getLayer(t).getPaintProperty(l)}setFeatureState(t,l){this._checkLoaded();const p=t.source,_=t.sourceLayer,v=this.getSource(p);if(void 0===v)return void this.fire(new c.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const E=v.type;if("geojson"===E&&_)return void this.fire(new c.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!_)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(p);for(const R of S)R.setFeatureState(_,t.id,l)}removeFeatureState(t,l){this._checkLoaded();const p=t.source,_=this.getSource(p);if(void 0===_)return void this.fire(new c.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const v=_.type,E="vector"===v?t.sourceLayer:void 0;if("vector"===v&&!E)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new c.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(p);for(const R of S)R.removeFeatureState(E,t.id,l)}getFeatureState(t){this._checkLoaded();const l=t.source,p=t.sourceLayer,_=this.getSource(l);if(void 0!==_){if("vector"!==_.type||p)return void 0===t.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,t.id);this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new c.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();t[p.id]||(t[p.id]=p.serialize())}return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(t){this._updatedLayers[t.id]=!0;const l=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&l&&"raster"!==l.getSource().type&&(this._updatedSources[t.source]="reload",l.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const l=E=>"fill-extrusion"===this._layers[E].type,p={},_=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(l(S)){p[S]=E;for(const R of t){const O=R[S];if(O)for(const N of O)_.push(N)}}}_.sort((E,S)=>S.intersectionZ-E.intersectionZ);const v=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(l(S))for(let R=_.length-1;R>=0;R--){const O=_[R].feature;if(p[O.layer.id]<E)break;v.push(O),_.pop()}else for(const R of t){const O=R[S];if(O)for(const N of O)v.push(N.feature)}}return v}queryRenderedFeatures(t,l,p){l&&l.filter&&this._validate(c.validateStyle.filter,"queryRenderedFeatures.filter",l.filter,null,l);const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new c.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of l.layers){const O=this._layers[R];if(!O)return this.fire(new c.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];_[O.source]=!0}}const v=[];l.availableImages=this._availableImages;const E=l&&l.layers?l.layers.some(R=>{const O=this.getLayer(R);return O&&O.is3D()}):this.has3DLayers(),S=Er.createFromScreenPoints(t,p);for(const R in this._sourceCaches){const O=this._sourceCaches[R].getSource().id;l.layers&&!_[O]||v.push(pe(this._sourceCaches[R],this._layers,this._serializedLayers,S,l,p,E,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(R,O,N,V,X,re,le){const ne={},fe=re.queryRenderedSymbols(V),ie=[];for(const me of Object.keys(fe).map(Number))ie.push(le[me]);ie.sort(Le);for(const me of ie){const ge=me.featureIndex.lookupSymbolFeatures(fe[me.bucketInstanceId],O,me.bucketIndex,me.sourceLayerIndex,X.filter,X.layers,X.availableImages,R);for(const se in ge){const ve=ne[se]=ne[se]||[],Te=ge[se];Te.sort((We,Ze)=>{const at=me.featureSortOrder;if(at){const nt=at.indexOf(We.featureIndex);return at.indexOf(Ze.featureIndex)-nt}return Ze.featureIndex-We.featureIndex});for(const We of Te)ve.push(We)}}for(const me in ne)ne[me].forEach(ge=>{const se=ge.feature,ve=N(R[me]).getFeatureState(se.layer["source-layer"],se.id);se.source=se.layer.source,se.layer["source-layer"]&&(se.sourceLayer=se.layer["source-layer"]),se.state=ve});return ne}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(t,l){l&&l.filter&&this._validate(c.validateStyle.filter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(t);let _=[];for(const v of p)_=_.concat(Ee(v,l));return _}addSourceType(t,l,p){return Ui.getSourceType(t)?p(new Error(`A source type called "${t}" already exists.`)):(Ui.setSourceType(t,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(t,l={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const E in t)if(!je(t[E],p[E])){_=!0;break}if(!_)return;const v={now:c.exported.now(),transition:c.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,l),this.light.updateTransitions(v)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(t){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof t.source){const l="terrain-dem-src";this.addSource(l,t.source),t=c.clone$2(t),t=c.extend(t,{source:l})}if(!this._validate(c.validateStyle.terrain,"terrain",t)){if(this.terrain){const l=this.terrain,p=l.get();for(const _ in t)if(!je(t[_],p[_])){l.set(t),this.stylesheet.terrain=t;const v={now:c.exported.now(),transition:c.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(v);break}}else this._createTerrain(t);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(t){const l=this.fog=new Ye(t,this.map.transform);this.stylesheet.fog=t;const p={now:c.exported.now(),transition:c.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(p)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();for(const _ in t)if(!je(t[_],p[_])){l.set(t),this.stylesheet.fog=t;const v={now:c.exported.now(),transition:c.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(v);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...l)}_createTerrain(t){const l=this.terrain=new Re(t);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const p={now:c.exported.now(),transition:c.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const l=this._layers[t];"fill-extrusion"===l.type&&this._updateLayer(l)}}_validate(t,l,p,_,v={}){return(!v||!1!==v.validate)&&Pa(this,t.call(c.validateStyle,c.extend({key:l,style:this.serialize(),value:p,styleSpec:c.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const l=this._getSourceCaches(t);for(const p of l)p.clearTiles()}_reloadSource(t){const l=this._getSourceCaches(t);for(const p of l)p.resume(),p.reload()}_updateSources(t){for(const l in this._sourceCaches)this._sourceCaches[l].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const l=this._sourceCaches[t];l.resume(),l.reload()}}_updatePlacement(t,l,p,_,v=!1){let E=!1,S=!1;const R={};for(const O of this._order){const N=this._layers[O];if("symbol"!==N.type)continue;if(!R[N.source]){const X=this._getLayerSourceCache(N);if(!X)continue;R[N.source]=X.getRenderableIds(!0).map(re=>X.getTileByID(re)).sort((re,le)=>le.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(le.tileID)?-1:1))}const V=this.crossTileSymbolIndex.addLayer(N,R[N.source],t.center.lng);E=E||V}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||0===p,this._layerOrderChanged&&this.fire(new c.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.exported.now(),t.zoom))&&(this.pauseablePlacement=new ls(t,this._order,v,l,p,_,this.placement,this.fog&&!this.fog.isSoftDisabled()?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.exported.now()),S=!0),E&&this.pauseablePlacement.placement.setStale()),S||E)for(const O of this._order){const N=this._layers[O];"symbol"===N.type&&this.placement.updateLayerOpacities(N,R[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const _=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(t,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(t,l,p){return c.makeRequest(l,p)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const l=[];return this._otherSourceCaches[t]&&l.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&l.push(this._symbolSourceCaches[t]),l}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}}Ui.getSourceType=function(d){return j[d]},Ui.setSourceType=function(d,t){j[d]=t},Ui.registerForPluginStateChange=c.registerForPluginStateChange;var us="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",ol="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let hs={},es={};hs=Un("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else \nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),es=Un("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const No=Un("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Is=us;var ka={background:Un("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Un("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Un("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Un("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Un("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));vec3 globePos=a_pos_3+xAxis*extrude.x+yAxis*extrude.y+elevationVector(tilePos)*elevation(tilePos);vec3 mercPos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+xAxis*extrude.x+yAxis*extrude.y;vec3 pos=mix_globe_mercator(globePos,mercPos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Un("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Un("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Un("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Un("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Un("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Un("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Un("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Un("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Un("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Un("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Un("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Un("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Un("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Un("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Un("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Un("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Un("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Un("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Un("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Un("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Un("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ol),skyboxGradient:Un("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ol),skyboxCapture:Un("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Un("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Un("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:Un("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying float v_depth;void main() {vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);v_depth=gl_Position.z/gl_Position.w;}")};function Un(d,t,l){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,v=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E=d.match(_),S=t.match(_),R=us.match(_);let O=S?S.concat(E):E;l||(hs.staticUniforms&&(O=hs.staticUniforms.concat(O)),es.staticUniforms&&(O=es.staticUniforms.concat(O))),O&&(O=O.concat(R));const N={};return{fragmentSource:d=d.replace(p,(V,X,re,le,ne)=>(N[ne]=!0,"define"===X?`\n#ifndef HAS_UNIFORM_u_${ne}\nvarying ${re} ${le} ${ne};\n#else\nuniform ${re} ${le} u_${ne};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${ne}\n    ${re} ${le} ${ne} = u_${ne};\n#endif\n`)),vertexSource:t=t.replace(p,(V,X,re,le,ne)=>{const fe="float"===le?"vec2":"vec4",ie=ne.match(/color/)?"color":fe;return N[ne]?"define"===X?`\n#ifndef HAS_UNIFORM_u_${ne}\nuniform lowp float u_${ne}_t;\nattribute ${re} ${fe} a_${ne};\nvarying ${re} ${le} ${ne};\n#else\nuniform ${re} ${le} u_${ne};\n#endif\n`:"vec4"===ie?`\n#ifndef HAS_UNIFORM_u_${ne}\n    ${ne} = a_${ne};\n#else\n    ${re} ${le} ${ne} = u_${ne};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${ne}\n    ${ne} = unpack_mix_${ie}(a_${ne}, u_${ne}_t);\n#else\n    ${re} ${le} ${ne} = u_${ne};\n#endif\n`:"define"===X?`\n#ifndef HAS_UNIFORM_u_${ne}\nuniform lowp float u_${ne}_t;\nattribute ${re} ${fe} a_${ne};\n#else\nuniform ${re} ${le} u_${ne};\n#endif\n`:"vec4"===ie?`\n#ifndef HAS_UNIFORM_u_${ne}\n    ${re} ${le} ${ne} = a_${ne};\n#else\n    ${re} ${le} ${ne} = u_${ne};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${ne}\n    ${re} ${le} ${ne} = unpack_mix_${ie}(a_${ne}, u_${ne}_t);\n#else\n    ${re} ${le} ${ne} = u_${ne};\n#endif\n`}),staticAttributes:v,staticUniforms:O}}class Ra{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,l,p,_,v,E,S,R){this.context=t;let O=this.boundPaintVertexBuffers.length!==_.length;for(let N=0;!O&&N<_.length;N++)this.boundPaintVertexBuffers[N]!==_[N]&&(O=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===p&&!O&&this.boundIndexBuffer===v&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===R?(t.bindVertexArrayOES.set(this.vao),S&&S.bind(),v&&v.dynamicDraw&&v.bind(),R&&R.bind()):this.freshBind(l,p,_,v,E,S,R)}freshBind(t,l,p,_,v,E,S){let R;const O=t.numAttributes,N=this.context,V=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=t,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=S;else{R=N.currentNumAttributes||0;for(let X=O;X<R;X++)V.disableVertexAttribArray(X)}l.enableAttributes(V,t);for(const X of p)X.enableAttributes(V,t);E&&E.enableAttributes(V,t),S&&S.enableAttributes(V,t),l.bind(),l.setVertexAttribPointers(V,t,v);for(const X of p)X.bind(),X.setVertexAttribPointers(V,t,v);E&&(E.bind(),E.setVertexAttribPointers(V,t,v)),_&&_.bind(),S&&(S.bind(),S.setVertexAttribPointers(V,t,v)),N.currentNumAttributes=O}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ds(d,t){const l=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new c.MercatorCoordinate(0,p/l).toLngLat().lat,new c.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function Do(d,t,l,p,_,v,E){const S=d.context,R=S.gl,O=l.fbo;if(!O)return;d.prepareDrawTile(t);const N=d.useProgram("hillshade");S.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,O.colorAttachment.get());const V=((ne,fe,ie,me)=>{const ge=ie.paint.get("hillshade-shadow-color"),se=ie.paint.get("hillshade-highlight-color"),ve=ie.paint.get("hillshade-accent-color");let Te=ie.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ie.paint.get("hillshade-illumination-anchor")&&(Te-=ne.transform.angle);const We=!ne.options.moving;return{u_matrix:me||ne.transform.calculateProjMatrix(fe.tileID.toUnwrapped(),We),u_image:0,u_latrange:ds(0,fe.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),Te],u_shadow:ge,u_highlight:se,u_accent:ve}})(d,l,p,d.terrain?t.projMatrix:null);d.prepareDrawProgram(S,N,t.toUnwrapped());const{tileBoundsBuffer:X,tileBoundsIndexBuffer:re,tileBoundsSegments:le}=d.getTileBoundsBuffers(l);N.draw(S,R.TRIANGLES,_,v,E,c.CullFaceMode.disabled,V,p.id,X,re,le)}function ca(d,t,l){if(!t.needsDEMTextureUpload)return;const p=d.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(l.stride);const v=l.getPixels();t.demTexture?t.demTexture.update(v,{premultiply:!1}):t.demTexture=new c.Texture(p,v,_.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Co(d,t,l,p,_,v){const E=d.context,S=E.gl;if(!t.dem)return;const R=t.dem;if(E.activeTexture.set(S.TEXTURE1),ca(d,t,R),!t.demTexture)return;t.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const O=R.dim;E.activeTexture.set(S.TEXTURE0);let N=t.fbo;if(!N){const le=new c.Texture(E,{width:O,height:O,data:null},S.RGBA);le.bind(S.LINEAR,S.CLAMP_TO_EDGE),N=t.fbo=E.createFramebuffer(O,O,!0),N.colorAttachment.set(le.texture)}E.bindFramebuffer.set(N.framebuffer),E.viewport.set([0,0,O,O]);const{tileBoundsBuffer:V,tileBoundsIndexBuffer:X,tileBoundsSegments:re}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(E,S.TRIANGLES,p,_,v,c.CullFaceMode.disabled,((le,ne)=>{const fe=ne.stride,ie=c.create$1();return c.ortho(ie,0,c.EXTENT,-c.EXTENT,0,0,1),c.translate(ie,ie,[0,-c.EXTENT,0]),{u_matrix:ie,u_image:1,u_dimension:[fe,fe],u_zoom:le.overscaledZ,u_unpack:ne.unpackVector}})(t.tileID,R),l.id,V,X,re),t.needsHillshadePrepare=!1}const Jn=(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_image0:new c.Uniform1i(d,t.u_image0),u_skirt_height:new c.Uniform1f(d,t.u_skirt_height)}),Ms=(d,t)=>({u_matrix:d,u_image0:0,u_skirt_height:t}),Zs=new class{constructor(){this.operations={}}newMorphing(d,t,l,p,_){if(d in this.operations){const v=this.operations[d];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[d]={startTime:p,phase:0,duration:_,from:t,to:l,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const t=this.operations[d];return{from:t.from,to:t.to,phase:t.phase}}update(d){for(const t in this.operations){const l=this.operations[t];for(l.phase=(d-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,d)){delete this.operations[t];break}}}_nextOp(d,t){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=t,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},qs={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ws(d,t){const l=1<<d.z;return!t&&(0===d.x||d.x===l-1)||0===d.y||d.y===l-1}const Qr=d=>({u_matrix:d});function z(d,t,l,p,_){if(_>0){const v=c.exported.now(),E=(v-d.timeAdded)/_,S=t?(v-t.timeAdded)/_:-1,R=l.getSource(),O=p.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),N=!t||Math.abs(t.tileID.overscaledZ-O)>Math.abs(d.tileID.overscaledZ-O),V=N&&d.refreshedUponExpiration?1:c.clamp(N?E:1-S,0,1);return d.refreshedUponExpiration&&E>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}class W extends c.SourceCache{constructor(t){const l=H("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Tt(At(),null),t.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,l,p){if(t.freezeTileCoverage)return;this.transform=t;const _=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,E)=>{if(v[E.key]="",!this._tiles[E.key]){const S=new c.Tile(E,this._source.tileSize*E.overscaleFactor(),t.tileZoom);S.state="loaded",this._tiles[E.key]=S}return v},{});for(const v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(t){const l=this.proxyCachedFBO[t];if(void 0!==l){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class B extends c.OverscaledTileID{constructor(t,l,p){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class J extends c.Elevation{constructor(t,l){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,v]=function(R){const O=new c.StructArrayLayout4i8,N=new c.StructArrayLayout3ui6,V=131;O.reserve(17161),N.reserve(33800);const X=c.EXTENT/128,re=c.EXTENT+X/2,le=re+X;for(let fe=-X;fe<le;fe+=X)for(let ie=-X;ie<le;ie+=X){const me=ie<0||ie>re||fe<0||fe>re?24575:0,ge=c.clamp(Math.round(ie),0,c.EXTENT),se=c.clamp(Math.round(fe),0,c.EXTENT);O.emplaceBack(ge+me,se,ge,se)}const ne=(fe,ie)=>{const me=ie*V+fe;N.emplaceBack(me+1,me,me+V),N.emplaceBack(me+V,me+V+1,me+1)};for(let fe=1;fe<129;fe++)for(let ie=1;ie<129;ie++)ne(ie,fe);return[0,129].forEach(fe=>{for(let ie=0;ie<130;ie++)ne(ie,fe),ne(fe,ie)}),[O,N,32768]}(),E=t.context;this.gridBuffer=E.createVertexBuffer(p,c.boundsAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(_),this.gridSegments=c.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=c.SegmentVector.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new W(l.map),this.orthoMatrix=c.create$1(),c.ortho(this.orthoMatrix,0,c.EXTENT,0,c.EXTENT,0,1);const S=E.gl;this._overlapStencilMode=new c.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,l,p){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const _=t.terrain.properties;this.sourceCache=t._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const v=()=>{this.sourceCache.used&&c.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.sourceCache.getSource().tileSize/128,S=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(l,E*S,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),l.updateElevation(!p),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&c.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=0===p._centerAltitude&&-1===this.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(p.center),-1),this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(R=>{const O=l.getTileByID(R).tileID;return O.projMatrix=p.calculateProjMatrix(O.toUnwrapped()),O});(function(R,O){const N=O.transform.pointCoordinate(O.transform.getCameraPoint()),V=new c.pointGeometry(N.x,N.y);R.sort((X,re)=>{if(re.overscaledZ-X.overscaledZ)return re.overscaledZ-X.overscaledZ;const le=new c.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),ne=new c.pointGeometry(re.canonical.x+(1<<re.canonical.z)*re.wrap,re.canonical.y),fe=V.mult(1<<X.canonical.z);return fe.x-=.5,fe.y-=.5,fe.distSqr(le)-fe.distSqr(ne)})})(_,this.painter),this._previousZoom=p.zoom;const v=this.proxyToSource||{};this.proxyToSource={},_.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const R in E){const O=E[R];if(!O.used||(O!==this.sourceCache&&(this._findCoveringTileCache[O.id]={}),this._setupProxiedCoordsForOrtho(O,t[R],v),O.usedForTerrain))continue;const N=t[R];O.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[l.id]=_.map(R=>new B(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=c.exported.now();const S={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const O=this.terrainTileForTile[R.key];if(!O)continue;const N=O.tileID.key;N in S||(this._visibleDemTiles.push(O),S[N]=N)}}_assignTerrainTiles(t){this._initializing||t.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const t=this.painter.context,l=t.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(t.activeTexture.set(l.TEXTURE1),ca(this.painter,_,v))}}_prepareDemTileUniforms(t,l,p,_){if(!l||null==l.demTexture)return!1;const v=t.tileID.canonical,E=Math.pow(2,l.tileID.canonical.z-v.z),S=_||"";return p[`u_dem_tl${S}`]=[v.x*E%1,v.y*E%1],p[`u_dem_scale${S}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let t=0;const l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const v=_.dem.tree.minimums[0];return v>0&&t++,p+v},0);return t?l/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,l=t.gl;t.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),_={width:1,height:1,data:new Uint8Array(c.DEMData.pack(p,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(_,{premultiply:!1}):v=this._emptyDEMTexture=new c.Texture(t,_,l.RGBA,{premultiply:!1}),v}setupElevationDraw(t,l,p){const _=this.painter.context,v=_.gl,E=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:c.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var S;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();let R=null,O=null,N=1;if(p&&p.morphing&&this._useVertexMorphing){const V=p.morphing.srcDemTile,X=p.morphing.dstDemTile;N=p.morphing.phase,V&&X&&(this._prepareDemTileUniforms(t,V,E,"_prev")&&(O=V),this._prepareDemTileUniforms(t,X,E)&&(R=X))}if(O&&R?(_.activeTexture.set(v.TEXTURE2),R.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),_.activeTexture.set(v.TEXTURE4),O.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),E.u_dem_lerp=N):(R=this.terrainTileForTile[t.tileID.key],_.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(t,R,E)?R.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),p&&p.useDepthForOcclusion&&(_.activeTexture.set(v.TEXTURE3),this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),p&&p.useMeterToDem&&R){const V=(1<<R.tileID.canonical.z)*c.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=V}p&&p.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,E)}renderToBackBuffer(t){const l=this.painter,p=this.painter.context;0!==t.length&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),this.renderingToTexture=!1,function(_,v,E,S,R){const O=_.context,N=O.gl;let V,X;const re=_.options.showTerrainWireframe?2:0,le=(ge,se)=>{if(X===ge)return;const ve=[qs[ge]];se&&ve.push(qs[re]),V=_.useProgram("terrainRaster",null,ve),X=ge},ne=_.colorModeForRenderPass(),fe=new c.DepthMode(N.LEQUAL,c.DepthMode.ReadWrite,_.depthRangeFor3D);Zs.update(R);const ie=_.transform,me=6*Math.pow(1.5,22-ie.zoom)*v.exaggeration();(re?[!1,!0]:[!1]).forEach(ge=>{X=-1;const se=ge?N.LINES:N.TRIANGLES,[ve,Te]=ge?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const at of S){const nt=E.getTile(at),It=c.StencilMode.disabled,Qe=v.prevTerrainTileForTile[at.key],kt=v.terrainTileForTile[at.key];Ze=kt,null!=(We=Qe)&&null!=Ze&&We.hasData()&&Ze.hasData()&&null!=We.demTexture&&null!=Ze.demTexture&&We.tileID.key!==Ze.tileID.key&&Zs.newMorphing(at.key,Qe,kt,R,250),O.activeTexture.set(N.TEXTURE0),nt.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const Ge=Zs.getMorphValuesForProxy(at.key),Ft=Ge?1:0;let Jt;Ge&&(Jt={morphing:{srcDemTile:Ge.from,dstDemTile:Ge.to,phase:c.easeCubicInOut(Ge.phase)}});const wn=Ms(at.projMatrix,Ws(at.canonical,ie.renderWorldCopies)?me/10:me);le(Ft,ge),v.setupElevationDraw(nt,V,Jt),_.prepareDrawProgram(O,V,at.toUnwrapped()),V.draw(O,se,fe,It,ne,c.CullFaceMode.backCCW,wn,"terrain_raster",v.gridBuffer,ve,Te)}var We,Ze})}(l,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],E=this._drapedRenderBatches.shift(),S=[],R=l.style.order;let O=0;for(const N of v){const V=_.getTileByID(N.proxyTileKey),X=_.proxyCachedFBO[N.key]?_.proxyCachedFBO[N.key][t]:void 0,re=void 0!==X?_.renderCache[X]:this.pool[O++],le=void 0!==X;if(V.texture=re.tex,le&&!re.dirty){S.push(V.tileID);continue}let ne;p.bindFramebuffer.set(re.fb.framebuffer),this.renderedToTile=!1,re.dirty&&(p.clear({color:c.Color.transparent}),re.dirty=!1);for(let fe=E.start;fe<=E.end;++fe){const ie=l.style._layers[R[fe]];if(ie.isHidden(l.transform.zoom))continue;const me=l.style._getLayerSourceCache(ie),ge=me?this.proxyToSource[N.key][me.id]:[N];if(!ge)continue;const se=ge;p.viewport.set([0,0,re.fb.width,re.fb.height]),ne!==(me?me.id:null)&&(this._setupStencil(re,ge,ie,me),ne=me?me.id:null),l.renderLayer(l,me,ie,se)}this.renderedToTile?(re.dirty=!0,S.push(V.tileID)):le||--O,5===O&&(O=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),E.end+1}postRender(){}renderCacheEfficiency(t){const l=t.order.length;if(0===l)return{efficiency:100};let p,_=0,v=0,E=!1;for(let S=0;S<l;++S){const R=t._layers[t.order[S]];this._style.isLayerDraped(R)?(E&&++_,++v):E||(E=!0,p=R.id)}return 0===v?{efficiency:100}:{efficiency:100*(1-_/v),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{t=Math.min(t,l.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,l,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const E=v.tileID,S=Math.pow(2,E.overscaledZ),{x:R,y:O}=E.canonical,N=R/S,V=(R+1)/S,X=O/S,re=(O+1)/S;return{minx:N,miny:X,maxx:V,maxy:re,t:v.dem.tree.raycastRoot(N,X,V,re,t,l,p),tile:v}});_.sort((v,E)=>(null!==v.t?v.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const v of _){if(null==v.t)return null;const E=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,t,l,p);if(null!=E)return E}return null}_createFBO(){const t=this.painter.context,l=t.gl,p=this.drapeBufferSize;t.activeTexture.set(l.TEXTURE0);const _=new c.Texture(t,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const v=t.createFramebuffer(p[0],p[1],!1);return v.colorAttachment.set(_.texture),v.depthAttachment=new uo(t,v.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const l=this._style._layers[t],p=l.isHidden(this.painter.transform.zoom),_=l.getCrossfadeParameters(),v=!!_&&1!==_.t,E=l.hasTransition();return"custom"!==l.type&&!p&&(v||E)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof Fo){t=!0;break}if(t)for(let l=0;l<this._style.order.length;++l){const p=this._style._layers[this._style.order[l]],_=p.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(p);if("raster"!==p.type||_||!v)continue;const E=p.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const R=this.proxyToSource[S.key][v.id];if(R)for(const O of R){const N=z(v.getTile(O),v.findLoadedParent(O,0),v,this.painter.transform,E);(1!==N.opacity||0!==N.mix)&&this._clearRenderCacheForTile(v.id,O)}}}}_setupDrapedRenderBatches(){const t=this._style.order,l=t.length;if(0===l)return;const p=[];let _,v=0,E=this._style._layers[t[v]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++v<l;)E=this._style._layers[t[v]];for(;v<l;++v){const S=this._style._layers[t[v]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?void 0===_&&(_=v):void 0!==_&&(p.push({start:_,end:v-1}),_=void 0))}void 0!==_&&p.push({start:_,end:v-1}),this._drapedRenderBatches=p}_setupRenderCache(t){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const E=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let S=0;S<E.length;++S){const R=Object.values(E[S]);l.renderCachePool.push(...R)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let E=p.length-1;E>=0;E--){const S=p[E];if(l.getTileByID(S.key),void 0!==l.proxyCachedFBO[S.key]){const R=t[S.key],O=this.proxyToSource[S.key];let N=0;for(const V in O){const X=O[V],re=R[V];if(!re||re.length!==X.length||X.some((le,ne)=>le!==re[ne]||_[V]&&_[V].hasOwnProperty(le.key))){N=-1;break}++N}for(const V in l.proxyCachedFBO[S.key])l.renderCache[l.proxyCachedFBO[S.key][V]].dirty=N<0||N!==Object.values(R).length}}const v=[...this._drapedRenderBatches];v.sort((E,S)=>S.end-S.start-(E.end-E.start));for(const E of v)for(const S of p){if(l.proxyCachedFBO[S.key])continue;let R=l.renderCachePool.pop();void 0===R&&l.renderCache.length<50&&(R=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==R&&(l.proxyCachedFBO[S.key]={},l.proxyCachedFBO[S.key][E.start]=R,l.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(t,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,E=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let S;if(p.isTileClipped())S=l.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):c.StencilMode.disabled}_renderTileClippingMasks(t,l){const p=this.painter,_=this.painter.context,v=_.gl;p._tileClippingMaskIDs={},_.setColorMode(c.ColorMode.disabled),_.setDepthMode(c.DepthMode.disabled);const E=p.useProgram("clippingMask");for(const S of t){const R=p._tileClippingMaskIDs[S.key]=--l;E.draw(_,v.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,Qr(S.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(t){const l=this.painter.transform;if(t.x<0||t.x>l.width||t.y<0||t.y>l.height)return null;const p=[t.x,t.y,1,1];c.transformMat4(p,p,l.pixelMatrixInverse),c.scale$2(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const _=l._camera.position,v=c.mercatorZfromAltitude(1,l.center.lat),E=[_[0],_[1],_[2]/v,0],S=c.subtract([],p.slice(0,3),E);c.normalize(S,S);const R=this.raycast(E,S,this._exaggeration);return null!==R&&R?(c.scaleAndAdd(E,E,S,R),E[3]=E[2],E[2]*=v,E):null}drawDepth(){const t=this.painter,l=t.context,p=this.proxySourceCache,_=Math.ceil(t.width),v=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===v||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const E=l.gl,S=l.createFramebuffer(_,v,!0);l.activeTexture.set(E.TEXTURE0);const R=new c.Texture(l,{width:_,height:v,data:null},E.RGBA);R.bind(E.NEAREST,E.CLAMP_TO_EDGE),S.colorAttachment.set(R.texture);const O=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,v);S.depthAttachment.set(O),this._depthFBO=S,this._depthTexture=R}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,v]),function(E,S,R,O){const N=E.context,V=N.gl;N.clear({depth:1});const X=E.useProgram("terrainDepth"),re=new c.DepthMode(V.LESS,c.DepthMode.ReadWrite,E.depthRangeFor3D);for(const le of O){const ne=R.getTile(le),fe=Ms(le.projMatrix,0);S.setupElevationDraw(ne,X),X.draw(N,V.TRIANGLES,re,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.backCCW,fe,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(t,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,l,p){if(t.getSource()instanceof Q)return this._setupProxiedCoordsForImageSource(t,l,p);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const _=this.proxiedCoords[t.id]=[],v=this.proxyCoords;for(let S=0;S<v.length;S++){const R=v[S],O=this._findTileCoveringTileID(R,t);if(O){const N=this._createProxiedId(R,O,p[R.key]&&p[R.key][t.id]);_.push(N),this.proxyToSource[R.key][t.id]=[N]}}let E=!1;for(let S=0;S<l.length;S++){const R=t.getTile(l[S]);if(!R||!R.hasData())continue;const O=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==R.tileID.canonical.z){const N=this.proxyToSource[O.tileID.key][t.id],V=this._createProxiedId(O.tileID,R,p[O.tileID.key]&&p[O.tileID.key][t.id]);N?N.splice(N.length-1,0,V):this.proxyToSource[O.tileID.key][t.id]=[V],_.push(V),E=!0}}this._sourceTilesOverlap[t.id]=E}_setupProxiedCoordsForImageSource(t,l,p){if(!t.getSource().loaded())return;const _=this.proxiedCoords[t.id]=[],v=this.proxyCoords,E=t.getSource(),S=new c.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),R=E.coordinates.map(c.MercatorCoordinate.fromLngLat).reduce((N,V)=>(N.min.x=Math.min(N.min.x,V.x-S.x),N.min.y=Math.min(N.min.y,V.y-S.y),N.max.x=Math.max(N.max.x,V.x-S.x),N.max.y=Math.max(N.max.y,V.y-S.y),N),{min:new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(N,V)=>{const X=N.wrap+N.canonical.x/(1<<N.canonical.z),re=N.canonical.y/(1<<N.canonical.z),le=c.EXTENT/(1<<N.canonical.z),ne=V.wrap+V.canonical.x/(1<<V.canonical.z),fe=V.canonical.y/(1<<V.canonical.z);return X+le<ne+R.min.x||X>ne+R.max.x||re+le<fe+R.min.y||re>fe+R.max.y};for(let N=0;N<v.length;N++){const V=v[N];for(let X=0;X<l.length;X++){const re=t.getTile(l[X]);if(!re||!re.hasData()||O(V,re.tileID))continue;const le=this._createProxiedId(V,re,p[V.key]&&p[V.key][t.id]),ne=this.proxyToSource[V.key][t.id];ne?ne.push(le):this.proxyToSource[V.key][t.id]=[le],_.push(le)}}}_createProxiedId(t,l,p){let _=this.orthoMatrix;if(p){const v=p.find(E=>E.key===l.tileID.key);if(v)return v}if(l.tileID.key!==t.key){const v=t.canonical.z-l.tileID.canonical.z;let E,S,R;_=c.create$1();const O=l.tileID.wrap-t.wrap<<t.overscaledZ;v>0?(E=c.EXTENT>>v,S=E*((l.tileID.canonical.x<<v)-t.canonical.x+O),R=E*((l.tileID.canonical.y<<v)-t.canonical.y)):(E=c.EXTENT<<-v,S=c.EXTENT*(l.tileID.canonical.x-(t.canonical.x+O<<-v)),R=c.EXTENT*(l.tileID.canonical.y-(t.canonical.y<<-v))),c.ortho(_,0,E,0,E,0,1),c.translate(_,_,[S,R,0])}return new B(l.tileID,t.key,_)}_findTileCoveringTileID(t,l){let p=l.getTile(t);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[l.id],v=_[t.key];if(p=v?l.getTileByID(v):null,p&&p.hasData()||null===v)return p;let E=p?p.tileID:t,S=E.overscaledZ;const R=l.getSource().minzoom,O=[];if(!v){const V=l.getSource().maxzoom;if(t.canonical.z>=V){const X=t.canonical.z-V;l.getSource().reparseOverscaled?(S=Math.max(t.canonical.z+2,l.transform.tileZoom),E=new c.OverscaledTileID(S,t.wrap,V,t.canonical.x>>X,t.canonical.y>>X)):0!==X&&(S=V,E=new c.OverscaledTileID(S,t.wrap,V,t.canonical.x>>X,t.canonical.y>>X))}E.key!==t.key&&(O.push(E.key),p=l.getTile(E))}const N=V=>{O.forEach(X=>{_[X]=V}),O.length=0};for(S-=1;S>=R&&(!p||!p.hasData());S--){p&&N(p.tileID.key);const V=E.calculateScaledKey(S);if(p=l.getTileByID(V),p&&p.hasData())break;const X=_[V];if(null===X)break;void 0===X?O.push(V):p=l.getTileByID(X)}return N(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(t){this.renderedToTile=!0}_clearRenderCacheForTile(t,l){let p=this._tilesDirty[t];p||(p=this._tilesDirty[t]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(l){let p,_,v;const E=new c.StructArrayLayout2ui4,S=131;for(_=1;_<129;_++){for(p=1;p<129;p++)v=_*S+p,E.emplaceBack(v,v+1),E.emplaceBack(v,v+S),E.emplaceBack(v+1,v+S),128===_&&E.emplaceBack(v+S,v+S+1);E.emplaceBack(v+1,v+1+S)}return E}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=c.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Se(d){const t=[];for(let l=0;l<d.length;l++){if(null===d[l])continue;const p=d[l].split(" ");t.push(p.pop())}return t}class ot{static cacheKey(t,l,p){let _=`${t}${p?p.cacheKey:""}`;for(const v of l)_+=`/${v}`;return _}constructor(t,l,p,_,v,E){const S=t.gl;this.program=S.createProgram();const R=Se(p.staticAttributes),O=_?_.getBinderAttributes():[],N=R.concat(O),V=p.staticUniforms?Se(p.staticUniforms):[],X=_?_.getBinderUniforms():[],re=V.concat(X),le=[];for(const ve of re)le.indexOf(ve)<0&&le.push(ve);let ne=_?_.defines():[];ne=ne.concat(E.map(ve=>`#define ${ve}`));const fe=ne.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Is,No.fragmentSource,es.fragmentSource,p.fragmentSource).join("\n"),ie=ne.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Is,No.vertexSource,es.vertexSource,hs.vertexSource,p.vertexSource).join("\n"),me=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(me,fe),S.compileShader(me),S.attachShader(this.program,me);const ge=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(ge,ie),S.compileShader(ge),S.attachShader(this.program,ge),this.attributes={};const se={};this.numAttributes=N.length;for(let ve=0;ve<this.numAttributes;ve++)N[ve]&&(S.bindAttribLocation(this.program,ve,N[ve]),this.attributes[N[ve]]=ve);S.linkProgram(this.program),S.deleteShader(ge),S.deleteShader(me);for(let ve=0;ve<le.length;ve++){const Te=le[ve];if(Te&&!se[Te]){const We=S.getUniformLocation(this.program,Te);We&&(se[Te]=We)}}var ve,Te;this.fixedUniforms=v(t,se),this.binderUniforms=_?_.getUniforms(t,se):[],-1!==E.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new c.Uniform1i(ve=t,(Te=se).u_dem),u_dem_prev:new c.Uniform1i(ve,Te.u_dem_prev),u_dem_unpack:new c.Uniform4f(ve,Te.u_dem_unpack),u_dem_tl:new c.Uniform2f(ve,Te.u_dem_tl),u_dem_scale:new c.Uniform1f(ve,Te.u_dem_scale),u_dem_tl_prev:new c.Uniform2f(ve,Te.u_dem_tl_prev),u_dem_scale_prev:new c.Uniform1f(ve,Te.u_dem_scale_prev),u_dem_size:new c.Uniform1f(ve,Te.u_dem_size),u_dem_lerp:new c.Uniform1f(ve,Te.u_dem_lerp),u_exaggeration:new c.Uniform1f(ve,Te.u_exaggeration),u_depth:new c.Uniform1i(ve,Te.u_depth),u_depth_size_inv:new c.Uniform2f(ve,Te.u_depth_size_inv),u_meter_to_dem:new c.Uniform1f(ve,Te.u_meter_to_dem),u_label_plane_matrix_inv:new c.UniformMatrix4f(ve,Te.u_label_plane_matrix_inv),u_tile_tl_up:new c.Uniform3f(ve,Te.u_tile_tl_up),u_tile_tr_up:new c.Uniform3f(ve,Te.u_tile_tr_up),u_tile_br_up:new c.Uniform3f(ve,Te.u_tile_br_up),u_tile_bl_up:new c.Uniform3f(ve,Te.u_tile_bl_up),u_tile_up_scale:new c.Uniform1f(ve,Te.u_tile_up_scale)}),-1!==E.indexOf("FOG")&&(this.fogUniforms=((ve,Te)=>({u_fog_matrix:new c.UniformMatrix4f(ve,Te.u_fog_matrix),u_fog_range:new c.Uniform2f(ve,Te.u_fog_range),u_fog_color:new c.Uniform4f(ve,Te.u_fog_color),u_fog_horizon_blend:new c.Uniform1f(ve,Te.u_fog_horizon_blend),u_fog_temporal_offset:new c.Uniform1f(ve,Te.u_fog_temporal_offset)}))(t,se))}setTerrainUniformValues(t,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in l)p[_].set(l[_])}}setFogUniformValues(t,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in l)p[_].location&&p[_].set(l[_])}}draw(t,l,p,_,v,E,S,R,O,N,V,X,re,le,ne,fe){const ie=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(p),t.setStencilMode(_),t.setColorMode(v),t.setCullFace(E);for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(S[ge]);le&&le.setUniforms(t,this.binderUniforms,X,{zoom:re});const me={[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[l];for(const ge of V.get()){const se=ge.vaos||(ge.vaos={});(se[R]||(se[R]=new Ra)).bind(t,this,O,le?le.getPaintVertexBuffers():[],N,ge.vertexOffset,ne,fe),ie.drawElements(l,ge.primitiveLength*me,ie.UNSIGNED_SHORT,ge.primitiveOffset*me*2)}}}function ht(d,t,l){const p=1/Sn(l,1,t.transform.tileZoom),_=Math.pow(2,l.tileID.overscaledZ),v=l.tileSize*Math.pow(2,t.transform.tileZoom)/_,E=v*(l.tileID.canonical.x+l.tileID.wrap*_),S=v*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[p,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[E>>16,S>>16],u_pixel_coord_lower:[65535&E,65535&S]}}const cn=(d,t,l,p)=>{const _=t.style.light,v=_.properties.get("position"),E=[v.x,v.y,v.z],S=c.create$2();"viewport"===_.properties.get("anchor")&&(c.fromRotation(S,-t.transform.angle),c.transformMat3(E,E,S));const R=_.properties.get("color");return{u_matrix:d,u_lightpos:E,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+l,u_opacity:p}},or=(d,t,l,p,_,v,E)=>c.extend(cn(d,t,l,p),ht(v,t,E),{u_height_factor:-Math.pow(2,_.overscaledZ)/E.tileSize/8}),fn=d=>({u_matrix:d}),hr=(d,t,l,p)=>c.extend(fn(d),ht(l,t,p)),Yn=(d,t)=>({u_matrix:d,u_world:t}),Fr=(d,t,l,p,_)=>c.extend(hr(d,t,l,p),{u_world:_}),Dn=(d,t,l,p)=>{const _=d.transform;let v;return v="map"===p.paint.get("circle-pitch-alignment")?_.calculatePixelsToTileUnitsMatrix(l):new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]),{u_camera_to_center_distance:_.cameraToCenterDistance,u_matrix:d.translatePosMatrix(t.projMatrix,l,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:c.exported.devicePixelRatio,u_extrude_scale:v}},mi=d=>{const t=[];return"map"===d.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===d.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},To=(d,t,l)=>{const p=c.EXTENT/l.tileSize;return{u_matrix:d,u_camera_to_center_distance:t.cameraToCenterDistance,u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},Di=(d,t,l=1)=>({u_matrix:d,u_color:t,u_overlay:0,u_overlay_scale:l}),ai=(d,t,l,p)=>({u_matrix:d,u_extrude_scale:Sn(t,1,l),u_intensity:p}),ro=(d,t,l,p,_,v)=>{const E=d.transform,S=E.calculatePixelsToTileUnitsMatrix(t),R={u_matrix:Ci(d,t,l,_),u_pixels_to_tile_units:S,u_device_pixel_ratio:c.exported.devicePixelRatio,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(As(l)){const O=fs(t,d.transform);R.u_texsize=t.lineAtlasTexture.size,R.u_scale=[O,p.fromScale,p.toScale],R.u_mix=p.t}return R},ts=(d,t,l,p,_)=>{const v=d.transform,E=fs(t,v);return{u_matrix:Ci(d,t,l,_),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:c.exported.devicePixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}};function fs(d,t){return 1/Sn(d,1,t.tileZoom)}function Ci(d,t,l,p){return d.translatePosMatrix(p||t.tileID.projMatrix,t,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const ua=d=>{const t=[];return As(d)&&t.push("RENDER_LINE_DASH"),d.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT"),t};function As(d){const t=d.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Ln=(d,t,l,p,_)=>{return{u_matrix:d,u_tl_parent:t,u_scale_parent:l,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(E=_.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(v=_.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:La(_.paint.get("raster-hue-rotate"))};var v,E};function La(d){d*=Math.PI/180;const t=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*t-l+1)/3,(Math.sqrt(3)*t-l+1)/3]}const dc=(d,t,l,p,_,v,E,S,R,O,N,V,X,re)=>{const le=_.transform;return{u_is_size_zoom_constant:+("constant"===d||"source"===d),u_is_size_feature_constant:+("constant"===d||"camera"===d),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_pitch:le.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:le.width/le.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:E,u_coord_matrix:S,u_is_text:+R,u_pitch_with_map:+p,u_texsize:O,u_tile_id:N,u_zoom_transition:V,u_inv_rot_matrix:X,u_merc_center:re,u_texture:0}},fc=(d,t,l,p,_,v,E,S,R,O,N,V,X,re,le)=>{const{cameraToCenterDistance:ne,_pitch:fe}=_.transform;return c.extend(dc(d,t,l,p,_,v,E,S,R,O,V,X,re,le),{u_gamma_scale:p?ne*Math.cos(_.terrain?0:fe):1,u_device_pixel_ratio:c.exported.devicePixelRatio,u_is_halo:+N})},Hc=(d,t,l,p,_,v,E,S,R,O,N,V,X,re)=>c.extend(fc(d,t,l,p,_,v,E,S,!0,R,!0,N,V,X,re),{u_texsize_icon:O,u_texture_icon:1}),pc=(d,t,l)=>({u_matrix:d,u_opacity:t,u_color:l}),Fl=(d,t,l,p,_,v)=>c.extend(function(E,S,R,O){const N=R.imageManager.getPattern(E.from.toString()),V=R.imageManager.getPattern(E.to.toString()),{width:X,height:re}=R.imageManager.getPixelSize(),le=Math.pow(2,O.tileID.overscaledZ),ne=O.tileSize*Math.pow(2,R.transform.tileZoom)/le,fe=ne*(O.tileID.canonical.x+O.tileID.wrap*le),ie=ne*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:N.tl,u_pattern_br_a:N.br,u_pattern_tl_b:V.tl,u_pattern_br_b:V.br,u_texsize:[X,re],u_mix:S.t,u_pattern_size_a:N.displaySize,u_pattern_size_b:V.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/Sn(O,1,R.transform.tileZoom),u_pixel_coord_upper:[fe>>16,ie>>16],u_pixel_coord_lower:[65535&fe,65535&ie]}}(p,v,l,_),{u_matrix:d,u_opacity:t}),Zc={fillExtrusion:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_lightpos:new c.Uniform3f(d,t.u_lightpos),u_lightintensity:new c.Uniform1f(d,t.u_lightintensity),u_lightcolor:new c.Uniform3f(d,t.u_lightcolor),u_vertical_gradient:new c.Uniform1f(d,t.u_vertical_gradient),u_opacity:new c.Uniform1f(d,t.u_opacity)}),fillExtrusionPattern:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_lightpos:new c.Uniform3f(d,t.u_lightpos),u_lightintensity:new c.Uniform1f(d,t.u_lightintensity),u_lightcolor:new c.Uniform3f(d,t.u_lightcolor),u_vertical_gradient:new c.Uniform1f(d,t.u_vertical_gradient),u_height_factor:new c.Uniform1f(d,t.u_height_factor),u_image:new c.Uniform1i(d,t.u_image),u_texsize:new c.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new c.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new c.Uniform3f(d,t.u_scale),u_fade:new c.Uniform1f(d,t.u_fade),u_opacity:new c.Uniform1f(d,t.u_opacity)}),fill:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix)}),fillPattern:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_image:new c.Uniform1i(d,t.u_image),u_texsize:new c.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new c.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new c.Uniform3f(d,t.u_scale),u_fade:new c.Uniform1f(d,t.u_fade)}),fillOutline:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_world:new c.Uniform2f(d,t.u_world)}),fillOutlinePattern:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_world:new c.Uniform2f(d,t.u_world),u_image:new c.Uniform1i(d,t.u_image),u_texsize:new c.Uniform2f(d,t.u_texsize),u_pixel_coord_upper:new c.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(d,t.u_pixel_coord_lower),u_scale:new c.Uniform3f(d,t.u_scale),u_fade:new c.Uniform1f(d,t.u_fade)}),circle:(d,t)=>({u_camera_to_center_distance:new c.Uniform1f(d,t.u_camera_to_center_distance),u_extrude_scale:new c.UniformMatrix2f(d,t.u_extrude_scale),u_device_pixel_ratio:new c.Uniform1f(d,t.u_device_pixel_ratio),u_matrix:new c.UniformMatrix4f(d,t.u_matrix)}),collisionBox:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_camera_to_center_distance:new c.Uniform1f(d,t.u_camera_to_center_distance),u_extrude_scale:new c.Uniform2f(d,t.u_extrude_scale)}),collisionCircle:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_inv_matrix:new c.UniformMatrix4f(d,t.u_inv_matrix),u_camera_to_center_distance:new c.Uniform1f(d,t.u_camera_to_center_distance),u_viewport_size:new c.Uniform2f(d,t.u_viewport_size)}),debug:(d,t)=>({u_color:new c.UniformColor(d,t.u_color),u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_overlay:new c.Uniform1i(d,t.u_overlay),u_overlay_scale:new c.Uniform1f(d,t.u_overlay_scale)}),clippingMask:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix)}),heatmap:(d,t)=>({u_extrude_scale:new c.Uniform1f(d,t.u_extrude_scale),u_intensity:new c.Uniform1f(d,t.u_intensity),u_matrix:new c.UniformMatrix4f(d,t.u_matrix)}),heatmapTexture:(d,t)=>({u_image:new c.Uniform1i(d,t.u_image),u_color_ramp:new c.Uniform1i(d,t.u_color_ramp),u_opacity:new c.Uniform1f(d,t.u_opacity)}),hillshade:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_image:new c.Uniform1i(d,t.u_image),u_latrange:new c.Uniform2f(d,t.u_latrange),u_light:new c.Uniform2f(d,t.u_light),u_shadow:new c.UniformColor(d,t.u_shadow),u_highlight:new c.UniformColor(d,t.u_highlight),u_accent:new c.UniformColor(d,t.u_accent)}),hillshadePrepare:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_image:new c.Uniform1i(d,t.u_image),u_dimension:new c.Uniform2f(d,t.u_dimension),u_zoom:new c.Uniform1f(d,t.u_zoom),u_unpack:new c.Uniform4f(d,t.u_unpack)}),line:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_pixels_to_tile_units:new c.UniformMatrix2f(d,t.u_pixels_to_tile_units),u_device_pixel_ratio:new c.Uniform1f(d,t.u_device_pixel_ratio),u_units_to_pixels:new c.Uniform2f(d,t.u_units_to_pixels),u_dash_image:new c.Uniform1i(d,t.u_dash_image),u_gradient_image:new c.Uniform1i(d,t.u_gradient_image),u_image_height:new c.Uniform1f(d,t.u_image_height),u_texsize:new c.Uniform2f(d,t.u_texsize),u_scale:new c.Uniform3f(d,t.u_scale),u_mix:new c.Uniform1f(d,t.u_mix)}),linePattern:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_texsize:new c.Uniform2f(d,t.u_texsize),u_pixels_to_tile_units:new c.UniformMatrix2f(d,t.u_pixels_to_tile_units),u_device_pixel_ratio:new c.Uniform1f(d,t.u_device_pixel_ratio),u_image:new c.Uniform1i(d,t.u_image),u_units_to_pixels:new c.Uniform2f(d,t.u_units_to_pixels),u_scale:new c.Uniform3f(d,t.u_scale),u_fade:new c.Uniform1f(d,t.u_fade)}),raster:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_tl_parent:new c.Uniform2f(d,t.u_tl_parent),u_scale_parent:new c.Uniform1f(d,t.u_scale_parent),u_buffer_scale:new c.Uniform1f(d,t.u_buffer_scale),u_fade_t:new c.Uniform1f(d,t.u_fade_t),u_opacity:new c.Uniform1f(d,t.u_opacity),u_image0:new c.Uniform1i(d,t.u_image0),u_image1:new c.Uniform1i(d,t.u_image1),u_brightness_low:new c.Uniform1f(d,t.u_brightness_low),u_brightness_high:new c.Uniform1f(d,t.u_brightness_high),u_saturation_factor:new c.Uniform1f(d,t.u_saturation_factor),u_contrast_factor:new c.Uniform1f(d,t.u_contrast_factor),u_spin_weights:new c.Uniform3f(d,t.u_spin_weights)}),symbolIcon:(d,t)=>({u_is_size_zoom_constant:new c.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new c.Uniform1f(d,t.u_size_t),u_size:new c.Uniform1f(d,t.u_size),u_camera_to_center_distance:new c.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new c.Uniform1f(d,t.u_pitch),u_rotate_symbol:new c.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new c.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new c.Uniform1f(d,t.u_fade_change),u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new c.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new c.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new c.Uniform1i(d,t.u_is_text),u_pitch_with_map:new c.Uniform1i(d,t.u_pitch_with_map),u_texsize:new c.Uniform2f(d,t.u_texsize),u_tile_id:new c.Uniform3f(d,t.u_tile_id),u_zoom_transition:new c.Uniform1f(d,t.u_zoom_transition),u_inv_rot_matrix:new c.UniformMatrix4f(d,t.u_inv_rot_matrix),u_merc_center:new c.Uniform2f(d,t.u_merc_center),u_texture:new c.Uniform1i(d,t.u_texture)}),symbolSDF:(d,t)=>({u_is_size_zoom_constant:new c.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new c.Uniform1f(d,t.u_size_t),u_size:new c.Uniform1f(d,t.u_size),u_camera_to_center_distance:new c.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new c.Uniform1f(d,t.u_pitch),u_rotate_symbol:new c.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new c.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new c.Uniform1f(d,t.u_fade_change),u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new c.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new c.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new c.Uniform1i(d,t.u_is_text),u_pitch_with_map:new c.Uniform1i(d,t.u_pitch_with_map),u_texsize:new c.Uniform2f(d,t.u_texsize),u_texture:new c.Uniform1i(d,t.u_texture),u_gamma_scale:new c.Uniform1f(d,t.u_gamma_scale),u_device_pixel_ratio:new c.Uniform1f(d,t.u_device_pixel_ratio),u_tile_id:new c.Uniform3f(d,t.u_tile_id),u_zoom_transition:new c.Uniform1f(d,t.u_zoom_transition),u_inv_rot_matrix:new c.UniformMatrix4f(d,t.u_inv_rot_matrix),u_merc_center:new c.Uniform2f(d,t.u_merc_center),u_is_halo:new c.Uniform1i(d,t.u_is_halo)}),symbolTextAndIcon:(d,t)=>({u_is_size_zoom_constant:new c.Uniform1i(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.Uniform1i(d,t.u_is_size_feature_constant),u_size_t:new c.Uniform1f(d,t.u_size_t),u_size:new c.Uniform1f(d,t.u_size),u_camera_to_center_distance:new c.Uniform1f(d,t.u_camera_to_center_distance),u_pitch:new c.Uniform1f(d,t.u_pitch),u_rotate_symbol:new c.Uniform1i(d,t.u_rotate_symbol),u_aspect_ratio:new c.Uniform1f(d,t.u_aspect_ratio),u_fade_change:new c.Uniform1f(d,t.u_fade_change),u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_label_plane_matrix:new c.UniformMatrix4f(d,t.u_label_plane_matrix),u_coord_matrix:new c.UniformMatrix4f(d,t.u_coord_matrix),u_is_text:new c.Uniform1i(d,t.u_is_text),u_pitch_with_map:new c.Uniform1i(d,t.u_pitch_with_map),u_texsize:new c.Uniform2f(d,t.u_texsize),u_texsize_icon:new c.Uniform2f(d,t.u_texsize_icon),u_texture:new c.Uniform1i(d,t.u_texture),u_texture_icon:new c.Uniform1i(d,t.u_texture_icon),u_gamma_scale:new c.Uniform1f(d,t.u_gamma_scale),u_device_pixel_ratio:new c.Uniform1f(d,t.u_device_pixel_ratio),u_is_halo:new c.Uniform1i(d,t.u_is_halo)}),background:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_opacity:new c.Uniform1f(d,t.u_opacity),u_color:new c.UniformColor(d,t.u_color)}),backgroundPattern:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_opacity:new c.Uniform1f(d,t.u_opacity),u_image:new c.Uniform1i(d,t.u_image),u_pattern_tl_a:new c.Uniform2f(d,t.u_pattern_tl_a),u_pattern_br_a:new c.Uniform2f(d,t.u_pattern_br_a),u_pattern_tl_b:new c.Uniform2f(d,t.u_pattern_tl_b),u_pattern_br_b:new c.Uniform2f(d,t.u_pattern_br_b),u_texsize:new c.Uniform2f(d,t.u_texsize),u_mix:new c.Uniform1f(d,t.u_mix),u_pattern_size_a:new c.Uniform2f(d,t.u_pattern_size_a),u_pattern_size_b:new c.Uniform2f(d,t.u_pattern_size_b),u_scale_a:new c.Uniform1f(d,t.u_scale_a),u_scale_b:new c.Uniform1f(d,t.u_scale_b),u_pixel_coord_upper:new c.Uniform2f(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(d,t.u_pixel_coord_lower),u_tile_units_to_pixels:new c.Uniform1f(d,t.u_tile_units_to_pixels)}),terrainRaster:Jn,terrainDepth:Jn,skybox:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_sun_direction:new c.Uniform3f(d,t.u_sun_direction),u_cubemap:new c.Uniform1i(d,t.u_cubemap),u_opacity:new c.Uniform1f(d,t.u_opacity),u_temporal_offset:new c.Uniform1f(d,t.u_temporal_offset)}),skyboxGradient:(d,t)=>({u_matrix:new c.UniformMatrix4f(d,t.u_matrix),u_color_ramp:new c.Uniform1i(d,t.u_color_ramp),u_center_direction:new c.Uniform3f(d,t.u_center_direction),u_radius:new c.Uniform1f(d,t.u_radius),u_opacity:new c.Uniform1f(d,t.u_opacity),u_temporal_offset:new c.Uniform1f(d,t.u_temporal_offset)}),skyboxCapture:(d,t)=>({u_matrix_3f:new c.UniformMatrix3f(d,t.u_matrix_3f),u_sun_direction:new c.Uniform3f(d,t.u_sun_direction),u_sun_intensity:new c.Uniform1f(d,t.u_sun_intensity),u_color_tint_r:new c.Uniform4f(d,t.u_color_tint_r),u_color_tint_m:new c.Uniform4f(d,t.u_color_tint_m),u_luminance:new c.Uniform1f(d,t.u_luminance)})};let wt;function Zn(d,t,l,p,_,v,E){const S=d.context,R=S.gl,O=d.useProgram("collisionBox"),N=[];let V=0,X=0;for(let ge=0;ge<p.length;ge++){const se=p[ge],ve=t.getTile(se),Te=ve.getBucket(l);if(!Te)continue;let We=se.projMatrix;0===_[0]&&0===_[1]||(We=d.translatePosMatrix(se.projMatrix,ve,_,v));const Ze=E?Te.textCollisionBox:Te.iconCollisionBox,at=Te.collisionCircleArray;if(at.length>0){const nt=c.create$1(),It=We;c.mul$1(nt,Te.placementInvProjMatrix,d.transform.glCoordMatrix),c.mul$1(nt,nt,Te.placementViewportMatrix),N.push({circleArray:at,circleOffset:X,transform:It,invTransform:nt}),V+=at.length/4,X=V}Ze&&(d.terrain&&d.terrain.setupElevationDraw(ve,O),O.draw(S,R.LINES,c.DepthMode.disabled,c.StencilMode.disabled,d.colorModeForRenderPass(),c.CullFaceMode.disabled,To(We,d.transform,ve),l.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,null,d.transform.zoom,null,Ze.collisionVertexBuffer,Ze.collisionVertexBufferExt))}if(!E||!N.length)return;const re=d.useProgram("collisionCircle"),le=new c.StructArrayLayout2f1f2i16;le.resize(4*V),le._trim();let ne=0;for(const ge of N)for(let se=0;se<ge.circleArray.length/4;se++){const ve=4*se,Te=ge.circleArray[ve+0],We=ge.circleArray[ve+1],Ze=ge.circleArray[ve+2],at=ge.circleArray[ve+3];le.emplace(ne++,Te,We,Ze,at,0),le.emplace(ne++,Te,We,Ze,at,1),le.emplace(ne++,Te,We,Ze,at,2),le.emplace(ne++,Te,We,Ze,at,3)}(!wt||wt.length<2*V)&&(wt=function(ge){const se=2*ge,ve=new c.StructArrayLayout3ui6;ve.resize(se),ve._trim();for(let Te=0;Te<se;Te++){const We=6*Te;ve.uint16[We+0]=4*Te+0,ve.uint16[We+1]=4*Te+1,ve.uint16[We+2]=4*Te+2,ve.uint16[We+3]=4*Te+2,ve.uint16[We+4]=4*Te+3,ve.uint16[We+5]=4*Te+0}return ve}(V));const fe=S.createIndexBuffer(wt,!0),ie=S.createVertexBuffer(le,c.collisionCircleLayout.members,!0);for(const ge of N){const se={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(me=d.transform).cameraToCenterDistance,u_viewport_size:[me.width,me.height]};re.draw(S,R.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,d.colorModeForRenderPass(),c.CullFaceMode.disabled,se,l.id,ie,fe,c.SegmentVector.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,d.transform.zoom,null,null,null)}var me;ie.destroy(),fe.destroy()}const Ps=c.identity(new Float32Array(16));function li(d,t,l,p,_,v){const{horizontalAlign:E,verticalAlign:S}=c.getAnchorAlignment(d),R=-(E-.5)*t,O=-(S-.5)*l,N=c.evaluateVariableOffset(d,p);return new c.pointGeometry((R/_+N[0])*v,(O/_+N[1])*v)}function ha(d,t,l,p,_,v,E,S,R,O,N,V){const X=d.text.placedSymbolArray,re=d.text.dynamicLayoutVertexArray,le=d.icon.dynamicLayoutVertexArray,ne={};re.clear();for(let fe=0;fe<X.length;fe++){const ie=X.get(fe),me=d.allowVerticalPlacement&&!ie.placedOrientation,ge=ie.hidden||!ie.crossTileID||me?null:p[ie.crossTileID];if(ge){const se=new c.pointGeometry(ie.tileAnchorX,ie.tileAnchorY),ve=V(se),Te=cr(se,l?S:E,ve),We=yr(v.cameraToCenterDistance,Te.signedDistanceFromCamera);let Ze=_.evaluateSizeForFeature(d.textSizeData,O,ie)*We/c.ONE_EM;l&&(Ze*=d.tilePixelRatio/R);const{width:at,height:nt,anchor:It,textOffset:Qe,textScale:kt}=ge,Ge=li(It,at,nt,Qe,kt,Ze),Ft=l?cr(se.add(Ge),E,ve).point:Te.point.add(t?Ge.rotate(-v.angle):Ge),Jt=d.allowVerticalPlacement&&ie.placedOrientation===c.WritingMode.vertical?Math.PI/2:0;for(let wn=0;wn<ie.numGlyphs;wn++)c.addDynamicAttributes(re,Ft,Jt);N&&ie.associatedIconIndex>=0&&(ne[ie.associatedIconIndex]={shiftedAnchor:Ft,angle:Jt})}else Dr(ie.numGlyphs,re)}if(N){le.clear();const fe=d.icon.placedSymbolArray;for(let ie=0;ie<fe.length;ie++){const me=fe.get(ie);if(me.hidden)Dr(me.numGlyphs,le);else{const ge=ne[ie];if(ge)for(let se=0;se<me.numGlyphs;se++)c.addDynamicAttributes(le,ge.shiftedAnchor,ge.angle);else Dr(me.numGlyphs,le)}}d.icon.dynamicLayoutVertexBuffer.updateData(le)}d.text.dynamicLayoutVertexBuffer.updateData(re)}function Xs(d,t,l){return l.iconsInText&&t?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function ni(d,t,l,p,_,v,E,S,R,O,N,V){const X=d.context,re=X.gl,le=d.transform,ne="map"===S,fe="map"===R,ie=ne&&"point"!==l.layout.get("symbol-placement"),me=ne&&!fe&&!ie,ge=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let se=!1;const ve=d.depthModeForSublayer(0,c.DepthMode.ReadOnly),Te=[0,0],We=l.layout.get("text-variable-anchor"),Ze=[],at=[];d.terrain&&fe&&at.push("PITCH_WITH_MAP_TERRAIN"),ie&&at.push("PROJECTED_POS_ON_VIEWPORT");for(const nt of p){const It=t.getTile(nt),Qe=It.getBucket(l);if(!Qe)continue;const kt=_?Qe.text:Qe.icon;if(!kt||!kt.segments.get().length)continue;const Ge=kt.programConfigurations.get(l.id),Ft=_||Qe.sdfIcons,Jt=_?Qe.textSizeData:Qe.iconSizeData,wn=fe||0!==le.pitch,vn=d.useProgram(Xs(Ft,_,Qe),Ge,at),Mn=c.evaluateSizeForZoom(Jt,le.zoom),An=[nt.canonical.x,nt.canonical.y,1<<nt.canonical.z];let Qt,zn,gr,ui,gi=[0,0],oo=null;if(_){if(zn=It.glyphAtlasTexture,gr=re.LINEAR,Qt=It.glyphAtlasTexture.size,Qe.iconsInText){gi=It.imageAtlasTexture.size,oo=It.imageAtlasTexture;const ko="composite"===Jt.kind||"camera"===Jt.kind;ui=wn||d.options.rotating||d.options.zooming||ko?re.LINEAR:re.NEAREST}}else{const ko=1!==l.layout.get("icon-size").constantOr(0)||Qe.iconsNeedLinear;zn=It.imageAtlasTexture,gr=Ft||d.options.rotating||d.options.zooming||ko||wn?re.LINEAR:re.NEAREST,Qt=It.imageAtlasTexture.size}const yo=d.transform.calculatePixelsToTileUnitsMatrix(It),Si=rn(nt.projMatrix,fe,ne,d.transform,yo),Wo=d.terrain&&fe&&ie?c.invert(new Float32Array(16),Si):Ps,so=ln(nt.projMatrix,fe,ne,d.transform,yo),Pr=We&&Qe.hasTextData(),Or="none"!==l.layout.get("icon-text-fit")&&Pr&&Qe.hasIconData();if(ie){const ko=le.elevation;Mr(Qe,nt.projMatrix,d,_,Si,so,fe,O,ko?Xo=>ko.getAtTileOffset(nt,Xo.x,Xo.y):null)}const ir=d.translatePosMatrix(nt.projMatrix,It,v,E),zr=ie||_&&We||Or?Ps:Si,Ri=d.translatePosMatrix(so,It,v,E,!0),wr=Ft&&0!==l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1);let Po;Po=Ft?Qe.iconsInText?Hc(Jt.kind,Mn,me,fe,d,ir,zr,Ri,Qt,gi,An,0,d.identityMat,Te):fc(Jt.kind,Mn,me,fe,d,ir,zr,Ri,_,Qt,!0,An,0,d.identityMat,Te):dc(Jt.kind,Mn,me,fe,d,ir,zr,Ri,_,Qt,An,0,d.identityMat,Te);const ql={program:vn,buffers:kt,uniformValues:Po,atlasTexture:zn,atlasTextureIcon:oo,atlasInterpolation:gr,atlasInterpolationIcon:ui,isSDF:Ft,hasHalo:wr,tile:It,labelPlaneMatrixInv:Wo};if(ge&&Qe.canOverlap){se=!0;const ko=kt.segments.get();for(const Xo of ko)Ze.push({segments:new c.SegmentVector([Xo]),sortKey:Xo.sortKey,state:ql})}else Ze.push({segments:kt.segments,sortKey:0,state:ql})}se&&Ze.sort((nt,It)=>nt.sortKey-It.sortKey);for(const nt of Ze){const It=nt.state;if(d.terrain&&d.terrain.setupElevationDraw(It.tile,It.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:It.labelPlaneMatrixInv}),X.activeTexture.set(re.TEXTURE0),It.atlasTexture.bind(It.atlasInterpolation,re.CLAMP_TO_EDGE),It.atlasTextureIcon&&(X.activeTexture.set(re.TEXTURE1),It.atlasTextureIcon&&It.atlasTextureIcon.bind(It.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),It.isSDF){const Qe=It.uniformValues;It.hasHalo&&(Qe.u_is_halo=1,Fa(It.buffers,nt.segments,l,d,It.program,ve,N,V,Qe)),Qe.u_is_halo=0}Fa(It.buffers,nt.segments,l,d,It.program,ve,N,V,It.uniformValues)}}function Fa(d,t,l,p,_,v,E,S,R){const O=p.context;_.draw(O,O.gl.TRIANGLES,v,E,S,c.CullFaceMode.disabled,R,l.id,d.layoutVertexBuffer,d.indexBuffer,t,l.paint,p.transform.zoom,d.programConfigurations.get(l.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function ps(d,t,l,p,_,v,E){const S=d.context.gl,R=l.paint.get("fill-pattern"),O=R&&R.constantOr(1),N=l.getCrossfadeParameters();let V,X,re,le,ne;E?(X=O&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=S.LINES):(X=O?"fillPattern":"fill",V=S.TRIANGLES);for(const fe of p){const ie=t.getTile(fe);if(O&&!ie.patternsLoaded())continue;const me=ie.getBucket(l);if(!me)continue;d.prepareDrawTile(fe);const ge=me.programConfigurations.get(l.id),se=d.useProgram(X,ge);O&&(d.context.activeTexture.set(S.TEXTURE0),ie.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ge.updatePaintBuffers(N));const ve=R.constantOr(null);if(ve&&ie.imageAtlas){const We=ie.imageAtlas,Ze=We.patternPositions[ve.to.toString()],at=We.patternPositions[ve.from.toString()];Ze&&at&&ge.setConstantPatternPositions(Ze,at)}const Te=d.translatePosMatrix(fe.projMatrix,ie,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(E){le=me.indexBuffer2,ne=me.segments2;const We=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];re="fillOutlinePattern"===X&&O?Fr(Te,d,N,ie,We):Yn(Te,We)}else le=me.indexBuffer,ne=me.segments,re=O?hr(Te,d,N,ie):fn(Te);d.prepareDrawProgram(d.context,se,fe.toUnwrapped()),se.draw(d.context,V,_,d.stencilModeForClipping(fe),v,c.CullFaceMode.disabled,re,l.id,me.layoutVertexBuffer,le,ne,l.paint,d.transform.zoom,ge)}}function Uo(d,t,l,p,_,v,E){const S=d.context,R=S.gl,O=l.paint.get("fill-extrusion-pattern"),N=O.constantOr(1),V=l.getCrossfadeParameters(),X=l.paint.get("fill-extrusion-opacity");for(const re of p){const le=t.getTile(re),ne=le.getBucket(l);if(!ne)continue;const fe=ne.programConfigurations.get(l.id),ie=d.useProgram(N?"fillExtrusionPattern":"fillExtrusion",fe);if(d.terrain){const Te=d.terrain;if(!ne.enableTerrain)continue;if(Te.setupElevationDraw(le,ie,{useMeterToDem:!0}),mc(S,t,re,ne,l,Te),!ne.centroidVertexBuffer){const We=ie.attributes.a_centroid_pos;void 0!==We&&R.vertexAttrib2f(We,0,0)}}N&&(d.context.activeTexture.set(R.TEXTURE0),le.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),fe.updatePaintBuffers(V));const me=O.constantOr(null);if(me&&le.imageAtlas){const Te=le.imageAtlas,We=Te.patternPositions[me.to.toString()],Ze=Te.patternPositions[me.from.toString()];We&&Ze&&fe.setConstantPatternPositions(We,Ze)}const ge=d.translatePosMatrix(re.projMatrix,le,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),se=l.paint.get("fill-extrusion-vertical-gradient"),ve=N?or(ge,d,se,X,re,V,le):cn(ge,d,se,X);d.prepareDrawProgram(S,ie,re.toUnwrapped()),ie.draw(S,S.gl.TRIANGLES,_,v,E,c.CullFaceMode.backCCW,ve,l.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,l.paint,d.transform.zoom,fe,d.terrain?ne.centroidVertexBuffer:null)}}function mc(d,t,l,p,_,v){const E=[ie=>{let me=ie.canonical.x-1,ge=ie.wrap;return me<0&&(me=(1<<ie.canonical.z)-1,ge--),new c.OverscaledTileID(ie.overscaledZ,ge,ie.canonical.z,me,ie.canonical.y)},ie=>{let me=ie.canonical.x+1,ge=ie.wrap;return me===1<<ie.canonical.z&&(me=0,ge++),new c.OverscaledTileID(ie.overscaledZ,ge,ie.canonical.z,me,ie.canonical.y)},ie=>new c.OverscaledTileID(ie.overscaledZ,ie.wrap,ie.canonical.z,ie.canonical.x,(0===ie.canonical.y?1<<ie.canonical.z:ie.canonical.y)-1),ie=>new c.OverscaledTileID(ie.overscaledZ,ie.wrap,ie.canonical.z,ie.canonical.x,ie.canonical.y===(1<<ie.canonical.z)-1?0:ie.canonical.y+1)],S=ie=>{const me=t.getSource().maxzoom,ge=We=>{const Ze=t.getTileByID(We);if(Ze&&Ze.hasData())return Ze.getBucket(_)};let se,ve,Te;return(ie.overscaledZ===ie.canonical.z||ie.overscaledZ>=me)&&(se=ge(ie.key)),ie.overscaledZ>=me&&(ve=ge(ie.calculateScaledKey(ie.overscaledZ+1))),ie.overscaledZ>me&&(Te=ge(ie.calculateScaledKey(ie.overscaledZ-1))),se||ve||Te},R=[0,0,0],O=(ie,me)=>(R[0]=Math.min(ie.min.y,me.min.y),R[1]=Math.max(ie.max.y,me.max.y),R[2]=c.EXTENT-me.min.x>ie.max.x?me.min.x-c.EXTENT:ie.max.x,R),N=(ie,me)=>(R[0]=Math.min(ie.min.x,me.min.x),R[1]=Math.max(ie.max.x,me.max.x),R[2]=c.EXTENT-me.min.y>ie.max.y?me.min.y-c.EXTENT:ie.max.y,R),V=[(ie,me)=>O(ie,me),(ie,me)=>O(me,ie),(ie,me)=>N(ie,me),(ie,me)=>N(me,ie)],X=new c.pointGeometry(0,0);let re,le,ne;const fe=(ie,me,ge,se,ve)=>{const Te=[[se?ge:ie,se?ie:ge,0],[se?ge:me,se?me:ge,0]],We=ve<0?c.EXTENT+ve:ve,Ze=[se?We:(ie+me)/2,se?(ie+me)/2:We,0];return 0===ge&&ve<0||0!==ge&&ve>0?v.getForTilePoints(ne,[Ze],!0,le):Te.push(Ze),v.getForTilePoints(l,Te,!0,re),Math.max(Te[0][2],Te[1][2],Ze[2])/v.exaggeration()};for(let ie=0;ie<4;ie++){const me=p.borders[ie];if(0===me.length&&(p.borderDone[ie]=!0),p.borderDone[ie])continue;const ge=ne=E[ie](l),se=S(ge);if(!(se&&se.enableTerrain&&(le=v.findDEMTileFor(ge),le&&le.dem)))continue;if(!re){const Ze=v.findDEMTileFor(l);if(!Ze||!Ze.dem)return;re=Ze}const ve=(ie<2?1:5)-ie,Te=se.borders[ve];let We=0;for(let Ze=0;Ze<me.length;Ze++){const at=p.featuresOnBorder[me[Ze]],nt=at.borders[ie];let It;for(;We<Te.length&&(It=se.featuresOnBorder[Te[We]],!(It.borders[ve][1]>nt[0]+3));)se.borderDone[ve]||se.encodeCentroid(void 0,It,!1),We++;if(It&&We<Te.length){const Qe=We;let kt=0;for(;!(It.borders[ve][0]>nt[1]-3)&&(kt++,++We!==Te.length);)It=se.featuresOnBorder[Te[We]];if(It=se.featuresOnBorder[Te[Qe]],at.intersectsCount()>1||It.intersectsCount()>1||1!==kt){1!==kt&&(We=Qe),p.encodeCentroid(void 0,at,!1),se.borderDone[ve]||se.encodeCentroid(void 0,It,!1);continue}const Ge=V[ie](at,It),Ft=ie%2?c.EXTENT-1:0;X.x=fe(Ge[0],Math.min(c.EXTENT-1,Ge[1]),Ft,ie<2,Ge[2]),X.y=0,p.encodeCentroid(X,at,!1),se.borderDone[ve]||se.encodeCentroid(X,It,!1)}else p.encodeCentroid(void 0,at,!1)}p.borderDone[ie]=p.needsCentroidUpdate=!0,se.borderDone[ve]||(se.borderDone[ve]=se.needsCentroidUpdate=!0)}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&0!==p.centroidVertexArray.length)&&p.uploadCentroid(d)}const da=new c.Color(1,0,0,1),Qn=new c.Color(0,1,0,1),Ti=new c.Color(0,0,1,1),ms=new c.Color(1,0,1,1),Ol=new c.Color(0,1,1,1);function Vo(d,t,l,p){sl(d,0,t+l/2,d.transform.width,l,p)}function ns(d,t,l,p){sl(d,t-l/2,0,l,d.transform.height,p)}function sl(d,t,l,p,_,v){const E=d.context,S=E.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*c.exported.devicePixelRatio,l*c.exported.devicePixelRatio,p*c.exported.devicePixelRatio,_*c.exported.devicePixelRatio),E.clear({color:v}),S.disable(S.SCISSOR_TEST)}function al(d,t,l){const p=d.context,_=p.gl,v=l.projMatrix,E=d.useProgram("debug"),S=t.getTileByID(l.key);d.terrain&&d.terrain.setupElevationDraw(S,E);const R=c.DepthMode.disabled,O=c.StencilMode.disabled,N=d.colorModeForRenderPass(),V="$debug";p.activeTexture.set(_.TEXTURE0),d.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),S._makeDebugTileBoundsBuffers(d.context,d.transform.projection);const X=S._tileDebugBuffer||d.debugBuffer,re=S._tileDebugIndexBuffer||d.debugIndexBuffer,le=S._tileDebugSegments||d.debugSegments;E.draw(p,_.LINE_STRIP,R,O,N,c.CullFaceMode.disabled,Di(v,c.Color.red),V,X,re,le);const ne=S.latestRawTileData,fe=Math.floor((ne&&ne.byteLength||0)/1024),ie=t.getTile(l).tileSize,me=512/Math.min(ie,512)*(l.overscaledZ/d.transform.zoom)*.5;let ge=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ge+=` => ${l.overscaledZ}`),function(se,ve){se.initDebugOverlayCanvas();const Te=se.debugOverlayCanvas,We=se.context.gl,Ze=se.debugOverlayCanvas.getContext("2d");Ze.clearRect(0,0,Te.width,Te.height),Ze.shadowColor="white",Ze.shadowBlur=2,Ze.lineWidth=1.5,Ze.strokeStyle="white",Ze.textBaseline="top",Ze.font="bold 36px Open Sans, sans-serif",Ze.fillText(ve,5,5),Ze.strokeText(ve,5,5),se.debugOverlayTexture.update(Te),se.debugOverlayTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE)}(d,`${ge} ${fe}kb`),E.draw(p,_.TRIANGLES,R,O,c.ColorMode.alphaBlended,c.CullFaceMode.disabled,Di(v,c.Color.transparent,me),V,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments)}const qc=c.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:zl}=qc;function mo(d,t,l,p){d.emplaceBack(t,l,p)}class ks{constructor(t){this.vertexArray=new c.StructArrayLayout3f12,this.indices=new c.StructArrayLayout3ui6,mo(this.vertexArray,-1,-1,1),mo(this.vertexArray,1,-1,1),mo(this.vertexArray,-1,1,1),mo(this.vertexArray,1,1,1),mo(this.vertexArray,-1,-1,-1),mo(this.vertexArray,1,-1,-1),mo(this.vertexArray,-1,1,-1),mo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,zl),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=c.SegmentVector.simpleSegment(0,0,36,12)}}function gs(d,t,l,p,_,v){const E=d.gl,S=t.paint.get("sky-atmosphere-color"),R=t.paint.get("sky-atmosphere-halo-color"),O=t.paint.get("sky-atmosphere-sun-intensity"),N={u_matrix_3f:c.fromMat4([],p),u_sun_direction:_,u_sun_intensity:O,u_color_tint_r:[(le=S).r,le.g,le.b,le.a],u_color_tint_m:[(ne=R).r,ne.g,ne.b,ne.a],u_luminance:5e-5};var le,ne;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+v,t.skyboxTexture,0),l.draw(d,E.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.frontCW,N,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Ys={symbol:function(d,t,l,p,_){if("translucent"!==d.renderPass)return;const v=c.StencilMode.disabled,E=d.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(S,R,O,N,V,X,re){const le=R.transform,ne="map"===V,fe="map"===X;for(const ie of S){const me=N.getTile(ie),ge=me.getBucket(O);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const se=c.evaluateSizeForZoom(ge.textSizeData,le.zoom),ve=R.transform.calculatePixelsToTileUnitsMatrix(me),Te=rn(ie.projMatrix,fe,ne,R.transform,ve),We="none"!==O.layout.get("icon-text-fit")&&ge.hasIconData();if(se){const Ze=Math.pow(2,le.zoom-me.tileID.overscaledZ),at=le.elevation;ha(ge,ne,fe,re,c.symbolSize,le,Te,ie.projMatrix,Ze,se,We,at?nt=>at.getAtTileOffset(ie,nt.x,nt.y):nt=>0)}}}(p,d,l,t,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),0!==l.paint.get("icon-opacity").constantOr(1)&&ni(d,t,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),v,E),0!==l.paint.get("text-opacity").constantOr(1)&&ni(d,t,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),v,E),t.map.showCollisionBoxes&&(Zn(d,t,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Zn(d,t,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,t,l,p){if("translucent"!==d.renderPass)return;const _=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),E=l.paint.get("circle-stroke-opacity"),S=void 0!==l.layout.get("circle-sort-key").constantOr(1);if(0===_.constantOr(1)&&(0===v.constantOr(1)||0===E.constantOr(1)))return;const R=d.context,O=R.gl,N=d.depthModeForSublayer(0,c.DepthMode.ReadOnly),V=c.StencilMode.disabled,X=d.colorModeForRenderPass(),re=[];for(let le=0;le<p.length;le++){const ne=p[le],fe=t.getTile(ne),ie=fe.getBucket(l);if(!ie)continue;const me=ie.programConfigurations.get(l.id),ge=mi(l),se={programConfiguration:me,program:d.useProgram("circle",me,ge),layoutVertexBuffer:ie.layoutVertexBuffer,indexBuffer:ie.indexBuffer,uniformValues:Dn(d,ne,fe,l),tile:fe};if(S){const ve=ie.segments.get();for(const Te of ve)re.push({segments:new c.SegmentVector([Te]),sortKey:Te.sortKey,state:se})}else re.push({segments:ie.segments,sortKey:0,state:se})}S&&re.sort((le,ne)=>le.sortKey-ne.sortKey);for(const le of re){const{programConfiguration:ne,program:fe,layoutVertexBuffer:ie,indexBuffer:me,uniformValues:ge,tile:se}=le.state,ve=le.segments;d.terrain&&d.terrain.setupElevationDraw(se,fe,{useDepthForOcclusion:!0}),d.prepareDrawProgram(R,fe,se.tileID.toUnwrapped()),fe.draw(R,O.TRIANGLES,N,V,X,c.CullFaceMode.disabled,ge,l.id,ie,me,ve,l.paint,d.transform.zoom,ne)}},heatmap:function(d,t,l,p){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===d.renderPass){const _=d.context,v=_.gl,E=c.StencilMode.disabled,S=new c.ColorMode([v.ONE,v.ONE],c.Color.transparent,[!0,!0,!0,!0]);(function(R,O,N){const V=R.gl;R.activeTexture.set(V.TEXTURE1),R.viewport.set([0,0,O.width/4,O.height/4]);let X=N.heatmapFbo;if(X)V.bindTexture(V.TEXTURE_2D,X.colorAttachment.get()),R.bindFramebuffer.set(X.framebuffer);else{const re=V.createTexture();V.bindTexture(V.TEXTURE_2D,re),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),X=N.heatmapFbo=R.createFramebuffer(O.width/4,O.height/4,!1),function(le,ne,fe,ie){const me=le.gl;me.texImage2D(me.TEXTURE_2D,0,me.RGBA,ne.width/4,ne.height/4,0,me.RGBA,le.extRenderToTextureHalfFloat?le.extTextureHalfFloat.HALF_FLOAT_OES:me.UNSIGNED_BYTE,null),ie.colorAttachment.set(fe)}(R,O,re,X)}})(_,d,l),_.clear({color:c.Color.transparent});for(let R=0;R<p.length;R++){const O=p[R];if(t.hasRenderableParent(O))continue;const N=t.getTile(O),V=N.getBucket(l);if(!V)continue;const X=V.programConfigurations.get(l.id),re=d.useProgram("heatmap",X),{zoom:le}=d.transform;d.terrain&&d.terrain.setupElevationDraw(N,re),d.prepareDrawProgram(_,re,O.toUnwrapped()),re.draw(_,v.TRIANGLES,c.DepthMode.disabled,E,S,c.CullFaceMode.disabled,ai(O.projMatrix,N,le,l.paint.get("heatmap-intensity")),l.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,l.paint,d.transform.zoom,X)}_.viewport.set([0,0,d.width,d.height])}else"translucent"===d.renderPass&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,v){const E=_.context,S=E.gl,R=v.heatmapFbo;if(!R)return;E.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,R.colorAttachment.get()),E.activeTexture.set(S.TEXTURE1);let O=v.colorRampTexture;O||(O=v.colorRampTexture=new c.Texture(E,v.colorRamp,S.RGBA)),O.bind(S.LINEAR,S.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(E,S.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,_.colorModeForRenderPass(),c.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:v.paint.get("heatmap-opacity")},v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(d,l))},line:function(d,t,l,p){if("translucent"!==d.renderPass)return;const _=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(0===_.constantOr(1)||0===v.constantOr(1))return;const E=d.depthModeForSublayer(0,c.DepthMode.ReadOnly),S=d.colorModeForRenderPass(),R=l.paint.get("line-dasharray"),O=R.constantOr(1),N=l.layout.get("line-cap"),V=l.paint.get("line-pattern"),X=V.constantOr(1),re=l.paint.get("line-gradient"),le=l.getCrossfadeParameters(),ne=X?"linePattern":"line",fe=d.context,ie=fe.gl;for(const me of p){const ge=t.getTile(me);if(X&&!ge.patternsLoaded())continue;const se=ge.getBucket(l);if(!se)continue;d.prepareDrawTile(me);const ve=se.programConfigurations.get(l.id),Te=ua(l),We=d.useProgram(ne,ve,Te),Ze=V.constantOr(null);if(Ze&&ge.imageAtlas){const kt=ge.imageAtlas,Ge=kt.patternPositions[Ze.to.toString()],Ft=kt.patternPositions[Ze.from.toString()];Ge&&Ft&&ve.setConstantPatternPositions(Ge,Ft)}const at=R.constantOr(null),nt=N.constantOr(null);if(!X&&at&&nt&&ge.lineAtlas){const kt=ge.lineAtlas,Ge=kt.getDash(at.to,nt),Ft=kt.getDash(at.from,nt);Ge&&Ft&&ve.setConstantPatternPositions(Ge,Ft)}const It=d.terrain?me.projMatrix:null,Qe=X?ts(d,ge,l,le,It):ro(d,ge,l,le,It,se.lineClipsArray.length);if(re){const kt=se.gradients[l.id];let Ge=kt.texture;if(l.gradientVersion!==kt.version){let Ft=256;if(l.stepInterpolant){const Jt=t.getSource().maxzoom,wn=me.canonical.z===Jt?Math.ceil(1<<d.transform.maxZoom-me.canonical.z):1;Ft=c.clamp(c.nextPowerOfTwo(se.maxLineLength/c.EXTENT*1024*wn),256,fe.maxTextureSize)}kt.gradient=c.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Ft,image:kt.gradient||void 0,clips:se.lineClipsArray}),kt.texture?kt.texture.update(kt.gradient):kt.texture=new c.Texture(fe,kt.gradient,ie.RGBA),kt.version=l.gradientVersion,Ge=kt.texture}fe.activeTexture.set(ie.TEXTURE1),Ge.bind(l.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}O&&(fe.activeTexture.set(ie.TEXTURE0),ge.lineAtlasTexture.bind(ie.LINEAR,ie.REPEAT),ve.updatePaintBuffers(le)),X&&(fe.activeTexture.set(ie.TEXTURE0),ge.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),ve.updatePaintBuffers(le)),d.prepareDrawProgram(fe,We,me.toUnwrapped()),We.draw(fe,ie.TRIANGLES,E,d.stencilModeForClipping(me),S,c.CullFaceMode.disabled,Qe,l.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,l.paint,d.transform.zoom,ve,se.layoutVertexBuffer2)}},fill:function(d,t,l,p){const _=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(0===v.constantOr(1))return;const E=d.colorModeForRenderPass(),S=l.paint.get("fill-pattern"),R=d.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===_.constantOr(c.Color.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";if(d.renderPass===R){const O=d.depthModeForSublayer(1,"opaque"===d.renderPass?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly);ps(d,t,l,p,O,E,!1)}if("translucent"===d.renderPass&&l.paint.get("fill-antialias")){const O=d.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,c.DepthMode.ReadOnly);ps(d,t,l,p,O,E,!0)}},"fill-extrusion":function(d,t,l,p){const _=l.paint.get("fill-extrusion-opacity");if(0!==_&&"translucent"===d.renderPass){const v=new c.DepthMode(d.context.gl.LEQUAL,c.DepthMode.ReadWrite,d.depthRangeFor3D);if(1!==_||l.paint.get("fill-extrusion-pattern").constantOr(1))Uo(d,t,l,p,v,c.StencilMode.disabled,c.ColorMode.disabled),Uo(d,t,l,p,v,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const E=d.colorModeForRenderPass();Uo(d,t,l,p,v,c.StencilMode.disabled,E)}}},hillshade:function(d,t,l,p){if("offscreen"!==d.renderPass&&"translucent"!==d.renderPass)return;const _=d.context,v=d.depthModeForSublayer(0,c.DepthMode.ReadOnly),E=d.colorModeForRenderPass(),S=d.terrain&&d.terrain.renderingToTexture,[R,O]="translucent"!==d.renderPass||S?[{},p]:d.stencilConfigForOverlap(p);for(const N of O){const V=t.getTile(N);if(V.needsHillshadePrepare&&"offscreen"===d.renderPass)Co(d,V,l,v,c.StencilMode.disabled,E);else if("translucent"===d.renderPass){const X=S&&d.terrain?d.terrain.stencilModeForRTTOverlap(N):R[N.overscaledZ];Do(d,N,V,l,v,X,E)}}_.viewport.set([0,0,d.width,d.height])},raster:function(d,t,l,p,_,v){if("translucent"!==d.renderPass||0===l.paint.get("raster-opacity")||!p.length)return;const E=d.context,S=E.gl,R=t.getSource(),O=d.useProgram("raster"),N=d.colorModeForRenderPass(),V=d.terrain&&d.terrain.renderingToTexture,[X,re]=R instanceof Q||V?[{},p]:d.stencilConfigForOverlap(p),le=re[re.length-1].overscaledZ,ne=!d.options.moving;for(const fe of re){const ie=V?c.DepthMode.disabled:d.depthModeForSublayer(fe.overscaledZ-le,1===l.paint.get("raster-opacity")?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly,S.LESS),me=fe.toUnwrapped(),ge=t.getTile(fe);if(V&&(!ge||!ge.hasData()))continue;const se=V?fe.projMatrix:d.transform.calculateProjMatrix(me,ne),ve=d.terrain&&V?d.terrain.stencilModeForRTTOverlap(fe):X[fe.overscaledZ],Te=v?0:l.paint.get("raster-fade-duration");ge.registerFadeDuration(Te);const We=t.findLoadedParent(fe,0),Ze=z(ge,We,t,d.transform,Te);let at,nt;d.terrain&&d.terrain.prepareDrawTile(fe);const It="nearest"===l.paint.get("raster-resampling")?S.NEAREST:S.LINEAR;E.activeTexture.set(S.TEXTURE0),ge.texture.bind(It,S.CLAMP_TO_EDGE),E.activeTexture.set(S.TEXTURE1),We?(We.texture.bind(It,S.CLAMP_TO_EDGE),at=Math.pow(2,We.tileID.overscaledZ-ge.tileID.overscaledZ),nt=[ge.tileID.canonical.x*at%1,ge.tileID.canonical.y*at%1]):ge.texture.bind(It,S.CLAMP_TO_EDGE);const Qe=Ln(se,nt||[0,0],at||1,Ze,l);if(d.prepareDrawProgram(E,O,me),R instanceof Q)O.draw(E,S.TRIANGLES,ie,c.StencilMode.disabled,N,c.CullFaceMode.disabled,Qe,l.id,R.boundsBuffer,d.quadTriangleIndexBuffer,R.boundsSegments);else{const{tileBoundsBuffer:kt,tileBoundsIndexBuffer:Ge,tileBoundsSegments:Ft}=d.getTileBoundsBuffers(ge);O.draw(E,S.TRIANGLES,ie,ve,N,c.CullFaceMode.disabled,Qe,l.id,kt,Ge,Ft)}}},background:function(d,t,l,p){const _=l.paint.get("background-color"),v=l.paint.get("background-opacity");if(0===v)return;const E=d.context,S=E.gl,R=d.transform,O=R.tileSize,N=l.paint.get("background-pattern");if(d.isPatternMissing(N))return;const V=!N&&1===_.a&&1===v&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==V)return;const X=c.StencilMode.disabled,re=d.depthModeForSublayer(0,"opaque"===V?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly),le=d.colorModeForRenderPass(),ne=d.useProgram(N?"backgroundPattern":"background");let fe,ie=p;ie||(fe=d.getBackgroundTiles(),ie=Object.values(fe).map(ge=>ge.tileID)),N&&(E.activeTexture.set(S.TEXTURE0),d.imageManager.bind(d.context));const me=l.getCrossfadeParameters();for(const ge of ie){const se=ge.toUnwrapped(),ve=p?ge.projMatrix:d.transform.calculateProjMatrix(se);d.prepareDrawTile(ge);const Te=t?t.getTile(ge):fe?fe[ge.key]:new c.Tile(ge,O,R.zoom,d),We=N?Fl(ve,v,d,N,{tileID:ge,tileSize:O},me):pc(ve,v,_);d.prepareDrawProgram(E,ne,se);const{tileBoundsBuffer:Ze,tileBoundsIndexBuffer:at,tileBoundsSegments:nt}=d.getTileBoundsBuffers(Te);ne.draw(E,S.TRIANGLES,re,X,le,c.CullFaceMode.disabled,We,l.id,Ze,at,nt)}},sky:function(d,t,l){const p=d.transform,_="mercator"===p.projection.name?1:c.smoothstep(7,8,p.zoom),v=l.paint.get("sky-opacity")*_;if(0===v)return;const E=d.context,S=l.paint.get("sky-type"),R=new c.DepthMode(E.gl.LEQUAL,c.DepthMode.ReadOnly,[0,1]),O=d.frameCounter/1e3%1;"atmosphere"===S?"offscreen"===d.renderPass?l.needsSkyboxCapture(d)&&(function(N,V,X,re){const le=N.context,ne=le.gl;let fe=V.skyboxFbo;if(!fe){fe=V.skyboxFbo=le.createFramebuffer(32,32,!1),V.skyboxGeometry=new ks(le),V.skyboxTexture=le.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,V.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let se=0;se<6;++se)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}le.bindFramebuffer.set(fe.framebuffer),le.viewport.set([0,0,32,32]);const ie=V.getCenter(N,!0),me=N.useProgram("skyboxCapture"),ge=new Float64Array(16);c.identity(ge),c.rotateY(ge,ge,.5*-Math.PI),gs(le,V,me,ge,ie,0),c.identity(ge),c.rotateY(ge,ge,.5*Math.PI),gs(le,V,me,ge,ie,1),c.identity(ge),c.rotateX(ge,ge,.5*-Math.PI),gs(le,V,me,ge,ie,2),c.identity(ge),c.rotateX(ge,ge,.5*Math.PI),gs(le,V,me,ge,ie,3),c.identity(ge),gs(le,V,me,ge,ie,4),c.identity(ge),c.rotateY(ge,ge,Math.PI),gs(le,V,me,ge,ie,5),le.viewport.set([0,0,N.width,N.height])}(d,l),l.markSkyboxValid(d)):"sky"===d.renderPass&&function(N,V,X,re,le){const ne=N.context,fe=ne.gl,ie=N.transform,me=N.useProgram("skybox");ne.activeTexture.set(fe.TEXTURE0),fe.bindTexture(fe.TEXTURE_CUBE_MAP,V.skyboxTexture);const ge={u_matrix:ie.skyboxMatrix,u_sun_direction:V.getCenter(N,!1),u_cubemap:0,u_opacity:re,u_temporal_offset:le};N.prepareDrawProgram(ne,me),me.draw(ne,fe.TRIANGLES,X,c.StencilMode.disabled,N.colorModeForRenderPass(),c.CullFaceMode.backCW,ge,"skybox",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(d,l,R,v,O):"gradient"===S&&"sky"===d.renderPass&&function(N,V,X,re,le){const ne=N.context,fe=ne.gl,ie=N.transform,me=N.useProgram("skyboxGradient");V.skyboxGeometry||(V.skyboxGeometry=new ks(ne)),ne.activeTexture.set(fe.TEXTURE0);let ge=V.colorRampTexture;ge||(ge=V.colorRampTexture=new c.Texture(ne,V.colorRamp,fe.RGBA)),ge.bind(fe.LINEAR,fe.CLAMP_TO_EDGE);const se=(ve=ie.skyboxMatrix,Te=V.getCenter(N,!1),We=V.paint.get("sky-gradient-radius"),Ze=re,at=le,{u_matrix:ve,u_color_ramp:0,u_center_direction:Te,u_radius:c.degToRad(We),u_opacity:Ze,u_temporal_offset:at});var ve,Te,We,Ze,at;N.prepareDrawProgram(ne,me),me.draw(ne,fe.TRIANGLES,X,c.StencilMode.disabled,N.colorModeForRenderPass(),c.CullFaceMode.backCW,se,"skyboxGradient",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(d,l,R,v,O)},debug:function(d,t,l){for(let p=0;p<l.length;p++)al(d,t,l[p])},custom:function(d,t,l){const p=d.context,_=l.implementation;if("mercator"===d.transform.projection.name){if("offscreen"===d.renderPass){const v=_.prerender;v&&(d.setCustomLayerDefaults(),p.setColorMode(d.colorModeForRenderPass()),v.call(_,p.gl,d.transform.customLayerMatrix()),p.setDirty(),d.setBaseState())}else if("translucent"===d.renderPass){d.setCustomLayerDefaults(),p.setColorMode(d.colorModeForRenderPass()),p.setStencilMode(c.StencilMode.disabled);const v="3d"===_.renderingMode?new c.DepthMode(d.context.gl.LEQUAL,c.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,c.DepthMode.ReadOnly);p.setDepthMode(v),_.render(p.gl,d.transform.customLayerMatrix()),p.setDirty(),d.setBaseState(),p.bindFramebuffer.set(null)}}else c.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.")}};class Wc{constructor(t,l){this.context=new Ni(t),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=c.SourceCache.maxUnderzooming+c.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new aa,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,l){const p=!!t&&!!t.terrain&&"mercator"===this.transform.projection.name;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new J(this,t));const _=this._terrain;this.transform.elevation=p?_:null,_.update(t,this.transform,l)}_updateFog(t){const l=t.fog;if(!l||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const v=p+.78*(_-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,l){if(this.width=t*c.exported.devicePixelRatio,this.height=l*c.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const t=this.context,l=new c.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(c.EXTENT,0),l.emplaceBack(0,c.EXTENT),l.emplaceBack(c.EXTENT,c.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(l,c.posAttributes.members),this.tileExtentSegments=c.SegmentVector.simpleSegment(0,0,4,2);const p=new c.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(c.EXTENT,0),p.emplaceBack(0,c.EXTENT),p.emplaceBack(c.EXTENT,c.EXTENT),this.debugBuffer=t.createVertexBuffer(p,c.posAttributes.members),this.debugSegments=c.SegmentVector.simpleSegment(0,0,4,5);const _=new c.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,c.posAttributes.members),this.viewportSegments=c.SegmentVector.simpleSegment(0,0,4,2);const v=new c.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(c.EXTENT,0,c.EXTENT,0),v.emplaceBack(0,c.EXTENT,0,c.EXTENT),v.emplaceBack(c.EXTENT,c.EXTENT,c.EXTENT,c.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(v,c.boundsAttributes.members),this.mercatorBoundsSegments=c.SegmentVector.simpleSegment(0,0,4,2);const E=new c.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E);const S=new c.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])S.emplaceBack(O);this.debugIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new c.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA),this.identityMat=c.create$1();const R=this.context.gl;this.stencilClearMode=new c.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(c.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,l=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(t,l.TRIANGLES,c.DepthMode.disabled,this.stencilClearMode,c.ColorMode.disabled,c.CullFaceMode.disabled,Qr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,l,p){if(!(l&&this.currentStencilSource!==l.id&&t.isTileClipped()&&p&&p.length))return;this.currentStencilSource=l.id;const _=this.context,v=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(c.ColorMode.disabled),_.setDepthMode(c.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of p){const R=l.getTile(S),O=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:V,tileBoundsSegments:X}=this.getTileBoundsBuffers(R);E.draw(_,v.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:v.ALWAYS,mask:0},O,255,v.KEEP,v.KEEP,v.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,Qr(S.projMatrix),"$clipping",N,V,X)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,l=this.context.gl;return new c.StencilMode({func:l.NOTEQUAL,mask:255},t,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const l=this.context.gl;return new c.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(t){const l=this.context.gl,p=t.sort((E,S)=>S.overscaledZ-E.overscaledZ),_=p[p.length-1].overscaledZ,v=p[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const E={};for(let S=0;S<v;S++)E[S+_]=new c.StencilMode({func:l.GEQUAL,mask:255},S+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[E,p]}return[{[_]:c.StencilMode.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const l=1/8;return new c.ColorMode([t.CONSTANT_COLOR,t.ONE],new c.Color(l,l,l,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?c.ColorMode.unblended:c.ColorMode.alphaBlended}depthModeForSublayer(t,l,p){if(!this.opaquePassEnabledForLayer())return c.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new c.DepthMode(p||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,l){this.style=t,this.options=l,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(c.exported.now()),this.imageManager.beginFrame();const p=this.style.order,_=this.style._sourceCaches;for(const O in _){const N=_[O];N.used&&N.prepare(this.context)}const v={},E={},S={};for(const O in _){const N=_[O];v[O]=N.getVisibleCoordinates(),E[O]=v[O].slice().reverse(),S[O]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<p.length;O++)if(this.style._layers[p[O]].is3D()){this.opaquePassCutoff=O;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),!c.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const O of p){const N=this.style._layers[O],V=t._getLayerSourceCache(N);if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const X=V?E[V.id]:void 0;("custom"===N.type||N.isSky()||X&&X.length)&&this.renderLayer(this,V,N,X)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let R=c.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(R=this.style.fog.properties.get("color")),this.context.clear({color:l.showOverdrawInspector?c.Color.black:R,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[p[this.currentLayer]],N=t._getLayerSourceCache(O);if(O.isSky())continue;const V=N?E[N.id]:void 0;this._renderTileClippingMasks(O,N,V),this.renderLayer(this,N,O,V)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const O=this.style._layers[p[this.currentLayer]],N=t._getLayerSourceCache(O);O.isSky()&&this.renderLayer(this,N,O,N?E[N.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const O=this.style._layers[p[this.currentLayer]],N=t._getLayerSourceCache(O);if(O.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(O)){if(O.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const V=N?("symbol"===O.type?S:E)[N.id]:void 0;this._renderTileClippingMasks(O,N,N?v[N.id]:void 0),this.renderLayer(this,N,O,V),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let O=null;c.values(this.style._layers).forEach(N=>{const V=t._getLayerSourceCache(N);V&&!N.isHidden(this.transform.zoom)&&(!O||O.getSource().maxzoom<V.getSource().maxzoom)&&(O=V)}),O&&this.options.showTileBoundaries&&Ys.debug(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const N=O.transform.padding;Vo(O,O.transform.height-(N.top||0),3,da),Vo(O,N.bottom||0,3,Qn),ns(O,N.left||0,3,Ti),ns(O,O.transform.width-(N.right||0),3,ms);const V=O.transform.centerPoint;var X,re,le,ne;sl(X=O,(re=V.x)-1,(le=O.transform.height-V.y)-10,2,20,ne=Ol),sl(X,re-10,le-1,20,2,ne)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%c.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(c.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,l,p,_){p.isHidden(this.transform.zoom)||("background"===p.type||"sky"===p.type||"custom"===p.type||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),Ys[p.type](t,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const l={};for(const p in t){const _=t[p],v=this.context.extTimerQuery,E=v.getQueryObjectEXT(_.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(_.query),l[p]=E}return l}translatePosMatrix(t,l,p,_,v){if(!p[0]&&!p[1])return t;const E=v?"map"===_?this.transform.angle:0:"viewport"===_?-this.transform.angle:0;if(E){const O=Math.sin(E),N=Math.cos(E);p=[p[0]*N-p[1]*O,p[0]*O+p[1]*N]}const S=[v?p[0]:Sn(l,p[0],this.transform.zoom),v?p[1]:Sn(l,p[1],this.transform.zoom),0],R=new Float32Array(16);return c.translate(R,t,S),R}saveTileTexture(t){const l=this._tileTextures[t.size[0]];l?l.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const l=this._tileTextures[t];return l&&l.length>0?l.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const l=this.imageManager.getPattern(t.from.toString()),p=this.imageManager.getPattern(t.to.toString());return!l||!p}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),l&&!t&&0!==l.getOpacity(this.transform.pitch)&&p.push("FOG"),t&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(t,l,p){this.cache=this.cache||{};const _=p||[],v=this.currentGlobalDefines().concat(_),E=ot.cacheKey(t,v,l);return this.cache[E]||(this.cache[E]=new ot(this.context,t,ka[t],l,Zc[t],v)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=c.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(t){this.terrain&&this.terrain.prepareDrawTile(t)}prepareDrawProgram(t,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const v=_.getOpacity(this.transform.pitch);0!==v&&l.setFogUniformValues(t,((E,S,R,O)=>{const N=S.properties.get("color"),V=E.frameCounter/1e3%1,X=[N.r/N.a,N.g/N.a,N.b/N.a,O];return{u_fog_matrix:R?E.transform.calculateFogTileMatrix(R):E.identityMat,u_fog_range:S.getFovAdjustedRange(E.transform._fov),u_fog_color:X,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:V}})(this,_,p,v))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,l=t.createTexture();return t.bindTexture(t.TEXTURE_2D,l),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)l[_.key]=t[_.key]||new c.Tile(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class Rs{constructor(t=0,l=0,p=0,_=0){if(isNaN(t)||t<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=l,this.left=p,this.right=_}interpolate(t,l,p){return null!=l.top&&null!=t.top&&(this.top=c.number(t.top,l.top,p)),null!=l.bottom&&null!=t.bottom&&(this.bottom=c.number(t.bottom,l.bottom,p)),null!=l.left&&null!=t.left&&(this.left=c.number(t.left,l.left,p)),null!=l.right&&null!=t.right&&(this.right=c.number(t.right,l.right,p)),this}getCenter(t,l){const p=c.clamp((this.left+t-this.right)/2,0,t),_=c.clamp((this.top+l-this.bottom)/2,0,l);return new c.pointGeometry(p,_)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Rs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function So(d,t){return[d[4*t],d[4*t+1],d[4*t+2],d[4*t+3]]}function io(d,t,l){d[4*t+0]=l[0],d[4*t+1]=l[1],d[4*t+2]=l[2],d[4*t+3]=l[3]}function fa(d,t){const l=So(d,3);c.fromQuat(d,t),io(d,3,l)}function ll(d,t){io(d,3,[t[0],t[1],t[2],1])}function Oa(d,t){const l=c.identity$1([]);return c.rotateZ$1(l,l,-t),c.rotateX$1(l,l,-d),l}function jo(d,t){const l=[d[0],d[1],0],p=[t[0],t[1],0];if(c.length(l)>=1e-15){const E=c.normalize([],l);c.scale(p,E,c.dot(p,E)),t[0]=p[0],t[1]=p[1]}const _=c.cross([],t,d);if(c.len(_)<1e-15)return null;const v=Math.atan2(-_[1],_[0]);return Oa(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),v)}class Bl{constructor(t,l){this.position=t,this.orientation=l}get position(){return this._position}set position(t){this._position=this._renderWorldCopies?function(l){if(!l)return;const p=Array.isArray(l)?new c.MercatorCoordinate(l[0],l[1],l[2]):l;return p.x=c.wrap(p.x,0,1),p}(t):t}lookAtPoint(t,l){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(t)):0,_=this.position,v=c.MercatorCoordinate.fromLngLat(t,p),E=[v.x-_.x,v.y-_.y,v.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=jo(E,l)}setPitchBearing(t,l){this.orientation=Oa(c.degToRad(t),c.degToRad(-l))}}class pa{constructor(t,l){this._transform=c.identity([]),this._orientation=c.identity$1([]),l&&(this._orientation=l,fa(this._transform,this._orientation)),t&&ll(this._transform,t)}get mercatorPosition(){const t=this.position;return new c.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=So(this._transform,3);return[t[0],t[1],t[2]]}set position(t){ll(this._transform,t)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,fa(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,l){this._orientation=Oa(t,l),fa(this._transform,this._orientation)}forward(){const t=So(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=So(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=So(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,l){const p=new Float64Array(16);return c.invert(p,this.getWorldToCamera(t,l)),p}getWorldToCameraPosition(t,l,p){const _=this.position;c.scale(_,_,-t);const v=new Float64Array(16);return c.fromScaling(v,[p,p,p]),c.translate(v,v,_),v[10]*=l,v}getWorldToCamera(t,l){const p=new Float64Array(16),_=new Float64Array(4),v=this.position;return c.conjugate(_,this._orientation),c.scale(v,v,-t),c.fromQuat(p,_),c.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(t,l,p,_){const v=new Float64Array(16);return c.perspective(v,t,l,p,_),v}getDistanceToElevation(t){const l=0===t?0:c.mercatorZfromAltitude(t,this.position[1]),p=this.forward();return(l-this.position[2])/p[2]}clone(){return new pa([...this.position],[...this.orientation])}}function ci(d,t){const l=Gr(d),p=function(v,E,S,R,O){const N=new c.LngLat(S.lng-180*Ks,S.lat),V=new c.LngLat(S.lng+180*Ks,S.lat),X=v.project(N.lng,N.lat),re=v.project(V.lng,V.lat),le=-Math.atan2(re.y-X.y,re.x-X.x),ne=c.MercatorCoordinate.fromLngLat(S);ne.y=c.clamp(ne.y,-.999975,.999975);const fe=ne.toLngLat(),ie=v.project(fe.lng,fe.lat),me=c.MercatorCoordinate.fromLngLat(fe);me.x+=Ks;const ge=me.toLngLat(),se=v.project(ge.lng,ge.lat),ve=Nl(se.x-ie.x,se.y-ie.y,le),Te=c.MercatorCoordinate.fromLngLat(fe);Te.y+=Ks;const We=Te.toLngLat(),Ze=v.project(We.lng,We.lat),at=Nl(Ze.x-ie.x,Ze.y-ie.y,le),nt=Math.abs(ve.x)/Math.abs(at.y),It=c.identity([]);c.rotateZ(It,It,-le*(1-(O?0:R)));const Qe=c.identity([]);return c.scale$1(Qe,Qe,[1,1-(1-nt)*R,1]),Qe[4]=-at.x/at.y*R,c.rotateZ(Qe,Qe,le),c.multiply(Qe,It,Qe),Qe}(d.projection,0,d.center,l,t),_=Io(d);return c.scale$1(p,p,[_,_,1]),p}function Io(d){const t=d.projection,l=Gr(d),p=_s(t,d.center),_=_s(t,c.LngLat.convert(t.center));return Math.pow(2,p*l+(1-l)*_)}function Gr(d){const t=d.projection.range;if(!t)return 0;const l=Math.max(d.width,d.height),p=Math.log(l/1024)/Math.LN2;return c.smoothstep(t[0]+p,t[1]+p,d.zoom)}const Ks=1/4e4;function _s(d,t){const l=c.clamp(t.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),p=new c.LngLat(t.lng-180*Ks,l),_=new c.LngLat(t.lng+180*Ks,l),v=d.project(p.lng,l),E=d.project(_.lng,l),S=c.MercatorCoordinate.fromLngLat(p),R=c.MercatorCoordinate.fromLngLat(_),O=E.x-v.x,N=E.y-v.y,V=R.x-S.x,X=R.y-S.y,re=Math.sqrt((V*V+X*X)/(O*O+N*N));return Math.log(re)/Math.LN2}function Nl(d,t,l){const p=Math.cos(l),_=Math.sin(l);return{x:d*p-t*_,y:d*_+t*p}}class Ul{constructor(t,l,p,_,v){this.tileSize=512,this._renderWorldCopies=void 0===v||v,this._minZoom=t||0,this._maxZoom=l||22,this._minPitch=null==p?0:p,this._maxPitch=null==_?60:_,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Rs,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new pa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const t=new Ul(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t.tileSize=this.tileSize,t.setMaxBounds(this.getMaxBounds()),t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._cameraZoom=this._cameraZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.setProjection(this.getProjection()),t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,t?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(t){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),t&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return c.pick(this.projection,["name","center","parallels"])}setProjection(t){null==t&&(t={name:"mercator"}),this.projectionOptions=t;const l=this.projection?this.getProjection():void 0;return this.projection=c.getProjection(t),!je(l,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.wrap}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return c.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return c.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.pointGeometry(this.width,this.height)}get bearing(){return c.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const l=-t*Math.PI/180;var p,_,v,E,S,R,O,N,V,X;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new c.ARRAY_TYPE(4),c.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),_=this.rotationMatrix,E=this.angle,S=(v=this.rotationMatrix)[0],R=v[1],O=v[2],N=v[3],V=Math.sin(E),X=Math.cos(E),_[0]=S*X+O*V,_[1]=R*X+N*V,_[2]=S*-V+O*X,_[3]=R*-V+N*X)}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const l=c.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(t){const l=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===t?(this._cameraZoom=null,!1):(this._centerAltitude=t,!0)}_updateCameraOnTerrain(){const t=this.cameraToCenterDistance/this.worldSize,l=c.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(l+t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,v=0;for(let E=0;E<l.length;E++){const S=new c.pointGeometry(l[E][0]*this.width,p+l[E][1]*(this.height-p)),R=t.pointCoordinate(S);if(!R)continue;const O=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);_+=R[3]*O,v+=O}return 0===v?NaN:_/v}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const t=this._cameraZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=c.mercatorZfromAltitude(l,this.center.lat),_=this._mercatorZfromZoom(t),v=this._mercatorZfromZoom(this._maxZoom),E=Math.max(_-p,v);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let p;p=t.z<this._camera.position[2]?[l.x,l.y,l.z]:[t.x,t.y,t.z];const _=c.length(c.sub([],this._camera.position,p));return c.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let l=!1;if(t.orientation&&!c.exactEquals(t.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(t.orientation)),t.position){const p=[t.position.x,t.position.y,t.position.z];c.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,l=new Bl;return l.position=new c.MercatorCoordinate(t[0],t[1],t[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(t){if(!c.length$1(t))return!1;c.normalize$1(t,t);const l=c.transformQuat([],[0,0,-1],t),p=c.transformQuat([],[0,-1,0],t);if(p[2]<0)return!1;const _=jo(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(t){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;t[2]=c.clamp(t[2],_/p,_/l),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,l,p){this._unmodified=!1,this._edgeInsets.interpolate(t,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const l=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(t){const l=[new c.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const p=this.pointCoordinate(new c.pointGeometry(0,0)),_=this.pointCoordinate(new c.pointGeometry(this.width,0)),v=this.pointCoordinate(new c.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new c.pointGeometry(0,this.height)),S=Math.floor(Math.min(p.x,_.x,v.x,E.x)),R=Math.floor(Math.max(p.x,_.x,v.x,E.x)),O=1;for(let N=S-O;N<=R+O;N++)0!==N&&l.push(new c.UnwrappedTileID(N,t))}return l}coveringTiles(t){let l=this.coveringZoomLevel(t);const p=l,_=this.elevation&&!t.isTerrainDEM,v="mercator"===this.projection.name;if(void 0!==t.minzoom&&l<t.minzoom)return[];void 0!==t.maxzoom&&l>t.maxzoom&&(l=t.maxzoom);const E=this.locationCoordinate(this.center),S=1<<l,R=[S*E.x,S*E.y,0],O=pn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l),N=this.pointCoordinate(this.getCameraPoint()),V=S*c.mercatorZfromAltitude(1,this.center.lat),X=this._camera.position[2]/c.mercatorZfromAltitude(1,this.center.lat),re=[S*N.x,S*N.y,X],le=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ne=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&v?l:0,fe=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ie=t.isTerrainDEM?-fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,me=Io(this),ge=Ge=>{const Ft=1/4e4,Jt=new c.MercatorCoordinate(Ge.x+Ft,Ge.y,Ge.z),wn=new c.MercatorCoordinate(Ge.x,Ge.y+Ft,Ge.z),vn=Ge.toLngLat(),Mn=Jt.toLngLat(),An=wn.toLngLat(),Qt=this.locationCoordinate(vn),zn=this.locationCoordinate(Mn),gr=this.locationCoordinate(An),ui=Math.hypot(zn.x-Qt.x,zn.y-Qt.y),gi=Math.hypot(gr.x-Qt.x,gr.y-Qt.y);return Math.sqrt(ui*gi)*me/Ft},se=(Ge,Ft,Jt,wn,vn,Mn)=>{const An=c.tileTransform({z:Ge,x:Ft,y:Jt},this.projection);return new on([(wn+An.x/An.scale)*S,S*(An.y/An.scale),vn],[(wn+An.x2/An.scale)*S,S*(An.y2/An.scale),Mn])},ve=Ge=>({aabb:se(0,0,0,Ge,ie,fe),zoom:0,x:0,y:0,wrap:Ge,fullyVisible:!1}),Te=[];let We=[];const Ze=l,at=t.reparseOverscaled?p:l,nt=Ge=>{if(!this._elevation||!Ge.tileID)return;const Ft=this._elevation.getMinMaxForTile(Ge.tileID),Jt=Ge.aabb;Ft?(Jt.min[2]=Ft.min,Jt.max[2]=Ft.max,Jt.center[2]=(Jt.min[2]+Jt.max[2])/2):(Ge.shouldSplit=kt(Ge),Ge.shouldSplit||(Jt.min[2]=Jt.max[2]=Jt.center[2]=this._centerAltitude))},It=Ge=>Ge*Ge,Qe=It((X-this._centerAltitude)*V),kt=Ge=>{if(Ge.zoom<ne)return!0;if(Ge.zoom===Ze)return!1;if(null!=Ge.shouldSplit)return Ge.shouldSplit;const Ft=Ge.aabb.distanceX(re),Jt=Ge.aabb.distanceY(re);let wn=Qe;_&&(wn=It(Ge.aabb.distanceZ(re)*V));let vn=1;if(!v&&p<=5){const An=Math.pow(2,Ge.zoom),Qt=ge(new c.MercatorCoordinate((Ge.x+.5)/An,(Ge.y+.5)/An));vn=Qt>.85?1:Qt}const Mn=Ft*Ft+Jt*Jt+wn;return Mn<It((1<<Ze-Ge.zoom)*le*vn*((An,Qt)=>{if(Qt*It(.707)<An)return 1;const zn=Math.sqrt(Qt/An);return zn/(1.4144271570014144+(Math.pow(1.1,zn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(wn,Qe),Mn))};if(this.renderWorldCopies)for(let Ge=1;Ge<=3;Ge++)Te.push(ve(-Ge)),Te.push(ve(Ge));for(Te.push(ve(0));Te.length>0;){const Ge=Te.pop(),Ft=Ge.x,Jt=Ge.y;let wn=Ge.fullyVisible;if(!wn){const vn=Ge.aabb.intersects(O);if(0===vn)continue;wn=2===vn}if(Ge.zoom!==Ze&&kt(Ge))for(let vn=0;vn<4;vn++){const Mn=(Ft<<1)+vn%2,An=(Jt<<1)+(vn>>1),Qt={aabb:"mercator"===this.projection.name?Ge.aabb.quadrant(vn):se(Ge.zoom+1,Mn,An,Ge.wrap,0,0),zoom:Ge.zoom+1,x:Mn,y:An,wrap:Ge.wrap,fullyVisible:wn,tileID:void 0,shouldSplit:void 0};_&&(Qt.tileID=new c.OverscaledTileID(Ge.zoom+1===Ze?at:Ge.zoom+1,Ge.wrap,Ge.zoom+1,Mn,An),nt(Qt)),Te.push(Qt)}else{const vn=Ge.zoom===Ze?at:Ge.zoom;if(t.minzoom&&t.minzoom>vn)continue;const Mn=R[0]-(.5+Ft+(Ge.wrap<<Ge.zoom))*(1<<l-Ge.zoom),An=R[1]-.5-Jt,Qt=Ge.tileID?Ge.tileID:new c.OverscaledTileID(vn,Ge.wrap,Ge.zoom,Ft,Jt);We.push({tileID:Qt,distanceSq:Mn*Mn+An*An})}}if(this.fogCullDistSq){const Ge=this.fogCullDistSq,Ft=this.horizonLineFromTop();We=We.filter(Jt=>{const wn=[0,0,0,1],vn=[c.EXTENT,c.EXTENT,0,1],Mn=this.calculateFogTileMatrix(Jt.tileID.toUnwrapped());c.transformMat4(wn,wn,Mn),c.transformMat4(vn,vn,Mn);const An=c.getAABBPointSquareDist(wn,vn);if(0===An)return!0;let Qt=!1;const zn=this._elevation;if(zn&&An>Ge&&0!==Ft){const gr=this.calculateProjMatrix(Jt.tileID.toUnwrapped());let ui;t.isTerrainDEM||(ui=zn.getMinMaxForTile(Jt.tileID)),ui||(ui={min:ie,max:fe});const gi=c.furthestTileCorner(this.rotation),oo=[gi[0]*c.EXTENT,gi[1]*c.EXTENT,ui.max];c.transformMat4$1(oo,oo,gr),Qt=(1-oo[1])*this.height*.5<Ft}return An<Ge||Qt})}return We.sort((Ge,Ft)=>Ge.distanceSq-Ft.distanceSq).map(Ge=>Ge.tileID)}resize(t,l){this.width=t,this.height=l,this.pixelsToGLUnits=[2/t,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const l=c.clamp(t.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),p=this.projection.project(t.lng,l);return new c.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,l){const p=this.pointCoordinate(l),_=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(t);this.setLocation(new c.MercatorCoordinate(v.x-(p.x-_.x),v.y-(p.y-_.y)))}setLocation(t){this.center=this.coordinateLocation(t),this.renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this._coordinatePoint(this.locationCoordinate(t),!1)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,l){const p=l?c.mercatorZfromAltitude(l,t.lat):void 0,_=this.projection.project(t.lng,t.lat);return new c.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,l){const p=null!=l?l:this._centerAltitude,_=[t.x,t.y,0,1],v=[t.x,t.y,1,1];c.transformMat4(_,_,this.pixelMatrixInverse),c.transformMat4(v,v,this.pixelMatrixInverse);const E=v[3];c.scale$2(_,_,1/_[3]),c.scale$2(v,v,1/E);const S=_[2],R=v[2];return{p0:_,p1:v,t:S===R?0:(p-S)/(R-S)}}screenPointToMercatorRay(t){const l=[t.x,t.y,0,1],p=[t.x,t.y,1,1];return c.transformMat4(l,l,this.pixelMatrixInverse),c.transformMat4(p,p,this.pixelMatrixInverse),c.scale$2(l,l,1/l[3]),c.scale$2(p,p,1/p[3]),l[2]=c.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=c.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,c.scale$2(l,l,1/this.worldSize),c.scale$2(p,p,1/this.worldSize),new Ot([l[0],l[1],l[2]],c.normalize([],c.sub([],p,l)))}rayIntersectionCoordinate(t){const{p0:l,p1:p,t:_}=t,v=c.mercatorZfromAltitude(l[2],this._center.lat),E=c.mercatorZfromAltitude(p[2],this._center.lat);return new c.MercatorCoordinate(c.number(l[0],p[0],_)/this.worldSize,c.number(l[1],p[1],_)/this.worldSize,c.number(v,E,_))}pointCoordinate(t,l=this._centerAltitude){const p=this.horizonLineFromTop(!1),_=new c.pointGeometry(t.x,Math.max(p,t.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(_,l))}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const l=this.elevation;let p=this.elevation.pointCoordinate(t);if(p)return new c.MercatorCoordinate(p[0],p[1],p[2]);let _=0,v=this.horizonLineFromTop();if(t.y>v)return this.pointCoordinate(t);const E=.02*v,S=t.clone();for(let R=0;R<10&&v-_>E;R++){S.y=c.number(_,v,.66);const O=l.pointCoordinate(S);O?(v=S.y,p=O):_=S.y}return p?new c.MercatorCoordinate(p[0],p[1],p[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const l=this.horizonLineFromTop();return t.y<l}}_coordinatePoint(t,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,_=[t.x*this.worldSize,t.y*this.worldSize,p+t.toAltitude(),1];return c.transformMat4(_,_,this.pixelMatrix),_[3]>0?new c.pointGeometry(_[0]/_[3],_[1]/_[3]):new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,l){const p=new c.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new c.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new c.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),E=new c.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(p,t),R=this.pointCoordinate(_,t);const O=this.pointCoordinate(v,l),N=this.pointCoordinate(E,l),V=(X,re)=>(re.y-X.y)/(re.x-X.x);return S.y>1&&R.y>=0?S=new c.MercatorCoordinate((1-N.y)/V(N,S)+N.x,1):S.y<0&&R.y<=1&&(S=new c.MercatorCoordinate(-N.y/V(N,S)+N.x,0)),R.y>1&&S.y>=0?R=new c.MercatorCoordinate((1-O.y)/V(O,R)+O.x,1):R.y<0&&S.y<=1&&(R=new c.MercatorCoordinate(-O.y/V(O,R)+O.x,0)),(new c.LngLatBounds).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(O))}_getBounds3D(){const t=this.elevation,l=t.visibleDemTiles.reduce((p,_)=>{if(_.dem){const v=_.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*t.exaggeration(),l.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return t?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-c.MAX_MERCATOR_LATITUDE,this.maxLat=c.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=c.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=c.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=c.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,l){let p,_,v;const E=t.canonical,S=c.identity(new Float64Array(16));if("mercator"===this.projection.name)p=l/this.zoomScale(E.z),_=(E.x+Math.pow(2,E.z)*t.wrap)*p,v=E.y*p;else{const R=c.tileTransform(E,this.projection);p=1,_=R.x+t.wrap*R.scale,v=R.y,c.scale$1(S,S,[p/R.scale,p/R.scale,this.pixelsPerMeter/this.worldSize])}return c.translate(S,S,[_,v,0]),c.scale$1(S,S,[p/c.EXTENT,p/c.EXTENT,1]),S}calculateDistanceTileData(t){const l=t.key,p=this._distanceTileDataCache;if(p[l])return p[l];const _=t.canonical,v=1/this.height,E=this.cameraWorldSize/this.zoomScale(_.z),S=(_.x+Math.pow(2,_.z)*t.wrap)*E,R=_.y*E,O=this.point,N=this.angle,V=Math.sin(-N),X=-Math.cos(-N);return p[l]={bearing:[V,X],center:[(O.x-S)*v,(O.y-R)*v],scale:E/c.EXTENT*v},p[l]}calculateFogTileMatrix(t){const l=t.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const _=this.calculatePosMatrix(t,this.cameraWorldSize);return c.multiply(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(t,l=!1){const p=t.key,_=l?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];const v=this.calculatePosMatrix(t,this.worldSize);return c.multiply(v,"mercator"===this.projection.name?l?this.alignedProjMatrix:this.projMatrix:this.mercatorMatrix,v),_[p]=new Float32Array(v),_[p]}calculatePixelsToTileUnitsMatrix(t){const l=t.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const _=function(v,E){const{scale:S}=v.tileTransform,R=S*c.EXTENT/(v.tileSize*Math.pow(2,E.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return O=new Float32Array(4),X=(N=E.inverseAdjustmentMatrix)[1],re=N[2],le=N[3],fe=(V=[R,R])[1],O[0]=N[0]*(ne=V[0]),O[1]=X*ne,O[2]=re*fe,O[3]=le*fe,O;var O,N,V,X,re,le,ne,fe}(t,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const l=this._camera.position,p=this._camera.forward();if(l[2]<=0||p[2]>=0)return;const _=c.mercatorZfromAltitude(1,this._center.lat);l[2]/=_,p[2]/=_,c.normalize(p,p);const v=t.raycast(l,p,t.exaggeration());if(v){const E=c.scaleAndAdd([],l,p,v),S=new c.MercatorCoordinate(E[0],E[1],c.mercatorZfromAltitude(E[2],c.latFromMercatorY(E[1]))),R=this._camera.position,O=S.z+c.length([S.x-R[0],S.y-R[1],S.z-R[2]]);this._cameraZoom=this._zoomFromMercatorZ(O),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const l=t.getAtPointOrZero(this._camera.mercatorPosition),p=this._minimumHeightOverTerrain()*Math.cos(c.degToRad(this._maxPitch)),_=c.mercatorZfromAltitude(l,this._center.lat),v=this._camera.position[2]-_;if(v<p){const E=this.locationCoordinate(this._center,this._centerAltitude),S=this._camera.mercatorPosition,R=[E.x-S.x,E.y-S.y,E.z-S.z],O=c.length(R);R[2]-=p-v;const N=c.length(R);if(0===N)return;c.scale(R,R,O/N),this._camera.position=[E.x-R[0],E.y-R[1],E.z-R[2]],this._camera.orientation=jo(R,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,"mercator"!==this.projection.name){const V=this.center;return V.lat=c.clamp(V.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(V.lng=c.clamp(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const t=this._unmodified,{x:l,y:p}=this.point;let _=0,v=l,E=p;const S=this.width/2,R=this.height/2,O=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(p-R<O&&(E=O+R),p+R>N&&(E=N-R),N-O<this.height&&(_=Math.max(_,this.height/(N-O)),E=(N+O)/2),this.maxBounds||!this.renderWorldCopies){const V=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,re=this.worldSize/2-(V+X)/2;v=(l+re+this.worldSize)%this.worldSize-re,v-S<V&&(v=V+S),v+S>X&&(v=X-S),X-V<this.width&&(_=Math.max(_,this.width/(X-V)),v=(X+V)/2)}v===l&&E===p||(this.center=this.unproject(new c.pointGeometry(v,E))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const l=this.pixelsPerMeter;this._updateCameraState();const p=Math.PI/2+this._pitch,_=this.fovAboveCenter,v=this.elevation?this.elevation.getMinElevationBelowMSL()*l:0,E=(this._camera.position[2]*this.worldSize-v)/Math.cos(this._pitch),S=Math.sin(_)*E/Math.sin(c.clamp(Math.PI-p-_,.01,Math.PI-.01)),R=this.point,O=R.x,N=R.y,V=Math.cos(Math.PI/2-this._pitch)*S+E,X=Math.min(1.01*V,E*(1/this._horizonShift)),re=this.height/50,le=this._camera.getWorldToCamera(this.worldSize,l),ne=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,re,X);ne[8]=2*-t.x/this.width,ne[9]=2*t.y/this.height;let fe=c.mul$1([],ne,le);if("mercator"!==this.projection.name){const It=this.locationCoordinate(this.center),Qe=c.identity([]);c.translate(Qe,Qe,[It.x*this.worldSize,It.y*this.worldSize,0]),c.multiply(Qe,Qe,ci(this)),c.translate(Qe,Qe,[-It.x*this.worldSize,-It.y*this.worldSize,0]),c.multiply(fe,fe,Qe),this.inverseAdjustmentMatrix=function(kt){const Ge=ci(kt,!0);return hn([],[Ge[0],Ge[1],Ge[4],Ge[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=c.scale$1([],fe,[this.worldSize,this.worldSize,this.worldSize/l]),this.projMatrix=fe,this.invProjMatrix=c.invert(new Float64Array(16),this.projMatrix);const ie=new Float32Array(16);c.identity(ie),c.scale$1(ie,ie,[1,-1,1]),c.rotateX(ie,ie,this._pitch),c.rotateZ(ie,ie,this.angle);const me=c.perspective(new Float32Array(16),this._fov,this.width/this.height,re,X),ge=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;me[8]=2*-t.x/this.width,me[9]=2*(t.y+ge)/this.height,this.skyboxMatrix=c.multiply(ie,me,ie);const se=this.width%2/2,ve=this.height%2/2,Te=Math.cos(this.angle),We=Math.sin(this.angle),Ze=O-Math.round(O)+Te*se+We*ve,at=N-Math.round(N)+Te*ve+We*se,nt=new Float64Array(fe);if(c.translate(nt,nt,[Ze>.5?Ze-1:Ze,at>.5?at-1:at,0]),this.alignedProjMatrix=nt,fe=c.create$1(),c.scale$1(fe,fe,[this.width/2,-this.height/2,1]),c.translate(fe,fe,[1,-1,0]),this.labelPlaneMatrix=fe,fe=c.create$1(),c.scale$1(fe,fe,[1,-1,1]),c.translate(fe,fe,[-1,-1,0]),c.scale$1(fe,fe,[2/this.width,2/this.height,1]),this.glCoordMatrix=fe,this.pixelMatrix=c.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},fe=c.invert(new Float64Array(16),this.pixelMatrix),!fe)throw new Error("failed to invert matrix");this.pixelMatrixInverse=fe,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height,v=[t,t,l];c.scale(v,v,_),c.scale(p,p,-1),c.multiply$1(p,p,v);const E=c.create$1();c.translate(E,E,p),c.scale$1(E,E,v),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,l,_)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const t=this._camera.forward(),l=this.cameraToCenterDistance,p=this.point,_=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-c.mercatorZfromAltitude(this._centerAltitude,this.center.lat),v=this.cameraToCenterDistance/_;this._camera.position=[p.x/this.worldSize-t[0]*l/v,p.y/this.worldSize-t[1]*l/v,c.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-t[2]*l/v]}_translateCameraConstrained(t){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=t[2];let _=1;p>0&&(_=Math.min((l-this._camera.position[2])/p,1)),this._camera.position=c.scaleAndAdd([],this._camera.position,t,_),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),v=c.mercatorZfromAltitude(this._centerAltitude,this.center.lat),E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.degToRad(this._maxPitch)),S=Math.max((t[2]-v)/Math.cos(p),E),R=this._zoomFromMercatorZ(S);c.scaleAndAdd(t,t,l,S),this._pitch=c.clamp(p,c.degToRad(this.minPitch),c.degToRad(this.maxPitch)),this.angle=c.wrap(_,-Math.PI,Math.PI),this._setZoom(c.clamp(R,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new c.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||"mercator"!==this.projection.name&&(c.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(t,l){const p=Math.min(t.x,l.x),_=Math.max(t.x,l.x),v=Math.min(t.y,l.y),E=Math.max(t.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const S=[new c.pointGeometry(p,v),new c.pointGeometry(_,E),new c.pointGeometry(p,E),new c.pointGeometry(_,v)],R=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const N of S){const V=this.pointRayIntersection(N);if(V.t<0)return!0;const X=this.rayIntersectionCoordinate(V);if(X.x<R||X.y<0||X.x>O||X.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.pointGeometry(0,0),new c.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,l){const p=c.length(c.sub([],this._camera.position,t)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.pointGeometry(0,t))}}function Vl(d,t){let l=!1,p=null;const _=()=>{p=null,l&&(d(),p=setTimeout(_,t),l=!1)};return()=>(l=!0,p||_(),p)}class cl{constructor(t){this._hashName=t&&encodeURIComponent(t),c.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Vl(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,c.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return c.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const l=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),E=Math.round(l.lng*v)/v,S=Math.round(l.lat*v)/v,R=this._map.getBearing(),O=this._map.getPitch();let N="";if(N+=t?`/${E}/${S}/${p}`:`${p}/${S}/${E}`,(R||O)&&(N+="/"+Math.round(10*R)/10),O&&(N+=`/${Math.round(O)}`),this._hashName){const V=this._hashName;let X=!1;const re=c.window.location.hash.slice(1).split("&").map(le=>{const ne=le.split("=")[0];return ne===V?(X=!0,`${ne}=${N}`):le}).filter(le=>le);return X||re.push(`${V}=${N}`),`#${re.join("&")}`}return`#${N}`}_getCurrentHash(){const t=c.window.location.hash.replace("#","");if(this._hashName){let l;return t.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:l,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=c.window.location.href.replace(/(#.+)?$/,this.getHashString());c.window.history.replaceState(c.window.history.state,null,t)}}const ys={linearity:.3,easing:c.bezier(0,0,.3,1)},ma=c.extend({deceleration:2500,maxSpeed:1400},ys),za=c.extend({deceleration:20,maxSpeed:1400},ys),ga=c.extend({deceleration:1e3,maxSpeed:360},ys),Vi=c.extend({deceleration:1e3,maxSpeed:90},ys);class gc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,l=c.exported.now();for(;t.length>0&&l-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new c.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const v=Mo(l.pan.mag(),p,c.extend({},ma,t||{}));_.offset=l.pan.mult(v.amount/l.pan.mag()),_.center=this._map.transform.center,Yi(_,v)}if(l.zoom){const v=Mo(l.zoom,p,za);_.zoom=this._map.transform.zoom+v.amount,Yi(_,v)}if(l.bearing){const v=Mo(l.bearing,p,ga);_.bearing=this._map.transform.bearing+c.clamp(v.amount,-179,179),Yi(_,v)}if(l.pitch){const v=Mo(l.pitch,p,Vi);_.pitch=this._map.transform.pitch+v.amount,Yi(_,v)}if(_.zoom||_.bearing){const v=void 0===l.pinchAround?l.around:l.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),c.extend(_,{noMoveStart:!0})}}function Yi(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function Mo(d,t,l){const{maxSpeed:p,linearity:_,deceleration:v}=l,E=c.clamp(d*_/(t/1e3),-p,p),S=Math.abs(E)/(v*_);return{easing:l.easing,duration:1e3*S,amount:E*(S/2)}}class ji extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,p,_={}){const v=ze.mousePos(l.getCanvasContainer(),p),E=l.unproject(v);super(t,c.extend({point:v,lngLat:E,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class rs extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,p){const _="touchend"===t?p.changedTouches:p.touches,v=ze.touchPos(l.getCanvasContainer(),_),E=v.map(R=>l.unproject(R)),S=v.reduce((R,O,N,V)=>R.add(O.div(V.length)),new c.pointGeometry(0,0));super(t,{points:v,point:S,lngLats:E,lngLat:l.unproject(S),originalEvent:p}),this._defaultPrevented=!1}}class $o extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,p){super(t,{originalEvent:p}),this._defaultPrevented=!1}}class ul{constructor(t,l){this._map=t,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new $o(t.type,this._map,t))}mousedown(t,l){return this._mousedownPos=l,this._firePreventable(new ji(t.type,this._map,t))}mouseup(t){this._map.fire(new ji(t.type,this._map,t))}preclick(t){const l=c.extend({},t);l.type="preclick",this._map.fire(new ji(l.type,this._map,l))}click(t,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(t),this._map.fire(new ji(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new ji(t.type,this._map,t))}mouseover(t){this._map.fire(new ji(t.type,this._map,t))}mouseout(t){this._map.fire(new ji(t.type,this._map,t))}touchstart(t){return this._firePreventable(new rs(t.type,this._map,t))}touchmove(t){this._map.fire(new rs(t.type,this._map,t))}touchend(t){this._map.fire(new rs(t.type,this._map,t))}touchcancel(t){this._map.fire(new rs(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jl{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new ji(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ji("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new ji(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _c{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,l){this.isEnabled()&&t.shiftKey&&0===t.button&&(ze.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(t,l){if(!this._active)return;const p=l;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=ze.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(_.x,p.x),E=Math.max(_.x,p.x),S=Math.min(_.y,p.y),R=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(ze.setTransform(this._box,`translate(${v}px,${S}px)`),this._box.style.width=E-v+"px",this._box.style.height=R-S+"px")})}mouseupWindow(t,l){if(!this._active||0!==t.button)return;const p=this._startPos,_=l;if(this.reset(),ze.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new c.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(ze.remove(this._box),this._box=null),ze.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,l){return this._map.fire(new c.Event(t,{originalEvent:l}))}}function hl(d,t){const l={};for(let p=0;p<d.length;p++)l[d[p].identifier]=t[p];return l}class yc{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const v=new c.pointGeometry(0,0);for(const E of _)v._add(E);return v.div(_.length)}(l),this.touches=hl(p,l)))}touchmove(t,l,p){if(this.aborted||!this.centroid)return;const _=hl(p,l);for(const v in this.touches){const E=this.touches[v],S=_[v];(!S||S.dist(E)>30)&&(this.aborted=!0)}}touchend(t,l,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class vs{constructor(t){this.singleTap=new yc(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,l,p){this.singleTap.touchstart(t,l,p)}touchmove(t,l,p){this.singleTap.touchmove(t,l,p)}touchend(t,l,p){const _=this.singleTap.touchend(t,l,p);if(_){const v=t.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(v&&E||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class $i{constructor(){this._zoomIn=new vs({numTouches:1,numTaps:2}),this._zoomOut=new vs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,l,p){this._zoomIn.touchstart(t,l,p),this._zoomOut.touchstart(t,l,p)}touchmove(t,l,p){this._zoomIn.touchmove(t,l,p),this._zoomOut.touchmove(t,l,p)}touchend(t,l,p){const _=this._zoomIn.touchend(t,l,p),v=this._zoomOut.touchend(t,l,p);return _?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(_)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xs={0:1,2:2};class Ki{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,l){return!1}_move(t,l){return{}}mousedown(t,l){if(this._lastPoint)return;const p=ze.mouseButton(t);this._correctButton(t,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(t,l){const p=this._lastPoint;if(p)if(t.preventDefault(),function(_,v){const E=xs[v];return void 0===_.buttons||(_.buttons&E)!==E}(t,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}mouseupWindow(t){this._lastPoint&&ze.mouseButton(t)===this._eventButton&&(this._moved&&ze.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $l extends Ki{mousedown(t,l){super.mousedown(t,l),this._lastPoint&&(this._active=!0)}_correctButton(t,l){return 0===l&&!t.ctrlKey}_move(t,l){return{around:l,panDelta:l.sub(t)}}}class is extends Ki{_correctButton(t,l){return 0===l&&t.ctrlKey||2===l}_move(t,l){const p=.8*(l.x-t.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(t){t.preventDefault()}}class Ao extends Ki{_correctButton(t,l){return 0===l&&t.ctrlKey||2===l}_move(t,l){const p=-.5*(l.y-t.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(t){t.preventDefault()}}class Xc{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),c.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.pointGeometry(0,0)}touchstart(t,l,p){return this._calculateTransform(t,l,p)}touchmove(t,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===p.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,l,p)}}touchend(t,l,p){this._calculateTransform(t,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,l,p){p.length>0&&(this._active=!0);const _=hl(p,l),v=new c.pointGeometry(0,0),E=new c.pointGeometry(0,0);let S=0;for(const O in _){const N=_[O],V=this._touches[O];V&&(v._add(N),E._add(N.sub(V)),S++,_[O]=N)}if(this._touches=_,S<this._minTouches||!E.mag())return;const R=E.div(S);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(S),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ze.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Ls{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,l,p){return{}}touchstart(t,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(t,l,p){if(!this._firstTwoTouches)return;t.preventDefault();const[_,v]=this._firstTwoTouches,E=_a(p,l,_),S=_a(p,l,v);if(!E||!S)return;const R=this._aroundCenter?null:E.add(S).div(2);return this._move([E,S],R,t)}touchend(t,l,p){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,E=_a(p,l,_),S=_a(p,l,v);E&&S||(this._active&&ze.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function _a(d,t,l){for(let p=0;p<d.length;p++)if(d[p].identifier===l)return t[p]}function ya(d,t){return Math.log(d/t)/Math.LN2}class Yc extends Ls{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,l){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ya(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ya(this._distance,p),pinchAround:l}}}function Js(d,t){return 180*d.angleWith(t)/Math.PI}class Go extends Ls{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,l){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Js(this._vector,p),pinchAround:l}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const l=25/(Math.PI*this._minDiameter)*360,p=Js(t,this._startVector);return Math.abs(p)<l}}function va(d){return Math.abs(d.y)>Math.abs(d.x)}class vc extends Ls{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){this._lastPoints=t,va(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,l,p){const _=t[0].sub(this._lastPoints[0]),v=t[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&p.touches.length<3)&&(this._valid=this.gestureBeginsVertically(_,v,p.timeStamp),this._valid))return this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+v.y)/2*-.5}}gestureBeginsVertically(t,l,p){if(void 0!==this._valid)return this._valid;const _=t.mag()>=2,v=l.mag()>=2;if(!_&&!v)return;if(!_||!v)return void 0===this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=t.y>0==l.y>0;return va(t)&&va(l)&&E}}const bs={panStep:100,bearingStep:15,pitchStep:10};class Wt{constructor(){const t=bs;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let l=0,p=0,_=0,v=0,E=0;switch(t.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?_=1:(t.preventDefault(),E=-1);break;case 40:t.shiftKey?_=-1:(t.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:S=>{const R=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:dl,zoom:l?Math.round(R)+l*(t.shiftKey?2:1):R,bearing:S.getBearing()+p*this._bearingStep,pitch:S.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-E*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function dl(d){return d*(2-d)}const Ba=4.000244140625;class M{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,c.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=t.deltaMode===c.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=c.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==l&&l%Ba==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),t.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=t,this._delta-=l,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=ze.mousePos(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,l=()=>t._terrainEnabled()?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>Ba?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==O&&(O=1/O);const N=l(),V=Math.pow(2,N),X="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(X*O))),"wheel"===this._type&&(this._startZoom=l(),this._easing=this._smoothOutEasing(200)),this._delta=0}const p="number"==typeof this._targetZoom?this._targetZoom:l(),_=this._startZoom,v=this._easing;let E,S=!1;if("wheel"===this._type&&_&&v){const R=Math.min((c.exported.now()-this._lastWheelEventTime)/200,1),O=v(R);E=c.number(_,p,O),R<1?this._frameId||(this._frameId=!0):S=!0}else E=p,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:E-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let l=c.ease;if(this._prevEase){const p=this._prevEase,_=(c.exported.now()-p.start)/p.duration,v=p.easing(_+.01)-p.easing(_),E=.27/Math.sqrt(v*v+1e-4)*.01,S=Math.sqrt(.0729-E*E);l=c.bezier(E,S,.25,1)}return this._prevEase={start:c.exported.now(),duration:t,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ze.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(c.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!c.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class T{constructor(t,l){this._clickZoom=t,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class C{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,l){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(t.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class L{constructor(){this._tap=new vs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,l,p){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(t,l,p))}touchmove(t,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=l[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,l,p)}touchend(t,l,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(t,l,p)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class U{constructor(t,l,p){this._el=t,this._mousePan=l,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Y{constructor(t,l,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _e{constructor(t,l,p,_){this._el=t,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const De=d=>d.zoom||d.drag||d.pitch||d.rotate;class Je extends c.Event{}class Kt{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,l){const p=c.sub([],l,t);this.radius=c.length(p[2]<0?c.div([],p,this.constants):[p[0],p[1],0])}projectRay(t){c.div(t,t,this.constants),c.normalize(t,t),c.mul$2(t,t,this.constants);const l=c.scale([],t,this.radius);if(l[2]>0){const p=c.scale([],[0,0,1],c.dot(l,[0,0,1])),_=c.scale([],c.normalize([],[l[0],l[1],0]),this.radius),v=c.add([],l,c.scale([],c.sub([],c.add([],_,p),l),2));l[0]=v[0],l[1]=v[1]}return l}}function Vn(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class un{constructor(t,l){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new gc(t),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Kt,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),c.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[c.window.document,"mousemove",{capture:!0}],[c.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[c.window,"blur",void 0]];for(const[_,v,E]of this._listeners)ze.addEventListener(_,v,_===c.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[t,l,p]of this._listeners)ze.removeEventListener(t,l,t===c.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(t){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new ul(l,t));const _=l.boxZoom=new _c(l,t);this._add("boxZoom",_);const v=new $i,E=new C;l.doubleClickZoom=new T(E,v),this._add("tapZoom",v),this._add("clickZoom",E);const S=new L;this._add("tapDragZoom",S);const R=l.touchPitch=new vc(l);this._add("touchPitch",R);const O=new is(t),N=new Ao(t);l.dragRotate=new Y(t,O,N),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const V=new $l(t),X=new Xc(l,t);l.dragPan=new U(p,V,X),this._add("mousePan",V),this._add("touchPan",X,["touchZoom","touchRotate"]);const re=new Go,le=new Yc;l.touchZoomRotate=new _e(p,le,re,S),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new jl(l));const ne=l.scrollZoom=new M(l,this);this._add("scrollZoom",ne,["mousePan"]);const fe=l.keyboard=new Wt;this._add("keyboard",fe);for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ie]&&l[ie].enable(t[ie])}_add(t,l,p){this._handlers.push({handlerName:t,handler:l,allowed:p}),this._handlersById[t]=l}stop(t){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(De(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,l,p){for(const _ in t)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const l=[];for(const p of t)this._el.contains(p.target)&&l.push(p);return l}handleEvent(t,l){this._updatingCamera=!0;const p="renderFrame"===t.type,_=p?void 0:t,v={needsRenderFrame:!1},E={},S={},R=t.touches?this._getMapTouches(t.touches):void 0,O=R?ze.touchPos(this._el,R):p?void 0:ze.mousePos(this._el,t);for(const{handlerName:X,handler:re,allowed:le}of this._handlers){if(!re.isEnabled())continue;let ne;this._blockedByActive(S,le,X)?re.reset():re[l||t.type]&&(ne=re[l||t.type](t,O,R),this.mergeHandlerResult(v,E,ne,X,_),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||re.isActive())&&(S[X]=re)}const N={};for(const X in this._previousActiveHandlers)S[X]||(N[X]=_);this._previousActiveHandlers=S,(Object.keys(N).length||Vn(v))&&(this._changes.push([v,E,N]),this._triggerRenderFrame()),(Object.keys(S).length||Vn(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=v;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(t,l,p,_,v){if(!p)return;c.extend(t,p);const E={handlerName:_,originalEvent:p.originalEvent||v};void 0!==p.zoomDelta&&(l.zoom=E),void 0!==p.panDelta&&(l.drag=E),void 0!==p.pitchDelta&&(l.pitch=E),void 0!==p.bearingDelta&&(l.rotate=E)}_applyChanges(){const t={},l={},p={};for(const[_,v,E]of this._changes)_.panDelta&&(t.panDelta=(t.panDelta||new c.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+_.pitchDelta),void 0!==_.around&&(t.around=_.around),void 0!==_.aroundCoord&&(t.aroundCoord=_.aroundCoord),void 0!==_.pinchAround&&(t.pinchAround=_.pinchAround),_.noInertia&&(t.noInertia=_.noInertia),c.extend(l,v),c.extend(p,E);this._updateMapTransform(t,l,p),this._changes=[]}_updateMapTransform(t,l,p){const _=this._map,v=_.transform,E=me=>[me.x,me.y,me.z];if((me=>{const ge=this._eventsInProgress.drag;return ge&&!this._handlersById[ge.handlerName].isActive()})()&&!Vn(t)){const me=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",me!==v.zoom&&this._map._update(!0)}if(!Vn(t))return this._fireEvents(l,p,!0);let{panDelta:S,zoomDelta:R,bearingDelta:O,pitchDelta:N,around:V,aroundCoord:X,pinchAround:re}=t;void 0!==re&&(V=re),(me=>l.drag&&!this._eventsInProgress.drag)()&&V&&(this._dragOrigin=E(v.pointCoordinate3D(V)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),V=V||_.transform.centerPoint,O&&(v.bearing+=O),N&&(v.pitch+=N),v._updateCameraState();const le=[0,0,0];if(S){const me=v.screenPointToMercatorRay(V),ge=v.screenPointToMercatorRay(V.sub(S)),se=this._trackingEllipsoid.projectRay(me.dir),ve=this._trackingEllipsoid.projectRay(ge.dir);le[0]=ve[0]-se[0],le[1]=ve[1]-se[1]}const ne=v.zoom,fe=[0,0,0];if(R){const me=E(X||v.pointCoordinate3D(V)),ge={dir:c.normalize([],c.sub([],me,v._camera.position))},se=v.screenPointToMercatorRay(v.centerPoint);if(ge.dir[2]<0){const ve=c.altitudeFromMercatorZ(me[2],me[1]),Te=v.rayIntersectionCoordinate(v.pointRayIntersection(v.centerPoint,ve)),We=v.zoomDeltaToMovement(E(Te),R)*(se.dir[2]/ge.dir[2]);c.scale(fe,ge.dir,We)}else if(v._terrainEnabled()){const ve=v.zoomDeltaToMovement(me,R);c.scale(fe,ge.dir,ve)}}const ie=c.add(le,le,fe);v._translateCameraConstrained(ie),R&&Math.abs(v.zoom-ne)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(l,p,!0)}_fireEvents(t,l,p){const _=De(this._eventsInProgress),v=De(t),E={};for(const N in t){const{originalEvent:V}=t[N];this._eventsInProgress[N]||(E[`${N}start`]=V),this._eventsInProgress[N]=t[N]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const N in E)this._fireEvent(N,E[N]);v&&this._fireEvent("move",v.originalEvent);for(const N in t){const{originalEvent:V}=t[N];this._fireEvent(N,V)}const S={};let R;for(const N in this._eventsInProgress){const{handlerName:V,originalEvent:X}=this._eventsInProgress[N];this._handlersById[V].isActive()||(delete this._eventsInProgress[N],R=l[V]||X,S[`${N}end`]=R)}for(const N in S)this._fireEvent(N,S[N]);const O=De(this._eventsInProgress);if(p&&(_||v)&&!O){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=X=>0!==X&&-this._bearingSnap<X&&X<this._bearingSnap;N?(V(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:R})):(this._map.fire(new c.Event("moveend",{originalEvent:R})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,l){this._map.fire(new c.Event(t,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Je("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const sr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class er extends c.Evented{constructor(t,l){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,c.bindAll(["_renderFrameCallback"],this)}getCenter(){return new c.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,l){return this.jumpTo({center:t},l)}panBy(t,l,p){return t=c.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,c.extend({offset:t},l),p)}panTo(t,l,p){return this.easeTo(c.extend({center:t},l),p)}getZoom(){return this.transform.zoom}setZoom(t,l){return this.jumpTo({zoom:t},l),this}zoomTo(t,l,p){return this.easeTo(c.extend({zoom:t},l),p)}zoomIn(t,l){return this.zoomTo(this.getZoom()+1,t,l),this}zoomOut(t,l){return this.zoomTo(this.getZoom()-1,t,l),this}getBearing(){return this.transform.bearing}setBearing(t,l){return this.jumpTo({bearing:t},l),this}getPadding(){return this.transform.padding}setPadding(t,l){return this.jumpTo({padding:t},l),this}rotateTo(t,l,p){return this.easeTo(c.extend({bearing:t},l),p)}resetNorth(t,l){return this.rotateTo(0,c.extend({duration:1e3},t),l),this}resetNorthPitch(t,l){return this.easeTo(c.extend({bearing:0,pitch:0,duration:1e3},t),l),this}snapToNorth(t,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,l):this}getPitch(){return this.transform.pitch}setPitch(t,l){return this.jumpTo({pitch:t},l),this}cameraForBounds(t,l){t=c.LngLatBounds.convert(t);const p=l&&l.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),p,l)}_extendCameraOptions(t){const l={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=c.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const p=t.padding;t.padding={top:p,bottom:p,right:p,left:p}}return t.padding=c.extend(l,t.padding),t}_cameraForBoxAndBearing(t,l,p,_){const v=this._extendCameraOptions(_),E=this.transform,S=E.padding,R=E.project(c.LngLat.convert(t)),O=E.project(c.LngLat.convert(l)),N=R.rotate(-c.degToRad(p)),V=O.rotate(-c.degToRad(p)),X=new c.pointGeometry(Math.max(N.x,V.x),Math.max(N.y,V.y)),re=new c.pointGeometry(Math.min(N.x,V.x),Math.min(N.y,V.y)),le=X.sub(re),ne=(E.width-(S.left+S.right+v.padding.left+v.padding.right))/le.x,fe=(E.height-(S.top+S.bottom+v.padding.top+v.padding.bottom))/le.y;if(fe<0||ne<0)return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ie=Math.min(E.scaleZoom(E.scale*Math.min(ne,fe)),v.maxZoom),me="number"==typeof v.offset.x?new c.pointGeometry(v.offset.x,v.offset.y):c.pointGeometry.convert(v.offset),ge=new c.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(p*Math.PI/180),se=me.add(ge).mult(E.scale/E.zoomScale(ie));return{center:E.unproject(R.add(O).div(2).sub(se)),zoom:ie,bearing:p}}_cameraForBox(t,l,p,_,v){const E=this._extendCameraOptions(v);p=p||0,_=_||0,t=c.LngLat.convert(t),l=c.LngLat.convert(l);const S=this.transform.clone();S.padding=E.padding;const R=this.getFreeCameraOptions(),O=new c.LngLat(.5*(t.lng+l.lng),.5*(t.lat+l.lat)),N=.5*(p+_);if(S._camera.position[2]<c.mercatorZfromAltitude(N,O.lat))return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");R.lookAtPoint(O),S.setFreeCameraOptions(R);const V=c.MercatorCoordinate.fromLngLat(t),X=c.MercatorCoordinate.fromLngLat(l),re=S.pointRayIntersection(S.centerPoint,N),le=[(ne=S.rayIntersectionCoordinate(re)).x,ne.y,ne.z];var ne;const fe=S.screenPointToMercatorRay(S.centerPoint);let ie,me=0;do{const ge=Math.floor(S.zoom),se=1<<ge,ve=Math.min(se*V.x,se*X.x),Te=Math.min(se*V.y,se*X.y),We=Math.max(se*V.x,se*X.x),Ze=Math.max(se*V.y,se*X.y),at=new on([ve,Te,p],[We,Ze,_]),nt=pn.fromInvProjectionMatrix(S.invProjMatrix,S.worldSize,ge);if(2!==at.intersects(nt)){ie&&(S._camera.position=c.scaleAndAdd([],S._camera.position,fe.dir,-ie),S._updateStateFromCamera());break}const It=c.sub([],S._camera.position,le);ie=.5*c.length(It),S._camera.position=c.scaleAndAdd([],S._camera.position,fe.dir,ie);try{S._updateStateFromCamera()}catch(Qe){return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++me<10);return{center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch}}fitBounds(t,l,p){return this._fitInternal(this.cameraForBounds(t,l),l,p)}_raycastElevationBox(t,l){const p=this.transform.elevation;if(!p)return;const _=new c.pointGeometry(t.x,l.y),v=new c.pointGeometry(l.x,t.y),E=p.pointCoordinate(t);if(!E)return;const S=p.pointCoordinate(l);if(!S)return;const R=p.pointCoordinate(_);if(!R)return;const O=p.pointCoordinate(v);if(!O)return;const N=new c.MercatorCoordinate(E[0],E[1]).toLngLat(),V=new c.MercatorCoordinate(S[0],S[1]).toLngLat(),X=new c.MercatorCoordinate(R[0],R[1]).toLngLat(),re=new c.MercatorCoordinate(O[0],O[1]).toLngLat(),le=Math.min(N.lng,Math.min(V.lng,Math.min(X.lng,re.lng))),ne=Math.min(N.lat,Math.min(V.lat,Math.min(X.lat,re.lat))),fe=Math.max(N.lng,Math.max(V.lng,Math.max(X.lng,re.lng))),ie=Math.max(N.lat,Math.max(V.lat,Math.max(X.lat,re.lat))),me=Math.min(E[3],Math.min(S[3],Math.min(R[3],O[3]))),ge=Math.max(E[3],Math.max(S[3],Math.max(R[3],O[3])));return{minLngLat:new c.LngLat(le,ne),maxLngLat:new c.LngLat(fe,ie),minAltitude:me,maxAltitude:ge}}fitScreenCoordinates(t,l,p,_,v){let E,S,R,O;const N=c.pointGeometry.convert(t),V=c.pointGeometry.convert(l),X=this._raycastElevationBox(N,V);if(X)E=X.minLngLat,S=X.maxLngLat,R=X.minAltitude,O=X.maxAltitude;else{if(this.transform.anyCornerOffEdge(N,V))return this;E=this.transform.pointLocation(N),S=this.transform.pointLocation(V)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(c.pointGeometry.convert(t)),this.transform.pointLocation(c.pointGeometry.convert(l)),p,_):this._cameraForBox(E,S,R,O,_),_,v)}_fitInternal(t,l,p){return t?(delete(l=c.extend(t,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(t,l){this.stop();const p=this.transform;let _=!1,v=!1,E=!1;return"zoom"in t&&p.zoom!==+t.zoom&&(_=!0,p.zoom=+t.zoom),void 0!==t.center&&(p.center=c.LngLat.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(v=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(E=!0,p.pitch=+t.pitch),null==t.padding||p.isPaddingEqual(t.padding)||(p.padding=t.padding),this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),_&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),v&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),E&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l))}getFreeCameraOptions(){return"mercator"!==this.transform.projection.name&&c.warnOnce(sr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,l){const p=this.transform;if("mercator"!==p.projection.name)return void c.warnOnce(sr);this.stop();const _=p.zoom,v=p.pitch,E=p.bearing;p.setFreeCameraOptions(t);const S=_!==p.zoom,R=v!==p.pitch,O=E!==p.bearing;return this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),S&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),O&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),R&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)),this}easeTo(t,l){this._stop(!1,t.easeId),(!1===(t=c.extend({offset:[0,0],duration:500,easing:c.ease},t)).animate||!t.essential&&c.exported.prefersReducedMotion)&&(t.duration=0);const p=this.transform,_=this.getZoom(),v=this.getBearing(),E=this.getPitch(),S=this.getPadding(),R="zoom"in t?+t.zoom:_,O="bearing"in t?this._normalizeBearing(t.bearing,v):v,N="pitch"in t?+t.pitch:E,V="padding"in t?t.padding:p.padding,X=c.pointGeometry.convert(t.offset);let re=p.centerPoint.add(X);const le=p.pointLocation(re),ne=c.LngLat.convert(t.center||le);this._normalizeCenter(ne);const fe=p.project(le),ie=p.project(ne).sub(fe),me=p.zoomScale(R-_);let ge,se;t.around&&(ge=c.LngLat.convert(t.around),se=p.locationPoint(ge));const ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||R!==_,this._rotating=this._rotating||v!==O,this._pitching=this._pitching||N!==E,this._padding=!p.isPaddingEqual(V),this._easeId=t.easeId,this._prepareEase(l,t.noMoveStart,ve),this._ease(Te=>{if(this._zooming&&(p.zoom=c.number(_,R,Te)),this._rotating&&(p.bearing=c.number(v,O,Te)),this._pitching&&(p.pitch=c.number(E,N,Te)),this._padding&&(p.interpolatePadding(S,V,Te),re=p.centerPoint.add(X)),ge)p.setLocationAtPoint(ge,se);else{const We=p.zoomScale(p.zoom-_),Ze=R>_?Math.min(2,me):Math.max(.5,me),at=Math.pow(Ze,1-Te),nt=p.unproject(fe.add(ie.mult(Te*at)).mult(We));p.setLocationAtPoint(p.renderWorldCopies?nt.wrap():nt,re)}this._fireMoveEvents(l)},Te=>{p.recenterOnTerrain(),this._afterEase(l,Te)},t),this}_prepareEase(t,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new c.Event("movestart",t)),this._zooming&&!p.zooming&&this.fire(new c.Event("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new c.Event("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new c.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new c.Event("move",t)),this._zooming&&this.fire(new c.Event("zoom",t)),this._rotating&&this.fire(new c.Event("rotate",t)),this._pitching&&this.fire(new c.Event("pitch",t))}_afterEase(t,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new c.Event("zoomend",t)),_&&this.fire(new c.Event("rotateend",t)),v&&this.fire(new c.Event("pitchend",t)),this.fire(new c.Event("moveend",t))}flyTo(t,l){if(!t.essential&&c.exported.prefersReducedMotion){const Ft=c.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ft,l)}this.stop(),t=c.extend({offset:[0,0],speed:1.2,curve:1.42,easing:c.ease},t);const p=this.transform,_=this.getZoom(),v=this.getBearing(),E=this.getPitch(),S=this.getPadding(),R="zoom"in t?c.clamp(+t.zoom,p.minZoom,p.maxZoom):_,O="bearing"in t?this._normalizeBearing(t.bearing,v):v,N="pitch"in t?+t.pitch:E,V="padding"in t?t.padding:p.padding,X=p.zoomScale(R-_),re=c.pointGeometry.convert(t.offset);let le=p.centerPoint.add(re);const ne=p.pointLocation(le),fe=c.LngLat.convert(t.center||ne);this._normalizeCenter(fe);const ie=p.project(ne),me=p.project(fe).sub(ie);let ge=t.curve;const se=Math.max(p.width,p.height),ve=se/X,Te=me.mag();if("minZoom"in t){const Ft=c.clamp(Math.min(t.minZoom,_,R),p.minZoom,p.maxZoom),Jt=se/p.zoomScale(Ft-_);ge=Math.sqrt(Jt/Te*2)}const We=ge*ge;function Ze(Ft){const Jt=(ve*ve-se*se+(Ft?-1:1)*We*We*Te*Te)/(2*(Ft?ve:se)*We*Te);return Math.log(Math.sqrt(Jt*Jt+1)-Jt)}function at(Ft){return(Math.exp(Ft)-Math.exp(-Ft))/2}function nt(Ft){return(Math.exp(Ft)+Math.exp(-Ft))/2}const It=Ze(0);let Qe=function(Ft){return nt(It)/nt(It+ge*Ft)},kt=function(Ft){return se*((nt(It)*(at(Jt=It+ge*Ft)/nt(Jt))-at(It))/We)/Te;var Jt},Ge=(Ze(1)-It)/ge;if(Math.abs(Te)<1e-6||!isFinite(Ge)){if(Math.abs(se-ve)<1e-6)return this.easeTo(t,l);const Ft=ve<se?-1:1;Ge=Math.abs(Math.log(ve/se))/ge,kt=function(){return 0},Qe=function(Jt){return Math.exp(Ft*ge*Jt)}}return t.duration="duration"in t?+t.duration:1e3*Ge/("screenSpeed"in t?+t.screenSpeed/ge:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=v!==O,this._pitching=N!==E,this._padding=!p.isPaddingEqual(V),this._prepareEase(l,!1),this._ease(Ft=>{const Jt=Ft*Ge,wn=1/Qe(Jt);p.zoom=1===Ft?R:_+p.scaleZoom(wn),this._rotating&&(p.bearing=c.number(v,O,Ft)),this._pitching&&(p.pitch=c.number(E,N,Ft)),this._padding&&(p.interpolatePadding(S,V,Ft),le=p.centerPoint.add(re));const vn=1===Ft?fe:p.unproject(ie.add(me.mult(kt(Jt))).mult(wn));p.setLocationAtPoint(p.renderWorldCopies?vn.wrap():vn,le),p._updateCenterElevation(),this._fireMoveEvents(l)},()=>this._afterEase(l),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,l)}if(!t){const p=this.handlers;p&&p.stop(!1)}return this}_ease(t,l,p){!1===p.animate||0===p.duration?(t(1),l()):(this._easeStart=c.exported.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((c.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,l){t=c.wrap(t,-180,180);const p=Math.abs(t-l);return Math.abs(t-360-l)<p&&(t-=360),Math.abs(t+360-l)<p&&(t+=360),t}_normalizeCenter(t){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=t.lng-l.center.lng;t.lng+=p>180?-360:p<-180?360:0}}class Ho{constructor(t={}){this.options=t,c.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const l=this.options&&this.options.compact;return this._map=t,this._container=ze.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ze.create("button","mapboxgl-ctrl-attrib-button",this._container),ze.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ze.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){ze.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,l){const p=this._map._getUIString(`AttributionControl.${l}`);t.setAttribute("aria-label",p),t.firstElementChild&&t.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.config.ACCESS_TOKEN}];if(t){const p=l.reduce((_,v,E)=>(v.value&&(_+=`${v.key}=${v.value}${E<l.length-1?"&":""}`),_),"?");t.href=`${c.config.FEEDBACK_URL}/${p}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(_=>"string"!=typeof _?"":_)):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._sourceCaches;for(const _ in l){const v=l[_];if(v.used){const E=v.getSource();E.attribution&&t.indexOf(E.attribution)<0&&t.push(E.attribution)}}t.sort((_,v)=>_.length-v.length),t=t.filter((_,v)=>{for(let E=v+1;E<t.length;E++)if(t[E].indexOf(_)>=0)return!1;return!0});const p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Zo{constructor(){c.bindAll(["_updateLogo"],this),c.bindAll(["_updateCompact"],this)}onAdd(t){this._map=t,this._container=ze.create("div","mapboxgl-ctrl");const l=ze.create("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ze.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const l in t){const p=t[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const l=t[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Ji{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const l=++this._id;return this._queue.push({callback:t,id:l,cancelled:!1}),l}remove(t){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const _ of p)if(_.id===t)return void(_.cancelled=!0)}run(t=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function go(d,t,l){if(d=new c.LngLat(d.lng,d.lat),t){const p=new c.LngLat(d.lng-360,d.lat),_=new c.LngLat(d.lng+360,d.lat),v=360*Math.ceil(Math.abs(d.lng-l.center.lng)/360),E=l.locationPoint(d).distSqr(t),S=t.x<0||t.y<0||t.x>l.width||t.y>l.height;l.locationPoint(p).distSqr(t)<E&&(S||Math.abs(p.lng-l.center.lng)<v)?d=p:l.locationPoint(_).distSqr(t)<E&&(S||Math.abs(_.lng-l.center.lng)<v)&&(d=_)}for(;Math.abs(d.lng-l.center.lng)>180;){const p=l.locationPoint(d);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}const _o={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Qi extends c.Evented{constructor(t,l){if(super(),(t instanceof c.window.HTMLElement||l)&&(t=c.extend({element:t},l)),c.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=c.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=ze.create("div"),this._element.setAttribute("aria-label","Map marker");const _=ze.createNS("http://www.w3.org/2000/svg","svg"),v=41,E=27;_.setAttributeNS(null,"display","block"),_.setAttributeNS(null,"height",`${v}px`),_.setAttributeNS(null,"width",`${E}px`),_.setAttributeNS(null,"viewBox",`0 0 ${E} ${v}`);const S=ze.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const R=ze.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");const O=ze.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(3.0, 29.0)"),O.setAttributeNS(null,"fill","#000000");const N=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ge of N){const se=ze.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",ge.rx),se.setAttributeNS(null,"ry",ge.ry),O.appendChild(se)}const V=ze.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"fill",this._color);const X=ze.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),V.appendChild(X);const re=ze.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"fill","#000000");const le=ze.createNS("http://www.w3.org/2000/svg","path");le.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),re.appendChild(le);const ne=ze.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ne.setAttributeNS(null,"fill","#FFFFFF");const fe=ze.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ie=ze.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#000000"),ie.setAttributeNS(null,"opacity","0.25"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962");const me=ze.createNS("http://www.w3.org/2000/svg","circle");me.setAttributeNS(null,"fill","#FFFFFF"),me.setAttributeNS(null,"cx","5.5"),me.setAttributeNS(null,"cy","5.5"),me.setAttributeNS(null,"r","5.4999962"),fe.appendChild(ie),fe.appendChild(me),R.appendChild(O),R.appendChild(V),R.appendChild(re),R.appendChild(ne),R.appendChild(fe),_.appendChild(R),_.setAttributeNS(null,"height",v*this._scale+"px"),_.setAttributeNS(null,"width",E*this._scale+"px"),this._element.appendChild(_),this._offset=c.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const p=this._element.classList;for(const _ in _o)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),ze.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=c.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const l=38.1,p=13.5,_=Math.sqrt(Math.pow(p,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-l],"bottom-left":[_,-1*(l-p+_)],"bottom-right":[-_,-1*(l-p+_)],left:[p,-1*(l-p)],right:[-p,-1*(l-p)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const l=t.code,p=t.charCode||t.keyCode;"Space"!==l&&"Enter"!==l&&32!==p&&13!==p||this.togglePopup()}_onMapClick(t){const l=t.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const t=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(t))return void this._clearFadeTimer();const l=this._map.unproject(t);let p=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const v=this._map.getFreeCameraOptions();if(v.position){const E=v.position.toLngLat();p=E.distanceTo(l)<.9*E.distanceTo(this._lngLat)}}const _=(1-this._map._queryFogOpacity(l))*(p?.2:1);this._element.style.opacity=`${_}`,this._popup&&this._popup._setOpacity(`${_}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(t){const l=this._map.transform;return!!t&&t.x>=0&&t.x<l.width&&t.y>=0&&t.y<l.height}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=go(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let l="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?l=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(l=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?p="rotateX(0deg)":"map"===this._pitchAlignment&&(p=`rotateX(${this._map.getPitch()}deg)`),t&&"moveend"!==t.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&ze.setTransform(this._element,`${_o[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${l}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const t=this._map.transform,l=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&l._rotate(t.angle),"map"===this._pitchAlignment&&(l.y*=Math.cos(t._pitch)),l}getOffset(){return this._offset}setOffset(t){return this._offset=c.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new c.Event("dragstart"))),this.fire(new c.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new c.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class qo{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const l=c.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,l,p){this._start=this.getValue(l),this._end=t,this._startTime=l,this._endTime=l+p}}const fl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Fs,HTMLElement:Rh,ImageBitmap:xa}=c.window,ri={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Gl(d){d.parentNode&&d.parentNode.removeChild(d)}const Lh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bu{constructor(t,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new is({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,p&&(this.mousePitch=new Ao({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),c.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ze.addEventListener(l,"mousedown",this.mousedown),ze.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),ze.addEventListener(l,"touchmove",this.touchmove),ze.addEventListener(l,"touchend",this.touchend),ze.addEventListener(l,"touchcancel",this.reset)}down(t,l){this.mouseRotate.mousedown(t,l),this.mousePitch&&this.mousePitch.mousedown(t,l),ze.disableDrag()}move(t,l){const p=this.map,_=this.mouseRotate.mousemoveWindow(t,l);if(_&&_.bearingDelta&&p.setBearing(p.getBearing()+_.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,l);v&&v.pitchDelta&&p.setPitch(p.getPitch()+v.pitchDelta)}}off(){const t=this.element;ze.removeEventListener(t,"mousedown",this.mousedown),ze.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),ze.removeEventListener(t,"touchmove",this.touchmove),ze.removeEventListener(t,"touchend",this.touchend),ze.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){ze.enableDrag(),ze.removeEventListener(c.window,"mousemove",this.mousemove),ze.removeEventListener(c.window,"mouseup",this.mouseup)}mousedown(t){this.down(c.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),ze.mousePos(this.element,t)),ze.addEventListener(c.window,"mousemove",this.mousemove),ze.addEventListener(c.window,"mouseup",this.mouseup)}mousemove(t){this.move(t,ze.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=ze.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=ze.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Nu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Na,Kc=0,xc=!1;const Ua={maxWidth:100,unit:"metric"};function Uu(d,t,l){const p=l&&l.maxWidth||100,_=d._container.getBoundingClientRect().height/2,v=d.unproject([0,_]),E=d.unproject([p,_]),S=v.distanceTo(E);if(l&&"imperial"===l.unit){const R=3.2808*S;R>5280?ei(t,p,R/5280,d._getUIString("ScaleControl.Miles"),d):ei(t,p,R,d._getUIString("ScaleControl.Feet"),d)}else l&&"nautical"===l.unit?ei(t,p,S/1852,d._getUIString("ScaleControl.NauticalMiles"),d):S>=1e3?ei(t,p,S/1e3,d._getUIString("ScaleControl.Kilometers"),d):ei(t,p,S,d._getUIString("ScaleControl.Meters"),d)}function ei(d,t,l,p,_){const v=function(S){const R=Math.pow(10,`${Math.floor(S)}`.length-1);let O=S/R;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(N){const V=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*V)/V}(O),R*O}(l),E=v/l;_._requestDomTask(()=>{d.style.width=t*E+"px",d.innerHTML=`${v}&nbsp;${p}`})}const Jc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Hl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Zl={version:c.version,supported:Et,setRTLTextPlugin:c.setRTLTextPlugin,getRTLTextPluginStatus:c.getRTLTextPluginStatus,Map:class extends er{constructor(d){if(null!=(d=c.extend({},ri,d)).minZoom&&null!=d.maxZoom&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=d.minPitch&&null!=d.maxPitch&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=d.minPitch&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=d.maxPitch&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ul(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._renderTaskQueue=new Ji,this._domRenderTaskQueue=new Ji,this._controls=[],this._markers=[],this._mapId=c.uniqueId(),this._locale=c.extend({},fl,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new qo(0),this._requestManager=new c.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,"string"==typeof d.container){if(this._container=c.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof Rh))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),c.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==c.window&&(c.window.addEventListener("online",this._onWindowOnline,!1),c.window.addEventListener("resize",this._onWindowResize,!1),c.window.addEventListener("orientationchange",this._onWindowResize,!1),c.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new un(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new cl("string"==typeof d.hash&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,c.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new Ho({customAttribution:d.customAttribution})),this._logoControl=new Zo,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new c.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new c.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(d,t){if(void 0===t&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=d.onAdd(this);this._controls.push(d);const p=this._controlPositions[t];return-1!==t.indexOf("bottom")?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){const[t,l]=this._containerDimensions();if(t===this.transform.width&&l===this.transform.height)return this;this._resizeCanvas(t,l),this.transform.resize(t,l),this.painter.resize(Math.ceil(t),Math.ceil(l));const p=!this._moving;return p&&this.fire(new c.Event("movestart",d)).fire(new c.Event("move",d)),this.fire(new c.Event("resize",d)),p&&this.fire(new c.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(c.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=null==d?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=null==d?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=null==d?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=null==d?85:d)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}getProjection(){return this.transform.getProjection()}setProjection(d){this._lazyInitEmptyStyle(),"string"==typeof d&&(d={name:d}),this._runtimeProjection=d,this.style.updateProjection()}project(d){return this.transform.locationPoint3D(c.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(c.pointGeometry.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(d,t,l){if("mouseenter"===d||"mouseover"===d){let p=!1;const _=E=>{const S=t.filter(O=>this.getLayer(O)),R=S.length?this.queryRenderedFeatures(E.point,{layers:S}):[];R.length?p||(p=!0,l.call(this,new ji(d,this,E.originalEvent,{features:R}))):p=!1},v=()=>{p=!1};return{layers:new Set(t),listener:l,delegates:{mousemove:_,mouseout:v}}}if("mouseleave"===d||"mouseout"===d){let p=!1;const _=E=>{const S=t.filter(R=>this.getLayer(R));(S.length?this.queryRenderedFeatures(E.point,{layers:S}):[]).length?p=!0:p&&(p=!1,l.call(this,new ji(d,this,E.originalEvent)))},v=E=>{p&&(p=!1,l.call(this,new ji(d,this,E.originalEvent)))};return{layers:new Set(t),listener:l,delegates:{mousemove:_,mouseout:v}}}{const p=_=>{const v=t.filter(S=>this.getLayer(S)),E=v.length?this.queryRenderedFeatures(_.point,{layers:v}):[];E.length&&(_.features=E,l.call(this,_),delete _.features)};return{layers:new Set(t),listener:l,delegates:{[d]:p}}}}on(d,t,l){if(void 0===l)return super.on(d,t);Array.isArray(t)||(t=[t]);const p=this._createDelegatedListener(d,t,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(d,t,l){if(void 0===l)return super.once(d,t);Array.isArray(t)||(t=[t]);const p=this._createDelegatedListener(d,t,l);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(d,t,l){if(void 0===l)return super.off(d,t);t=new Set(Array.isArray(t)?t:[t]);const p=(v,E)=>{if(v.size!==E.size)return!1;for(const S of v)if(!E.has(S))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[d]:void 0;return _&&(v=>{for(let E=0;E<v.length;E++){const S=v[E];if(S.listener===l&&p(S.layers,t)){for(const R in S.delegates)this.off(R,S.delegates[R]);return v.splice(E,1),this}}})(_),this}queryRenderedFeatures(d,t){return this.style?(void 0!==t||void 0===d||d instanceof c.pointGeometry||Array.isArray(d)||(t=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(d,t){return this.style.querySourceFeatures(d,t)}queryTerrainElevation(d,t){const l=this.transform.elevation;return l?(t=c.extend({},{exaggerated:!0},t),l.getAtPoint(c.MercatorCoordinate.fromLngLat(d),null,t.exaggerated)):null}setStyle(d,t){return!1!==(t=c.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(d,t))}_getUIString(d){const t=this._locale[d];if(null==t)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),d&&(this.style=new Ui(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof d?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ui(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,t){if("string"==typeof d){const l=this._requestManager.normalizeStyleURL(d),p=this._requestManager.transformRequest(l,c.ResourceType.Style);c.getJSON(p,(_,v)=>{_?this.fire(new c.ErrorEvent(_)):v&&this._updateDiff(v,t)})}else"object"==typeof d&&this._updateDiff(d,t)}_updateDiff(d,t){try{this.style.setState(d)&&this._update(!0)}catch(l){c.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(d,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.warnOnce("There is no style added to the map.")}addSource(d,t){return this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)}isSourceLoaded(d){const t=this.style&&this.style._getSourceCaches(d);if(0!==t.length)return t.every(l=>l.loaded());this.fire(new c.ErrorEvent(new Error(`There is no source with ID '${d}'`)))}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const t in d){const l=d[t]._tiles;for(const p in l){const _=l[p];if("loaded"!==_.state&&"errored"!==_.state)return!1}}return!0}addSourceType(d,t,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,l)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,t,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:v,content:E}={}){if(this._lazyInitEmptyStyle(),t instanceof Fs||xa&&t instanceof xa){const{width:S,height:R,data:O}=c.exported.getImageData(t);this.style.addImage(d,{data:new c.RGBAImage({width:S,height:R},O),pixelRatio:l,stretchX:_,stretchY:v,content:E,sdf:p,version:0})}else{if(void 0===t.width||void 0===t.height)return this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:R,data:O}=t,N=t;this.style.addImage(d,{data:new c.RGBAImage({width:S,height:R},new Uint8Array(O)),pixelRatio:l,stretchX:_,stretchY:v,content:E,sdf:p,version:0,userImage:N}),N.onAdd&&N.onAdd(this,d)}}}updateImage(d,t){const l=this.style.getImage(d);if(!l)return this.fire(new c.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof Fs||xa&&t instanceof xa?c.exported.getImageData(t):t,{width:_,height:v,data:E}=p;return void 0===_||void 0===v?this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):_!==l.data.width||v!==l.data.height?this.fire(new c.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(l.data.replace(E,!(t instanceof Fs||xa&&t instanceof xa)),void this.style.updateImage(d,l))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new c.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,t){c.getImage(this._requestManager.transformRequest(d,c.ResourceType.Image),(l,p)=>{t(l,p instanceof Fs?c.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(d,t){return this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)}moveLayer(d,t){return this.style.moveLayer(d,t),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,t,l){return this.style.setLayerZoomRange(d,t,l),this._update(!0)}setFilter(d,t,l={}){return this.style.setFilter(d,t,l),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,t,l,p={}){return this.style.setPaintProperty(d,t,l,p),this._update(!0)}getPaintProperty(d,t){return this.style.getPaintProperty(d,t)}setLayoutProperty(d,t,l,p={}){return this.style.setLayoutProperty(d,t,l,p),this._update(!0)}getLayoutProperty(d,t){return this.style.getLayoutProperty(d,t)}setLight(d,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.LngLat.convert(d),this.transform):0}setFeatureState(d,t){return this.style.setFeatureState(d,t),this._update()}removeFeatureState(d,t){return this.style.removeFeatureState(d,t),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_containerDimensions(){let d=0,t=0;return this._container&&(d=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300),[d,t]}_detectMissingCSS(){"rgb(250, 128, 114)"!==c.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&c.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=ze.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ze.create("div","mapboxgl-canvas-container",d);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=ze.create("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const l=this._containerDimensions();this._resizeCanvas(l[0],l[1]);const p=this._controlContainer=ze.create("div","mapboxgl-control-container",d),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{_[v]=ze.create("div",`mapboxgl-ctrl-${v}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t){const l=c.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(d),this._canvas.height=l*Math.ceil(t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const t=this._markers.indexOf(d);-1!==t&&this._markers.splice(t,1)}_setupPainter(){const d=c.extend({},Et.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);t?(c.storeAuthState(t,!0),this.painter=new Wc(t,this.transform),this.on("data",l=>{"source"===l.dataType&&this.painter.setTileLoadedFlag(!0)}),c.exported$1.testSupport(t)):this.fire(new c.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new c.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let t;const l=this.painter.context.extTimerQuery,p=c.exported.now();this.listens("gpu-timing-frame")&&(t=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,t));let _=this._updateAverageElevation(p);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;let v=!1;const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,O=this.transform.pitch,N=c.exported.now();this.style.zoomHistory.update(R,N);const V=new c.EvaluationParameters(R,{now:N,fadeDuration:E,pitch:O,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),X=V.crossFadingFactor();1===X&&X===this._crossFadingFactor||(v=!0,this._crossFadingFactor=X),this.style.update(V)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new c.Event("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const R=c.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,t),setTimeout(()=>{const O=l.getQueryObjectEXT(t,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(t),this.fire(new c.Event("gpu-timing-frame",{cpuTime:R,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(R);this.fire(new c.Event("gpu-timing-layer",{layerTimes:O}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(S||this._repaint)this.triggerRepaint();else{const R=!this.isMoving()&&this.loaded();if(R&&(_=this._updateAverageElevation(p,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new c.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new c.Event("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const d of this._markers)d._update()}_updateAverageElevation(d,t=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);if((t||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();isNaN(_)?_=0:this._averageElevationLastSampledAt=d;const v=Math.abs(p-_);if(v>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(_),l(_);this._averageElevation.easeTo(_,d,300)}else if(v>1e-4)return this._averageElevation.jumpTo(_),l(_)}return!!this._averageElevation.isEasing(d)&&l(this._averageElevation.getValue(d))}_authenticate(){c.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===c.AUTH_ERR_MSG||401===d.status)){const t=this.painter.context.gl;c.storeAuthState(t,!1),this._logoControl instanceof Zo&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),c.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function _(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);const E=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,E),E}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(d),t.canvasCopies.map(_),t.timeStamps)}_canvasPixelComparison(d,t,l){let p=l[1]-l[0];const _=d.length/4;for(let v=0;v<t.length;v++){const E=t[v];let S=0;for(let R=0;R<E.length;R+=4)E[R]===d[R]&&E[R+1]===d[R+1]&&E[R+2]===d[R+2]&&E[R+3]===d[R+3]&&(S+=1);p+=(l[v+2]-l[v+1])*(1-S/_)}return p}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.clearWorkerCaches(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==c.window&&(c.window.removeEventListener("resize",this._onWindowResize,!1),c.window.removeEventListener("orientationchange",this._onWindowResize,!1),c.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.removeEventListener("online",this._onWindowOnline,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),Gl(this._canvasContainer),Gl(this._controlContainer),Gl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),c.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new c.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=c.exported.frame(t=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(t)}))}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}_setCacheLimits(d,t){c.setCacheLimits(d,t)}get version(){return c.version}},NavigationControl:class{constructor(d){this.options=c.extend({},Lh,d),this._container=ze.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(c.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),ze.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),ze.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(c.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=ze.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const d=this._map.getZoom(),t=d===this._map.getMaxZoom(),l=d===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())}_rotateCompassArrow(){const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=d)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ze.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,t){const l=ze.create("button",d,this._container);return l.type="button",l.addEventListener("click",t),l}_setButtonTitle(d,t){const l=this._map._getUIString(`NavigationControl.${t}`);d.setAttribute("aria-label",l),d.firstElementChild&&d.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends c.Evented{constructor(d){super(),this.options=c.extend({},Nu,d),c.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Vl(this._updateMarkerRotation,20)}onAdd(d){var t;return this._map=d,this._container=ze.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,void 0!==Na?t(Na):void 0!==c.window.navigator.permissions?c.window.navigator.permissions.query({name:"geolocation"}).then(l=>{Na="denied"!==l.state,t(Na)}):(Na=!!c.window.navigator.geolocation,t(Na)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(c.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ze.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Kc=0,xc=!1}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),l=d.coords;return t&&(l.longitude<t.getWest()||l.longitude>t.getEast()||l.latitude<t.getSouth()||l.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new c.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(d),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("geolocate",d)),this._finish()}}_updateCamera(d){const t=new c.LngLat(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,p=this._map.getBearing(),_=c.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(l),_,{geolocateSource:!0})}_updateMarker(d){if(d){const t=new c.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map._container.getBoundingClientRect().height/2,t=this._map.unproject([0,d]),l=this._map.unproject([100,d]),p=t.distanceTo(l)/100,_=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(1===d.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===d.code&&xc)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=ze.create("button","mapboxgl-ctrl-geolocate",this._container),ze.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===d){c.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ze.create("div","mapboxgl-user-location"),this._dotElement.appendChild(ze.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ze.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Qi({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ze.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.Event("trackuserlocationend")))})}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:!0===d.absolute&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Kc--,xc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Kc++,Kc>1?(d={maximumAge:6e5,timeout:0},xc=!0):(d=this.options.positionOptions,xc=!1),this._geolocationWatchID=c.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else c.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{c.window.addEventListener("ondeviceorientationabsolute"in c.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==c.window.DeviceMotionEvent&&"function"==typeof c.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&d()}).catch(console.error):d()}_clearWatch(){c.window.navigator.geolocation.clearWatch(this._geolocationWatchID),c.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),c.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ho,ScaleControl:class{constructor(d){this.options=c.extend({},Ua,d),c.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Uu(this._map,this._container,this.options)}onAdd(d){return this._map=d,this._container=ze.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ze.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(d){this.options.unit=d,Uu(this._map,this._container,this.options)}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof c.window.HTMLElement?this._container=d.container:c.warnOnce("Full screen control 'container' must be a DOM element.")),c.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in c.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in c.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=ze.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){ze.remove(this._controlContainer),this._map=null,c.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!c.window.document.fullscreenEnabled&&!c.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=ze.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ze.create("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden",!0),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),c.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(c.window.document.fullscreenElement||c.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?c.window.document.exitFullscreen?c.window.document.exitFullscreen():c.window.document.webkitCancelFullScreen&&c.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends c.Evented{constructor(d){super(),this.options=c.extend(Object.create(Jc),d),c.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new c.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ze.remove(this._content),this._container&&(ze.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new c.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=c.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(c.window.document.createTextNode(d))}setHTML(d){const t=c.window.document.createDocumentFragment(),l=c.window.document.createElement("body");let p;for(l.innerHTML=d;p=l.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ze.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._container&&this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._container&&this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let t;return this._classList.delete(d)?t=!1:(this._classList.add(d),t=!0),this._container&&this._updateClassList(),t}_createCloseButton(){this.options.closeButton&&(this._closeButton=ze.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(d){this._update(d.point)}_onMouseMove(d){this._update(d.point)}_onDrag(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const t=this._pos,l=this._container.offsetWidth,p=this._container.offsetHeight;let _;return _=t.y+d.bottom.y<p?["top"]:t.y>this._map.transform.height-p?["bottom"]:[],t.x<l/2?_.push("left"):t.x>this._map.transform.width-l/2&&_.push("right"),0===_.length?"bottom":_.join("-")}_updateClassList(){const d=[...this._classList];d.push("mapboxgl-popup"),this._anchor&&d.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&d.push("mapboxgl-popup-track-pointer"),this._container.className=d.join(" ")}_update(d){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=ze.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=ze.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=go(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||d){const t=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat),l=function(v){if(v||(v=new c.pointGeometry(0,0)),"number"==typeof v){const E=Math.round(Math.sqrt(.5*Math.pow(v,2)));return{center:new c.pointGeometry(0,0),top:new c.pointGeometry(0,v),"top-left":new c.pointGeometry(E,E),"top-right":new c.pointGeometry(-E,E),bottom:new c.pointGeometry(0,-v),"bottom-left":new c.pointGeometry(E,-E),"bottom-right":new c.pointGeometry(-E,-E),left:new c.pointGeometry(v,0),right:new c.pointGeometry(-v,0)}}if(v instanceof c.pointGeometry||Array.isArray(v)){const E=c.pointGeometry.convert(v);return{center:E,top:E,"top-left":E,"top-right":E,bottom:E,"bottom-left":E,"bottom-right":E,left:E,right:E}}return{center:c.pointGeometry.convert(v.center||[0,0]),top:c.pointGeometry.convert(v.top||[0,0]),"top-left":c.pointGeometry.convert(v["top-left"]||[0,0]),"top-right":c.pointGeometry.convert(v["top-right"]||[0,0]),bottom:c.pointGeometry.convert(v.bottom||[0,0]),"bottom-left":c.pointGeometry.convert(v["bottom-left"]||[0,0]),"bottom-right":c.pointGeometry.convert(v["bottom-right"]||[0,0]),left:c.pointGeometry.convert(v.left||[0,0]),right:c.pointGeometry.convert(v.right||[0,0])}}(this.options.offset),p=this._anchor=this._getAnchor(l),_=t.add(l[p]).round();this._map._requestDomTask(()=>{this._container&&p&&ze.setTransform(this._container,`${_o[p]} translate(${_.x}px,${_.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Hl);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._content&&(this._content.style.opacity=d),this._tip&&(this._tip.style.opacity=d)}},Marker:Qi,Style:Ui,LngLat:c.LngLat,LngLatBounds:c.LngLatBounds,Point:c.pointGeometry,MercatorCoordinate:c.MercatorCoordinate,FreeCameraOptions:Bl,Evented:c.Evented,config:c.config,prewarm:function(){At().acquire(Ce)},clearPrewarmedResources:function(){const d=st;d&&(d.isPreloaded()&&1===d.numActive()?(d.release(Ce),st=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return c.config.ACCESS_TOKEN},set accessToken(d){c.config.ACCESS_TOKEN=d},get baseApiUrl(){return c.config.API_URL},set baseApiUrl(d){c.config.API_URL=d},get workerCount(){return Ue.workerCount},set workerCount(d){Ue.workerCount=d},get maxParallelImageRequests(){return c.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){c.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){c.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:c.exported.setNow,restoreNow:c.exported.restoreNow};return Zl}),ue}()},9105:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{y:()=>He});var ue=xe(5173),oe=xe(5414),Lt=xe(746),c=xe(7190);var Gt=xe(4288),je=xe(2908),ze=xe(9160);let He=(()=>{class it{constructor(hn){hn&&(this._subscribe=hn)}lift(hn){const Ot=new it;return Ot.source=this,Ot.operator=hn,Ot}subscribe(hn,Ot,pn){const on=function(it){return it&&it instanceof ue.Lv||function(it){return it&&(0,je.m)(it.next)&&(0,je.m)(it.error)&&(0,je.m)(it.complete)}(it)&&(0,oe.Nn)(it)}(hn)?hn:new ue.Hp(hn,Ot,pn);return(0,ze.x)(()=>{const{operator:zt,source:gt}=this;on.add(zt?zt.call(on,gt):gt?this._subscribe(on):this._trySubscribe(on))}),on}_trySubscribe(hn){try{return this._subscribe(hn)}catch(Ot){hn.error(Ot)}}forEach(hn,Ot){return new(Ot=mt(Ot))((pn,on)=>{let zt;zt=this.subscribe(gt=>{try{hn(gt)}catch(mn){on(mn),null==zt||zt.unsubscribe()}},on,pn)})}_subscribe(hn){var Ot;return null===(Ot=this.source)||void 0===Ot?void 0:Ot.subscribe(hn)}[Lt.L](){return this}pipe(...hn){return function(it){return 0===it.length?c.y:1===it.length?it[0]:function(hn){return it.reduce((Ot,pn)=>pn(Ot),hn)}}(hn)(this)}toPromise(hn){return new(hn=mt(hn))((Ot,pn)=>{let on;this.subscribe(zt=>on=zt,zt=>pn(zt),()=>Ot(on))})}}return it.create=Ut=>new it(Ut),it})();function mt(it){var Ut;return null!==(Ut=null!=it?it:Gt.v.Promise)&&void 0!==Ut?Ut:Promise}},7396:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{x:()=>Gt});var ue=xe(9105),oe=xe(5414);const c=(0,xe(6171).d)(ze=>function(){ze(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Et=xe(7487),an=xe(9160);let Gt=(()=>{class ze extends ue.y{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(mt){const Zt=new je(this,this);return Zt.operator=mt,Zt}_throwIfClosed(){if(this.closed)throw new c}next(mt){(0,an.x)(()=>{if(this._throwIfClosed(),!this.isStopped){const Zt=this.observers.slice();for(const Tn of Zt)Tn.next(mt)}})}error(mt){(0,an.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=mt;const{observers:Zt}=this;for(;Zt.length;)Zt.shift().error(mt)}})}complete(){(0,an.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:mt}=this;for(;mt.length;)mt.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var mt;return(null===(mt=this.observers)||void 0===mt?void 0:mt.length)>0}_trySubscribe(mt){return this._throwIfClosed(),super._trySubscribe(mt)}_subscribe(mt){return this._throwIfClosed(),this._checkFinalizedStatuses(mt),this._innerSubscribe(mt)}_innerSubscribe(mt){const{hasError:Zt,isStopped:Tn,observers:it}=this;return Zt||Tn?oe.Lc:(it.push(mt),new oe.w0(()=>(0,Et.P)(it,mt)))}_checkFinalizedStatuses(mt){const{hasError:Zt,thrownError:Tn,isStopped:it}=this;Zt?mt.error(Tn):it&&mt.complete()}asObservable(){const mt=new ue.y;return mt.source=this,mt}}return ze.create=(He,mt)=>new je(He,mt),ze})();class je extends Gt{constructor(He,mt){super(),this.destination=He,this.source=mt}next(He){var mt,Zt;null===(Zt=null===(mt=this.destination)||void 0===mt?void 0:mt.next)||void 0===Zt||Zt.call(mt,He)}error(He){var mt,Zt;null===(Zt=null===(mt=this.destination)||void 0===mt?void 0:mt.error)||void 0===Zt||Zt.call(mt,He)}complete(){var He,mt;null===(mt=null===(He=this.destination)||void 0===He?void 0:He.complete)||void 0===mt||mt.call(He)}_subscribe(He){var mt,Zt;return null!==(Zt=null===(mt=this.source)||void 0===mt?void 0:mt.subscribe(He))&&void 0!==Zt?Zt:oe.Lc}}},5173:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{Hp:()=>Tn,Lv:()=>Zt});var ue=xe(2908),oe=xe(5414),Lt=xe(4288),c=xe(7050),Et=xe(1261);const an=ze("C",void 0,void 0);function ze(pn,on,zt){return{kind:pn,value:on,error:zt}}var He=xe(6494),mt=xe(9160);class Zt extends oe.w0{constructor(on){super(),this.isStopped=!1,on?(this.destination=on,(0,oe.Nn)(on)&&on.add(this)):this.destination=Ot}static create(on,zt,gt){return new Tn(on,zt,gt)}next(on){this.isStopped?hn(ze("N",on,void 0),this):this._next(on)}error(on){this.isStopped?hn(ze("E",void 0,on),this):(this.isStopped=!0,this._error(on))}complete(){this.isStopped?hn(an,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(on){this.destination.next(on)}_error(on){try{this.destination.error(on)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class Tn extends Zt{constructor(on,zt,gt){let mn;if(super(),(0,ue.m)(on))mn=on;else if(on){let Fn;({next:mn,error:zt,complete:gt}=on),this&&Lt.v.useDeprecatedNextContext?(Fn=Object.create(on),Fn.unsubscribe=()=>this.unsubscribe()):Fn=on,mn=null==mn?void 0:mn.bind(Fn),zt=null==zt?void 0:zt.bind(Fn),gt=null==gt?void 0:gt.bind(Fn)}this.destination={next:mn?it(mn):Et.Z,error:it(null!=zt?zt:Ut),complete:gt?it(gt):Et.Z}}}function it(pn,on){return(...zt)=>{try{pn(...zt)}catch(gt){Lt.v.useDeprecatedSynchronousErrorHandling?(0,mt.O)(gt):(0,c.h)(gt)}}}function Ut(pn){throw pn}function hn(pn,on){const{onStoppedNotification:zt}=Lt.v;zt&&He.z.setTimeout(()=>zt(pn,on))}const Ot={closed:!0,next:Et.Z,error:Ut,complete:Et.Z}},5414:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{Lc:()=>an,w0:()=>Et,Nn:()=>Gt});var ue=xe(2908);const Lt=(0,xe(6171).d)(ze=>function(mt){ze(this),this.message=mt?`${mt.length} errors occurred during unsubscription:\n${mt.map((Zt,Tn)=>`${Tn+1}) ${Zt.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=mt});var c=xe(7487);class Et{constructor(He){this.initialTeardown=He,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let He;if(!this.closed){this.closed=!0;const{_parentage:mt}=this;if(mt)if(this._parentage=null,Array.isArray(mt))for(const it of mt)it.remove(this);else mt.remove(this);const{initialTeardown:Zt}=this;if((0,ue.m)(Zt))try{Zt()}catch(it){He=it instanceof Lt?it.errors:[it]}const{_teardowns:Tn}=this;if(Tn){this._teardowns=null;for(const it of Tn)try{je(it)}catch(Ut){He=null!=He?He:[],Ut instanceof Lt?He=[...He,...Ut.errors]:He.push(Ut)}}if(He)throw new Lt(He)}}add(He){var mt;if(He&&He!==this)if(this.closed)je(He);else{if(He instanceof Et){if(He.closed||He._hasParent(this))return;He._addParent(this)}(this._teardowns=null!==(mt=this._teardowns)&&void 0!==mt?mt:[]).push(He)}}_hasParent(He){const{_parentage:mt}=this;return mt===He||Array.isArray(mt)&&mt.includes(He)}_addParent(He){const{_parentage:mt}=this;this._parentage=Array.isArray(mt)?(mt.push(He),mt):mt?[mt,He]:He}_removeParent(He){const{_parentage:mt}=this;mt===He?this._parentage=null:Array.isArray(mt)&&(0,c.P)(mt,He)}remove(He){const{_teardowns:mt}=this;mt&&(0,c.P)(mt,He),He instanceof Et&&He._removeParent(this)}}Et.EMPTY=(()=>{const ze=new Et;return ze.closed=!0,ze})();const an=Et.EMPTY;function Gt(ze){return ze instanceof Et||ze&&"closed"in ze&&(0,ue.m)(ze.remove)&&(0,ue.m)(ze.add)&&(0,ue.m)(ze.unsubscribe)}function je(ze){(0,ue.m)(ze)?ze():ze.unsubscribe()}},4288:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{v:()=>ue});const ue={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},5514:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{z:()=>Et});var ue=xe(6007),Lt=xe(4810),c=xe(6658);function Et(...an){return(0,ue.J)(1)((0,c.D)(an,(0,Lt.yG)(an)))}},3703:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{E:()=>oe});const oe=new(xe(9105).y)(Et=>Et.complete())},6658:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{D:()=>gn});var ue=xe(5823),oe=xe(7596),Lt=xe(5711),c=xe(9817);function Et(dn,Ht=0){return(0,Lt.e)((Re,$e)=>{Re.subscribe(new c.Q($e,tt=>(0,oe.f)($e,dn,()=>$e.next(tt),Ht),()=>(0,oe.f)($e,dn,()=>$e.complete(),Ht),tt=>(0,oe.f)($e,dn,()=>$e.error(tt),Ht)))})}function an(dn,Ht=0){return(0,Lt.e)((Re,$e)=>{$e.add(dn.schedule(()=>Re.subscribe($e),Ht))})}var ze=xe(9105),mt=xe(818),Zt=xe(2908);function it(dn,Ht){if(!dn)throw new Error("Iterable cannot be null");return new ze.y(Re=>{(0,oe.f)(Re,Ht,()=>{const $e=dn[Symbol.asyncIterator]();(0,oe.f)(Re,Ht,()=>{$e.next().then(tt=>{tt.done?Re.complete():Re.next(tt.value)})},0,!0)})})}var Ut=xe(3746),hn=xe(7516),Ot=xe(3472),pn=xe(9203),on=xe(3135),zt=xe(454),gt=xe(6537);function gn(dn,Ht){return Ht?function(dn,Ht){if(null!=dn){if((0,Ut.c)(dn))return function(dn,Ht){return(0,ue.Xf)(dn).pipe(an(Ht),Et(Ht))}(dn,Ht);if((0,Ot.z)(dn))return function(dn,Ht){return new ze.y(Re=>{let $e=0;return Ht.schedule(function(){$e===dn.length?Re.complete():(Re.next(dn[$e++]),Re.closed||this.schedule())})})}(dn,Ht);if((0,hn.t)(dn))return function(dn,Ht){return(0,ue.Xf)(dn).pipe(an(Ht),Et(Ht))}(dn,Ht);if((0,on.D)(dn))return it(dn,Ht);if((0,pn.T)(dn))return function(dn,Ht){return new ze.y(Re=>{let $e;return(0,oe.f)(Re,Ht,()=>{$e=dn[mt.h](),(0,oe.f)(Re,Ht,()=>{let tt,lt;try{({value:tt,done:lt}=$e.next())}catch(Pt){return void Re.error(Pt)}lt?Re.complete():Re.next(tt)},0,!0)}),()=>(0,Zt.m)(null==$e?void 0:$e.return)&&$e.return()})}(dn,Ht);if((0,gt.L)(dn))return function(dn,Ht){return it((0,gt.Q)(dn),Ht)}(dn,Ht)}throw(0,zt.z)(dn)}(dn,Ht):(0,ue.Xf)(dn)}},5823:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{Xf:()=>Tn});var ue=xe(6086),oe=xe(3472),Lt=xe(7516),c=xe(9105),Et=xe(3746),an=xe(3135),Gt=xe(454),je=xe(9203),ze=xe(6537),He=xe(2908),mt=xe(7050),Zt=xe(746);function Tn(gt){if(gt instanceof c.y)return gt;if(null!=gt){if((0,Et.c)(gt))return function(gt){return new c.y(mn=>{const Fn=gt[Zt.L]();if((0,He.m)(Fn.subscribe))return Fn.subscribe(mn);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(gt);if((0,oe.z)(gt))return function(gt){return new c.y(mn=>{for(let Fn=0;Fn<gt.length&&!mn.closed;Fn++)mn.next(gt[Fn]);mn.complete()})}(gt);if((0,Lt.t)(gt))return function(gt){return new c.y(mn=>{gt.then(Fn=>{mn.closed||(mn.next(Fn),mn.complete())},Fn=>mn.error(Fn)).then(null,mt.h)})}(gt);if((0,an.D)(gt))return pn(gt);if((0,je.T)(gt))return function(gt){return new c.y(mn=>{for(const Fn of gt)if(mn.next(Fn),mn.closed)return;mn.complete()})}(gt);if((0,ze.L)(gt))return function(gt){return pn((0,ze.Q)(gt))}(gt)}throw(0,Gt.z)(gt)}function pn(gt){return new c.y(mn=>{(function(gt,mn){var Fn,gn,dn,Ht;return(0,ue.mG)(this,void 0,void 0,function*(){try{for(Fn=(0,ue.KL)(gt);!(gn=yield Fn.next()).done;)if(mn.next(gn.value),mn.closed)return}catch(Re){dn={error:Re}}finally{try{gn&&!gn.done&&(Ht=Fn.return)&&(yield Ht.call(Fn))}finally{if(dn)throw dn.error}}mn.complete()})})(gt,mn).catch(Fn=>mn.error(Fn))})}},1680:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{of:()=>Lt});var ue=xe(4810),oe=xe(6658);function Lt(...c){const Et=(0,ue.yG)(c);return(0,oe.D)(c,Et)}},9817:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{Q:()=>oe});var ue=xe(5173);class oe extends ue.Lv{constructor(c,Et,an,Gt,je){super(c),this.onFinalize=je,this._next=Et?function(ze){try{Et(ze)}catch(He){c.error(He)}}:super._next,this._error=Gt?function(ze){try{Gt(ze)}catch(He){c.error(He)}finally{this.unsubscribe()}}:super._error,this._complete=an?function(){try{an()}catch(ze){c.error(ze)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var c;const{closed:Et}=this;super.unsubscribe(),!Et&&(null===(c=this.onFinalize)||void 0===c||c.call(this))}}},8475:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{b:()=>Lt});var ue=xe(9964),oe=xe(2908);function Lt(c,Et){return(0,oe.m)(Et)?(0,ue.z)(c,Et,1):(0,ue.z)(c,1)}},181:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{h:()=>Lt});var ue=xe(5711),oe=xe(9817);function Lt(c,Et){return(0,ue.e)((an,Gt)=>{let je=0;an.subscribe(new oe.Q(Gt,ze=>c.call(Et,ze,je++)&&Gt.next(ze)))})}},2201:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{U:()=>Lt});var ue=xe(5711),oe=xe(9817);function Lt(c,Et){return(0,ue.e)((an,Gt)=>{let je=0;an.subscribe(new oe.Q(Gt,ze=>{Gt.next(c.call(Et,ze,je++))}))})}},6007:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{J:()=>Lt});var ue=xe(9964),oe=xe(7190);function Lt(c=1/0){return(0,ue.z)(oe.y,c)}},9964:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{z:()=>je});var ue=xe(2201),oe=xe(5823),Lt=xe(5711),Et=(xe(7596),xe(9817)),Gt=xe(2908);function je(ze,He,mt=1/0){return(0,Gt.m)(He)?je((Zt,Tn)=>(0,ue.U)((it,Ut)=>He(Zt,it,Tn,Ut))((0,oe.Xf)(ze(Zt,Tn))),mt):("number"==typeof He&&(mt=He),(0,Lt.e)((Zt,Tn)=>function(ze,He,mt,Zt,Tn,it,Ut,hn){const Ot=[];let pn=0,on=0,zt=!1;const gt=()=>{zt&&!Ot.length&&!pn&&He.complete()},mn=gn=>pn<Zt?Fn(gn):Ot.push(gn),Fn=gn=>{pn++;let dn=!1;(0,oe.Xf)(mt(gn,on++)).subscribe(new Et.Q(He,Ht=>{He.next(Ht)},()=>{dn=!0},void 0,()=>{if(dn)try{for(pn--;Ot.length&&pn<Zt;){const Ht=Ot.shift();Fn(Ht)}gt()}catch(Ht){He.error(Ht)}}))};return ze.subscribe(new Et.Q(He,mn,()=>{zt=!0,gt()})),()=>{}}(Zt,Tn,ze,mt)))}},3453:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{q:()=>c});var ue=xe(3703),oe=xe(5711),Lt=xe(9817);function c(Et){return Et<=0?()=>ue.E:(0,oe.e)((an,Gt)=>{let je=0;an.subscribe(new Lt.Q(Gt,ze=>{++je<=Et&&(Gt.next(ze),Et<=je&&Gt.complete())}))})}},6801:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{b:()=>Et});var ue=xe(2908),oe=xe(5711),Lt=xe(9817),c=xe(7190);function Et(an,Gt,je){const ze=(0,ue.m)(an)||Gt||je?{next:an,error:Gt,complete:je}:an;return ze?(0,oe.e)((He,mt)=>{var Zt;null===(Zt=ze.subscribe)||void 0===Zt||Zt.call(ze);let Tn=!0;He.subscribe(new Lt.Q(mt,it=>{var Ut;null===(Ut=ze.next)||void 0===Ut||Ut.call(ze,it),mt.next(it)},()=>{var it;Tn=!1,null===(it=ze.complete)||void 0===it||it.call(ze),mt.complete()},it=>{var Ut;Tn=!1,null===(Ut=ze.error)||void 0===Ut||Ut.call(ze,it),mt.error(it)},()=>{var it,Ut;Tn&&(null===(it=ze.unsubscribe)||void 0===it||it.call(ze)),null===(Ut=ze.finalize)||void 0===Ut||Ut.call(ze)}))}):c.y}},6494:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{z:()=>ue});const ue={setTimeout(...oe){const{delegate:Lt}=ue;return((null==Lt?void 0:Lt.setTimeout)||setTimeout)(...oe)},clearTimeout(oe){const{delegate:Lt}=ue;return((null==Lt?void 0:Lt.clearTimeout)||clearTimeout)(oe)},delegate:void 0}},818:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{h:()=>oe});const oe="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"},746:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{L:()=>ue});const ue="function"==typeof Symbol&&Symbol.observable||"@@observable"},4810:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{jO:()=>c,yG:()=>Et,_6:()=>an});var ue=xe(2908),oe=xe(5766);function Lt(Gt){return Gt[Gt.length-1]}function c(Gt){return(0,ue.m)(Lt(Gt))?Gt.pop():void 0}function Et(Gt){return(0,oe.K)(Lt(Gt))?Gt.pop():void 0}function an(Gt,je){return"number"==typeof Lt(Gt)?Gt.pop():je}},7487:(yn,Ct,xe)=>{"use strict";function ue(oe,Lt){if(oe){const c=oe.indexOf(Lt);0<=c&&oe.splice(c,1)}}xe.d(Ct,{P:()=>ue})},6171:(yn,Ct,xe)=>{"use strict";function ue(oe){const c=oe(Et=>{Error.call(Et),Et.stack=(new Error).stack});return c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c}xe.d(Ct,{d:()=>ue})},9160:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{x:()=>Lt,O:()=>c});var ue=xe(4288);let oe=null;function Lt(Et){if(ue.v.useDeprecatedSynchronousErrorHandling){const an=!oe;if(an&&(oe={errorThrown:!1,error:null}),Et(),an){const{errorThrown:Gt,error:je}=oe;if(oe=null,Gt)throw je}}else Et()}function c(Et){ue.v.useDeprecatedSynchronousErrorHandling&&oe&&(oe.errorThrown=!0,oe.error=Et)}},7596:(yn,Ct,xe)=>{"use strict";function ue(oe,Lt,c,Et=0,an=!1){const Gt=Lt.schedule(function(){c(),an?oe.add(this.schedule(null,Et)):this.unsubscribe()},Et);if(oe.add(Gt),!an)return Gt}xe.d(Ct,{f:()=>ue})},7190:(yn,Ct,xe)=>{"use strict";function ue(oe){return oe}xe.d(Ct,{y:()=>ue})},3472:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{z:()=>ue});const ue=oe=>oe&&"number"==typeof oe.length&&"function"!=typeof oe},3135:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{D:()=>oe});var ue=xe(2908);function oe(Lt){return Symbol.asyncIterator&&(0,ue.m)(null==Lt?void 0:Lt[Symbol.asyncIterator])}},2908:(yn,Ct,xe)=>{"use strict";function ue(oe){return"function"==typeof oe}xe.d(Ct,{m:()=>ue})},3746:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{c:()=>Lt});var ue=xe(746),oe=xe(2908);function Lt(c){return(0,oe.m)(c[ue.L])}},9203:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{T:()=>Lt});var ue=xe(818),oe=xe(2908);function Lt(c){return(0,oe.m)(null==c?void 0:c[ue.h])}},7516:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{t:()=>oe});var ue=xe(2908);function oe(Lt){return(0,ue.m)(null==Lt?void 0:Lt.then)}},6537:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{Q:()=>Lt,L:()=>c});var ue=xe(6086),oe=xe(2908);function Lt(Et){return(0,ue.FC)(this,arguments,function*(){const Gt=Et.getReader();try{for(;;){const{value:je,done:ze}=yield(0,ue.qq)(Gt.read());if(ze)return yield(0,ue.qq)(void 0);yield yield(0,ue.qq)(je)}}finally{Gt.releaseLock()}})}function c(Et){return(0,oe.m)(null==Et?void 0:Et.getReader)}},5766:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{K:()=>oe});var ue=xe(2908);function oe(Lt){return Lt&&(0,ue.m)(Lt.schedule)}},5711:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{A:()=>oe,e:()=>Lt});var ue=xe(2908);function oe(c){return(0,ue.m)(null==c?void 0:c.lift)}function Lt(c){return Et=>{if(oe(Et))return Et.lift(function(an){try{return c(an,this)}catch(Gt){this.error(Gt)}});throw new TypeError("Unable to lift unknown Observable type")}}},1261:(yn,Ct,xe)=>{"use strict";function ue(){}xe.d(Ct,{Z:()=>ue})},7050:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{h:()=>Lt});var ue=xe(4288),oe=xe(6494);function Lt(c){oe.z.setTimeout(()=>{const{onUnhandledError:Et}=ue.v;if(!Et)throw c;Et(c)})}},454:(yn,Ct,xe)=>{"use strict";function ue(oe){return new TypeError(`You provided ${null!==oe&&"object"==typeof oe?"an invalid object":`'${oe}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}xe.d(Ct,{z:()=>ue})},1251:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{N:()=>ue});const ue={production:!0,mapboxToken:"pk.eyJ1IjoiZ2FicmllbGRwMzYiLCJhIjoiY2t4MHU3cDUwMThmdzJucW9sZGdvM3hlNCJ9.vdkzt1gS39JOVZF2hVgoAg"}},3481:(yn,Ct,xe)=>{"use strict";var ue=xe(6019),oe=xe(3019);class Lt extends ue.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class c extends Lt{static makeCurrent(){(0,ue.HT)(new c)}onAndCancel(ye,ae,ke){return ye.addEventListener(ae,ke,!1),()=>{ye.removeEventListener(ae,ke,!1)}}dispatchEvent(ye,ae){ye.dispatchEvent(ae)}remove(ye){ye.parentNode&&ye.parentNode.removeChild(ye)}createElement(ye,ae){return(ae=ae||this.getDefaultDocument()).createElement(ye)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(ye){return ye.nodeType===Node.ELEMENT_NODE}isShadowRoot(ye){return ye instanceof DocumentFragment}getGlobalEventTarget(ye,ae){return"window"===ae?window:"document"===ae?ye:"body"===ae?ye.body:null}getBaseHref(ye){const ae=(Et=Et||document.querySelector("base"),Et?Et.getAttribute("href"):null);return null==ae?null:function(te){Gt=Gt||document.createElement("a"),Gt.setAttribute("href",te);const ye=Gt.pathname;return"/"===ye.charAt(0)?ye:`/${ye}`}(ae)}resetBaseElement(){Et=null}getUserAgent(){return window.navigator.userAgent}getCookie(ye){return(0,ue.Mx)(document.cookie,ye)}}let Gt,Et=null;const ze=new oe.OlP("TRANSITION_ID"),mt=[{provide:oe.ip1,useFactory:function(te,ye,ae){return()=>{ae.get(oe.CZH).donePromise.then(()=>{const ke=(0,ue.q)(),qe=ye.querySelectorAll(`style[ng-transition="${te}"]`);for(let Rt=0;Rt<qe.length;Rt++)ke.remove(qe[Rt])})}},deps:[ze,ue.K0,oe.zs3],multi:!0}];class Zt{static init(){(0,oe.VLi)(new Zt)}addToWindow(ye){oe.dqk.getAngularTestability=(ke,qe=!0)=>{const Rt=ye.findTestabilityInTree(ke,qe);if(null==Rt)throw new Error("Could not find testability for element.");return Rt},oe.dqk.getAllAngularTestabilities=()=>ye.getAllTestabilities(),oe.dqk.getAllAngularRootElements=()=>ye.getAllRootElements(),oe.dqk.frameworkStabilizers||(oe.dqk.frameworkStabilizers=[]),oe.dqk.frameworkStabilizers.push(ke=>{const qe=oe.dqk.getAllAngularTestabilities();let Rt=qe.length,xn=!1;const Mt=function(Xe){xn=xn||Xe,Rt--,0==Rt&&ke(xn)};qe.forEach(function(Xe){Xe.whenStable(Mt)})})}findTestabilityInTree(ye,ae,ke){if(null==ae)return null;const qe=ye.getTestability(ae);return null!=qe?qe:ke?(0,ue.q)().isShadowRoot(ae)?this.findTestabilityInTree(ye,ae.host,!0):this.findTestabilityInTree(ye,ae.parentElement,!0):null}}let Tn=(()=>{class te{build(){return new XMLHttpRequest}}return te.\u0275fac=function(ae){return new(ae||te)},te.\u0275prov=oe.Yz7({token:te,factory:te.\u0275fac}),te})();const it=new oe.OlP("EventManagerPlugins");let Ut=(()=>{class te{constructor(ae,ke){this._zone=ke,this._eventNameToPlugin=new Map,ae.forEach(qe=>qe.manager=this),this._plugins=ae.slice().reverse()}addEventListener(ae,ke,qe){return this._findPluginFor(ke).addEventListener(ae,ke,qe)}addGlobalEventListener(ae,ke,qe){return this._findPluginFor(ke).addGlobalEventListener(ae,ke,qe)}getZone(){return this._zone}_findPluginFor(ae){const ke=this._eventNameToPlugin.get(ae);if(ke)return ke;const qe=this._plugins;for(let Rt=0;Rt<qe.length;Rt++){const xn=qe[Rt];if(xn.supports(ae))return this._eventNameToPlugin.set(ae,xn),xn}throw new Error(`No event manager plugin found for event ${ae}`)}}return te.\u0275fac=function(ae){return new(ae||te)(oe.LFG(it),oe.LFG(oe.R0b))},te.\u0275prov=oe.Yz7({token:te,factory:te.\u0275fac}),te})();class hn{constructor(ye){this._doc=ye}addGlobalEventListener(ye,ae,ke){const qe=(0,ue.q)().getGlobalEventTarget(this._doc,ye);if(!qe)throw new Error(`Unsupported event target ${qe} for event ${ae}`);return this.addEventListener(qe,ae,ke)}}let Ot=(()=>{class te{constructor(){this._stylesSet=new Set}addStyles(ae){const ke=new Set;ae.forEach(qe=>{this._stylesSet.has(qe)||(this._stylesSet.add(qe),ke.add(qe))}),this.onStylesAdded(ke)}onStylesAdded(ae){}getAllStyles(){return Array.from(this._stylesSet)}}return te.\u0275fac=function(ae){return new(ae||te)},te.\u0275prov=oe.Yz7({token:te,factory:te.\u0275fac}),te})(),pn=(()=>{class te extends Ot{constructor(ae){super(),this._doc=ae,this._hostNodes=new Map,this._hostNodes.set(ae.head,[])}_addStylesToHost(ae,ke,qe){ae.forEach(Rt=>{const xn=this._doc.createElement("style");xn.textContent=Rt,qe.push(ke.appendChild(xn))})}addHost(ae){const ke=[];this._addStylesToHost(this._stylesSet,ae,ke),this._hostNodes.set(ae,ke)}removeHost(ae){const ke=this._hostNodes.get(ae);ke&&ke.forEach(on),this._hostNodes.delete(ae)}onStylesAdded(ae){this._hostNodes.forEach((ke,qe)=>{this._addStylesToHost(ae,qe,ke)})}ngOnDestroy(){this._hostNodes.forEach(ae=>ae.forEach(on))}}return te.\u0275fac=function(ae){return new(ae||te)(oe.LFG(ue.K0))},te.\u0275prov=oe.Yz7({token:te,factory:te.\u0275fac}),te})();function on(te){(0,ue.q)().remove(te)}const zt={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},gt=/%COMP%/g;function $e(te,ye,ae){for(let ke=0;ke<ye.length;ke++){let qe=ye[ke];Array.isArray(qe)?$e(te,qe,ae):(qe=qe.replace(gt,te),ae.push(qe))}return ae}function tt(te){return ye=>{if("__ngUnwrap__"===ye)return te;!1===te(ye)&&(ye.preventDefault(),ye.returnValue=!1)}}let Pt=(()=>{class te{constructor(ae,ke,qe){this.eventManager=ae,this.sharedStylesHost=ke,this.appId=qe,this.rendererByCompId=new Map,this.defaultRenderer=new Ye(ae)}createRenderer(ae,ke){if(!ae||!ke)return this.defaultRenderer;switch(ke.encapsulation){case oe.ifc.Emulated:{let qe=this.rendererByCompId.get(ke.id);return qe||(qe=new Er(this.eventManager,this.sharedStylesHost,ke,this.appId),this.rendererByCompId.set(ke.id,qe)),qe.applyToHost(ae),qe}case 1:case oe.ifc.ShadowDom:return new nn(this.eventManager,this.sharedStylesHost,ae,ke);default:if(!this.rendererByCompId.has(ke.id)){const qe=$e(ke.id,ke.styles,[]);this.sharedStylesHost.addStyles(qe),this.rendererByCompId.set(ke.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return te.\u0275fac=function(ae){return new(ae||te)(oe.LFG(Ut),oe.LFG(pn),oe.LFG(oe.AFp))},te.\u0275prov=oe.Yz7({token:te,factory:te.\u0275fac}),te})();class Ye{constructor(ye){this.eventManager=ye,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(ye,ae){return ae?document.createElementNS(zt[ae]||ae,ye):document.createElement(ye)}createComment(ye){return document.createComment(ye)}createText(ye){return document.createTextNode(ye)}appendChild(ye,ae){ye.appendChild(ae)}insertBefore(ye,ae,ke){ye&&ye.insertBefore(ae,ke)}removeChild(ye,ae){ye&&ye.removeChild(ae)}selectRootElement(ye,ae){let ke="string"==typeof ye?document.querySelector(ye):ye;if(!ke)throw new Error(`The selector "${ye}" did not match any elements`);return ae||(ke.textContent=""),ke}parentNode(ye){return ye.parentNode}nextSibling(ye){return ye.nextSibling}setAttribute(ye,ae,ke,qe){if(qe){ae=qe+":"+ae;const Rt=zt[qe];Rt?ye.setAttributeNS(Rt,ae,ke):ye.setAttribute(ae,ke)}else ye.setAttribute(ae,ke)}removeAttribute(ye,ae,ke){if(ke){const qe=zt[ke];qe?ye.removeAttributeNS(qe,ae):ye.removeAttribute(`${ke}:${ae}`)}else ye.removeAttribute(ae)}addClass(ye,ae){ye.classList.add(ae)}removeClass(ye,ae){ye.classList.remove(ae)}setStyle(ye,ae,ke,qe){qe&(oe.JOm.DashCase|oe.JOm.Important)?ye.style.setProperty(ae,ke,qe&oe.JOm.Important?"important":""):ye.style[ae]=ke}removeStyle(ye,ae,ke){ke&oe.JOm.DashCase?ye.style.removeProperty(ae):ye.style[ae]=""}setProperty(ye,ae,ke){ye[ae]=ke}setValue(ye,ae){ye.nodeValue=ae}listen(ye,ae,ke){return"string"==typeof ye?this.eventManager.addGlobalEventListener(ye,ae,tt(ke)):this.eventManager.addEventListener(ye,ae,tt(ke))}}class Er extends Ye{constructor(ye,ae,ke,qe){super(ye),this.component=ke;const Rt=$e(qe+"-"+ke.id,ke.styles,[]);ae.addStyles(Rt),this.contentAttr="_ngcontent-%COMP%".replace(gt,qe+"-"+ke.id),this.hostAttr="_nghost-%COMP%".replace(gt,qe+"-"+ke.id)}applyToHost(ye){super.setAttribute(ye,this.hostAttr,"")}createElement(ye,ae){const ke=super.createElement(ye,ae);return super.setAttribute(ke,this.contentAttr,""),ke}}class nn extends Ye{constructor(ye,ae,ke,qe){super(ye),this.sharedStylesHost=ae,this.hostEl=ke,this.shadowRoot=ke.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const Rt=$e(qe.id,qe.styles,[]);for(let xn=0;xn<Rt.length;xn++){const Mt=document.createElement("style");Mt.textContent=Rt[xn],this.shadowRoot.appendChild(Mt)}}nodeOrShadowRoot(ye){return ye===this.hostEl?this.shadowRoot:ye}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(ye,ae){return super.appendChild(this.nodeOrShadowRoot(ye),ae)}insertBefore(ye,ae,ke){return super.insertBefore(this.nodeOrShadowRoot(ye),ae,ke)}removeChild(ye,ae){return super.removeChild(this.nodeOrShadowRoot(ye),ae)}parentNode(ye){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(ye)))}}let Wn=(()=>{class te extends hn{constructor(ae){super(ae)}supports(ae){return!0}addEventListener(ae,ke,qe){return ae.addEventListener(ke,qe,!1),()=>this.removeEventListener(ae,ke,qe)}removeEventListener(ae,ke,qe){return ae.removeEventListener(ke,qe)}}return te.\u0275fac=function(ae){return new(ae||te)(oe.LFG(ue.K0))},te.\u0275prov=oe.Yz7({token:te,factory:te.\u0275fac}),te})();const zi=["alt","control","meta","shift"],Nr={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Wr={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},kn={alt:te=>te.altKey,control:te=>te.ctrlKey,meta:te=>te.metaKey,shift:te=>te.shiftKey};let Wi=(()=>{class te extends hn{constructor(ae){super(ae)}supports(ae){return null!=te.parseEventName(ae)}addEventListener(ae,ke,qe){const Rt=te.parseEventName(ke),xn=te.eventCallback(Rt.fullKey,qe,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,ue.q)().onAndCancel(ae,Rt.domEventName,xn))}static parseEventName(ae){const ke=ae.toLowerCase().split("."),qe=ke.shift();if(0===ke.length||"keydown"!==qe&&"keyup"!==qe)return null;const Rt=te._normalizeKey(ke.pop());let xn="";if(zi.forEach(Xe=>{const rn=ke.indexOf(Xe);rn>-1&&(ke.splice(rn,1),xn+=Xe+".")}),xn+=Rt,0!=ke.length||0===Rt.length)return null;const Mt={};return Mt.domEventName=qe,Mt.fullKey=xn,Mt}static getEventFullKey(ae){let ke="",qe=function(te){let ye=te.key;if(null==ye){if(ye=te.keyIdentifier,null==ye)return"Unidentified";ye.startsWith("U+")&&(ye=String.fromCharCode(parseInt(ye.substring(2),16)),3===te.location&&Wr.hasOwnProperty(ye)&&(ye=Wr[ye]))}return Nr[ye]||ye}(ae);return qe=qe.toLowerCase()," "===qe?qe="space":"."===qe&&(qe="dot"),zi.forEach(Rt=>{Rt!=qe&&kn[Rt](ae)&&(ke+=Rt+".")}),ke+=qe,ke}static eventCallback(ae,ke,qe){return Rt=>{te.getEventFullKey(Rt)===ae&&qe.runGuarded(()=>ke(Rt))}}static _normalizeKey(ae){return"esc"===ae?"escape":ae}}return te.\u0275fac=function(ae){return new(ae||te)(oe.LFG(ue.K0))},te.\u0275prov=oe.Yz7({token:te,factory:te.\u0275fac}),te})();const jn=(0,oe.eFA)(oe._c5,"browser",[{provide:oe.Lbi,useValue:ue.bD},{provide:oe.g9A,useValue:function(){c.makeCurrent(),Zt.init()},multi:!0},{provide:ue.K0,useFactory:function(){return(0,oe.RDi)(document),document},deps:[]}]),xi=[{provide:oe.zSh,useValue:"root"},{provide:oe.qLn,useFactory:function(){return new oe.qLn},deps:[]},{provide:it,useClass:Wn,multi:!0,deps:[ue.K0,oe.R0b,oe.Lbi]},{provide:it,useClass:Wi,multi:!0,deps:[ue.K0]},{provide:Pt,useClass:Pt,deps:[Ut,pn,oe.AFp]},{provide:oe.FYo,useExisting:Pt},{provide:Ot,useExisting:pn},{provide:pn,useClass:pn,deps:[ue.K0]},{provide:oe.dDg,useClass:oe.dDg,deps:[oe.R0b]},{provide:Ut,useClass:Ut,deps:[it,oe.R0b]},{provide:ue.JF,useClass:Tn,deps:[]}];let $n=(()=>{class te{constructor(ae){if(ae)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(ae){return{ngModule:te,providers:[{provide:oe.AFp,useValue:ae.appId},{provide:ze,useExisting:oe.AFp},mt]}}}return te.\u0275fac=function(ae){return new(ae||te)(oe.LFG(te,12))},te.\u0275mod=oe.oAB({type:te}),te.\u0275inj=oe.cJS({providers:xi,imports:[ue.ez,oe.hGG]}),te})();"undefined"!=typeof window&&window;var Ee=xe(4522),Le=xe(4739);const Be=[{path:"mapas",loadChildren:()=>xe.e(630).then(xe.bind(xe,6630)).then(te=>te.MapasModule)},{path:"**",redirectTo:"mapas"}];let Ce=(()=>{class te{}return te.\u0275fac=function(ae){return new(ae||te)},te.\u0275mod=oe.oAB({type:te}),te.\u0275inj=oe.cJS({imports:[[Le.Bz.forRoot(Be)],Le.Bz]}),te})();var Ue=xe(1251),st=xe(401);const At=function(te){return[te]};function ct(te,ye){if(1&te&&(oe.TgZ(0,"li",2),oe._uU(1),oe.qZA()),2&te){const ae=ye.$implicit;oe.Q6J("routerLink",oe.VKq(2,At,ae.ruta)),oe.xp6(1),oe.hij(" ",ae.nombre," ")}}let tn=(()=>{class te{constructor(){this.menu=[{nombre:"Geolocalizaci\xf3n",ruta:"./mapas/fullscreen"},{nombre:"Zoom",ruta:"./mapas/zoom-range"},{nombre:"Marcadores",ruta:"./mapas/marcadores"},{nombre:"Propiedades",ruta:"./mapas/propiedades"}]}}return te.\u0275fac=function(ae){return new(ae||te)},te.\u0275cmp=oe.Xpm({type:te,selectors:[["app-menu"]],decls:2,vars:1,consts:[["id","menu-ul",1,"list-group","animate__animated","animate__bounceIn"],["routerLinkActive","active","class","list-group-item mt-2","id","li-menu",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active","id","li-menu",1,"list-group-item","mt-2",3,"routerLink"]],template:function(ae,ke){1&ae&&(oe.TgZ(0,"ul",0),oe.YNc(1,ct,2,4,"li",1),oe.qZA()),2&ae&&(oe.xp6(1),oe.Q6J("ngForOf",ke.menu))},directives:[ue.sg,Le.Od,Le.rH],styles:["li[_ngcontent-%COMP%]{cursor:pointer}"]}),te})(),St=(()=>{class te{ngOnInit(){st.accessToken=Ue.N.mapboxToken}}return te.\u0275fac=function(ae){return new(ae||te)},te.\u0275cmp=oe.Xpm({type:te,selectors:[["app-root"]],decls:2,vars:0,template:function(ae,ke){1&ae&&(oe._UZ(0,"app-menu"),oe._UZ(1,"router-outlet"))},directives:[tn,Le.lC],encapsulation:2}),te})(),we=(()=>{class te{}return te.\u0275fac=function(ae){return new(ae||te)},te.\u0275mod=oe.oAB({type:te,bootstrap:[St]}),te.\u0275inj=oe.cJS({providers:[],imports:[[$n,Ee.JF,Ce]]}),te})();Ue.N.production&&(0,oe.G48)(),jn().bootstrapModule(we).catch(te=>console.error(te))},6019:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{mr:()=>on,ez:()=>es,K0:()=>Gt,JJ:()=>Rl,Do:()=>gt,V_:()=>He,Ye:()=>mn,S$:()=>Ot,mk:()=>no,sg:()=>fo,O5:()=>Dr,PC:()=>Cr,b0:()=>zt,lw:()=>je,EM:()=>Jn,JF:()=>Qr,w_:()=>an,bD:()=>No,q:()=>Lt,Mx:()=>ho,HT:()=>Et});var ue=xe(3019);let oe=null;function Lt(){return oe}function Et(z){oe||(oe=z)}class an{}const Gt=new ue.OlP("DocumentToken");let je=(()=>{class z{historyGo(B){throw new Error("Not implemented")}}return z.\u0275fac=function(B){return new(B||z)},z.\u0275prov=ue.Yz7({token:z,factory:function(){return(0,ue.LFG)(mt)},providedIn:"platform"}),z})();const He=new ue.OlP("Location Initialized");let mt=(()=>{class z extends je{constructor(B){super(),this._doc=B,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Lt().getBaseHref(this._doc)}onPopState(B){const J=Lt().getGlobalEventTarget(this._doc,"window");return J.addEventListener("popstate",B,!1),()=>J.removeEventListener("popstate",B)}onHashChange(B){const J=Lt().getGlobalEventTarget(this._doc,"window");return J.addEventListener("hashchange",B,!1),()=>J.removeEventListener("hashchange",B)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(B){this.location.pathname=B}pushState(B,J,Se){Zt()?this._history.pushState(B,J,Se):this.location.hash=Se}replaceState(B,J,Se){Zt()?this._history.replaceState(B,J,Se):this.location.hash=Se}forward(){this._history.forward()}back(){this._history.back()}historyGo(B=0){this._history.go(B)}getState(){return this._history.state}}return z.\u0275fac=function(B){return new(B||z)(ue.LFG(Gt))},z.\u0275prov=ue.Yz7({token:z,factory:function(){return new mt((0,ue.LFG)(Gt))},providedIn:"platform"}),z})();function Zt(){return!!window.history.pushState}function it(z,W){if(0==z.length)return W;if(0==W.length)return z;let B=0;return z.endsWith("/")&&B++,W.startsWith("/")&&B++,2==B?z+W.substring(1):1==B?z+W:z+"/"+W}function Ut(z){const W=z.match(/#|\?|$/),B=W&&W.index||z.length;return z.slice(0,B-("/"===z[B-1]?1:0))+z.slice(B)}function hn(z){return z&&"?"!==z[0]?"?"+z:z}let Ot=(()=>{class z{historyGo(B){throw new Error("Not implemented")}}return z.\u0275fac=function(B){return new(B||z)},z.\u0275prov=ue.Yz7({token:z,factory:function(){return function(z){const W=(0,ue.LFG)(Gt).location;return new zt((0,ue.LFG)(je),W&&W.origin||"")}()},providedIn:"root"}),z})();const on=new ue.OlP("appBaseHref");let zt=(()=>{class z extends Ot{constructor(B,J){if(super(),this._platformLocation=B,this._removeListenerFns=[],null==J&&(J=this._platformLocation.getBaseHrefFromDOM()),null==J)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=J}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(B){this._removeListenerFns.push(this._platformLocation.onPopState(B),this._platformLocation.onHashChange(B))}getBaseHref(){return this._baseHref}prepareExternalUrl(B){return it(this._baseHref,B)}path(B=!1){const J=this._platformLocation.pathname+hn(this._platformLocation.search),Se=this._platformLocation.hash;return Se&&B?`${J}${Se}`:J}pushState(B,J,Se,ot){const ht=this.prepareExternalUrl(Se+hn(ot));this._platformLocation.pushState(B,J,ht)}replaceState(B,J,Se,ot){const ht=this.prepareExternalUrl(Se+hn(ot));this._platformLocation.replaceState(B,J,ht)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(B=0){var J,Se;null==(Se=(J=this._platformLocation).historyGo)||Se.call(J,B)}}return z.\u0275fac=function(B){return new(B||z)(ue.LFG(je),ue.LFG(on,8))},z.\u0275prov=ue.Yz7({token:z,factory:z.\u0275fac}),z})(),gt=(()=>{class z extends Ot{constructor(B,J){super(),this._platformLocation=B,this._baseHref="",this._removeListenerFns=[],null!=J&&(this._baseHref=J)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(B){this._removeListenerFns.push(this._platformLocation.onPopState(B),this._platformLocation.onHashChange(B))}getBaseHref(){return this._baseHref}path(B=!1){let J=this._platformLocation.hash;return null==J&&(J="#"),J.length>0?J.substring(1):J}prepareExternalUrl(B){const J=it(this._baseHref,B);return J.length>0?"#"+J:J}pushState(B,J,Se,ot){let ht=this.prepareExternalUrl(Se+hn(ot));0==ht.length&&(ht=this._platformLocation.pathname),this._platformLocation.pushState(B,J,ht)}replaceState(B,J,Se,ot){let ht=this.prepareExternalUrl(Se+hn(ot));0==ht.length&&(ht=this._platformLocation.pathname),this._platformLocation.replaceState(B,J,ht)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(B=0){var J,Se;null==(Se=(J=this._platformLocation).historyGo)||Se.call(J,B)}}return z.\u0275fac=function(B){return new(B||z)(ue.LFG(je),ue.LFG(on,8))},z.\u0275prov=ue.Yz7({token:z,factory:z.\u0275fac}),z})(),mn=(()=>{class z{constructor(B,J){this._subject=new ue.vpe,this._urlChangeListeners=[],this._platformStrategy=B;const Se=this._platformStrategy.getBaseHref();this._platformLocation=J,this._baseHref=Ut(dn(Se)),this._platformStrategy.onPopState(ot=>{this._subject.emit({url:this.path(!0),pop:!0,state:ot.state,type:ot.type})})}path(B=!1){return this.normalize(this._platformStrategy.path(B))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(B,J=""){return this.path()==this.normalize(B+hn(J))}normalize(B){return z.stripTrailingSlash(function(z,W){return z&&W.startsWith(z)?W.substring(z.length):W}(this._baseHref,dn(B)))}prepareExternalUrl(B){return B&&"/"!==B[0]&&(B="/"+B),this._platformStrategy.prepareExternalUrl(B)}go(B,J="",Se=null){this._platformStrategy.pushState(Se,"",B,J),this._notifyUrlChangeListeners(this.prepareExternalUrl(B+hn(J)),Se)}replaceState(B,J="",Se=null){this._platformStrategy.replaceState(Se,"",B,J),this._notifyUrlChangeListeners(this.prepareExternalUrl(B+hn(J)),Se)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(B=0){var J,Se;null==(Se=(J=this._platformStrategy).historyGo)||Se.call(J,B)}onUrlChange(B){this._urlChangeListeners.push(B),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(J=>{this._notifyUrlChangeListeners(J.url,J.state)}))}_notifyUrlChangeListeners(B="",J){this._urlChangeListeners.forEach(Se=>Se(B,J))}subscribe(B,J,Se){return this._subject.subscribe({next:B,error:J,complete:Se})}}return z.normalizeQueryParams=hn,z.joinWithSlash=it,z.stripTrailingSlash=Ut,z.\u0275fac=function(B){return new(B||z)(ue.LFG(Ot),ue.LFG(je))},z.\u0275prov=ue.Yz7({token:z,factory:function(){return new mn((0,ue.LFG)(Ot),(0,ue.LFG)(je))},providedIn:"root"}),z})();function dn(z){return z.replace(/\/index.html$/,"")}var Re=(()=>((Re=Re||{})[Re.Decimal=0]="Decimal",Re[Re.Percent=1]="Percent",Re[Re.Currency=2]="Currency",Re[Re.Scientific=3]="Scientific",Re))(),$e=(()=>(($e=$e||{})[$e.Zero=0]="Zero",$e[$e.One=1]="One",$e[$e.Two=2]="Two",$e[$e.Few=3]="Few",$e[$e.Many=4]="Many",$e[$e.Other=5]="Other",$e))(),Ye=(()=>((Ye=Ye||{})[Ye.Decimal=0]="Decimal",Ye[Ye.Group=1]="Group",Ye[Ye.List=2]="List",Ye[Ye.PercentSign=3]="PercentSign",Ye[Ye.PlusSign=4]="PlusSign",Ye[Ye.MinusSign=5]="MinusSign",Ye[Ye.Exponential=6]="Exponential",Ye[Ye.SuperscriptingExponent=7]="SuperscriptingExponent",Ye[Ye.PerMille=8]="PerMille",Ye[Ye.Infinity=9]="Infinity",Ye[Ye.NaN=10]="NaN",Ye[Ye.TimeSeparator=11]="TimeSeparator",Ye[Ye.CurrencyDecimal=12]="CurrencyDecimal",Ye[Ye.CurrencyGroup=13]="CurrencyGroup",Ye))();function Xr(z,W){const B=(0,ue.cg1)(z),J=B[ue.wAp.NumberSymbols][W];if(void 0===J){if(W===Ye.CurrencyDecimal)return B[ue.wAp.NumberSymbols][Ye.Decimal];if(W===Ye.CurrencyGroup)return B[ue.wAp.NumberSymbols][Ye.Group]}return J}const xi=ue.kL8,Ue=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function ln(z){const W=parseInt(z);if(isNaN(W))throw new Error("Invalid integer literal when parsing "+z);return W}class cr{}let bn=(()=>{class z extends cr{constructor(B){super(),this.locale=B}getPluralCategory(B,J){switch(xi(J||this.locale)(B)){case $e.Zero:return"zero";case $e.One:return"one";case $e.Two:return"two";case $e.Few:return"few";case $e.Many:return"many";default:return"other"}}}return z.\u0275fac=function(B){return new(B||z)(ue.LFG(ue.soG))},z.\u0275prov=ue.Yz7({token:z,factory:z.\u0275fac}),z})();function ho(z,W){W=encodeURIComponent(W);for(const B of z.split(";")){const J=B.indexOf("="),[Se,ot]=-1==J?[B,""]:[B.slice(0,J),B.slice(J+1)];if(Se.trim()===W)return decodeURIComponent(ot)}return null}let no=(()=>{class z{constructor(B,J,Se,ot){this._iterableDiffers=B,this._keyValueDiffers=J,this._ngEl=Se,this._renderer=ot,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(B){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof B?B.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(B){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof B?B.split(/\s+/):B,this._rawClass&&((0,ue.sIi)(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const B=this._iterableDiffer.diff(this._rawClass);B&&this._applyIterableChanges(B)}else if(this._keyValueDiffer){const B=this._keyValueDiffer.diff(this._rawClass);B&&this._applyKeyValueChanges(B)}}_applyKeyValueChanges(B){B.forEachAddedItem(J=>this._toggleClass(J.key,J.currentValue)),B.forEachChangedItem(J=>this._toggleClass(J.key,J.currentValue)),B.forEachRemovedItem(J=>{J.previousValue&&this._toggleClass(J.key,!1)})}_applyIterableChanges(B){B.forEachAddedItem(J=>{if("string"!=typeof J.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${(0,ue.AaK)(J.item)}`);this._toggleClass(J.item,!0)}),B.forEachRemovedItem(J=>this._toggleClass(J.item,!1))}_applyClasses(B){B&&(Array.isArray(B)||B instanceof Set?B.forEach(J=>this._toggleClass(J,!0)):Object.keys(B).forEach(J=>this._toggleClass(J,!!B[J])))}_removeClasses(B){B&&(Array.isArray(B)||B instanceof Set?B.forEach(J=>this._toggleClass(J,!1)):Object.keys(B).forEach(J=>this._toggleClass(J,!1)))}_toggleClass(B,J){(B=B.trim())&&B.split(/\s+/g).forEach(Se=>{J?this._renderer.addClass(this._ngEl.nativeElement,Se):this._renderer.removeClass(this._ngEl.nativeElement,Se)})}}return z.\u0275fac=function(B){return new(B||z)(ue.Y36(ue.ZZ4),ue.Y36(ue.aQg),ue.Y36(ue.SBq),ue.Y36(ue.Qsj))},z.\u0275dir=ue.lG2({type:z,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),z})();class mr{constructor(W,B,J,Se){this.$implicit=W,this.ngForOf=B,this.index=J,this.count=Se}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let fo=(()=>{class z{constructor(B,J,Se){this._viewContainer=B,this._template=J,this._differs=Se,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(B){this._ngForOf=B,this._ngForOfDirty=!0}set ngForTrackBy(B){this._trackByFn=B}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(B){B&&(this._template=B)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const B=this._ngForOf;if(!this._differ&&B)try{this._differ=this._differs.find(B).create(this.ngForTrackBy)}catch(J){throw new Error(`Cannot find a differ supporting object '${B}' of type '${function(z){return z.name||typeof z}(B)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const B=this._differ.diff(this._ngForOf);B&&this._applyChanges(B)}}_applyChanges(B){const J=[];B.forEachOperation((Se,ot,ht)=>{if(null==Se.previousIndex){const cn=this._viewContainer.createEmbeddedView(this._template,new mr(null,this._ngForOf,-1,-1),null===ht?void 0:ht),or=new po(Se,cn);J.push(or)}else if(null==ht)this._viewContainer.remove(null===ot?void 0:ot);else if(null!==ot){const cn=this._viewContainer.get(ot);this._viewContainer.move(cn,ht);const or=new po(Se,cn);J.push(or)}});for(let Se=0;Se<J.length;Se++)this._perViewChange(J[Se].view,J[Se].record);for(let Se=0,ot=this._viewContainer.length;Se<ot;Se++){const ht=this._viewContainer.get(Se);ht.context.index=Se,ht.context.count=ot,ht.context.ngForOf=this._ngForOf}B.forEachIdentityChange(Se=>{this._viewContainer.get(Se.currentIndex).context.$implicit=Se.item})}_perViewChange(B,J){B.context.$implicit=J.item}static ngTemplateContextGuard(B,J){return!0}}return z.\u0275fac=function(B){return new(B||z)(ue.Y36(ue.s_b),ue.Y36(ue.Rgc),ue.Y36(ue.ZZ4))},z.\u0275dir=ue.lG2({type:z,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),z})();class po{constructor(W,B){this.record=W,this.view=B}}let Dr=(()=>{class z{constructor(B,J){this._viewContainer=B,this._context=new Jo,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=J}set ngIf(B){this._context.$implicit=this._context.ngIf=B,this._updateView()}set ngIfThen(B){pi("ngIfThen",B),this._thenTemplateRef=B,this._thenViewRef=null,this._updateView()}set ngIfElse(B){pi("ngIfElse",B),this._elseTemplateRef=B,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(B,J){return!0}}return z.\u0275fac=function(B){return new(B||z)(ue.Y36(ue.s_b),ue.Y36(ue.Rgc))},z.\u0275dir=ue.lG2({type:z,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),z})();class Jo{constructor(){this.$implicit=null,this.ngIf=null}}function pi(z,W){if(W&&!W.createEmbeddedView)throw new Error(`${z} must be a TemplateRef, but received '${(0,ue.AaK)(W)}'.`)}let Cr=(()=>{class z{constructor(B,J,Se){this._ngEl=B,this._differs=J,this._renderer=Se,this._ngStyle=null,this._differ=null}set ngStyle(B){this._ngStyle=B,!this._differ&&B&&(this._differ=this._differs.find(B).create())}ngDoCheck(){if(this._differ){const B=this._differ.diff(this._ngStyle);B&&this._applyChanges(B)}}_setStyle(B,J){const[Se,ot]=B.split(".");null!=(J=null!=J&&ot?`${J}${ot}`:J)?this._renderer.setStyle(this._ngEl.nativeElement,Se,J):this._renderer.removeStyle(this._ngEl.nativeElement,Se)}_applyChanges(B){B.forEachRemovedItem(J=>this._setStyle(J.key,null)),B.forEachAddedItem(J=>this._setStyle(J.key,J.currentValue)),B.forEachChangedItem(J=>this._setStyle(J.key,J.currentValue))}}return z.\u0275fac=function(B){return new(B||z)(ue.Y36(ue.SBq),ue.Y36(ue.aQg),ue.Y36(ue.Qsj))},z.\u0275dir=ue.lG2({type:z,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),z})();let Rl=(()=>{class z{constructor(B){this._locale=B}transform(B,J,Se){if(!function(z){return!(null==z||""===z||z!=z)}(B))return null;Se=Se||this._locale;try{return function(z,W,B){return function(z,W,B,J,Se,ot,ht=!1){let cn="",or=!1;if(isFinite(z)){let fn=function(z){let J,Se,ot,ht,cn,W=Math.abs(z)+"",B=0;for((Se=W.indexOf("."))>-1&&(W=W.replace(".","")),(ot=W.search(/e/i))>0?(Se<0&&(Se=ot),Se+=+W.slice(ot+1),W=W.substring(0,ot)):Se<0&&(Se=W.length),ot=0;"0"===W.charAt(ot);ot++);if(ot===(cn=W.length))J=[0],Se=1;else{for(cn--;"0"===W.charAt(cn);)cn--;for(Se-=ot,J=[],ht=0;ot<=cn;ot++,ht++)J[ht]=Number(W.charAt(ot))}return Se>22&&(J=J.splice(0,21),B=Se-1,Se=1),{digits:J,exponent:B,integerLen:Se}}(z);ht&&(fn=function(z){if(0===z.digits[0])return z;const W=z.digits.length-z.integerLen;return z.exponent?z.exponent+=2:(0===W?z.digits.push(0,0):1===W&&z.digits.push(0),z.integerLen+=2),z}(fn));let hr=W.minInt,Yn=W.minFrac,Fr=W.maxFrac;if(ot){const ro=ot.match(Ue);if(null===ro)throw new Error(`${ot} is not a valid digit info`);const ts=ro[1],fs=ro[3],Ci=ro[5];null!=ts&&(hr=ln(ts)),null!=fs&&(Yn=ln(fs)),null!=Ci?Fr=ln(Ci):null!=fs&&Yn>Fr&&(Fr=Yn)}!function(z,W,B){if(W>B)throw new Error(`The minimum number of digits after fraction (${W}) is higher than the maximum (${B}).`);let J=z.digits,Se=J.length-z.integerLen;const ot=Math.min(Math.max(W,Se),B);let ht=ot+z.integerLen,cn=J[ht];if(ht>0){J.splice(Math.max(z.integerLen,ht));for(let Yn=ht;Yn<J.length;Yn++)J[Yn]=0}else{Se=Math.max(0,Se),z.integerLen=1,J.length=Math.max(1,ht=ot+1),J[0]=0;for(let Yn=1;Yn<ht;Yn++)J[Yn]=0}if(cn>=5)if(ht-1<0){for(let Yn=0;Yn>ht;Yn--)J.unshift(0),z.integerLen++;J.unshift(1),z.integerLen++}else J[ht-1]++;for(;Se<Math.max(0,ot);Se++)J.push(0);let or=0!==ot;const fn=W+z.integerLen,hr=J.reduceRight(function(Yn,Fr,Dn,mi){return mi[Dn]=(Fr+=Yn)<10?Fr:Fr-10,or&&(0===mi[Dn]&&Dn>=fn?mi.pop():or=!1),Fr>=10?1:0},0);hr&&(J.unshift(hr),z.integerLen++)}(fn,Yn,Fr);let Dn=fn.digits,mi=fn.integerLen;const To=fn.exponent;let Di=[];for(or=Dn.every(ro=>!ro);mi<hr;mi++)Dn.unshift(0);for(;mi<0;mi++)Dn.unshift(0);mi>0?Di=Dn.splice(mi,Dn.length):(Di=Dn,Dn=[0]);const ai=[];for(Dn.length>=W.lgSize&&ai.unshift(Dn.splice(-W.lgSize,Dn.length).join(""));Dn.length>W.gSize;)ai.unshift(Dn.splice(-W.gSize,Dn.length).join(""));Dn.length&&ai.unshift(Dn.join("")),cn=ai.join(Xr(B,J)),Di.length&&(cn+=Xr(B,Se)+Di.join("")),To&&(cn+=Xr(B,Ye.Exponential)+"+"+To)}else cn=Xr(B,Ye.Infinity);return cn=z<0&&!or?W.negPre+cn+W.negSuf:W.posPre+cn+W.posSuf,cn}(z,function(z,W="-"){const B={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},J=z.split(";"),Se=J[0],ot=J[1],ht=-1!==Se.indexOf(".")?Se.split("."):[Se.substring(0,Se.lastIndexOf("0")+1),Se.substring(Se.lastIndexOf("0")+1)],cn=ht[0],or=ht[1]||"";B.posPre=cn.substr(0,cn.indexOf("#"));for(let hr=0;hr<or.length;hr++){const Yn=or.charAt(hr);"0"===Yn?B.minFrac=B.maxFrac=hr+1:"#"===Yn?B.maxFrac=hr+1:B.posSuf+=Yn}const fn=cn.split(",");if(B.gSize=fn[1]?fn[1].length:0,B.lgSize=fn[2]||fn[1]?(fn[2]||fn[1]).length:0,ot){const hr=Se.length-B.posPre.length-B.posSuf.length,Yn=ot.indexOf("#");B.negPre=ot.substr(0,Yn).replace(/'/g,""),B.negSuf=ot.substr(Yn+hr).replace(/'/g,"")}else B.negPre=W+B.posPre,B.negSuf=B.posSuf;return B}(function(z,W){return(0,ue.cg1)(z)[ue.wAp.NumberFormats][W]}(W,Re.Decimal),Xr(W,Ye.MinusSign)),W,Ye.Group,Ye.Decimal,B)}(function(z){if("string"==typeof z&&!isNaN(Number(z)-parseFloat(z)))return Number(z);if("number"!=typeof z)throw new Error(`${z} is not a number`);return z}(B),Se,J)}catch(ot){throw function(z,W){return Error(`InvalidPipeArgument: '${W}' for pipe '${(0,ue.AaK)(z)}'`)}(z,ot.message)}}}return z.\u0275fac=function(B){return new(B||z)(ue.Y36(ue.soG,16))},z.\u0275pipe=ue.Yjl({name:"number",type:z,pure:!0}),z})();let es=(()=>{class z{}return z.\u0275fac=function(B){return new(B||z)},z.\u0275mod=ue.oAB({type:z}),z.\u0275inj=ue.cJS({providers:[{provide:cr,useClass:bn}]}),z})();const No="browser";let Jn=(()=>{class z{}return z.\u0275prov=(0,ue.Yz7)({token:z,providedIn:"root",factory:()=>new Ms((0,ue.LFG)(Gt),window)}),z})();class Ms{constructor(W,B){this.document=W,this.window=B,this.offset=()=>[0,0]}setOffset(W){this.offset=Array.isArray(W)?()=>W:W}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(W){this.supportsScrolling()&&this.window.scrollTo(W[0],W[1])}scrollToAnchor(W){if(!this.supportsScrolling())return;const B=function(z,W){const B=z.getElementById(W)||z.getElementsByName(W)[0];if(B)return B;if("function"==typeof z.createTreeWalker&&z.body&&(z.body.createShadowRoot||z.body.attachShadow)){const J=z.createTreeWalker(z.body,NodeFilter.SHOW_ELEMENT);let Se=J.currentNode;for(;Se;){const ot=Se.shadowRoot;if(ot){const ht=ot.getElementById(W)||ot.querySelector(`[name="${W}"]`);if(ht)return ht}Se=J.nextNode()}}return null}(this.document,W);B&&(this.scrollToElement(B),this.attemptFocus(B))}setHistoryScrollRestoration(W){if(this.supportScrollRestoration()){const B=this.window.history;B&&B.scrollRestoration&&(B.scrollRestoration=W)}}scrollToElement(W){const B=W.getBoundingClientRect(),J=B.left+this.window.pageXOffset,Se=B.top+this.window.pageYOffset,ot=this.offset();this.window.scrollTo(J-ot[0],Se-ot[1])}attemptFocus(W){return W.focus(),this.document.activeElement===W}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const W=Zs(this.window.history)||Zs(Object.getPrototypeOf(this.window.history));return!(!W||!W.writable&&!W.set)}catch(W){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(W){return!1}}}function Zs(z){return Object.getOwnPropertyDescriptor(z,"scrollRestoration")}class Qr{}},4522:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{eN:()=>Ye,JF:()=>Lr,PG:()=>je});var ue=xe(6019),oe=xe(3019),Lt=xe(1680),c=xe(9105),Et=xe(8475),an=xe(181),Gt=xe(2201);class je{}class ze{}class He{constructor(Ae){this.normalizedNames=new Map,this.lazyUpdate=null,Ae?this.lazyInit="string"==typeof Ae?()=>{this.headers=new Map,Ae.split("\n").forEach(Oe=>{const bt=Oe.indexOf(":");if(bt>0){const pt=Oe.slice(0,bt),_t=pt.toLowerCase(),Vt=Oe.slice(bt+1).trim();this.maybeSetNormalizedName(pt,_t),this.headers.has(_t)?this.headers.get(_t).push(Vt):this.headers.set(_t,[Vt])}})}:()=>{this.headers=new Map,Object.keys(Ae).forEach(Oe=>{let bt=Ae[Oe];const pt=Oe.toLowerCase();"string"==typeof bt&&(bt=[bt]),bt.length>0&&(this.headers.set(pt,bt),this.maybeSetNormalizedName(Oe,pt))})}:this.headers=new Map}has(Ae){return this.init(),this.headers.has(Ae.toLowerCase())}get(Ae){this.init();const Oe=this.headers.get(Ae.toLowerCase());return Oe&&Oe.length>0?Oe[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(Ae){return this.init(),this.headers.get(Ae.toLowerCase())||null}append(Ae,Oe){return this.clone({name:Ae,value:Oe,op:"a"})}set(Ae,Oe){return this.clone({name:Ae,value:Oe,op:"s"})}delete(Ae,Oe){return this.clone({name:Ae,value:Oe,op:"d"})}maybeSetNormalizedName(Ae,Oe){this.normalizedNames.has(Oe)||this.normalizedNames.set(Oe,Ae)}init(){this.lazyInit&&(this.lazyInit instanceof He?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(Ae=>this.applyUpdate(Ae)),this.lazyUpdate=null))}copyFrom(Ae){Ae.init(),Array.from(Ae.headers.keys()).forEach(Oe=>{this.headers.set(Oe,Ae.headers.get(Oe)),this.normalizedNames.set(Oe,Ae.normalizedNames.get(Oe))})}clone(Ae){const Oe=new He;return Oe.lazyInit=this.lazyInit&&this.lazyInit instanceof He?this.lazyInit:this,Oe.lazyUpdate=(this.lazyUpdate||[]).concat([Ae]),Oe}applyUpdate(Ae){const Oe=Ae.name.toLowerCase();switch(Ae.op){case"a":case"s":let bt=Ae.value;if("string"==typeof bt&&(bt=[bt]),0===bt.length)return;this.maybeSetNormalizedName(Ae.name,Oe);const pt=("a"===Ae.op?this.headers.get(Oe):void 0)||[];pt.push(...bt),this.headers.set(Oe,pt);break;case"d":const _t=Ae.value;if(_t){let Vt=this.headers.get(Oe);if(!Vt)return;Vt=Vt.filter(en=>-1===_t.indexOf(en)),0===Vt.length?(this.headers.delete(Oe),this.normalizedNames.delete(Oe)):this.headers.set(Oe,Vt)}else this.headers.delete(Oe),this.normalizedNames.delete(Oe)}}forEach(Ae){this.init(),Array.from(this.normalizedNames.keys()).forEach(Oe=>Ae(this.normalizedNames.get(Oe),this.headers.get(Oe)))}}class mt{encodeKey(Ae){return Ut(Ae)}encodeValue(Ae){return Ut(Ae)}decodeKey(Ae){return decodeURIComponent(Ae)}decodeValue(Ae){return decodeURIComponent(Ae)}}const Tn=/%(\d[a-f0-9])/gi,it={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function Ut(dt){return encodeURIComponent(dt).replace(Tn,(Ae,Oe)=>{var bt;return null!=(bt=it[Oe])?bt:Ae})}function hn(dt){return`${dt}`}class Ot{constructor(Ae={}){if(this.updates=null,this.cloneFrom=null,this.encoder=Ae.encoder||new mt,Ae.fromString){if(Ae.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(dt,Ae){const Oe=new Map;return dt.length>0&&dt.replace(/^\?/,"").split("&").forEach(pt=>{const _t=pt.indexOf("="),[Vt,en]=-1==_t?[Ae.decodeKey(pt),""]:[Ae.decodeKey(pt.slice(0,_t)),Ae.decodeValue(pt.slice(_t+1))],En=Oe.get(Vt)||[];En.push(en),Oe.set(Vt,En)}),Oe}(Ae.fromString,this.encoder)}else Ae.fromObject?(this.map=new Map,Object.keys(Ae.fromObject).forEach(Oe=>{const bt=Ae.fromObject[Oe];this.map.set(Oe,Array.isArray(bt)?bt:[bt])})):this.map=null}has(Ae){return this.init(),this.map.has(Ae)}get(Ae){this.init();const Oe=this.map.get(Ae);return Oe?Oe[0]:null}getAll(Ae){return this.init(),this.map.get(Ae)||null}keys(){return this.init(),Array.from(this.map.keys())}append(Ae,Oe){return this.clone({param:Ae,value:Oe,op:"a"})}appendAll(Ae){const Oe=[];return Object.keys(Ae).forEach(bt=>{const pt=Ae[bt];Array.isArray(pt)?pt.forEach(_t=>{Oe.push({param:bt,value:_t,op:"a"})}):Oe.push({param:bt,value:pt,op:"a"})}),this.clone(Oe)}set(Ae,Oe){return this.clone({param:Ae,value:Oe,op:"s"})}delete(Ae,Oe){return this.clone({param:Ae,value:Oe,op:"d"})}toString(){return this.init(),this.keys().map(Ae=>{const Oe=this.encoder.encodeKey(Ae);return this.map.get(Ae).map(bt=>Oe+"="+this.encoder.encodeValue(bt)).join("&")}).filter(Ae=>""!==Ae).join("&")}clone(Ae){const Oe=new Ot({encoder:this.encoder});return Oe.cloneFrom=this.cloneFrom||this,Oe.updates=(this.updates||[]).concat(Ae),Oe}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(Ae=>this.map.set(Ae,this.cloneFrom.map.get(Ae))),this.updates.forEach(Ae=>{switch(Ae.op){case"a":case"s":const Oe=("a"===Ae.op?this.map.get(Ae.param):void 0)||[];Oe.push(hn(Ae.value)),this.map.set(Ae.param,Oe);break;case"d":if(void 0===Ae.value){this.map.delete(Ae.param);break}{let bt=this.map.get(Ae.param)||[];const pt=bt.indexOf(hn(Ae.value));-1!==pt&&bt.splice(pt,1),bt.length>0?this.map.set(Ae.param,bt):this.map.delete(Ae.param)}}}),this.cloneFrom=this.updates=null)}}class on{constructor(){this.map=new Map}set(Ae,Oe){return this.map.set(Ae,Oe),this}get(Ae){return this.map.has(Ae)||this.map.set(Ae,Ae.defaultValue()),this.map.get(Ae)}delete(Ae){return this.map.delete(Ae),this}keys(){return this.map.keys()}}function gt(dt){return"undefined"!=typeof ArrayBuffer&&dt instanceof ArrayBuffer}function mn(dt){return"undefined"!=typeof Blob&&dt instanceof Blob}function Fn(dt){return"undefined"!=typeof FormData&&dt instanceof FormData}class dn{constructor(Ae,Oe,bt,pt){let _t;if(this.url=Oe,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=Ae.toUpperCase(),function(dt){switch(dt){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||pt?(this.body=void 0!==bt?bt:null,_t=pt):_t=bt,_t&&(this.reportProgress=!!_t.reportProgress,this.withCredentials=!!_t.withCredentials,_t.responseType&&(this.responseType=_t.responseType),_t.headers&&(this.headers=_t.headers),_t.context&&(this.context=_t.context),_t.params&&(this.params=_t.params)),this.headers||(this.headers=new He),this.context||(this.context=new on),this.params){const Vt=this.params.toString();if(0===Vt.length)this.urlWithParams=Oe;else{const en=Oe.indexOf("?");this.urlWithParams=Oe+(-1===en?"?":en<Oe.length-1?"&":"")+Vt}}else this.params=new Ot,this.urlWithParams=Oe}serializeBody(){return null===this.body?null:gt(this.body)||mn(this.body)||Fn(this.body)||"undefined"!=typeof URLSearchParams&&this.body instanceof URLSearchParams||"string"==typeof this.body?this.body:this.body instanceof Ot?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Fn(this.body)?null:mn(this.body)?this.body.type||null:gt(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Ot?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(Ae={}){var Ur;const Oe=Ae.method||this.method,bt=Ae.url||this.url,pt=Ae.responseType||this.responseType,_t=void 0!==Ae.body?Ae.body:this.body,Vt=void 0!==Ae.withCredentials?Ae.withCredentials:this.withCredentials,en=void 0!==Ae.reportProgress?Ae.reportProgress:this.reportProgress;let En=Ae.headers||this.headers,_r=Ae.params||this.params;const fi=null!=(Ur=Ae.context)?Ur:this.context;return void 0!==Ae.setHeaders&&(En=Object.keys(Ae.setHeaders).reduce((Xn,qt)=>Xn.set(qt,Ae.setHeaders[qt]),En)),Ae.setParams&&(_r=Object.keys(Ae.setParams).reduce((Xn,qt)=>Xn.set(qt,Ae.setParams[qt]),_r)),new dn(Oe,bt,_t,{params:_r,headers:En,context:fi,reportProgress:en,responseType:pt,withCredentials:Vt})}}var Ht=(()=>((Ht=Ht||{})[Ht.Sent=0]="Sent",Ht[Ht.UploadProgress=1]="UploadProgress",Ht[Ht.ResponseHeader=2]="ResponseHeader",Ht[Ht.DownloadProgress=3]="DownloadProgress",Ht[Ht.Response=4]="Response",Ht[Ht.User=5]="User",Ht))();class Re{constructor(Ae,Oe=200,bt="OK"){this.headers=Ae.headers||new He,this.status=void 0!==Ae.status?Ae.status:Oe,this.statusText=Ae.statusText||bt,this.url=Ae.url||null,this.ok=this.status>=200&&this.status<300}}class $e extends Re{constructor(Ae={}){super(Ae),this.type=Ht.ResponseHeader}clone(Ae={}){return new $e({headers:Ae.headers||this.headers,status:void 0!==Ae.status?Ae.status:this.status,statusText:Ae.statusText||this.statusText,url:Ae.url||this.url||void 0})}}class tt extends Re{constructor(Ae={}){super(Ae),this.type=Ht.Response,this.body=void 0!==Ae.body?Ae.body:null}clone(Ae={}){return new tt({body:void 0!==Ae.body?Ae.body:this.body,headers:Ae.headers||this.headers,status:void 0!==Ae.status?Ae.status:this.status,statusText:Ae.statusText||this.statusText,url:Ae.url||this.url||void 0})}}class lt extends Re{constructor(Ae){super(Ae,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${Ae.url||"(unknown url)"}`:`Http failure response for ${Ae.url||"(unknown url)"}: ${Ae.status} ${Ae.statusText}`,this.error=Ae.error||null}}function Pt(dt,Ae){return{body:Ae,headers:dt.headers,context:dt.context,observe:dt.observe,params:dt.params,reportProgress:dt.reportProgress,responseType:dt.responseType,withCredentials:dt.withCredentials}}let Ye=(()=>{class dt{constructor(Oe){this.handler=Oe}request(Oe,bt,pt={}){let _t;if(Oe instanceof dn)_t=Oe;else{let En,_r;En=pt.headers instanceof He?pt.headers:new He(pt.headers),pt.params&&(_r=pt.params instanceof Ot?pt.params:new Ot({fromObject:pt.params})),_t=new dn(Oe,bt,void 0!==pt.body?pt.body:null,{headers:En,context:pt.context,params:_r,reportProgress:pt.reportProgress,responseType:pt.responseType||"json",withCredentials:pt.withCredentials})}const Vt=(0,Lt.of)(_t).pipe((0,Et.b)(En=>this.handler.handle(En)));if(Oe instanceof dn||"events"===pt.observe)return Vt;const en=Vt.pipe((0,an.h)(En=>En instanceof tt));switch(pt.observe||"body"){case"body":switch(_t.responseType){case"arraybuffer":return en.pipe((0,Gt.U)(En=>{if(null!==En.body&&!(En.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return En.body}));case"blob":return en.pipe((0,Gt.U)(En=>{if(null!==En.body&&!(En.body instanceof Blob))throw new Error("Response is not a Blob.");return En.body}));case"text":return en.pipe((0,Gt.U)(En=>{if(null!==En.body&&"string"!=typeof En.body)throw new Error("Response is not a string.");return En.body}));default:return en.pipe((0,Gt.U)(En=>En.body))}case"response":return en;default:throw new Error(`Unreachable: unhandled observe type ${pt.observe}}`)}}delete(Oe,bt={}){return this.request("DELETE",Oe,bt)}get(Oe,bt={}){return this.request("GET",Oe,bt)}head(Oe,bt={}){return this.request("HEAD",Oe,bt)}jsonp(Oe,bt){return this.request("JSONP",Oe,{params:(new Ot).append(bt,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Oe,bt={}){return this.request("OPTIONS",Oe,bt)}patch(Oe,bt,pt={}){return this.request("PATCH",Oe,Pt(pt,bt))}post(Oe,bt,pt={}){return this.request("POST",Oe,Pt(pt,bt))}put(Oe,bt,pt={}){return this.request("PUT",Oe,Pt(pt,bt))}}return dt.\u0275fac=function(Oe){return new(Oe||dt)(oe.LFG(je))},dt.\u0275prov=oe.Yz7({token:dt,factory:dt.\u0275fac}),dt})();class Tt{constructor(Ae,Oe){this.next=Ae,this.interceptor=Oe}handle(Ae){return this.interceptor.intercept(Ae,this.next)}}const Sn=new oe.OlP("HTTP_INTERCEPTORS");let Er=(()=>{class dt{intercept(Oe,bt){return bt.handle(Oe)}}return dt.\u0275fac=function(Oe){return new(Oe||dt)},dt.\u0275prov=oe.Yz7({token:dt,factory:dt.\u0275fac}),dt})();const Wi=/^\)\]\}',?\n/;let to=(()=>{class dt{constructor(Oe){this.xhrFactory=Oe}handle(Oe){if("JSONP"===Oe.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new c.y(bt=>{const pt=this.xhrFactory.build();if(pt.open(Oe.method,Oe.urlWithParams),Oe.withCredentials&&(pt.withCredentials=!0),Oe.headers.forEach((qt,Rn)=>pt.setRequestHeader(qt,Rn.join(","))),Oe.headers.has("Accept")||pt.setRequestHeader("Accept","application/json, text/plain, */*"),!Oe.headers.has("Content-Type")){const qt=Oe.detectContentTypeHeader();null!==qt&&pt.setRequestHeader("Content-Type",qt)}if(Oe.responseType){const qt=Oe.responseType.toLowerCase();pt.responseType="json"!==qt?qt:"text"}const _t=Oe.serializeBody();let Vt=null;const en=()=>{if(null!==Vt)return Vt;const qt=1223===pt.status?204:pt.status,Rn=pt.statusText||"OK",tr=new He(pt.getAllResponseHeaders()),Gn=function(dt){return"responseURL"in dt&&dt.responseURL?dt.responseURL:/^X-Request-URL:/m.test(dt.getAllResponseHeaders())?dt.getResponseHeader("X-Request-URL"):null}(pt)||Oe.url;return Vt=new $e({headers:tr,status:qt,statusText:Rn,url:Gn}),Vt},En=()=>{let{headers:qt,status:Rn,statusText:tr,url:Gn}=en(),Vr=null;204!==Rn&&(Vr=void 0===pt.response?pt.responseText:pt.response),0===Rn&&(Rn=Vr?200:0);let bi=Rn>=200&&Rn<300;if("json"===Oe.responseType&&"string"==typeof Vr){const uo=Vr;Vr=Vr.replace(Wi,"");try{Vr=""!==Vr?JSON.parse(Vr):null}catch(nr){Vr=uo,bi&&(bi=!1,Vr={error:nr,text:Vr})}}bi?(bt.next(new tt({body:Vr,headers:qt,status:Rn,statusText:tr,url:Gn||void 0})),bt.complete()):bt.error(new lt({error:Vr,headers:qt,status:Rn,statusText:tr,url:Gn||void 0}))},_r=qt=>{const{url:Rn}=en(),tr=new lt({error:qt,status:pt.status||0,statusText:pt.statusText||"Unknown Error",url:Rn||void 0});bt.error(tr)};let fi=!1;const Ur=qt=>{fi||(bt.next(en()),fi=!0);let Rn={type:Ht.DownloadProgress,loaded:qt.loaded};qt.lengthComputable&&(Rn.total=qt.total),"text"===Oe.responseType&&!!pt.responseText&&(Rn.partialText=pt.responseText),bt.next(Rn)},Xn=qt=>{let Rn={type:Ht.UploadProgress,loaded:qt.loaded};qt.lengthComputable&&(Rn.total=qt.total),bt.next(Rn)};return pt.addEventListener("load",En),pt.addEventListener("error",_r),pt.addEventListener("timeout",_r),pt.addEventListener("abort",_r),Oe.reportProgress&&(pt.addEventListener("progress",Ur),null!==_t&&pt.upload&&pt.upload.addEventListener("progress",Xn)),pt.send(_t),bt.next({type:Ht.Sent}),()=>{pt.removeEventListener("error",_r),pt.removeEventListener("abort",_r),pt.removeEventListener("load",En),pt.removeEventListener("timeout",_r),Oe.reportProgress&&(pt.removeEventListener("progress",Ur),null!==_t&&pt.upload&&pt.upload.removeEventListener("progress",Xn)),pt.readyState!==pt.DONE&&pt.abort()}})}}return dt.\u0275fac=function(Oe){return new(Oe||dt)(oe.LFG(ue.JF))},dt.\u0275prov=oe.Yz7({token:dt,factory:dt.\u0275fac}),dt})();const Ir=new oe.OlP("XSRF_COOKIE_NAME"),On=new oe.OlP("XSRF_HEADER_NAME");class Bi{}let jn=(()=>{class dt{constructor(Oe,bt,pt){this.doc=Oe,this.platform=bt,this.cookieName=pt,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Oe=this.doc.cookie||"";return Oe!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,ue.Mx)(Oe,this.cookieName),this.lastCookieString=Oe),this.lastToken}}return dt.\u0275fac=function(Oe){return new(Oe||dt)(oe.LFG(ue.K0),oe.LFG(oe.Lbi),oe.LFG(Ir))},dt.\u0275prov=oe.Yz7({token:dt,factory:dt.\u0275fac}),dt})(),xi=(()=>{class dt{constructor(Oe,bt){this.tokenService=Oe,this.headerName=bt}intercept(Oe,bt){const pt=Oe.url.toLowerCase();if("GET"===Oe.method||"HEAD"===Oe.method||pt.startsWith("http://")||pt.startsWith("https://"))return bt.handle(Oe);const _t=this.tokenService.getToken();return null!==_t&&!Oe.headers.has(this.headerName)&&(Oe=Oe.clone({headers:Oe.headers.set(this.headerName,_t)})),bt.handle(Oe)}}return dt.\u0275fac=function(Oe){return new(Oe||dt)(oe.LFG(Bi),oe.LFG(On))},dt.\u0275prov=oe.Yz7({token:dt,factory:dt.\u0275fac}),dt})(),$n=(()=>{class dt{constructor(Oe,bt){this.backend=Oe,this.injector=bt,this.chain=null}handle(Oe){if(null===this.chain){const bt=this.injector.get(Sn,[]);this.chain=bt.reduceRight((pt,_t)=>new Tt(pt,_t),this.backend)}return this.chain.handle(Oe)}}return dt.\u0275fac=function(Oe){return new(Oe||dt)(oe.LFG(ze),oe.LFG(oe.zs3))},dt.\u0275prov=oe.Yz7({token:dt,factory:dt.\u0275fac}),dt})(),Kr=(()=>{class dt{static disable(){return{ngModule:dt,providers:[{provide:xi,useClass:Er}]}}static withOptions(Oe={}){return{ngModule:dt,providers:[Oe.cookieName?{provide:Ir,useValue:Oe.cookieName}:[],Oe.headerName?{provide:On,useValue:Oe.headerName}:[]]}}}return dt.\u0275fac=function(Oe){return new(Oe||dt)},dt.\u0275mod=oe.oAB({type:dt}),dt.\u0275inj=oe.cJS({providers:[xi,{provide:Sn,useExisting:xi,multi:!0},{provide:Bi,useClass:jn},{provide:Ir,useValue:"XSRF-TOKEN"},{provide:On,useValue:"X-XSRF-TOKEN"}]}),dt})(),Lr=(()=>{class dt{}return dt.\u0275fac=function(Oe){return new(Oe||dt)},dt.\u0275mod=oe.oAB({type:dt}),dt.\u0275inj=oe.cJS({providers:[Ye,{provide:je,useClass:$n},to,{provide:ze,useExisting:to}],imports:[[Kr.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),dt})()},3019:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{deG:()=>Gl,tb:()=>Hv,AFp:()=>jv,ip1:()=>Bg,CZH:()=>kh,hGG:()=>_w,z2F:()=>af,sBO:()=>Zb,Sil:()=>Ug,_Vd:()=>Qd,EJc:()=>qv,SBq:()=>ef,qLn:()=>ec,vpe:()=>Al,tBr:()=>Wo,XFs:()=>_t,OlP:()=>ri,zs3:()=>Li,ZZ4:()=>em,aQg:()=>tm,soG:()=>Jp,YKP:()=>tv,h0i:()=>Mh,PXZ:()=>Nb,R0b:()=>ia,FiY:()=>so,Lbi:()=>Gv,g9A:()=>$v,Qsj:()=>y1,FYo:()=>Ky,JOm:()=>Da,tp0:()=>Or,Rgc:()=>of,dDg:()=>Yv,GfV:()=>Jy,s_b:()=>Wp,ifc:()=>tr,eFA:()=>Qv,G48:()=>Hb,_c5:()=>uw,VLi:()=>Fb,c2e:()=>Zv,zSh:()=>Ia,wAp:()=>Nn,vHH:()=>gn,cg1:()=>mg,kL8:()=>wy,dqk:()=>nr,sIi:()=>P,CqO:()=>I_,QGY:()=>lg,F4k:()=>S_,RDi:()=>J,AaK:()=>Ot,TTD:()=>ds,xp6:()=>Jf,uIk:()=>Fe,ekj:()=>dg,Suo:()=>xv,Xpm:()=>Ce,lG2:()=>te,Yz7:()=>$n,cJS:()=>Xi,oAB:()=>tn,Yjl:()=>ye,Y36:()=>qd,_UZ:()=>E_,qZA:()=>ag,TgZ:()=>sg,EpF:()=>T_,LFG:()=>Qt,$8M:()=>Ji,$Z:()=>w_,NdJ:()=>cg,CRH:()=>bv,oxw:()=>k_,ALo:()=>hv,xi3:()=>dv,Q6J:()=>ig,VKq:()=>ov,iGM:()=>yv,MAs:()=>Hi,CHM:()=>Ps,LSH:()=>Wu,YNc:()=>_i,_uU:()=>ny,hij:()=>Up,AsE:()=>pg,Gf:()=>vv});var ue=xe(6007),oe=xe(5823),Lt=xe(3703),c=xe(4810),Et=xe(6658),Gt=xe(7396),je=xe(5414),ze=xe(9105),He=xe(3453),mt=xe(5173),Zt=xe(5711);function it(r,o,...s){return!0===o?(r(),null):!1===o?null:o(...s).pipe((0,He.q)(1)).subscribe(()=>r())}function Ut(r){for(let o in r)if(r[o]===Ut)return o;throw Error("Could not find renamed property on target object.")}function Ot(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(Ot).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const o=r.toString();if(null==o)return""+o;const s=o.indexOf("\n");return-1===s?o:o.substring(0,s)}function pn(r,o){return null==r||""===r?null===o?"":o:null==o||""===o?r:r+" "+o}const on=Ut({__forward_ref__:Ut});function zt(r){return r.__forward_ref__=zt,r.toString=function(){return Ot(this())},r}function gt(r){return function(r){return"function"==typeof r&&r.hasOwnProperty(on)&&r.__forward_ref__===zt}(r)?r():r}class gn extends Error{constructor(o,s){super(function(r,o){return`${r?`NG0${r}: `:""}${o}`}(o,s)),this.code=o}}function Re(r){return"string"==typeof r?r:null==r?"":String(r)}function $e(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():Re(r)}function Ye(r,o){const s=o?` in ${o}`:"";throw new gn("201",`No provider for ${$e(r)} found${s}`)}function Ir(r,o){null==r&&function(r,o,s,h){throw new Error(`ASSERTION ERROR: ${r}`+(null==h?"":` [Expected=> ${s} ${h} ${o} <=Actual]`))}(o,r,null,"!=")}function $n(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function Xi(r){return{providers:r.providers||[],imports:r.imports||[]}}function Kr(r){return Lr(r,Ae)||Lr(r,bt)}function Lr(r,o){return r.hasOwnProperty(o)?r[o]:null}function dt(r){return r&&(r.hasOwnProperty(Oe)||r.hasOwnProperty(pt))?r[Oe]:null}const Ae=Ut({\u0275prov:Ut}),Oe=Ut({\u0275inj:Ut}),bt=Ut({ngInjectableDef:Ut}),pt=Ut({ngInjectorDef:Ut});var _t=(()=>((_t=_t||{})[_t.Default=0]="Default",_t[_t.Host=1]="Host",_t[_t.Self=2]="Self",_t[_t.SkipSelf=4]="SkipSelf",_t[_t.Optional=8]="Optional",_t))();let Vt;function En(r){const o=Vt;return Vt=r,o}function _r(r,o,s){const h=Kr(r);return h&&"root"==h.providedIn?void 0===h.value?h.value=h.factory():h.value:s&_t.Optional?null:void 0!==o?o:void Ye(Ot(r),"Injector")}function Ur(r){return{toString:r}.toString()}var Xn=(()=>((Xn=Xn||{})[Xn.OnPush=0]="OnPush",Xn[Xn.Default=1]="Default",Xn))(),tr=(()=>{return(r=tr||(tr={}))[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",tr;var r})();const Gn="undefined"!=typeof globalThis&&globalThis,Vr="undefined"!=typeof window&&window,bi="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,nr=Gn||"undefined"!=typeof global&&global||Vr||bi,wi={},Q=[],j=Ut({\u0275cmp:Ut}),H=Ut({\u0275dir:Ut}),ee=Ut({\u0275pipe:Ut}),pe=Ut({\u0275mod:Ut}),Ee=Ut({\u0275fac:Ut}),Le=Ut({__NG_ELEMENT_ID__:Ut});let Be=0;function Ce(r){return Ur(()=>{const s={},h={type:r.type,providersResolver:null,decls:r.decls,vars:r.vars,factory:null,template:r.template||null,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:s,inputs:null,outputs:null,exportAs:r.exportAs||null,onPush:r.changeDetection===Xn.OnPush,directiveDefs:null,pipeDefs:null,selectors:r.selectors||Q,viewQuery:r.viewQuery||null,features:r.features||null,data:r.data||{},encapsulation:r.encapsulation||tr.Emulated,id:"c",styles:r.styles||Q,_:null,setInput:null,schemas:r.schemas||null,tView:null},m=r.directives,y=r.features,w=r.pipes;return h.id+=Be++,h.inputs=we(r.inputs,s),h.outputs=we(r.outputs),y&&y.forEach(I=>I(h)),h.directiveDefs=m?()=>("function"==typeof m?m():m).map(st):null,h.pipeDefs=w?()=>("function"==typeof w?w():w).map(At):null,h})}function st(r){return ae(r)||function(r){return r[H]||null}(r)}function At(r){return function(r){return r[ee]||null}(r)}const ct={};function tn(r){return Ur(()=>{const o={type:r.type,bootstrap:r.bootstrap||Q,declarations:r.declarations||Q,imports:r.imports||Q,exports:r.exports||Q,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null};return null!=r.id&&(ct[r.id]=r.type),o})}function we(r,o){if(null==r)return wi;const s={};for(const h in r)if(r.hasOwnProperty(h)){let m=r[h],y=m;Array.isArray(m)&&(y=m[1],m=m[0]),s[m]=h,o&&(o[m]=y)}return s}const te=Ce;function ye(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,onDestroy:r.type.prototype.ngOnDestroy||null}}function ae(r){return r[j]||null}function Rt(r,o){const s=r[pe]||null;if(!s&&!0===o)throw new Error(`Type ${Ot(r)} does not have '\u0275mod' property.`);return s}function ki(r){return Array.isArray(r)&&"object"==typeof r[1]}function $r(r){return Array.isArray(r)&&!0===r[1]}function Bo(r){return 0!=(8&r.flags)}function Qo(r){return 2==(2&r.flags)}function Ts(r){return 1==(1&r.flags)}function Jr(r){return null!==r.template}function Pl(r){return 0!=(512&r[2])}function Un(r,o){return r.hasOwnProperty(Ee)?r[Ee]:null}class Ra{constructor(o,s,h){this.previousValue=o,this.currentValue=s,this.firstChange=h}isFirstChange(){return this.firstChange}}function ds(){return Do}function Do(r){return r.type.prototype.ngOnChanges&&(r.setInput=Co),ca}function ca(){const r=Ms(this),o=null==r?void 0:r.current;if(o){const s=r.previous;if(s===wi)r.previous=o;else for(let h in o)s[h]=o[h];r.current=null,this.ngOnChanges(o)}}function Co(r,o,s,h){const m=Ms(r)||function(r,o){return r[Jn]=o}(r,{previous:wi,current:null}),y=m.current||(m.current={}),w=m.previous,I=this.declaredInputs[s],k=w[I];y[I]=new Ra(k&&k.currentValue,o,w===wi),r[h]=o}ds.ngInherit=!0;const Jn="__ngSimpleChanges__";function Ms(r){return r[Jn]||null}let B;function J(r){B=r}function ht(r){return!!r.listen}const cn={createRenderer:(r,o)=>void 0!==B?B:"undefined"!=typeof document?document:void 0};function fn(r){for(;Array.isArray(r);)r=r[0];return r}function Fr(r,o){return fn(o[r])}function Dn(r,o){return fn(o[r.index])}function To(r,o){return r.data[o]}function Di(r,o){return r[o]}function ai(r,o){const s=o[r];return ki(s)?s:s[0]}function ro(r){return 4==(4&r[2])}function ts(r){return 128==(128&r[2])}function Ci(r,o){return null==o?null:r[o]}function ua(r){r[18]=0}function As(r,o){r[5]+=o;let s=r,h=r[3];for(;null!==h&&(1===o&&1===s[5]||-1===o&&0===s[5]);)h[5]+=o,s=h,h=h[3]}const Ln={lFrame:fa(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function pc(){return Ln.bindingsEnabled}function wt(){return Ln.lFrame.lView}function Zn(){return Ln.lFrame.tView}function Ps(r){return Ln.lFrame.contextLView=r,r[8]}function li(){let r=ha();for(;null!==r&&64===r.type;)r=r.parent;return r}function ha(){return Ln.lFrame.currentTNode}function ni(r,o){const s=Ln.lFrame;s.currentTNode=r,s.isParent=o}function Fa(){return Ln.lFrame.isParent}function da(){return Ln.isInCheckNoChangesMode}function Qn(r){Ln.isInCheckNoChangesMode=r}function Ti(){const r=Ln.lFrame;let o=r.bindingRootIndex;return-1===o&&(o=r.bindingRootIndex=r.tView.bindingStartIndex),o}function Vo(){return Ln.lFrame.bindingIndex++}function ns(r){const o=Ln.lFrame,s=o.bindingIndex;return o.bindingIndex=o.bindingIndex+r,s}function qc(r,o){const s=Ln.lFrame;s.bindingIndex=s.bindingRootIndex=r,mo(o)}function mo(r){Ln.lFrame.currentDirectiveIndex=r}function gs(){return Ln.lFrame.currentQueryIndex}function Ys(r){Ln.lFrame.currentQueryIndex=r}function Wc(r){const o=r[1];return 2===o.type?o.declTNode:1===o.type?r[6]:null}function Rs(r,o,s){if(s&_t.SkipSelf){let m=o,y=r;for(;!(m=m.parent,null!==m||s&_t.Host||(m=Wc(y),null===m||(y=y[15],10&m.type))););if(null===m)return!1;o=m,r=y}const h=Ln.lFrame=io();return h.currentTNode=o,h.lView=r,!0}function So(r){const o=io(),s=r[1];Ln.lFrame=o,o.currentTNode=s.firstChild,o.lView=r,o.tView=s,o.contextLView=r,o.bindingIndex=s.bindingStartIndex,o.inI18n=!1}function io(){const r=Ln.lFrame,o=null===r?null:r.child;return null===o?fa(r):o}function fa(r){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=o),o}function ll(){const r=Ln.lFrame;return Ln.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const Oa=ll;function jo(){const r=ll();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function ci(){return Ln.lFrame.selectedIndex}function Io(r){Ln.lFrame.selectedIndex=r}function Gr(){const r=Ln.lFrame;return To(r.tView,r.selectedIndex)}function ys(r,o){for(let s=o.directiveStart,h=o.directiveEnd;s<h;s++){const y=r.data[s].type.prototype,{ngAfterContentInit:w,ngAfterContentChecked:I,ngAfterViewInit:k,ngAfterViewChecked:G,ngOnDestroy:q}=y;w&&(r.contentHooks||(r.contentHooks=[])).push(-s,w),I&&((r.contentHooks||(r.contentHooks=[])).push(s,I),(r.contentCheckHooks||(r.contentCheckHooks=[])).push(s,I)),k&&(r.viewHooks||(r.viewHooks=[])).push(-s,k),G&&((r.viewHooks||(r.viewHooks=[])).push(s,G),(r.viewCheckHooks||(r.viewCheckHooks=[])).push(s,G)),null!=q&&(r.destroyHooks||(r.destroyHooks=[])).push(s,q)}}function ma(r,o,s){Vi(r,o,3,s)}function za(r,o,s,h){(3&r[2])===s&&Vi(r,o,s,h)}function ga(r,o){let s=r[2];(3&s)===o&&(s&=2047,s+=1,r[2]=s)}function Vi(r,o,s,h){const y=null!=h?h:-1,w=o.length-1;let I=0;for(let k=void 0!==h?65535&r[18]:0;k<w;k++)if("number"==typeof o[k+1]){if(I=o[k],null!=h&&I>=h)break}else o[k]<0&&(r[18]+=65536),(I<y||-1==y)&&(gc(r,s,o,k),r[18]=(4294901760&r[18])+k+2),k++}function gc(r,o,s,h){const m=s[h]<0,y=s[h+1],I=r[m?-s[h]:s[h]];if(m){if(r[2]>>11<r[18]>>16&&(3&r[2])===o){r[2]+=2048;try{y.call(I)}finally{}}}else try{y.call(I)}finally{}}class Mo{constructor(o,s,h){this.factory=o,this.resolving=!1,this.canSeeViewProviders=s,this.injectImpl=h}}function vs(r,o,s){const h=ht(r);let m=0;for(;m<s.length;){const y=s[m];if("number"==typeof y){if(0!==y)break;m++;const w=s[m++],I=s[m++],k=s[m++];h?r.setAttribute(o,I,k,w):o.setAttributeNS(w,I,k)}else{const w=y,I=s[++m];xs(w)?h&&r.setProperty(o,w,I):h?r.setAttribute(o,w,I):o.setAttribute(w,I),m++}}return m}function $i(r){return 3===r||4===r||6===r}function xs(r){return 64===r.charCodeAt(0)}function Ki(r,o){if(null!==o&&0!==o.length)if(null===r||0===r.length)r=o.slice();else{let s=-1;for(let h=0;h<o.length;h++){const m=o[h];"number"==typeof m?s=m:0===s||$l(r,s,m,null,-1===s||2===s?o[++h]:null)}}return r}function $l(r,o,s,h,m){let y=0,w=r.length;if(-1===o)w=-1;else for(;y<r.length;){const I=r[y++];if("number"==typeof I){if(I===o){w=-1;break}if(I>o){w=y-1;break}}}for(;y<r.length;){const I=r[y];if("number"==typeof I)break;if(I===s){if(null===h)return void(null!==m&&(r[y+1]=m));if(h===r[y+1])return void(r[y+2]=m)}y++,null!==h&&y++,null!==m&&y++}-1!==w&&(r.splice(w,0,o),y=w+1),r.splice(y++,0,s),null!==h&&r.splice(y++,0,h),null!==m&&r.splice(y++,0,m)}function is(r){return-1!==r}function Ao(r){return 32767&r}function Ls(r,o){let s=function(r){return r>>16}(r),h=o;for(;s>0;)h=h[15],s--;return h}let _a=!0;function ya(r){const o=_a;return _a=r,o}let va=0;function bs(r,o){const s=dl(r,o);if(-1!==s)return s;const h=o[1];h.firstCreatePass&&(r.injectorIndex=o.length,Wt(h.data,r),Wt(o,null),Wt(h.blueprint,null));const m=Ba(r,o),y=r.injectorIndex;if(is(m)){const w=Ao(m),I=Ls(m,o),k=I[1].data;for(let G=0;G<8;G++)o[y+G]=I[w+G]|k[w+G]}return o[y+8]=m,y}function Wt(r,o){r.push(0,0,0,0,0,0,0,0,o)}function dl(r,o){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===o[r.injectorIndex+8]?-1:r.injectorIndex}function Ba(r,o){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let s=0,h=null,m=o;for(;null!==m;){const y=m[1],w=y.type;if(h=2===w?y.declTNode:1===w?m[6]:null,null===h)return-1;if(s++,m=m[15],-1!==h.injectorIndex)return h.injectorIndex|s<<16}return-1}function M(r,o,s){!function(r,o,s){let h;"string"==typeof s?h=s.charCodeAt(0)||0:s.hasOwnProperty(Le)&&(h=s[Le]),null==h&&(h=s[Le]=va++);const m=255&h;o.data[r+(m>>5)]|=1<<m}(r,o,s)}function C(r,o,s){if(s&_t.Optional)return r;Ye(o,"NodeInjector")}function L(r,o,s,h){if(s&_t.Optional&&void 0===h&&(h=null),0==(s&(_t.Self|_t.Host))){const m=r[9],y=En(void 0);try{return m?m.get(o,h,s&_t.Optional):_r(o,h,s&_t.Optional)}finally{En(y)}}return C(h,o,s)}function U(r,o,s,h=_t.Default,m){if(null!==r){const y=function(r){if("string"==typeof r)return r.charCodeAt(0)||0;const o=r.hasOwnProperty(Le)?r[Le]:void 0;return"number"==typeof o?o>=0?255&o:_e:o}(s);if("function"==typeof y){if(!Rs(o,r,h))return h&_t.Host?C(m,s,h):L(o,s,h,m);try{const w=y(h);if(null!=w||h&_t.Optional)return w;Ye(s)}finally{Oa()}}else if("number"==typeof y){let w=null,I=dl(r,o),k=-1,G=h&_t.Host?o[16][6]:null;for((-1===I||h&_t.SkipSelf)&&(k=-1===I?Ba(r,o):o[I+8],-1!==k&&sr(h,!1)?(w=o[1],I=Ao(k),o=Ls(k,o)):I=-1);-1!==I;){const q=o[1];if(un(y,I,q.data)){const he=De(I,o,s,w,h,G);if(he!==Y)return he}k=o[I+8],-1!==k&&sr(h,o[1].data[I+8]===G)&&un(y,I,o)?(w=q,I=Ao(k),o=Ls(k,o)):I=-1}}}return L(o,s,h,m)}const Y={};function _e(){return new er(li(),wt())}function De(r,o,s,h,m,y){const w=o[1],I=w.data[r+8],q=Je(I,w,s,null==h?Qo(I)&&_a:h!=w&&0!=(3&I.type),m&_t.Host&&y===I);return null!==q?Kt(o,w,q,I):Y}function Je(r,o,s,h,m){const y=r.providerIndexes,w=o.data,I=1048575&y,k=r.directiveStart,q=y>>20,Ie=m?I+q:r.directiveEnd;for(let Ve=h?I:I+q;Ve<Ie;Ve++){const ft=w[Ve];if(Ve<k&&s===ft||Ve>=k&&ft.type===s)return Ve}if(m){const Ve=w[k];if(Ve&&Jr(Ve)&&Ve.type===s)return k}return null}function Kt(r,o,s,h){let m=r[s];const y=o.data;if(function(r){return r instanceof Mo}(m)){const w=m;w.resolving&&function(r,o){throw new gn("200",`Circular dependency in DI detected for ${r}`)}($e(y[s]));const I=ya(w.canSeeViewProviders);w.resolving=!0;const k=w.injectImpl?En(w.injectImpl):null;Rs(r,h,_t.Default);try{m=r[s]=w.factory(void 0,y,r,h),o.firstCreatePass&&s>=h.directiveStart&&function(r,o,s){const{ngOnChanges:h,ngOnInit:m,ngDoCheck:y}=o.type.prototype;if(h){const w=Do(o);(s.preOrderHooks||(s.preOrderHooks=[])).push(r,w),(s.preOrderCheckHooks||(s.preOrderCheckHooks=[])).push(r,w)}m&&(s.preOrderHooks||(s.preOrderHooks=[])).push(0-r,m),y&&((s.preOrderHooks||(s.preOrderHooks=[])).push(r,y),(s.preOrderCheckHooks||(s.preOrderCheckHooks=[])).push(r,y))}(s,y[s],o)}finally{null!==k&&En(k),ya(I),w.resolving=!1,Oa()}}return m}function un(r,o,s){return!!(s[o+(r>>5)]&1<<r)}function sr(r,o){return!(r&_t.Self||r&_t.Host&&o)}class er{constructor(o,s){this._tNode=o,this._lView=s}get(o,s,h){return U(this._tNode,this._lView,o,h,s)}}function Ji(r){return function(r,o){if("class"===o)return r.classes;if("style"===o)return r.styles;const s=r.attrs;if(s){const h=s.length;let m=0;for(;m<h;){const y=s[m];if($i(y))break;if(0===y)m+=2;else if("number"==typeof y)for(m++;m<h&&"string"==typeof s[m];)m++;else{if(y===o)return s[m+1];m+=2}}}return null}(li(),r)}const _o="__parameters__";function Fs(r,o,s){return Ur(()=>{const h=function(r){return function(...s){if(r){const h=r(...s);for(const m in h)this[m]=h[m]}}}(o);function m(...y){if(this instanceof m)return h.apply(this,y),this;const w=new m(...y);return I.annotation=w,I;function I(k,G,q){const he=k.hasOwnProperty(_o)?k[_o]:Object.defineProperty(k,_o,{value:[]})[_o];for(;he.length<=q;)he.push(null);return(he[q]=he[q]||[]).push(w),k}}return s&&(m.prototype=Object.create(s.prototype)),m.prototype.ngMetadataName=r,m.annotationCls=m,m})}class ri{constructor(o,s){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof s?this.__NG_ELEMENT_ID__=s:void 0!==s&&(this.\u0275prov=$n({token:this,providedIn:s.providedIn||"root",factory:s.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Gl=new ri("AnalyzeForEntryComponents");function t(r,o){void 0===o&&(o=r);for(let s=0;s<r.length;s++){let h=r[s];Array.isArray(h)?(o===r&&(o=r.slice(0,s)),t(h,o)):o!==r&&o.push(h)}return o}function l(r,o){r.forEach(s=>Array.isArray(s)?l(s,o):o(s))}function p(r,o,s){o>=r.length?r.push(s):r.splice(o,0,s)}function _(r,o){return o>=r.length-1?r.pop():r.splice(o,1)[0]}function X(r,o,s){let h=le(r,o);return h>=0?r[1|h]=s:(h=~h,function(r,o,s,h){let m=r.length;if(m==o)r.push(s,h);else if(1===m)r.push(h,r[0]),r[0]=s;else{for(m--,r.push(r[m-1],r[m]);m>o;)r[m]=r[m-2],m--;r[o]=s,r[o+1]=h}}(r,h,o,s)),h}function re(r,o){const s=le(r,o);if(s>=0)return r[1|s]}function le(r,o){return function(r,o,s){let h=0,m=r.length>>s;for(;m!==h;){const y=h+(m-h>>1),w=r[y<<s];if(o===w)return y<<s;w>o?m=y:h=y+1}return~(m<<s)}(r,o,1)}const nt={},It="__NG_DI_FLAG__",Qe="ngTempTokenPath",Ge=/\n/gm,Jt="__source",wn=Ut({provide:String,useValue:Ut});let vn;function Mn(r){const o=vn;return vn=r,o}function An(r,o=_t.Default){if(void 0===vn)throw new Error("inject() must be called from an injection context");return null===vn?_r(r,void 0,o):vn.get(r,o&_t.Optional?null:void 0,o)}function Qt(r,o=_t.Default){return(Vt||An)(gt(r),o)}function ui(r){const o=[];for(let s=0;s<r.length;s++){const h=gt(r[s]);if(Array.isArray(h)){if(0===h.length)throw new Error("Arguments array must have arguments.");let m,y=_t.Default;for(let w=0;w<h.length;w++){const I=h[w],k=oo(I);"number"==typeof k?-1===k?m=I.token:y|=k:m=I}o.push(Qt(m,y))}else o.push(Qt(h))}return o}function gi(r,o){return r[It]=o,r.prototype[It]=o,r}function oo(r){return r[It]}const Wo=gi(Fs("Inject",r=>({token:r})),-1),so=gi(Fs("Optional"),8),Or=gi(Fs("SkipSelf"),4);class ru{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function wa(r){return r instanceof ru?r.changingThisBreaksApplicationSecurity:r}const pf=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Qs=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var Ii=(()=>((Ii=Ii||{})[Ii.NONE=0]="NONE",Ii[Ii.HTML=1]="HTML",Ii[Ii.STYLE=2]="STYLE",Ii[Ii.SCRIPT=3]="SCRIPT",Ii[Ii.URL=4]="URL",Ii[Ii.RESOURCE_URL=5]="RESOURCE_URL",Ii))();function Wu(r){const o=function(){const r=wt();return r&&r[12]}();return o?o.sanitize(Ii.URL,r)||"":function(r,o){const s=function(r){return r instanceof ru&&r.getTypeName()||null}(r);if(null!=s&&s!==o){if("ResourceURL"===s&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${s} (see https://g.co/ng/security#xss)`)}return s===o}(r,"URL")?wa(r):function(r){return(r=String(r)).match(pf)||r.match(Qs)?r:"unsafe:"+r}(Re(r))}const Gh="__ngContext__";function Ro(r,o){r[Gh]=o}function ao(r){const o=function(r){return r[Gh]||null}(r);return o?Array.isArray(o)?o:o.lView:null}function qh(r){return r.ngOriginalError}function hu(r,...o){r.error(...o)}class ec{constructor(){this._console=console}handleError(o){const s=this._findOriginalError(o),h=(r=o)&&r.ngErrorLogger||hu;var r;h(this._console,"ERROR",o),s&&h(this._console,"ORIGINAL ERROR",s)}_findOriginalError(o){let s=o&&qh(o);for(;s&&qh(s);)s=qh(s);return s||null}}const Yh=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(nr))();function Os(r){return r instanceof Function?r():r}var Da=(()=>((Da=Da||{})[Da.Important=1]="Important",Da[Da.DashCase=2]="DashCase",Da))();function Yu(r,o){return undefined(r,o)}function du(r){const o=r[3];return $r(o)?o[3]:o}function Qh(r){return Of(r[13])}function ed(r){return Of(r[4])}function Of(r){for(;null!==r&&!$r(r);)r=r[4];return r}function xl(r,o,s,h,m){if(null!=h){let y,w=!1;$r(h)?y=h:ki(h)&&(w=!0,h=h[0]);const I=fn(h);0===r&&null!==s?null==m?Vf(o,s,I):qa(o,s,I,m||null,!0):1===r&&null!==s?qa(o,s,I,m||null,!0):2===r?function(r,o,s){const h=rc(r,o);h&&function(r,o,s,h){ht(r)?r.removeChild(o,s,h):o.removeChild(s)}(r,h,o,s)}(o,I,w):3===r&&o.destroyNode(I),null!=y&&function(r,o,s,h,m){const y=s[7];y!==fn(s)&&xl(o,r,h,y,m);for(let I=10;I<s.length;I++){const k=s[I];mu(k[1],k,r,o,h,y)}}(o,r,y,s,m)}}function ii(r,o,s){return ht(r)?r.createElement(o,s):null===s?r.createElement(o):r.createElementNS(s,o)}function nd(r,o){const s=r[9],h=s.indexOf(o),m=o[3];1024&o[2]&&(o[2]&=-1025,As(m,-1)),s.splice(h,1)}function nc(r,o){if(r.length<=10)return;const s=10+o,h=r[s];if(h){const m=h[17];null!==m&&m!==r&&nd(m,h),o>0&&(r[s-1][4]=h[4]);const y=_(r,10+o);!function(r,o){mu(r,o,o[11],2,null,null),o[0]=null,o[6]=null}(h[1],h);const w=y[19];null!==w&&w.detachView(y[1]),h[3]=null,h[4]=null,h[2]&=-129}return h}function eh(r,o){if(!(256&o[2])){const s=o[11];ht(s)&&s.destroyNode&&mu(r,o,s,3,null,null),function(r){let o=r[13];if(!o)return pu(r[1],r);for(;o;){let s=null;if(ki(o))s=o[13];else{const h=o[10];h&&(s=h)}if(!s){for(;o&&!o[4]&&o!==r;)ki(o)&&pu(o[1],o),o=o[3];null===o&&(o=r),ki(o)&&pu(o[1],o),s=o&&o[4]}o=s}}(o)}}function pu(r,o){if(!(256&o[2])){o[2]&=-129,o[2]|=256,function(r,o){let s;if(null!=r&&null!=(s=r.destroyHooks))for(let h=0;h<s.length;h+=2){const m=o[s[h]];if(!(m instanceof Mo)){const y=s[h+1];if(Array.isArray(y))for(let w=0;w<y.length;w+=2){const I=m[y[w]],k=y[w+1];try{k.call(I)}finally{}}else try{y.call(m)}finally{}}}}(r,o),function(r,o){const s=r.cleanup,h=o[7];let m=-1;if(null!==s)for(let y=0;y<s.length-1;y+=2)if("string"==typeof s[y]){const w=s[y+1],I="function"==typeof w?w(o):fn(o[w]),k=h[m=s[y+2]],G=s[y+3];"boolean"==typeof G?I.removeEventListener(s[y],k,G):G>=0?h[m=G]():h[m=-G].unsubscribe(),y+=2}else{const w=h[m=s[y+1]];s[y].call(w)}if(null!==h){for(let y=m+1;y<h.length;y++)h[y]();o[7]=null}}(r,o),1===o[1].type&&ht(o[11])&&o[11].destroy();const s=o[17];if(null!==s&&$r(o[3])){s!==o[3]&&nd(s,o);const h=o[19];null!==h&&h.detachView(r)}}}function Ic(r,o,s){return function(r,o,s){let h=o;for(;null!==h&&40&h.type;)h=(o=h).parent;if(null===h)return s[0];if(2&h.flags){const m=r.data[h.directiveStart].encapsulation;if(m===tr.None||m===tr.Emulated)return null}return Dn(h,s)}(r,o.parent,s)}function qa(r,o,s,h,m){ht(r)?r.insertBefore(o,s,h,m):o.insertBefore(s,h,m)}function Vf(r,o,s){ht(r)?r.appendChild(o,s):o.appendChild(s)}function th(r,o,s,h,m){null!==h?qa(r,o,s,h,m):Vf(r,o,s)}function rc(r,o){return ht(r)?r.parentNode(o):o.parentNode}let Gf=function(r,o,s){return 40&r.type?Dn(r,s):null};function Wa(r,o,s,h){const m=Ic(r,h,o),y=o[11],I=function(r,o,s){return Gf(r,o,s)}(h.parent||o[6],h,o);if(null!=m)if(Array.isArray(s))for(let k=0;k<s.length;k++)th(y,m,s[k],I,!1);else th(y,m,s,I,!1)}function nh(r,o){if(null!==o){const s=o.type;if(3&s)return Dn(o,r);if(4&s)return rh(-1,r[o.index]);if(8&s){const h=o.child;if(null!==h)return nh(r,h);{const m=r[o.index];return $r(m)?rh(-1,m):fn(m)}}if(32&s)return Yu(o,r)()||fn(r[o.index]);{const h=Hf(r,o);return null!==h?Array.isArray(h)?h[0]:nh(du(r[16]),h):nh(r,o.next)}}return null}function Hf(r,o){return null!==o?r[16][6].projection[o.projection]:null}function rh(r,o){const s=10+r+1;if(s<o.length){const h=o[s],m=h[1].firstChild;if(null!==m)return nh(h,m)}return o[7]}function ad(r,o,s,h,m,y,w){for(;null!=s;){const I=h[s.index],k=s.type;if(w&&0===o&&(I&&Ro(fn(I),h),s.flags|=4),64!=(64&s.flags))if(8&k)ad(r,o,s.child,h,m,y,!1),xl(o,r,m,I,y);else if(32&k){const G=Yu(s,h);let q;for(;q=G();)xl(o,r,m,q,y);xl(o,r,m,I,y)}else 16&k?Zf(r,o,h,s,m,y):xl(o,r,m,I,y);s=w?s.projectionNext:s.next}}function mu(r,o,s,h,m,y){ad(s,h,r.firstChild,o,m,y,!1)}function Zf(r,o,s,h,m,y){const w=s[16],k=w[6].projection[h.projection];if(Array.isArray(k))for(let G=0;G<k.length;G++)xl(o,r,m,k[G],y);else ad(r,o,k,w[3],m,y,!0)}function ld(r,o,s){ht(r)?r.setAttribute(o,"style",s):o.style.cssText=s}function _u(r,o,s){ht(r)?""===s?r.removeAttribute(o,"class"):r.setAttribute(o,"class",s):o.className=s}function qf(r,o,s){let h=r.length;for(;;){const m=r.indexOf(o,s);if(-1===m)return m;if(0===m||r.charCodeAt(m-1)<=32){const y=o.length;if(m+y===h||r.charCodeAt(m+y)<=32)return m}s=m+1}}const Mc="ng-template";function Wf(r,o,s){let h=0;for(;h<r.length;){let m=r[h++];if(s&&"class"===m){if(m=r[h],-1!==qf(m.toLowerCase(),o,0))return!0}else if(1===m){for(;h<r.length&&"string"==typeof(m=r[h++]);)if(m.toLowerCase()===o)return!0;return!1}}return!1}function cd(r){return 4===r.type&&r.value!==Mc}function Dm(r,o,s){return o===(4!==r.type||s?r.value:Mc)}function Cm(r,o,s){let h=4;const m=r.attrs||[],y=function(r){for(let o=0;o<r.length;o++)if($i(r[o]))return o;return r.length}(m);let w=!1;for(let I=0;I<o.length;I++){const k=o[I];if("number"!=typeof k){if(!w)if(4&h){if(h=2|1&h,""!==k&&!Dm(r,k,s)||""===k&&1===o.length){if(ea(h))return!1;w=!0}}else{const G=8&h?k:o[++I];if(8&h&&null!==r.attrs){if(!Wf(r.attrs,G,s)){if(ea(h))return!1;w=!0}continue}const he=Tm(8&h?"class":k,m,cd(r),s);if(-1===he){if(ea(h))return!1;w=!0;continue}if(""!==G){let Ie;Ie=he>y?"":m[he+1].toLowerCase();const Ve=8&h?Ie:null;if(Ve&&-1!==qf(Ve,G,0)||2&h&&G!==Ie){if(ea(h))return!1;w=!0}}}}else{if(!w&&!ea(h)&&!ea(k))return!1;if(w&&ea(k))continue;w=!1,h=k|1&h}}return ea(h)||w}function ea(r){return 0==(1&r)}function Tm(r,o,s,h){if(null===o)return-1;let m=0;if(h||!s){let y=!1;for(;m<o.length;){const w=o[m];if(w===r)return m;if(3===w||6===w)y=!0;else{if(1===w||2===w){let I=o[++m];for(;"string"==typeof I;)I=o[++m];continue}if(4===w)break;if(0===w){m+=4;continue}}m+=y?1:2}return-1}return function(r,o){let s=r.indexOf(4);if(s>-1)for(s++;s<r.length;){const h=r[s];if("number"==typeof h)return-1;if(h===o)return s;s++}return-1}(o,r)}function Xf(r,o,s=!1){for(let h=0;h<o.length;h++)if(Cm(r,o[h],s))return!0;return!1}function ud(r,o){return r?":not("+o.trim()+")":o}function Yf(r){let o=r[0],s=1,h=2,m="",y=!1;for(;s<r.length;){let w=r[s];if("string"==typeof w)if(2&h){const I=r[++s];m+="["+w+(I.length>0?'="'+I+'"':"")+"]"}else 8&h?m+="."+w:4&h&&(m+=" "+w);else""!==m&&!ea(w)&&(o+=ud(y,m),m=""),h=w,y=y||!ea(h);s++}return""!==m&&(o+=ud(y,m)),o}const qn={};function Jf(r){Qf(Zn(),wt(),ci()+r,da())}function Qf(r,o,s,h){if(!h)if(3==(3&o[2])){const y=r.preOrderCheckHooks;null!==y&&ma(o,y,s)}else{const y=r.preOrderHooks;null!==y&&za(o,y,0,s)}Io(s)}function oh(r,o){return r<<17|o<<2}function Zr(r){return r>>17&32767}function Ac(r){return 2|r}function os(r){return(131068&r)>>2}function fd(r,o){return-131069&r|o<<2}function oc(r){return 1|r}function cp(r,o){const s=r.contentQueries;if(null!==s)for(let h=0;h<s.length;h+=2){const m=s[h],y=s[h+1];if(-1!==y){const w=r.data[y];Ys(m),w.contentQueries(2,o[y],y)}}}function kc(r,o,s,h,m,y,w,I,k,G){const q=o.blueprint.slice();return q[0]=m,q[2]=140|h,ua(q),q[3]=q[15]=r,q[8]=s,q[10]=w||r&&r[10],q[11]=I||r&&r[11],q[12]=k||r&&r[12]||null,q[9]=G||r&&r[9]||null,q[6]=y,q[16]=2==o.type?r[16]:q,q}function sc(r,o,s,h,m){let y=r.data[o];if(null===y)y=function(r,o,s,h,m){const y=ha(),w=Fa(),k=r.data[o]=function(r,o,s,h,m,y){return{type:s,index:h,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:m,attrs:y,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,w?y:y&&y.parent,s,o,h,m);return null===r.firstChild&&(r.firstChild=k),null!==y&&(w?null==y.child&&null!==k.parent&&(y.child=k):null===y.next&&(y.next=k)),k}(r,o,s,h,m),Ln.lFrame.inI18n&&(y.flags|=64);else if(64&y.type){y.type=s,y.value=h,y.attrs=m;const w=function(){const r=Ln.lFrame,o=r.currentTNode;return r.isParent?o:o.parent}();y.injectorIndex=null===w?-1:w.injectorIndex}return ni(y,!0),y}function ac(r,o,s,h){if(0===s)return-1;const m=o.length;for(let y=0;y<s;y++)o.push(h),r.blueprint.push(h),r.data.push(null);return m}function Eu(r,o,s){So(o);try{const h=r.viewQuery;null!==h&&_h(1,h,s);const m=r.template;null!==m&&bd(r,o,m,1,s),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&cp(r,o),r.staticViewQueries&&_h(2,r.viewQuery,s);const y=r.components;null!==y&&function(r,o){for(let s=0;s<o.length;s++)Xm(r,o[s])}(o,y)}catch(h){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),h}finally{o[2]&=-5,jo()}}function Rc(r,o,s,h){const m=o[2];if(256==(256&m))return;So(o);const y=da();try{ua(o),function(r){Ln.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==s&&bd(r,o,s,2,h);const w=3==(3&m);if(!y)if(w){const G=r.preOrderCheckHooks;null!==G&&ma(o,G,null)}else{const G=r.preOrderHooks;null!==G&&za(o,G,0,null),ga(o,0)}if(function(r){for(let o=Qh(r);null!==o;o=ed(o)){if(!o[2])continue;const s=o[9];for(let h=0;h<s.length;h++){const m=s[h],y=m[3];0==(1024&m[2])&&As(y,1),m[2]|=1024}}}(o),function(r){for(let o=Qh(r);null!==o;o=ed(o))for(let s=10;s<o.length;s++){const h=o[s],m=h[1];ts(h)&&Rc(m,h,m.template,h[8])}}(o),null!==r.contentQueries&&cp(r,o),!y)if(w){const G=r.contentCheckHooks;null!==G&&ma(o,G)}else{const G=r.contentHooks;null!==G&&za(o,G,1),ga(o,1)}!function(r,o){const s=r.hostBindingOpCodes;if(null!==s)try{for(let h=0;h<s.length;h++){const m=s[h];if(m<0)Io(~m);else{const y=m,w=s[++h],I=s[++h];qc(w,y),I(2,o[y])}}}finally{Io(-1)}}(r,o);const I=r.components;null!==I&&function(r,o){for(let s=0;s<o.length;s++)Wm(r,o[s])}(o,I);const k=r.viewQuery;if(null!==k&&_h(2,k,h),!y)if(w){const G=r.viewCheckHooks;null!==G&&ma(o,G)}else{const G=r.viewHooks;null!==G&&za(o,G,2),ga(o,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),y||(o[2]&=-73),1024&o[2]&&(o[2]&=-1025,As(o[3],-1))}finally{jo()}}function hp(r,o,s,h){const m=o[10],y=!da(),w=ro(o);try{y&&!w&&m.begin&&m.begin(),w&&Eu(r,o,h),Rc(r,o,s,h)}finally{y&&!w&&m.end&&m.end()}}function bd(r,o,s,h,m){const y=ci(),w=2&h;try{Io(-1),w&&o.length>20&&Qf(r,o,20,da()),s(h,m)}finally{Io(y)}}function ch(r,o,s){!pc()||(function(r,o,s,h){const m=s.directiveStart,y=s.directiveEnd;r.firstCreatePass||bs(s,o),Ro(h,o);const w=s.initialInputs;for(let I=m;I<y;I++){const k=r.data[I],G=Jr(k);G&&Td(o,s,k);const q=Kt(o,r,I,s);Ro(q,o),null!==w&&Id(0,I-m,q,k,0,w),G&&(ai(s.index,o)[8]=q)}}(r,o,s,Dn(s,o)),128==(128&s.flags)&&function(r,o,s){const h=s.directiveStart,m=s.directiveEnd,w=s.index,I=Ln.lFrame.currentDirectiveIndex;try{Io(w);for(let k=h;k<m;k++){const G=r.data[k],q=o[k];mo(k),(null!==G.hostBindings||0!==G.hostVars||null!==G.hostAttrs)&&_p(G,q)}}finally{Io(-1),mo(I)}}(r,o,s))}function uh(r,o,s=Dn){const h=o.localNames;if(null!==h){let m=o.index+1;for(let y=0;y<h.length;y+=2){const w=h[y+1],I=-1===w?s(o,r):r[w];r[m++]=I}}}function hh(r){const o=r.tView;return null===o||o.incompleteFirstPass?r.tView=Ka(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts):o}function Ka(r,o,s,h,m,y,w,I,k,G){const q=20+h,he=q+m,Ie=function(r,o){const s=[];for(let h=0;h<o;h++)s.push(h<r?null:qn);return s}(q,he),Ve="function"==typeof G?G():G;return Ie[1]={type:r,blueprint:Ie,template:s,queries:null,viewQuery:I,declTNode:o,data:Ie.slice().fill(null,q),bindingStartIndex:q,expandoStartIndex:he,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof y?y():y,pipeRegistry:"function"==typeof w?w():w,firstChild:null,schemas:k,consts:Ve,incompleteFirstPass:!1}}function Tu(r,o,s,h){const m=Ad(o);null===s?m.push(h):(m.push(s),r.firstCreatePass&&vh(r).push(h,m.length-1))}function fp(r,o,s){for(let h in r)if(r.hasOwnProperty(h)){const m=r[h];(s=null===s?{}:s).hasOwnProperty(h)?s[h].push(o,m):s[h]=[o,m]}return s}function Ca(r,o,s,h){let m=!1;if(pc()){const y=function(r,o,s){const h=r.directiveRegistry;let m=null;if(h)for(let y=0;y<h.length;y++){const w=h[y];Xf(s,w.selectors,!1)&&(m||(m=[]),M(bs(s,o),r,w.type),Jr(w)?(yp(r,s),m.unshift(w)):m.push(w))}return m}(r,o,s),w=null===h?null:{"":-1};if(null!==y){m=!0,vp(s,r.data.length,y.length);for(let q=0;q<y.length;q++){const he=y[q];he.providersResolver&&he.providersResolver(he)}let I=!1,k=!1,G=ac(r,o,y.length,null);for(let q=0;q<y.length;q++){const he=y[q];s.mergedAttrs=Ki(s.mergedAttrs,he.hostAttrs),ph(r,s,o,G,he),Cd(G,he,w),null!==he.contentQueries&&(s.flags|=8),(null!==he.hostBindings||null!==he.hostAttrs||0!==he.hostVars)&&(s.flags|=128);const Ie=he.type.prototype;!I&&(Ie.ngOnChanges||Ie.ngOnInit||Ie.ngDoCheck)&&((r.preOrderHooks||(r.preOrderHooks=[])).push(s.index),I=!0),!k&&(Ie.ngOnChanges||Ie.ngDoCheck)&&((r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(s.index),k=!0),G++}!function(r,o){const h=o.directiveEnd,m=r.data,y=o.attrs,w=[];let I=null,k=null;for(let G=o.directiveStart;G<h;G++){const q=m[G],he=q.inputs,Ie=null===y||cd(o)?null:xp(he,y);w.push(Ie),I=fp(he,G,I),k=fp(q.outputs,G,k)}null!==I&&(I.hasOwnProperty("class")&&(o.flags|=16),I.hasOwnProperty("style")&&(o.flags|=32)),o.initialInputs=w,o.inputs=I,o.outputs=k}(r,s)}w&&function(r,o,s){if(o){const h=r.localNames=[];for(let m=0;m<o.length;m+=2){const y=s[o[m+1]];if(null==y)throw new gn("301",`Export of name '${o[m+1]}' not found!`);h.push(o[m],y)}}}(s,h,w)}return s.mergedAttrs=Ki(s.mergedAttrs,s.attrs),m}function Ed(r,o,s,h,m,y){const w=y.hostBindings;if(w){let I=r.hostBindingOpCodes;null===I&&(I=r.hostBindingOpCodes=[]);const k=~o.index;(function(r){let o=r.length;for(;o>0;){const s=r[--o];if("number"==typeof s&&s<0)return s}return 0})(I)!=k&&I.push(k),I.push(h,m,w)}}function _p(r,o){null!==r.hostBindings&&r.hostBindings(1,o)}function yp(r,o){o.flags|=2,(r.components||(r.components=[])).push(o.index)}function Cd(r,o,s){if(s){if(o.exportAs)for(let h=0;h<o.exportAs.length;h++)s[o.exportAs[h]]=r;Jr(o)&&(s[""]=r)}}function vp(r,o,s){r.flags|=1,r.directiveStart=o,r.directiveEnd=o+s,r.providerIndexes=o}function ph(r,o,s,h,m){r.data[h]=m;const y=m.factory||(m.factory=Un(m.type)),w=new Mo(y,Jr(m),null);r.blueprint[h]=w,s[h]=w,Ed(r,o,0,h,ac(r,s,m.hostVars,qn),m)}function Td(r,o,s){const h=Dn(o,r),m=hh(s),y=r[10],w=Iu(r,kc(r,m,null,s.onPush?64:16,h,o,y,y.createRenderer(h,s),null,null));r[o.index]=w}function vo(r,o,s,h,m,y){const w=Dn(r,o);!function(r,o,s,h,m,y,w){if(null==y)ht(r)?r.removeAttribute(o,m,s):o.removeAttribute(m);else{const I=null==w?Re(y):w(y,h||"",m);ht(r)?r.setAttribute(o,m,I,s):s?o.setAttributeNS(s,m,I):o.setAttribute(m,I)}}(o[11],w,y,r.value,s,h,m)}function Id(r,o,s,h,m,y){const w=y[o];if(null!==w){const I=h.setInput;for(let k=0;k<w.length;){const G=w[k++],q=w[k++],he=w[k++];null!==I?h.setInput(s,he,G,q):s[q]=he}}}function xp(r,o){let s=null,h=0;for(;h<o.length;){const m=o[h];if(0!==m)if(5!==m){if("number"==typeof m)break;r.hasOwnProperty(m)&&(null===s&&(s=[]),s.push(m,r[m],o[h+1])),h+=2}else h+=2;else h+=4}return s}function bp(r,o,s,h){return new Array(r,!0,!1,o,null,0,h,s,null,null)}function Wm(r,o){const s=ai(o,r);if(ts(s)){const h=s[1];80&s[2]?Rc(h,s,h.template,s[8]):s[5]>0&&Su(s)}}function Su(r){for(let h=Qh(r);null!==h;h=ed(h))for(let m=10;m<h.length;m++){const y=h[m];if(1024&y[2]){const w=y[1];Rc(w,y,w.template,y[8])}else y[5]>0&&Su(y)}const s=r[1].components;if(null!==s)for(let h=0;h<s.length;h++){const m=ai(s[h],r);ts(m)&&m[5]>0&&Su(m)}}function Xm(r,o){const s=ai(o,r),h=s[1];(function(r,o){for(let s=o.length;s<r.blueprint.length;s++)o.push(r.blueprint[s])})(h,s),Eu(h,s,s[8])}function Iu(r,o){return r[13]?r[14][4]=o:r[13]=o,r[14]=o,o}function mh(r){for(;r;){r[2]|=64;const o=du(r);if(Pl(r)&&!o)return r;r=o}return null}function zc(r,o,s){const h=o[10];h.begin&&h.begin();try{Rc(r,o,r.template,s)}catch(m){throw Lo(o,m),m}finally{h.end&&h.end()}}function gh(r){!function(r){for(let o=0;o<r.components.length;o++){const s=r.components[o],h=ao(s),m=h[1];hp(m,h,m.template,s)}}(r[8])}function _h(r,o,s){Ys(0),o(r,s)}const yh=(()=>Promise.resolve(null))();function Ad(r){return r[7]||(r[7]=[])}function vh(r){return r.cleanup||(r.cleanup=[])}function Lo(r,o){const s=r[9],h=s?s.get(ec,null):null;h&&h.handleError(o)}function Bc(r,o,s,h,m){for(let y=0;y<s.length;){const w=s[y++],I=s[y++],k=o[w],G=r.data[w];null!==G.setInput?G.setInput(k,m,h,I):k[I]=m}}function Ta(r,o,s){const h=Fr(o,r);!function(r,o,s){ht(r)?r.setValue(o,s):o.textContent=s}(r[11],h,s)}function Mu(r,o,s){let h=s?r.styles:null,m=s?r.classes:null,y=0;if(null!==o)for(let w=0;w<o.length;w++){const I=o[w];"number"==typeof I?y=I:1==y?m=pn(m,I):2==y&&(h=pn(h,I+": "+o[++w]+";"))}s?r.styles=h:r.stylesWithoutHost=h,s?r.classes=m:r.classesWithoutHost=m}const Sa=new ri("INJECTOR",-1);class na{get(o,s=nt){if(s===nt){const h=new Error(`NullInjectorError: No provider for ${Ot(o)}!`);throw h.name="NullInjectorError",h}return s}}const Ia=new ri("Set Injector scope."),Dl={},Dp={};let Au;function kd(){return void 0===Au&&(Au=new na),Au}function Rd(r,o=null,s=null,h){const m=Cp(r,o,s,h);return m._resolveInjectorDefTypes(),m}function Cp(r,o=null,s=null,h){return new Tp(r,s,o||kd(),h)}class Tp{constructor(o,s,h,m=null){this.parent=h,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const y=[];s&&l(s,I=>this.processProvider(I,o,s)),l([o],I=>this.processInjectorType(I,[],y)),this.records.set(Sa,lc(void 0,this));const w=this.records.get(Ia);this.scope=null!=w?w.value:null,this.source=m||("object"==typeof o?null:Ot(o))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(o=>o.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(o,s=nt,h=_t.Default){this.assertNotDestroyed();const m=Mn(this),y=En(void 0);try{if(!(h&_t.SkipSelf)){let I=this.records.get(o);if(void 0===I){const k=("function"==typeof(r=o)||"object"==typeof r&&r instanceof ri)&&Kr(o);I=k&&this.injectableDefInScope(k)?lc(xh(o),Dl):null,this.records.set(o,I)}if(null!=I)return this.hydrate(o,I)}return(h&_t.Self?kd():this.parent).get(o,s=h&_t.Optional&&s===nt?null:s)}catch(w){if("NullInjectorError"===w.name){if((w[Qe]=w[Qe]||[]).unshift(Ot(o)),m)throw w;return function(r,o,s,h){const m=r[Qe];throw o[Jt]&&m.unshift(o[Jt]),r.message=function(r,o,s,h=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.substr(2):r;let m=Ot(o);if(Array.isArray(o))m=o.map(Ot).join(" -> ");else if("object"==typeof o){let y=[];for(let w in o)if(o.hasOwnProperty(w)){let I=o[w];y.push(w+":"+("string"==typeof I?JSON.stringify(I):Ot(I)))}m=`{${y.join(", ")}}`}return`${s}${h?"("+h+")":""}[${m}]: ${r.replace(Ge,"\n  ")}`}("\n"+r.message,m,s,h),r.ngTokenPath=m,r[Qe]=null,r}(w,o,"R3InjectorError",this.source)}throw w}finally{En(y),Mn(m)}var r}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(o=>this.get(o))}toString(){const o=[];return this.records.forEach((h,m)=>o.push(Ot(m))),`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(o,s,h){if(!(o=gt(o)))return!1;let m=dt(o);const y=null==m&&o.ngModule||void 0,w=void 0===y?o:y,I=-1!==h.indexOf(w);if(void 0!==y&&(m=dt(y)),null==m)return!1;if(null!=m.imports&&!I){let q;h.push(w);try{l(m.imports,he=>{this.processInjectorType(he,s,h)&&(void 0===q&&(q=[]),q.push(he))})}finally{}if(void 0!==q)for(let he=0;he<q.length;he++){const{ngModule:Ie,providers:Ve}=q[he];l(Ve,ft=>this.processProvider(ft,Ie,Ve||Q))}}this.injectorDefTypes.add(w);const k=Un(w)||(()=>new w);this.records.set(w,lc(k,Dl));const G=m.providers;if(null!=G&&!I){const q=o;l(G,he=>this.processProvider(he,q,G))}return void 0!==y&&void 0!==o.providers}processProvider(o,s,h){let m=Qa(o=gt(o))?o:gt(o&&o.provide);const y=(r=o,Fd(r)?lc(void 0,r.useValue):lc(function(r,o,s){let h;if(Qa(r)){const m=gt(r);return Un(m)||xh(m)}if(Fd(r))h=()=>gt(r.useValue);else if(function(r){return!(!r||!r.useFactory)}(r))h=()=>r.useFactory(...ui(r.deps||[]));else if(function(r){return!(!r||!r.useExisting)}(r))h=()=>Qt(gt(r.useExisting));else{const m=gt(r&&(r.useClass||r.provide));if(!function(r){return!!r.deps}(r))return Un(m)||xh(m);h=()=>new m(...ui(r.deps))}return h}(r),Dl));var r;if(Qa(o)||!0!==o.multi)this.records.get(m);else{let w=this.records.get(m);w||(w=lc(void 0,Dl,!0),w.factory=()=>ui(w.multi),this.records.set(m,w)),m=o,w.multi.push(o)}this.records.set(m,y)}hydrate(o,s){return s.value===Dl&&(s.value=Dp,s.value=s.factory()),"object"==typeof s.value&&s.value&&null!==(r=s.value)&&"object"==typeof r&&"function"==typeof r.ngOnDestroy&&this.onDestroy.add(s.value),s.value;var r}injectableDefInScope(o){if(!o.providedIn)return!1;const s=gt(o.providedIn);return"string"==typeof s?"any"===s||s===this.scope:this.injectorDefTypes.has(s)}}function xh(r){const o=Kr(r),s=null!==o?o.factory:Un(r);if(null!==s)return s;if(r instanceof ri)throw new Error(`Token ${Ot(r)} is missing a \u0275prov definition.`);if(r instanceof Function)return function(r){const o=r.length;if(o>0){const h=function(r,o){const s=[];for(let h=0;h<r;h++)s.push(o);return s}(o,"?");throw new Error(`Can't resolve all parameters for ${Ot(r)}: (${h.join(", ")}).`)}const s=function(r){const o=r&&(r[Ae]||r[bt]);if(o){const s=function(r){if(r.hasOwnProperty("name"))return r.name;const o=(""+r).match(/^function\s*([^\s(]+)/);return null===o?"":o[1]}(r);return console.warn(`DEPRECATED: DI is instantiating a token "${s}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${s}" class.`),o}return null}(r);return null!==s?()=>s.factory(r):()=>new r}(r);throw new Error("unreachable")}function lc(r,o,s=!1){return{factory:r,value:o,multi:s?[]:void 0}}function Fd(r){return null!==r&&"object"==typeof r&&wn in r}function Qa(r){return"function"==typeof r}let Li=(()=>{class r{static create(s,h){var m;if(Array.isArray(s))return Rd({name:""},h,s,"");{const y=null!=(m=s.name)?m:"";return Rd({name:y},s.parent,s.providers,y)}}}return r.THROW_IF_NOT_FOUND=nt,r.NULL=new na,r.\u0275prov=$n({token:r,providedIn:"any",factory:()=>Qt(Sa)}),r.__NG_ELEMENT_ID__=-1,r})();function Bp(r,o){ys(ao(r)[1],li())}let b=null;function D(){if(!b){const r=nr.Symbol;if(r&&r.iterator)b=r.iterator;else{const o=Object.getOwnPropertyNames(Map.prototype);for(let s=0;s<o.length;++s){const h=o[s];"entries"!==h&&"size"!==h&&Map.prototype[h]===Map.prototype.entries&&(b=h)}}}return b}function P(r){return!!Z(r)&&(Array.isArray(r)||!(r instanceof Map)&&D()in r)}function Z(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function K(r,o,s){return r[o]=s}function de(r,o,s){return!Object.is(r[o],s)&&(r[o]=s,!0)}function be(r,o,s,h){const m=de(r,o,s);return de(r,o+1,h)||m}function Fe(r,o,s,h){const m=wt();return de(m,Vo(),o)&&(Zn(),vo(Gr(),m,r,o,s,h)),Fe}function Ke(r,o,s,h,m,y){const I=be(r,Ln.lFrame.bindingIndex,s,m);return ns(2),I?o+Re(s)+h+Re(m)+y:qn}function _i(r,o,s,h,m,y,w,I){const k=wt(),G=Zn(),q=r+20,he=G.firstCreatePass?function(r,o,s,h,m,y,w,I,k){const G=o.consts,q=sc(o,r,4,w||null,Ci(G,I));Ca(o,s,q,Ci(G,k)),ys(o,q);const he=q.tViews=Ka(2,q,h,m,y,o.directiveRegistry,o.pipeRegistry,null,o.schemas,G);return null!==o.queries&&(o.queries.template(o,q),he.queries=o.queries.embeddedTView(q)),q}(q,G,k,o,s,h,m,y,w):G.data[q];ni(he,!1);const Ie=k[11].createComment("");Wa(G,k,Ie,he),Ro(Ie,k),Iu(k,k[q]=bp(Ie,k,Ie,he)),Ts(he)&&ch(G,k,he),null!=w&&uh(k,he,I)}function Hi(r){return Di(Ln.lFrame.contextLView,20+r)}function qd(r,o=_t.Default){const s=wt();return null===s?Qt(r,o):U(li(),s,gt(r),o)}function w_(){throw new Error("invalid")}function ig(r,o,s){const h=wt();return de(h,Vo(),o)&&function(r,o,s,h,m,y,w,I){const k=Dn(o,s);let q,G=o.inputs;!I&&null!=G&&(q=G[h])?(Bc(r,s,q,h,m),Qo(o)&&function(r,o){const s=ai(o,r);16&s[2]||(s[2]|=64)}(s,o.index)):3&o.type&&(h=function(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(h),m=null!=w?w(m,o.value||"",h):m,ht(y)?y.setProperty(k,h,m):xs(h)||(k.setProperty?k.setProperty(h,m):k[h]=m))}(Zn(),Gr(),h,r,o,h[11],s,!1),ig}function og(r,o,s,h,m){const w=m?"class":"style";Bc(r,s,o.inputs[w],w,h)}function sg(r,o,s,h){const m=wt(),y=Zn(),w=20+r,I=m[11],k=m[w]=ii(I,o,Ln.lFrame.currentNamespace),G=y.firstCreatePass?function(r,o,s,h,m,y,w){const I=o.consts,G=sc(o,r,2,m,Ci(I,y));return Ca(o,s,G,Ci(I,w)),null!==G.attrs&&Mu(G,G.attrs,!1),null!==G.mergedAttrs&&Mu(G,G.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,G),G}(w,y,m,0,o,s,h):y.data[w];ni(G,!0);const q=G.mergedAttrs;null!==q&&vs(I,k,q);const he=G.classes;null!==he&&_u(I,k,he);const Ie=G.styles;null!==Ie&&ld(I,k,Ie),64!=(64&G.flags)&&Wa(y,m,k,G),0===Ln.lFrame.elementDepthCount&&Ro(k,m),Ln.lFrame.elementDepthCount++,Ts(G)&&(ch(y,m,G),function(r,o,s){if(Bo(o)){const m=o.directiveEnd;for(let y=o.directiveStart;y<m;y++){const w=r.data[y];w.contentQueries&&w.contentQueries(1,s[y],y)}}}(y,G,m)),null!==h&&uh(m,G)}function ag(){let r=li();Fa()?Ln.lFrame.isParent=!1:(r=r.parent,ni(r,!1));const o=r;Ln.lFrame.elementDepthCount--;const s=Zn();s.firstCreatePass&&(ys(s,r),Bo(r)&&s.queries.elementEnd(r)),null!=o.classesWithoutHost&&function(r){return 0!=(16&r.flags)}(o)&&og(s,o,wt(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function(r){return 0!=(32&r.flags)}(o)&&og(s,o,wt(),o.stylesWithoutHost,!1)}function E_(r,o,s,h){sg(r,o,s,h),ag()}function T_(){return wt()}function lg(r){return!!r&&"function"==typeof r.then}function S_(r){return!!r&&"function"==typeof r.subscribe}const I_=S_;function cg(r,o,s,h){const m=wt(),y=Zn(),w=li();return function(r,o,s,h,m,y,w,I){const k=Ts(h),q=r.firstCreatePass&&vh(r),he=o[8],Ie=Ad(o);let Ve=!0;if(3&h.type||I){const Yt=Dn(h,o),sn=I?I(Yt):Yt,xt=Ie.length,Pn=I?pr=>I(fn(pr[h.index])):h.index;if(ht(s)){let pr=null;if(!I&&k&&(pr=function(r,o,s,h){const m=r.cleanup;if(null!=m)for(let y=0;y<m.length-1;y+=2){const w=m[y];if(w===s&&m[y+1]===h){const I=o[7],k=m[y+2];return I.length>k?I[k]:null}"string"==typeof w&&(y+=2)}return null}(r,o,m,h.index)),null!==pr)(pr.__ngLastListenerFn__||pr).__ngNextListenerFn__=y,pr.__ngLastListenerFn__=y,Ve=!1;else{y=ug(h,o,he,y,!1);const qr=s.listen(sn,m,y);Ie.push(y,qr),q&&q.push(m,Pn,xt,xt+1)}}else y=ug(h,o,he,y,!0),sn.addEventListener(m,y,w),Ie.push(y),q&&q.push(m,Pn,xt,w)}else y=ug(h,o,he,y,!1);const ft=h.outputs;let Nt;if(Ve&&null!==ft&&(Nt=ft[m])){const Yt=Nt.length;if(Yt)for(let sn=0;sn<Yt;sn+=2){const oa=o[Nt[sn]][Nt[sn+1]].subscribe(y),zu=Ie.length;Ie.push(y,oa),q&&q.push(m,h.index,zu,-(zu+1))}}}(y,m,m[11],w,r,o,!!s,h),cg}function P_(r,o,s,h){try{return!1!==s(h)}catch(m){return Lo(r,m),!1}}function ug(r,o,s,h,m){return function y(w){if(w===Function)return h;const I=2&r.flags?ai(r.index,o):o;0==(32&o[2])&&mh(I);let k=P_(o,0,h,w),G=y.__ngNextListenerFn__;for(;G;)k=P_(o,0,G,w)&&k,G=G.__ngNextListenerFn__;return m&&!1===k&&(w.preventDefault(),w.returnValue=!1),k}}function k_(r=1){return function(r){return(Ln.lFrame.contextLView=function(r,o){for(;r>0;)o=o[15],r--;return o}(r,Ln.lFrame.contextLView))[8]}(r)}function j_(r,o,s,h,m){const y=r[s+1],w=null===o;let I=h?Zr(y):os(y),k=!1;for(;0!==I&&(!1===k||w);){const q=r[I+1];P0(r[I],o)&&(k=!0,r[I+1]=h?oc(q):Ac(q)),I=h?Zr(q):os(q)}k&&(r[s+1]=h?Ac(y):oc(y))}function P0(r,o){return null===r||null==o||(Array.isArray(r)?r[1]:r)===o||!(!Array.isArray(r)||"string"!=typeof o)&&le(r,o)>=0}function dg(r,o){return function(r,o,s,h){const m=wt(),y=Zn(),w=ns(2);y.firstUpdatePass&&function(r,o,s,h){const m=r.data;if(null===m[s+1]){const y=m[ci()],w=function(r,o){return o>=r.expandoStartIndex}(r,s);(function(r,o){return 0!=(r.flags&(o?16:32))})(y,h)&&null===o&&!w&&(o=!1),o=function(r,o,s,h){const m=function(r){const o=Ln.lFrame.currentDirectiveIndex;return-1===o?null:r[o]}(r);let y=h?o.residualClasses:o.residualStyles;if(null===m)0===(h?o.classBindings:o.styleBindings)&&(s=Wd(s=fg(null,r,o,s,h),o.attrs,h),y=null);else{const w=o.directiveStylingLast;if(-1===w||r[w]!==m)if(s=fg(m,r,o,s,h),null===y){let k=function(r,o,s){const h=s?o.classBindings:o.styleBindings;if(0!==os(h))return r[Zr(h)]}(r,o,h);void 0!==k&&Array.isArray(k)&&(k=fg(null,r,o,k[1],h),k=Wd(k,o.attrs,h),function(r,o,s,h){r[Zr(s?o.classBindings:o.styleBindings)]=h}(r,o,h,k))}else y=function(r,o,s){let h;const m=o.directiveEnd;for(let y=1+o.directiveStylingLast;y<m;y++)h=Wd(h,r[y].hostAttrs,s);return Wd(h,o.attrs,s)}(r,o,h)}return void 0!==y&&(h?o.residualClasses=y:o.residualStyles=y),s}(m,y,o,h),function(r,o,s,h,m,y){let w=y?o.classBindings:o.styleBindings,I=Zr(w),k=os(w);r[h]=s;let q,G=!1;if(Array.isArray(s)){const he=s;q=he[1],(null===q||le(he,q)>0)&&(G=!0)}else q=s;if(m)if(0!==k){const Ie=Zr(r[I+1]);r[h+1]=oh(Ie,I),0!==Ie&&(r[Ie+1]=fd(r[Ie+1],h)),r[I+1]=function(r,o){return 131071&r|o<<17}(r[I+1],h)}else r[h+1]=oh(I,0),0!==I&&(r[I+1]=fd(r[I+1],h)),I=h;else r[h+1]=oh(k,0),0===I?I=h:r[k+1]=fd(r[k+1],h),k=h;G&&(r[h+1]=Ac(r[h+1])),j_(r,q,h,!0),j_(r,q,h,!1),function(r,o,s,h,m){const y=m?r.residualClasses:r.residualStyles;null!=y&&"string"==typeof o&&le(y,o)>=0&&(s[h+1]=oc(s[h+1]))}(o,q,r,h,y),w=oh(I,k),y?o.classBindings=w:o.styleBindings=w}(m,y,o,s,w,h)}}(y,r,w,h),o!==qn&&de(m,w,o)&&function(r,o,s,h,m,y,w,I){if(!(3&o.type))return;const k=r.data,G=k[I+1];Np(function(r){return 1==(1&r)}(G)?ey(k,o,s,m,os(G),w):void 0)||(Np(y)||function(r){return 2==(2&r)}(G)&&(y=ey(k,null,s,m,I,w)),function(r,o,s,h,m){const y=ht(r);if(o)m?y?r.addClass(s,h):s.classList.add(h):y?r.removeClass(s,h):s.classList.remove(h);else{let w=-1===h.indexOf("-")?void 0:Da.DashCase;if(null==m)y?r.removeStyle(s,h,w):s.style.removeProperty(h);else{const I="string"==typeof m&&m.endsWith("!important");I&&(m=m.slice(0,-10),w|=Da.Important),y?r.setStyle(s,h,m,w):s.style.setProperty(h,m,I?"important":"")}}}(h,w,Fr(ci(),s),m,y))}(y,y.data[ci()],m,m[11],r,m[w+1]=function(r,o){return null==r||("string"==typeof o?r+=o:"object"==typeof r&&(r=Ot(wa(r)))),r}(o,s),h,w)}(r,o,null,!0),dg}function fg(r,o,s,h,m){let y=null;const w=s.directiveEnd;let I=s.directiveStylingLast;for(-1===I?I=s.directiveStart:I++;I<w&&(y=o[I],h=Wd(h,y.hostAttrs,m),y!==r);)I++;return null!==r&&(s.directiveStylingLast=I),h}function Wd(r,o,s){const h=s?1:2;let m=-1;if(null!==o)for(let y=0;y<o.length;y++){const w=o[y];"number"==typeof w?m=w:m===h&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),X(r,w,!!s||o[++y]))}return void 0===r?null:r}function ey(r,o,s,h,m,y){const w=null===o;let I;for(;m>0;){const k=r[m],G=Array.isArray(k),q=G?k[1]:k,he=null===q;let Ie=s[m+1];Ie===qn&&(Ie=he?Q:void 0);let Ve=he?re(Ie,h):q===h?Ie:void 0;if(G&&!Np(Ve)&&(Ve=re(k,h)),Np(Ve)&&(I=Ve,w))return I;const ft=r[m+1];m=w?Zr(ft):os(ft)}if(null!==o){let k=y?o.residualClasses:o.residualStyles;null!=k&&(I=re(k,h))}return I}function Np(r){return void 0!==r}function ny(r,o=""){const s=wt(),h=Zn(),m=r+20,y=h.firstCreatePass?sc(h,m,1,o,null):h.data[m],w=s[m]=function(r,o){return ht(r)?r.createText(o):r.createTextNode(o)}(s[11],o);Wa(h,s,w,y),ni(y,!1)}function Up(r,o,s){const h=wt(),m=function(r,o,s,h){return de(r,Vo(),s)?o+Re(s)+h:qn}(h,r,o,s);return m!==qn&&Ta(h,ci(),m),Up}function pg(r,o,s,h,m){const y=wt(),w=Ke(y,r,o,s,h,m);return w!==qn&&Ta(y,ci(),w),pg}const Fu=void 0;var dx=["en",[["a","p"],["AM","PM"],Fu],[["AM","PM"],Fu,Fu],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Fu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Fu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Fu,"{1} 'at' {0}",Fu],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(r){const s=Math.floor(Math.abs(r)),h=r.toString().replace(/^[^.]*\.?/,"").length;return 1===s&&0===h?1:5}];let Th={};function mg(r){const o=function(r){return r.toLowerCase().replace(/_/g,"-")}(r);let s=Ey(o);if(s)return s;const h=o.split("-")[0];if(s=Ey(h),s)return s;if("en"===h)return dx;throw new Error(`Missing locale data for the locale "${r}".`)}function wy(r){return mg(r)[Nn.PluralCase]}function Ey(r){return r in Th||(Th[r]=nr.ng&&nr.ng.common&&nr.ng.common.locales&&nr.ng.common.locales[r]),Th[r]}var Nn=(()=>((Nn=Nn||{})[Nn.LocaleId=0]="LocaleId",Nn[Nn.DayPeriodsFormat=1]="DayPeriodsFormat",Nn[Nn.DayPeriodsStandalone=2]="DayPeriodsStandalone",Nn[Nn.DaysFormat=3]="DaysFormat",Nn[Nn.DaysStandalone=4]="DaysStandalone",Nn[Nn.MonthsFormat=5]="MonthsFormat",Nn[Nn.MonthsStandalone=6]="MonthsStandalone",Nn[Nn.Eras=7]="Eras",Nn[Nn.FirstDayOfWeek=8]="FirstDayOfWeek",Nn[Nn.WeekendRange=9]="WeekendRange",Nn[Nn.DateFormat=10]="DateFormat",Nn[Nn.TimeFormat=11]="TimeFormat",Nn[Nn.DateTimeFormat=12]="DateTimeFormat",Nn[Nn.NumberSymbols=13]="NumberSymbols",Nn[Nn.NumberFormats=14]="NumberFormats",Nn[Nn.CurrencyCode=15]="CurrencyCode",Nn[Nn.CurrencySymbol=16]="CurrencySymbol",Nn[Nn.CurrencyName=17]="CurrencyName",Nn[Nn.Currencies=18]="Currencies",Nn[Nn.Directionality=19]="Directionality",Nn[Nn.PluralCase=20]="PluralCase",Nn[Nn.ExtraData=21]="ExtraData",Nn))();const Vp="en-US";let Dy=Vp;class Xy{}class m1{resolveComponentFactory(o){throw function(r){const o=Error(`No component factory found for ${Ot(r)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=r,o}(o)}}let Qd=(()=>{class r{}return r.NULL=new m1,r})();function g1(){return Ih(li(),wt())}function Ih(r,o){return new ef(Dn(r,o))}let ef=(()=>{class r{constructor(s){this.nativeElement=s}}return r.__NG_ELEMENT_ID__=g1,r})();function _1(r){return r instanceof ef?r.nativeElement:r}class Ky{}let y1=(()=>{class r{}return r.__NG_ELEMENT_ID__=()=>function(){const r=wt(),s=ai(li().index,r);return function(r){return r[11]}(ki(s)?s:r)}(),r})(),b1=(()=>{class r{}return r.\u0275prov=$n({token:r,providedIn:"root",factory:()=>null}),r})();class Jy{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const w1=new Jy("13.0.3"),wg={};function Zp(r,o,s,h,m=!1){for(;null!==s;){const y=o[s.index];if(null!==y&&h.push(fn(y)),$r(y))for(let I=10;I<y.length;I++){const k=y[I],G=k[1].firstChild;null!==G&&Zp(k[1],k,G,h)}const w=s.type;if(8&w)Zp(r,o,s.child,h);else if(32&w){const I=Yu(s,o);let k;for(;k=I();)h.push(k)}else if(16&w){const I=Hf(o,s);if(Array.isArray(I))h.push(...I);else{const k=du(o[16]);Zp(k[1],k,I,h,!0)}}s=m?s.projectionNext:s.next}return h}class tf{constructor(o,s){this._lView=o,this._cdRefInjectingView=s,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const o=this._lView,s=o[1];return Zp(s,o,s.firstChild,[])}get context(){return this._lView[8]}set context(o){this._lView[8]=o}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[3];if($r(o)){const s=o[8],h=s?s.indexOf(this):-1;h>-1&&(nc(o,h),_(s,h))}this._attachedToViewContainer=!1}eh(this._lView[1],this._lView)}onDestroy(o){Tu(this._lView[1],this._lView,null,o)}markForCheck(){mh(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){zc(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(r,o,s){Qn(!0);try{zc(r,o,s)}finally{Qn(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var o;this._appRef=null,mu(this._lView[1],o=this._lView,o[11],2,null,null)}attachToAppRef(o){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=o}}class E1 extends tf{constructor(o){super(o),this._view=o}detectChanges(){gh(this._view)}checkNoChanges(){!function(r){Qn(!0);try{gh(r)}finally{Qn(!1)}}(this._view)}get context(){return null}}class Qy extends Qd{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const s=ae(o);return new Eg(s,this.ngModule)}}function ev(r){const o=[];for(let s in r)r.hasOwnProperty(s)&&o.push({propName:r[s],templateName:s});return o}const C1=new ri("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Yh});class Eg extends Xy{constructor(o,s){super(),this.componentDef=o,this.ngModule=s,this.componentType=o.type,this.selector=o.selectors.map(Yf).join(","),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!s}get inputs(){return ev(this.componentDef.inputs)}get outputs(){return ev(this.componentDef.outputs)}create(o,s,h,m){const y=(m=m||this.ngModule)?function(r,o){return{get:(s,h,m)=>{const y=r.get(s,wg,m);return y!==wg||h===wg?y:o.get(s,h,m)}}}(o,m.injector):o,w=y.get(Ky,cn),I=y.get(b1,null),k=w.createRenderer(null,this.componentDef),G=this.componentDef.selectors[0][0]||"div",q=h?function(r,o,s){if(ht(r))return r.selectRootElement(o,s===tr.ShadowDom);let h="string"==typeof o?r.querySelector(o):o;return h.textContent="",h}(k,h,this.componentDef.encapsulation):ii(w.createRenderer(null,this.componentDef),G,function(r){const o=r.toLowerCase();return"svg"===o?"http://www.w3.org/2000/svg":"math"===o?"http://www.w3.org/1998/MathML/":null}(G)),he=this.componentDef.onPush?576:528,Ie=function(r,o){return{components:[],scheduler:r||Yh,clean:yh,playerHandler:o||null,flags:0}}(),Ve=Ka(0,null,null,1,0,null,null,null,null,null),ft=kc(null,Ve,Ie,he,null,null,w,k,I,y);let Nt,Yt;So(ft);try{const sn=function(r,o,s,h,m,y){const w=s[1];s[20]=r;const k=sc(w,20,2,"#host",null),G=k.mergedAttrs=o.hostAttrs;null!==G&&(Mu(k,G,!0),null!==r&&(vs(m,r,G),null!==k.classes&&_u(m,r,k.classes),null!==k.styles&&ld(m,r,k.styles)));const q=h.createRenderer(r,o),he=kc(s,hh(o),null,o.onPush?64:16,s[20],k,h,q,y||null,null);return w.firstCreatePass&&(M(bs(k,s),w,o.type),yp(w,k),vp(k,s.length,1)),Iu(s,he),s[20]=he}(q,this.componentDef,ft,w,k);if(q)if(h)vs(k,q,["ng-version",w1.full]);else{const{attrs:xt,classes:Pn}=function(r){const o=[],s=[];let h=1,m=2;for(;h<r.length;){let y=r[h];if("string"==typeof y)2===m?""!==y&&o.push(y,r[++h]):8===m&&s.push(y);else{if(!ea(m))break;m=y}h++}return{attrs:o,classes:s}}(this.componentDef.selectors[0]);xt&&vs(k,q,xt),Pn&&Pn.length>0&&_u(k,q,Pn.join(" "))}if(Yt=To(Ve,20),void 0!==s){const xt=Yt.projection=[];for(let Pn=0;Pn<this.ngContentSelectors.length;Pn++){const pr=s[Pn];xt.push(null!=pr?Array.from(pr):null)}}Nt=function(r,o,s,h,m){const y=s[1],w=function(r,o,s){const h=li();r.firstCreatePass&&(s.providersResolver&&s.providersResolver(s),ph(r,h,o,ac(r,o,1,null),s));const m=Kt(o,r,h.directiveStart,h);Ro(m,o);const y=Dn(h,o);return y&&Ro(y,o),m}(y,s,o);if(h.components.push(w),r[8]=w,m&&m.forEach(k=>k(w,o)),o.contentQueries){const k=li();o.contentQueries(1,w,k.directiveStart)}const I=li();return!y.firstCreatePass||null===o.hostBindings&&null===o.hostAttrs||(Io(I.index),Ed(s[1],I,0,I.directiveStart,I.directiveEnd,o),_p(o,w)),w}(sn,this.componentDef,ft,Ie,[Bp]),Eu(Ve,ft,null)}finally{jo()}return new I1(this.componentType,Nt,Ih(Yt,ft),ft,Yt)}}class I1 extends class{}{constructor(o,s,h,m,y){super(),this.location=h,this._rootLView=m,this._tNode=y,this.instance=s,this.hostView=this.changeDetectorRef=new E1(m),this.componentType=o}get injector(){return new er(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}class Mh{}class tv{}const Ah=new Map;class iv extends Mh{constructor(o,s){super(),this._parent=s,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Qy(this);const h=Rt(o);this._bootstrapComponents=Os(h.bootstrap),this._r3Injector=Cp(o,s,[{provide:Mh,useValue:this},{provide:Qd,useValue:this.componentFactoryResolver}],Ot(o)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(o)}get(o,s=Li.THROW_IF_NOT_FOUND,h=_t.Default){return o===Li||o===Mh||o===Sa?this:this._r3Injector.get(o,s,h)}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(s=>s()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class Dg extends tv{constructor(o){super(),this.moduleType=o,null!==Rt(o)&&function(r){const o=new Set;!function s(h){const m=Rt(h,!0),y=m.id;null!==y&&(function(r,o,s){if(o&&o!==s)throw new Error(`Duplicate module registered for ${r} - ${Ot(o)} vs ${Ot(o.name)}`)}(y,Ah.get(y),h),Ah.set(y,h));const w=Os(m.imports);for(const I of w)o.has(I)||(o.add(I),s(I))}(r)}(o)}create(o){return new iv(this.moduleType,o)}}function ov(r,o,s,h){return function(r,o,s,h,m,y){const w=o+s;return de(r,w,m)?K(r,w+1,y?h.call(y,m):h(m)):nf(r,w+1)}(wt(),Ti(),r,o,s,h)}function nf(r,o){const s=r[o];return s===qn?void 0:s}function hv(r,o){const s=Zn();let h;const m=r+20;s.firstCreatePass?(h=function(r,o){if(o)for(let s=o.length-1;s>=0;s--){const h=o[s];if(r===h.name)return h}}(o,s.pipeRegistry),s.data[m]=h,h.onDestroy&&(s.destroyHooks||(s.destroyHooks=[])).push(m,h.onDestroy)):h=s.data[m];const y=h.factory||(h.factory=Un(h.type)),w=En(qd);try{const I=ya(!1),k=y();return ya(I),function(r,o,s,h){s>=r.data.length&&(r.data[s]=null,r.blueprint[s]=null),o[s]=h}(s,wt(),m,k),k}finally{En(w)}}function dv(r,o,s,h){const m=r+20,y=wt(),w=Di(y,m);return function(r,o){return r[1].data[o].pure}(y,m)?function(r,o,s,h,m,y,w){const I=o+s;return be(r,I,m,y)?K(r,I+2,w?h.call(w,m,y):h(m,y)):nf(r,I+2)}(y,Ti(),o,w.transform,s,h,w):w.transform(s,h)}function Cg(r){return o=>{setTimeout(r,void 0,o)}}const Al=class extends Gt.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,s,h){var k,G,q;let m=o,y=s||(()=>null),w=h;if(o&&"object"==typeof o){const he=o;m=null==(k=he.next)?void 0:k.bind(he),y=null==(G=he.error)?void 0:G.bind(he),w=null==(q=he.complete)?void 0:q.bind(he)}this.__isAsync&&(y=Cg(y),m&&(m=Cg(m)),w&&(w=Cg(w)));const I=super.subscribe({next:m,error:y,complete:w});return o instanceof je.w0&&o.add(I),I}};function Z1(){return this._results[D()]()}class Tg{constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const s=D(),h=Tg.prototype;h[s]||(h[s]=Z1)}get changes(){return this._changes||(this._changes=new Al)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,s){return this._results.reduce(o,s)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,s){const h=this;h.dirty=!1;const m=t(o);(this._changesDetected=!function(r,o,s){if(r.length!==o.length)return!1;for(let h=0;h<r.length;h++){let m=r[h],y=o[h];if(s&&(m=s(m),y=s(y)),y!==m)return!1}return!0}(h._results,m,s))&&(h._results=m,h.length=m.length,h.last=m[this.length-1],h.first=m[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let of=(()=>{class r{}return r.__NG_ELEMENT_ID__=X1,r})();const q1=of,W1=class extends q1{constructor(o,s,h){super(),this._declarationLView=o,this._declarationTContainer=s,this.elementRef=h}createEmbeddedView(o){const s=this._declarationTContainer.tViews,h=kc(this._declarationLView,s,o,16,null,s.declTNode,null,null,null,null);h[17]=this._declarationLView[this._declarationTContainer.index];const y=this._declarationLView[19];return null!==y&&(h[19]=y.createEmbeddedView(s)),Eu(s,h,o),new tf(h)}};function X1(){return qp(li(),wt())}function qp(r,o){return 4&r.type?new W1(o,r,Ih(r,o)):null}let Wp=(()=>{class r{}return r.__NG_ELEMENT_ID__=Y1,r})();function Y1(){return mv(li(),wt())}const K1=Wp,fv=class extends K1{constructor(o,s,h){super(),this._lContainer=o,this._hostTNode=s,this._hostLView=h}get element(){return Ih(this._hostTNode,this._hostLView)}get injector(){return new er(this._hostTNode,this._hostLView)}get parentInjector(){const o=Ba(this._hostTNode,this._hostLView);if(is(o)){const s=Ls(o,this._hostLView),h=Ao(o);return new er(s[1].data[h+8],s)}return new er(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const s=pv(this._lContainer);return null!==s&&s[o]||null}get length(){return this._lContainer.length-10}createEmbeddedView(o,s,h){const m=o.createEmbeddedView(s||{});return this.insert(m,h),m}createComponent(o,s,h,m,y){const w=o&&!("function"==typeof o);let I;if(w)I=s;else{const he=s||{};I=he.index,h=he.injector,m=he.projectableNodes,y=he.ngModuleRef}const k=w?o:new Eg(ae(o)),G=h||this.parentInjector;if(!y&&null==k.ngModule&&G){const he=G.get(Mh,null);he&&(y=he)}const q=k.create(G,m,void 0,y);return this.insert(q.hostView,I),q}insert(o,s){const h=o._lView,m=h[1];if($r(h[3])){const q=this.indexOf(o);if(-1!==q)this.detach(q);else{const he=h[3],Ie=new fv(he,he[6],he[3]);Ie.detach(Ie.indexOf(o))}}const y=this._adjustIndex(s),w=this._lContainer;!function(r,o,s,h){const m=10+h,y=s.length;h>0&&(s[m-1][4]=o),h<y-10?(o[4]=s[m],p(s,10+h,o)):(s.push(o),o[4]=null),o[3]=s;const w=o[17];null!==w&&s!==w&&function(r,o){const s=r[9];o[16]!==o[3][3][16]&&(r[2]=!0),null===s?r[9]=[o]:s.push(o)}(w,o);const I=o[19];null!==I&&I.insertView(r),o[2]|=128}(m,h,w,y);const I=rh(y,w),k=h[11],G=rc(k,w[7]);return null!==G&&function(r,o,s,h,m,y){h[0]=m,h[6]=o,mu(r,h,s,1,m,y)}(m,w[6],k,h,G,I),o.attachToViewContainerRef(),p(Sg(w),y,o),o}move(o,s){return this.insert(o,s)}indexOf(o){const s=pv(this._lContainer);return null!==s?s.indexOf(o):-1}remove(o){const s=this._adjustIndex(o,-1),h=nc(this._lContainer,s);h&&(_(Sg(this._lContainer),s),eh(h[1],h))}detach(o){const s=this._adjustIndex(o,-1),h=nc(this._lContainer,s);return h&&null!=_(Sg(this._lContainer),s)?new tf(h):null}_adjustIndex(o,s=0){return null==o?this.length+s:o}};function pv(r){return r[8]}function Sg(r){return r[8]||(r[8]=[])}function mv(r,o){let s;const h=o[r.index];if($r(h))s=h;else{let m;if(8&r.type)m=fn(h);else{const y=o[11];m=y.createComment("");const w=Dn(r,o);qa(y,rc(y,w),m,function(r,o){return ht(r)?r.nextSibling(o):o.nextSibling}(y,w),!1)}o[r.index]=s=bp(h,o,m,r),Iu(o,s)}return new fv(s,r,o)}class Ig{constructor(o){this.queryList=o,this.matches=null}clone(){return new Ig(this.queryList)}setDirty(){this.queryList.setDirty()}}class Mg{constructor(o=[]){this.queries=o}createEmbeddedView(o){const s=o.queries;if(null!==s){const h=null!==o.contentQueries?o.contentQueries[0]:s.length,m=[];for(let y=0;y<h;y++){const w=s.getByIndex(y);m.push(this.queries[w.indexInDeclarationView].clone())}return new Mg(m)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let s=0;s<this.queries.length;s++)null!==Dv(o,s).matches&&this.queries[s].setDirty()}}class gv{constructor(o,s,h=null){this.predicate=o,this.flags=s,this.read=h}}class Ag{constructor(o=[]){this.queries=o}elementStart(o,s){for(let h=0;h<this.queries.length;h++)this.queries[h].elementStart(o,s)}elementEnd(o){for(let s=0;s<this.queries.length;s++)this.queries[s].elementEnd(o)}embeddedTView(o){let s=null;for(let h=0;h<this.length;h++){const m=null!==s?s.length:0,y=this.getByIndex(h).embeddedTView(o,m);y&&(y.indexInDeclarationView=h,null!==s?s.push(y):s=[y])}return null!==s?new Ag(s):null}template(o,s){for(let h=0;h<this.queries.length;h++)this.queries[h].template(o,s)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class Pg{constructor(o,s=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=s}elementStart(o,s){this.isApplyingToNode(s)&&this.matchTNode(o,s)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,s){this.elementStart(o,s)}embeddedTView(o,s){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,s),new Pg(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const s=this._declarationNodeIndex;let h=o.parent;for(;null!==h&&8&h.type&&h.index!==s;)h=h.parent;return s===(null!==h?h.index:-1)}return this._appliesToNextNode}matchTNode(o,s){const h=this.metadata.predicate;if(Array.isArray(h))for(let m=0;m<h.length;m++){const y=h[m];this.matchTNodeWithReadOption(o,s,eb(s,y)),this.matchTNodeWithReadOption(o,s,Je(s,o,y,!1,!1))}else h===of?4&s.type&&this.matchTNodeWithReadOption(o,s,-1):this.matchTNodeWithReadOption(o,s,Je(s,o,h,!1,!1))}matchTNodeWithReadOption(o,s,h){if(null!==h){const m=this.metadata.read;if(null!==m)if(m===ef||m===Wp||m===of&&4&s.type)this.addMatch(s.index,-2);else{const y=Je(s,o,m,!1,!1);null!==y&&this.addMatch(s.index,y)}else this.addMatch(s.index,h)}}addMatch(o,s){null===this.matches?this.matches=[o,s]:this.matches.push(o,s)}}function eb(r,o){const s=r.localNames;if(null!==s)for(let h=0;h<s.length;h+=2)if(s[h]===o)return s[h+1];return null}function nb(r,o,s,h){return-1===s?function(r,o){return 11&r.type?Ih(r,o):4&r.type?qp(r,o):null}(o,r):-2===s?function(r,o,s){return s===ef?Ih(o,r):s===of?qp(o,r):s===Wp?mv(o,r):void 0}(r,o,h):Kt(r,r[1],s,o)}function _v(r,o,s,h){const m=o[19].queries[h];if(null===m.matches){const y=r.data,w=s.matches,I=[];for(let k=0;k<w.length;k+=2){const G=w[k];I.push(G<0?null:nb(o,y[G],w[k+1],s.metadata.read))}m.matches=I}return m.matches}function kg(r,o,s,h){const m=r.queries.getByIndex(s),y=m.matches;if(null!==y){const w=_v(r,o,m,s);for(let I=0;I<y.length;I+=2){const k=y[I];if(k>0)h.push(w[I/2]);else{const G=y[I+1],q=o[-k];for(let he=10;he<q.length;he++){const Ie=q[he];Ie[17]===Ie[3]&&kg(Ie[1],Ie,G,h)}if(null!==q[9]){const he=q[9];for(let Ie=0;Ie<he.length;Ie++){const Ve=he[Ie];kg(Ve[1],Ve,G,h)}}}}}return h}function yv(r){const o=wt(),s=Zn(),h=gs();Ys(h+1);const m=Dv(s,h);if(r.dirty&&ro(o)===(2==(2&m.metadata.flags))){if(null===m.matches)r.reset([]);else{const y=m.crossesNgTemplate?kg(s,o,h,[]):_v(s,o,m,h);r.reset(y,_1),r.notifyOnChanges()}return!0}return!1}function vv(r,o,s){const h=Zn();h.firstCreatePass&&(Ev(h,new gv(r,o,s),-1),2==(2&o)&&(h.staticViewQueries=!0)),wv(h,wt(),o)}function xv(r,o,s,h){const m=Zn();if(m.firstCreatePass){const y=li();Ev(m,new gv(o,s,h),y.index),function(r,o){const s=r.contentQueries||(r.contentQueries=[]);o!==(s.length?s[s.length-1]:-1)&&s.push(r.queries.length-1,o)}(m,r),2==(2&s)&&(m.staticContentQueries=!0)}wv(m,wt(),s)}function bv(){return r=wt(),o=gs(),r[19].queries[o].queryList;var r,o}function wv(r,o,s){const h=new Tg(4==(4&s));Tu(r,o,h,h.destroy),null===o[19]&&(o[19]=new Mg),o[19].queries.push(new Ig(h))}function Ev(r,o,s){null===r.queries&&(r.queries=new Ag),r.queries.track(new Pg(o,s))}function Dv(r,o){return r.queries.getByIndex(o)}function Kp(...r){}const Bg=new ri("Application Initializer");let kh=(()=>{class r{constructor(s){this.appInits=s,this.resolve=Kp,this.reject=Kp,this.initialized=!1,this.done=!1,this.donePromise=new Promise((h,m)=>{this.resolve=h,this.reject=m})}runInitializers(){if(this.initialized)return;const s=[],h=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let m=0;m<this.appInits.length;m++){const y=this.appInits[m]();if(lg(y))s.push(y);else if(I_(y)){const w=new Promise((I,k)=>{y.subscribe({complete:I,error:k})});s.push(w)}}Promise.all(s).then(()=>{h()}).catch(m=>{this.reject(m)}),0===s.length&&h(),this.initialized=!0}}return r.\u0275fac=function(s){return new(s||r)(Qt(Bg,8))},r.\u0275prov=$n({token:r,factory:r.\u0275fac}),r})();const jv=new ri("AppId"),Cb={provide:jv,useFactory:function(){return`${Ng()}${Ng()}${Ng()}`},deps:[]};function Ng(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const $v=new ri("Platform Initializer"),Gv=new ri("Platform ID"),Hv=new ri("appBootstrapListener");let Zv=(()=>{class r{log(s){console.log(s)}warn(s){console.warn(s)}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=$n({token:r,factory:r.\u0275fac}),r})();const Jp=new ri("LocaleId"),qv=new ri("DefaultCurrencyCode");class Tb{constructor(o,s){this.ngModuleFactory=o,this.componentFactories=s}}let Ug=(()=>{class r{compileModuleSync(s){return new Dg(s)}compileModuleAsync(s){return Promise.resolve(this.compileModuleSync(s))}compileModuleAndAllComponentsSync(s){const h=this.compileModuleSync(s),y=Os(Rt(s).declarations).reduce((w,I)=>{const k=ae(I);return k&&w.push(new Eg(k)),w},[]);return new Tb(h,y)}compileModuleAndAllComponentsAsync(s){return Promise.resolve(this.compileModuleAndAllComponentsSync(s))}clearCache(){}clearCacheFor(s){}getModuleId(s){}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=$n({token:r,factory:r.\u0275fac}),r})();const Ib=(()=>Promise.resolve(0))();function Vg(r){"undefined"==typeof Zone?Ib.then(()=>{r&&r.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",r)}class ia{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:s=!1,shouldCoalesceRunChangeDetection:h=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Al(!1),this.onMicrotaskEmpty=new Al(!1),this.onStable=new Al(!1),this.onError=new Al(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const m=this;m._nesting=0,m._outer=m._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(m._inner=m._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(m._inner=m._inner.fork(Zone.longStackTraceZoneSpec)),m.shouldCoalesceEventChangeDetection=!h&&s,m.shouldCoalesceRunChangeDetection=h,m.lastRequestAnimationFrameId=-1,m.nativeRequestAnimationFrame=function(){let r=nr.requestAnimationFrame,o=nr.cancelAnimationFrame;if("undefined"!=typeof Zone&&r&&o){const s=r[Zone.__symbol__("OriginalDelegate")];s&&(r=s);const h=o[Zone.__symbol__("OriginalDelegate")];h&&(o=h)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function(r){const o=()=>{!function(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(nr,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,$g(r),r.isCheckStableRunning=!0,jg(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),$g(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(s,h,m,y,w,I)=>{try{return Wv(r),s.invokeTask(m,y,w,I)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===y.type||r.shouldCoalesceRunChangeDetection)&&o(),Xv(r)}},onInvoke:(s,h,m,y,w,I,k)=>{try{return Wv(r),s.invoke(m,y,w,I,k)}finally{r.shouldCoalesceRunChangeDetection&&o(),Xv(r)}},onHasTask:(s,h,m,y)=>{s.hasTask(m,y),h===m&&("microTask"==y.change?(r._hasPendingMicrotasks=y.microTask,$g(r),jg(r)):"macroTask"==y.change&&(r.hasPendingMacrotasks=y.macroTask))},onHandleError:(s,h,m,y)=>(s.handleError(m,y),r.runOutsideAngular(()=>r.onError.emit(y)),!1)})}(m)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ia.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(ia.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(o,s,h){return this._inner.run(o,s,h)}runTask(o,s,h,m){const y=this._inner,w=y.scheduleEventTask("NgZoneEvent: "+m,o,Ab,Kp,Kp);try{return y.runTask(w,s,h)}finally{y.cancelTask(w)}}runGuarded(o,s,h){return this._inner.runGuarded(o,s,h)}runOutsideAngular(o){return this._outer.run(o)}}const Ab={};function jg(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function $g(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function Wv(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function Xv(r){r._nesting--,jg(r)}class Rb{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Al,this.onMicrotaskEmpty=new Al,this.onStable=new Al,this.onError=new Al}run(o,s,h){return o.apply(s,h)}runGuarded(o,s,h){return o.apply(s,h)}runOutsideAngular(o){return o()}runTask(o,s,h,m){return o.apply(s,h)}}let Yv=(()=>{class r{constructor(s){this._ngZone=s,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),s.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ia.assertNotInAngularZone(),Vg(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Vg(()=>{for(;0!==this._callbacks.length;){let s=this._callbacks.pop();clearTimeout(s.timeoutId),s.doneCb(this._didWork)}this._didWork=!1});else{let s=this.getPendingTasks();this._callbacks=this._callbacks.filter(h=>!h.updateCb||!h.updateCb(s)||(clearTimeout(h.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(s=>({source:s.source,creationLocation:s.creationLocation,data:s.data})):[]}addCallback(s,h,m){let y=-1;h&&h>0&&(y=setTimeout(()=>{this._callbacks=this._callbacks.filter(w=>w.timeoutId!==y),s(this._didWork,this.getPendingTasks())},h)),this._callbacks.push({doneCb:s,timeoutId:y,updateCb:m})}whenStable(s,h,m){if(m&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(s,h,m),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(s,h,m){return[]}}return r.\u0275fac=function(s){return new(s||r)(Qt(ia))},r.\u0275prov=$n({token:r,factory:r.\u0275fac}),r})(),Kv=(()=>{class r{constructor(){this._applications=new Map,Gg.addToWindow(this)}registerApplication(s,h){this._applications.set(s,h)}unregisterApplication(s){this._applications.delete(s)}unregisterAllApplications(){this._applications.clear()}getTestability(s){return this._applications.get(s)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(s,h=!0){return Gg.findTestabilityInTree(this,s,h)}}return r.\u0275fac=function(s){return new(s||r)},r.\u0275prov=$n({token:r,factory:r.\u0275fac}),r})();class Lb{addToWindow(o){}findTestabilityInTree(o,s,h){return null}}function Fb(r){Gg=r}let rl,Gg=new Lb;const Jv=new ri("AllowMultipleToken");class Nb{constructor(o,s){this.name=o,this.token=s}}function Qv(r,o,s=[]){const h=`Platform: ${o}`,m=new ri(h);return(y=[])=>{let w=e0();if(!w||w.injector.get(Jv,!1))if(r)r(s.concat(y).concat({provide:m,useValue:!0}));else{const I=s.concat(y).concat({provide:m,useValue:!0},{provide:Ia,useValue:"platform"});!function(r){if(rl&&!rl.destroyed&&!rl.injector.get(Jv,!1))throw new gn("400","");rl=r.get(t0);const o=r.get($v,null);o&&o.forEach(s=>s())}(Li.create({providers:I,name:h}))}return function(r){const o=e0();if(!o)throw new gn("401","");return o}()}}function e0(){return rl&&!rl.destroyed?rl:null}let t0=(()=>{class r{constructor(s){this._injector=s,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(s,h){const I=function(r,o){let s;return s="noop"===r?new Rb:("zone.js"===r?void 0:r)||new ia({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==o?void 0:o.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==o?void 0:o.ngZoneRunCoalescing)}),s}(h?h.ngZone:void 0,{ngZoneEventCoalescing:h&&h.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:h&&h.ngZoneRunCoalescing||!1}),k=[{provide:ia,useValue:I}];return I.run(()=>{const G=Li.create({providers:k,parent:this.injector,name:s.moduleType.name}),q=s.create(G),he=q.injector.get(ec,null);if(!he)throw new gn("402","");return I.runOutsideAngular(()=>{const Ie=I.onError.subscribe({next:Ve=>{he.handleError(Ve)}});q.onDestroy(()=>{Hg(this._modules,q),Ie.unsubscribe()})}),function(r,o,s){try{const h=s();return lg(h)?h.catch(m=>{throw o.runOutsideAngular(()=>r.handleError(m)),m}):h}catch(h){throw o.runOutsideAngular(()=>r.handleError(h)),h}}(he,I,()=>{const Ie=q.injector.get(kh);return Ie.runInitializers(),Ie.donePromise.then(()=>(function(r){Ir(r,"Expected localeId to be defined"),"string"==typeof r&&(Dy=r.toLowerCase().replace(/_/g,"-"))}(q.injector.get(Jp,Vp)||Vp),this._moduleDoBootstrap(q),q))})})}bootstrapModule(s,h=[]){const m=n0({},h);return function(r,o,s){const h=new Dg(s);return Promise.resolve(h)}(0,0,s).then(y=>this.bootstrapModuleFactory(y,m))}_moduleDoBootstrap(s){const h=s.injector.get(af);if(s._bootstrapComponents.length>0)s._bootstrapComponents.forEach(m=>h.bootstrap(m));else{if(!s.instance.ngDoBootstrap)throw new gn("403","");s.instance.ngDoBootstrap(h)}this._modules.push(s)}onDestroy(s){this._destroyListeners.push(s)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new gn("404","");this._modules.slice().forEach(s=>s.destroy()),this._destroyListeners.forEach(s=>s()),this._destroyed=!0}get destroyed(){return this._destroyed}}return r.\u0275fac=function(s){return new(s||r)(Qt(Li))},r.\u0275prov=$n({token:r,factory:r.\u0275fac}),r})();function n0(r,o){return Array.isArray(o)?o.reduce(n0,r):Hn(Hn({},r),o)}let af=(()=>{class r{constructor(s,h,m,y,w){this._zone=s,this._injector=h,this._exceptionHandler=m,this._componentFactoryResolver=y,this._initStatus=w,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const I=new ze.y(G=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{G.next(this._stable),G.complete()})}),k=new ze.y(G=>{let q;this._zone.runOutsideAngular(()=>{q=this._zone.onStable.subscribe(()=>{ia.assertNotInAngularZone(),Vg(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,G.next(!0))})})});const he=this._zone.onUnstable.subscribe(()=>{ia.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{G.next(!1)}))});return()=>{q.unsubscribe(),he.unsubscribe()}});this.isStable=function(...r){const o=(0,c.yG)(r),s=(0,c._6)(r,1/0),h=r;return h.length?1===h.length?(0,oe.Xf)(h[0]):(0,ue.J)(s)((0,Et.D)(h,o)):Lt.E}(I,k.pipe(function(r={}){const{connector:o=(()=>new Gt.x),resetOnError:s=!0,resetOnComplete:h=!0,resetOnRefCountZero:m=!0}=r;return y=>{let w=null,I=null,k=null,G=0,q=!1,he=!1;const Ie=()=>{null==I||I.unsubscribe(),I=null},Ve=()=>{Ie(),w=k=null,q=he=!1},ft=()=>{const Nt=w;Ve(),null==Nt||Nt.unsubscribe()};return(0,Zt.e)((Nt,Yt)=>{G++,!he&&!q&&Ie();const sn=k=null!=k?k:o();Yt.add(()=>{G--,0===G&&!he&&!q&&(I=it(ft,m))}),sn.subscribe(Yt),w||(w=new mt.Hp({next:xt=>sn.next(xt),error:xt=>{he=!0,Ie(),I=it(Ve,s,xt),sn.error(xt)},complete:()=>{q=!0,Ie(),I=it(Ve,h),sn.complete()}}),(0,Et.D)(Nt).subscribe(w))})(y)}}()))}bootstrap(s,h){if(!this._initStatus.done)throw new gn("405","");let m;m=s instanceof Xy?s:this._componentFactoryResolver.resolveComponentFactory(s),this.componentTypes.push(m.componentType);const y=function(r){return r.isBoundToModule}(m)?void 0:this._injector.get(Mh),I=m.create(Li.NULL,[],h||m.selector,y),k=I.location.nativeElement,G=I.injector.get(Yv,null),q=G&&I.injector.get(Kv);return G&&q&&q.registerApplication(k,G),I.onDestroy(()=>{this.detachView(I.hostView),Hg(this.components,I),q&&q.unregisterApplication(k)}),this._loadComponent(I),I}tick(){if(this._runningTick)throw new gn("101","");try{this._runningTick=!0;for(let s of this._views)s.detectChanges()}catch(s){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(s))}finally{this._runningTick=!1}}attachView(s){const h=s;this._views.push(h),h.attachToAppRef(this)}detachView(s){const h=s;Hg(this._views,h),h.detachFromAppRef()}_loadComponent(s){this.attachView(s.hostView),this.tick(),this.components.push(s),this._injector.get(Hv,[]).concat(this._bootstrapListeners).forEach(m=>m(s))}ngOnDestroy(){this._views.slice().forEach(s=>s.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return r.\u0275fac=function(s){return new(s||r)(Qt(ia),Qt(Li),Qt(ec),Qt(Qd),Qt(kh))},r.\u0275prov=$n({token:r,factory:r.\u0275fac}),r})();function Hg(r,o){const s=r.indexOf(o);s>-1&&r.splice(s,1)}let o0=!0;function Hb(){o0=!1}let Zb=(()=>{class r{}return r.__NG_ELEMENT_ID__=qb,r})();function qb(r){return function(r,o,s){if(Qo(r)&&!s){const h=ai(r.index,o);return new tf(h,h)}return 47&r.type?new tf(o[16],o):null}(li(),wt(),16==(16&r))}class d0{constructor(){}supports(o){return P(o)}create(o){return new ew(o)}}const Qb=(r,o)=>o;class ew{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||Qb}forEachItem(o){let s;for(s=this._itHead;null!==s;s=s._next)o(s)}forEachOperation(o){let s=this._itHead,h=this._removalsHead,m=0,y=null;for(;s||h;){const w=!h||s&&s.currentIndex<p0(h,m,y)?s:h,I=p0(w,m,y),k=w.currentIndex;if(w===h)m--,h=h._nextRemoved;else if(s=s._next,null==w.previousIndex)m++;else{y||(y=[]);const G=I-m,q=k-m;if(G!=q){for(let Ie=0;Ie<G;Ie++){const Ve=Ie<y.length?y[Ie]:y[Ie]=0,ft=Ve+Ie;q<=ft&&ft<G&&(y[Ie]=Ve+1)}y[w.previousIndex]=q-G}}I!==k&&o(w,I,k)}}forEachPreviousItem(o){let s;for(s=this._previousItHead;null!==s;s=s._nextPrevious)o(s)}forEachAddedItem(o){let s;for(s=this._additionsHead;null!==s;s=s._nextAdded)o(s)}forEachMovedItem(o){let s;for(s=this._movesHead;null!==s;s=s._nextMoved)o(s)}forEachRemovedItem(o){let s;for(s=this._removalsHead;null!==s;s=s._nextRemoved)o(s)}forEachIdentityChange(o){let s;for(s=this._identityChangesHead;null!==s;s=s._nextIdentityChange)o(s)}diff(o){if(null==o&&(o=[]),!P(o))throw new Error(`Error trying to diff '${Ot(o)}'. Only arrays and iterables are allowed`);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let m,y,w,s=this._itHead,h=!1;if(Array.isArray(o)){this.length=o.length;for(let I=0;I<this.length;I++)y=o[I],w=this._trackByFn(I,y),null!==s&&Object.is(s.trackById,w)?(h&&(s=this._verifyReinsertion(s,y,w,I)),Object.is(s.item,y)||this._addIdentityChange(s,y)):(s=this._mismatch(s,y,w,I),h=!0),s=s._next}else m=0,function(r,o){if(Array.isArray(r))for(let s=0;s<r.length;s++)o(r[s]);else{const s=r[D()]();let h;for(;!(h=s.next()).done;)o(h.value)}}(o,I=>{w=this._trackByFn(m,I),null!==s&&Object.is(s.trackById,w)?(h&&(s=this._verifyReinsertion(s,I,w,m)),Object.is(s.item,I)||this._addIdentityChange(s,I)):(s=this._mismatch(s,I,w,m),h=!0),s=s._next,m++}),this.length=m;return this._truncate(s),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,s,h,m){let y;return null===o?y=this._itTail:(y=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null))?(Object.is(o.item,s)||this._addIdentityChange(o,s),this._reinsertAfter(o,y,m)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(h,m))?(Object.is(o.item,s)||this._addIdentityChange(o,s),this._moveAfter(o,y,m)):o=this._addAfter(new tw(s,h),y,m),o}_verifyReinsertion(o,s,h,m){let y=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null);return null!==y?o=this._reinsertAfter(y,o._prev,m):o.currentIndex!=m&&(o.currentIndex=m,this._addToMoves(o,m)),o}_truncate(o){for(;null!==o;){const s=o._next;this._addToRemovals(this._unlink(o)),o=s}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,s,h){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const m=o._prevRemoved,y=o._nextRemoved;return null===m?this._removalsHead=y:m._nextRemoved=y,null===y?this._removalsTail=m:y._prevRemoved=m,this._insertAfter(o,s,h),this._addToMoves(o,h),o}_moveAfter(o,s,h){return this._unlink(o),this._insertAfter(o,s,h),this._addToMoves(o,h),o}_addAfter(o,s,h){return this._insertAfter(o,s,h),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,s,h){const m=null===s?this._itHead:s._next;return o._next=m,o._prev=s,null===m?this._itTail=o:m._prev=o,null===s?this._itHead=o:s._next=o,null===this._linkedRecords&&(this._linkedRecords=new f0),this._linkedRecords.put(o),o.currentIndex=h,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const s=o._prev,h=o._next;return null===s?this._itHead=h:s._next=h,null===h?this._itTail=s:h._prev=s,o}_addToMoves(o,s){return o.previousIndex===s||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new f0),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,s){return o.item=s,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class tw{constructor(o,s){this.item=o,this.trackById=s,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class nw{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,s){let h;for(h=this._head;null!==h;h=h._nextDup)if((null===s||s<=h.currentIndex)&&Object.is(h.trackById,o))return h;return null}remove(o){const s=o._prevDup,h=o._nextDup;return null===s?this._head=h:s._nextDup=h,null===h?this._tail=s:h._prevDup=s,null===this._head}}class f0{constructor(){this.map=new Map}put(o){const s=o.trackById;let h=this.map.get(s);h||(h=new nw,this.map.set(s,h)),h.add(o)}get(o,s){const m=this.map.get(o);return m?m.get(o,s):null}remove(o){const s=o.trackById;return this.map.get(s).remove(o)&&this.map.delete(s),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function p0(r,o,s){const h=r.previousIndex;if(null===h)return h;let m=0;return s&&h<s.length&&(m=s[h]),h+o+m}class m0{constructor(){}supports(o){return o instanceof Map||Z(o)}create(){return new rw}}class rw{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let s;for(s=this._mapHead;null!==s;s=s._next)o(s)}forEachPreviousItem(o){let s;for(s=this._previousMapHead;null!==s;s=s._nextPrevious)o(s)}forEachChangedItem(o){let s;for(s=this._changesHead;null!==s;s=s._nextChanged)o(s)}forEachAddedItem(o){let s;for(s=this._additionsHead;null!==s;s=s._nextAdded)o(s)}forEachRemovedItem(o){let s;for(s=this._removalsHead;null!==s;s=s._nextRemoved)o(s)}diff(o){if(o){if(!(o instanceof Map||Z(o)))throw new Error(`Error trying to diff '${Ot(o)}'. Only maps and objects are allowed`)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let s=this._mapHead;if(this._appendAfter=null,this._forEach(o,(h,m)=>{if(s&&s.key===m)this._maybeAddToChanges(s,h),this._appendAfter=s,s=s._next;else{const y=this._getOrCreateRecordForKey(m,h);s=this._insertBeforeOrAppend(s,y)}}),s){s._prev&&(s._prev._next=null),this._removalsHead=s;for(let h=s;null!==h;h=h._nextRemoved)h===this._mapHead&&(this._mapHead=null),this._records.delete(h.key),h._nextRemoved=h._next,h.previousValue=h.currentValue,h.currentValue=null,h._prev=null,h._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,s){if(o){const h=o._prev;return s._next=o,s._prev=h,o._prev=s,h&&(h._next=s),o===this._mapHead&&(this._mapHead=s),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=s,s._prev=this._appendAfter):this._mapHead=s,this._appendAfter=s,null}_getOrCreateRecordForKey(o,s){if(this._records.has(o)){const m=this._records.get(o);this._maybeAddToChanges(m,s);const y=m._prev,w=m._next;return y&&(y._next=w),w&&(w._prev=y),m._next=null,m._prev=null,m}const h=new iw(o);return this._records.set(o,h),h.currentValue=s,this._addToAdditions(h),h}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,s){Object.is(s,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=s,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,s){o instanceof Map?o.forEach(s):Object.keys(o).forEach(h=>s(o[h],h))}}class iw{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function g0(){return new em([new d0])}let em=(()=>{class r{constructor(s){this.factories=s}static create(s,h){if(null!=h){const m=h.factories.slice();s=s.concat(m)}return new r(s)}static extend(s){return{provide:r,useFactory:h=>r.create(s,h||g0()),deps:[[r,new Or,new so]]}}find(s){const h=this.factories.find(m=>m.supports(s));if(null!=h)return h;throw new Error(`Cannot find a differ supporting object '${s}' of type '${function(r){return r.name||typeof r}(s)}'`)}}return r.\u0275prov=$n({token:r,providedIn:"root",factory:g0}),r})();function _0(){return new tm([new m0])}let tm=(()=>{class r{constructor(s){this.factories=s}static create(s,h){if(h){const m=h.factories.slice();s=s.concat(m)}return new r(s)}static extend(s){return{provide:r,useFactory:h=>r.create(s,h||_0()),deps:[[r,new Or,new so]]}}find(s){const h=this.factories.find(m=>m.supports(s));if(h)return h;throw new Error(`Cannot find a differ supporting object '${s}'`)}}return r.\u0275prov=$n({token:r,providedIn:"root",factory:_0}),r})();const sw=[new m0],lw=new em([new d0]),cw=new tm(sw),uw=Qv(null,"core",[{provide:Gv,useValue:"unknown"},{provide:t0,deps:[Li]},{provide:Kv,deps:[]},{provide:Zv,deps:[]}]),mw=[{provide:af,useClass:af,deps:[ia,Li,ec,Qd,kh]},{provide:C1,deps:[ia],useFactory:function(r){let o=[];return r.onStable.subscribe(()=>{for(;o.length;)o.pop()()}),function(s){o.push(s)}}},{provide:kh,useClass:kh,deps:[[new so,Bg]]},{provide:Ug,useClass:Ug,deps:[]},Cb,{provide:em,useFactory:function(){return lw},deps:[]},{provide:tm,useFactory:function(){return cw},deps:[]},{provide:Jp,useFactory:function(r){return r||"undefined"!=typeof $localize&&$localize.locale||Vp},deps:[[new Wo(Jp),new so,new Or]]},{provide:qv,useValue:"USD"}];let _w=(()=>{class r{constructor(s){}}return r.\u0275fac=function(s){return new(s||r)(Qt(af))},r.\u0275mod=tn({type:r}),r.\u0275inj=Xi({providers:mw}),r})()},4739:(yn,Ct,xe)=>{"use strict";xe.d(Ct,{rH:()=>Mo,Od:()=>$o,Bz:()=>Ao,lC:()=>B});var ue=xe(6019),oe=xe(3019),Lt=xe(7396);class c extends Lt.x{constructor(T){super(),this._value=T}get value(){return this.getValue()}_subscribe(T){const C=super._subscribe(T);return!C.closed&&T.next(this._value),C}getValue(){const{hasError:T,thrownError:C,_value:L}=this;if(T)throw C;return this._throwIfClosed(),L}next(T){super.next(this._value=T)}}var Et=xe(9105);const{isArray:an}=Array,{getPrototypeOf:Gt,prototype:je,keys:ze}=Object;var Zt=xe(6658),Tn=xe(7190),it=xe(2201);const{isArray:Ut}=Array;var pn=xe(4810),zt=xe(9817),gt=xe(7596);function mn(...M){const T=(0,pn.yG)(M),C=(0,pn.jO)(M),{args:L,keys:U}=function(M){if(1===M.length){const T=M[0];if(an(T))return{args:T,keys:null};if(function(M){return M&&"object"==typeof M&&Gt(M)===je}(T)){const C=ze(T);return{args:C.map(L=>T[L]),keys:C}}}return{args:M,keys:null}}(M);if(0===L.length)return(0,Zt.D)([],T);const Y=new Et.y(function(M,T,C=Tn.y){return L=>{gn(T,()=>{const{length:U}=M,Y=new Array(U);let _e=U,De=U;for(let Je=0;Je<U;Je++)gn(T,()=>{const Kt=(0,Zt.D)(M[Je],T);let Vn=!1;Kt.subscribe(new zt.Q(L,un=>{Y[Je]=un,Vn||(Vn=!0,De--),De||L.next(C(Y.slice()))},()=>{--_e||L.complete()}))},L)},L)}}(L,T,U?_e=>function(M,T){return M.reduce((C,L,U)=>(C[L]=T[U],C),{})}(U,_e):Tn.y));return C?Y.pipe(function(M){return(0,it.U)(T=>function(M,T){return Ut(T)?M(...T):M(T)}(M,T))}(C)):Y}function gn(M,T,C){M?(0,gt.f)(C,M,T):T()}const Ht=(0,xe(6171).d)(M=>function(){M(this),this.name="EmptyError",this.message="no elements in sequence"});var Re=xe(5823);function $e(M){return new Et.y(T=>{(0,Re.Xf)(M()).subscribe(T)})}var tt=xe(5414),lt=xe(5711);function Pt(){return(0,lt.e)((M,T)=>{let C=null;M._refCount++;const L=new zt.Q(T,void 0,void 0,void 0,()=>{if(!M||M._refCount<=0||0<--M._refCount)return void(C=null);const U=M._connection,Y=C;C=null,U&&(!Y||U===Y)&&U.unsubscribe(),T.unsubscribe()});M.subscribe(L),L.closed||(C=M.connect())})}class Ye extends Et.y{constructor(T,C){super(),this.source=T,this.subjectFactory=C,this._subject=null,this._refCount=0,this._connection=null,(0,lt.A)(T)&&(this.lift=T.lift)}_subscribe(T){return this.getSubject().subscribe(T)}getSubject(){const T=this._subject;return(!T||T.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:T}=this;this._subject=this._connection=null,null==T||T.unsubscribe()}connect(){let T=this._connection;if(!T){T=this._connection=new tt.w0;const C=this.getSubject();T.add(this.source.subscribe(new zt.Q(C,void 0,()=>{this._teardown(),C.complete()},L=>{this._teardown(),C.error(L)},()=>this._teardown()))),T.closed&&(this._connection=null,T=tt.w0.EMPTY)}return T}refCount(){return Pt()(this)}}var Tt=xe(1680),Sn=xe(5514),Er=xe(3703);function nn(M,T){return(0,lt.e)((C,L)=>{let U=null,Y=0,_e=!1;const De=()=>_e&&!U&&L.complete();C.subscribe(new zt.Q(L,Je=>{null==U||U.unsubscribe();let Kt=0;const Vn=Y++;(0,Re.Xf)(M(Je,Vn)).subscribe(U=new zt.Q(L,un=>L.next(T?T(Je,un,Vn,Kt++):un),()=>{U=null,De()}))},()=>{_e=!0,De()}))})}function zi(M,T,C,L,U){return(Y,_e)=>{let De=C,Je=T,Kt=0;Y.subscribe(new zt.Q(_e,Vn=>{const un=Kt++;Je=De?M(Je,Vn,un):(De=!0,Vn),L&&_e.next(Je)},U&&(()=>{De&&_e.next(Je),_e.complete()})))}}function lr(M,T){return(0,lt.e)(zi(M,T,arguments.length>=2,!0))}function Nr(M){return(0,lt.e)((T,C)=>{let Y,L=null,U=!1;L=T.subscribe(new zt.Q(C,void 0,void 0,_e=>{Y=(0,Re.Xf)(M(_e,Nr(M)(T))),L?(L.unsubscribe(),L=null,Y.subscribe(C)):U=!0})),U&&(L.unsubscribe(),L=null,Y.subscribe(C))})}var Wr=xe(181);function kn(M){return M<=0?()=>Er.E:(0,lt.e)((T,C)=>{let L=[];T.subscribe(new zt.Q(C,U=>{L.push(U),M<L.length&&L.shift()},()=>{for(const U of L)C.next(U);C.complete()},void 0,()=>{L=null}))})}function Wi(M=Xr){return(0,lt.e)((T,C)=>{let L=!1;T.subscribe(new zt.Q(C,U=>{L=!0,C.next(U)},()=>L?C.complete():C.error(M())))})}function Xr(){return new Ht}function to(M){return(0,lt.e)((T,C)=>{let L=!1;T.subscribe(new zt.Q(C,U=>{L=!0,C.next(U)},()=>{L||C.next(M),C.complete()}))})}var On=xe(3453);function Bi(M,T){const C=arguments.length>=2;return L=>L.pipe(M?(0,Wr.h)((U,Y)=>M(U,Y,L)):Tn.y,(0,On.q)(1),C?to(T):Wi(()=>new Ht))}var xi=xe(8475),$n=xe(9964),Rr=xe(6801),Xi=xe(6007);class Kr{constructor(T,C){this.id=T,this.url=C}}class Lr extends Kr{constructor(T,C,L="imperative",U=null){super(T,C),this.navigationTrigger=L,this.restoredState=U}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Pi extends Kr{constructor(T,C,L){super(T,C),this.urlAfterRedirects=L}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Eo extends Kr{constructor(T,C,L){super(T,C),this.reason=L}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class dt extends Kr{constructor(T,C,L){super(T,C),this.error=L}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Ae extends Kr{constructor(T,C,L,U){super(T,C),this.urlAfterRedirects=L,this.state=U}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Oe extends Kr{constructor(T,C,L,U){super(T,C),this.urlAfterRedirects=L,this.state=U}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class bt extends Kr{constructor(T,C,L,U,Y){super(T,C),this.urlAfterRedirects=L,this.state=U,this.shouldActivate=Y}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class pt extends Kr{constructor(T,C,L,U){super(T,C),this.urlAfterRedirects=L,this.state=U}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _t extends Kr{constructor(T,C,L,U){super(T,C),this.urlAfterRedirects=L,this.state=U}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Vt{constructor(T){this.route=T}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class en{constructor(T){this.route=T}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class En{constructor(T){this.snapshot=T}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class _r{constructor(T){this.snapshot=T}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class fi{constructor(T){this.snapshot=T}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ur{constructor(T){this.snapshot=T}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Xn{constructor(T,C,L){this.routerEvent=T,this.position=C,this.anchor=L}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const qt="primary";class Rn{constructor(T){this.params=T||{}}has(T){return Object.prototype.hasOwnProperty.call(this.params,T)}get(T){if(this.has(T)){const C=this.params[T];return Array.isArray(C)?C[0]:C}return null}getAll(T){if(this.has(T)){const C=this.params[T];return Array.isArray(C)?C:[C]}return[]}get keys(){return Object.keys(this.params)}}function tr(M){return new Rn(M)}const Gn="ngNavigationCancelingError";function Vr(M){const T=Error("NavigationCancelingError: "+M);return T[Gn]=!0,T}function uo(M,T,C){const L=C.path.split("/");if(L.length>M.length||"full"===C.pathMatch&&(T.hasChildren()||L.length<M.length))return null;const U={};for(let Y=0;Y<L.length;Y++){const _e=L[Y],De=M[Y];if(_e.startsWith(":"))U[_e.substring(1)]=De;else if(_e!==De.path)return null}return{consumed:M.slice(0,L.length),posParams:U}}function Ni(M,T){const C=M?Object.keys(M):void 0,L=T?Object.keys(T):void 0;if(!C||!L||C.length!=L.length)return!1;let U;for(let Y=0;Y<C.length;Y++)if(U=C[Y],!Fo(M[U],T[U]))return!1;return!0}function Fo(M,T){if(Array.isArray(M)&&Array.isArray(T)){if(M.length!==T.length)return!1;const C=[...M].sort(),L=[...T].sort();return C.every((U,Y)=>L[Y]===U)}return M===T}function wi(M){return Array.prototype.concat.apply([],M)}function Q(M){return M.length>0?M[M.length-1]:null}function H(M,T){for(const C in M)M.hasOwnProperty(C)&&T(M[C],C)}function ee(M){return(0,oe.CqO)(M)?M:(0,oe.QGY)(M)?(0,Zt.D)(Promise.resolve(M)):(0,Tt.of)(M)}const Ee={exact:function Ue(M,T,C){if(!ae(M.segments,T.segments)||!tn(M.segments,T.segments,C)||M.numberOfChildren!==T.numberOfChildren)return!1;for(const L in T.children)if(!M.children[L]||!Ue(M.children[L],T.children[L],C))return!1;return!0},subset:At},Le={exact:function(M,T){return Ni(M,T)},subset:function(M,T){return Object.keys(T).length<=Object.keys(M).length&&Object.keys(T).every(C=>Fo(M[C],T[C]))},ignored:()=>!0};function Be(M,T,C){return Ee[C.paths](M.root,T.root,C.matrixParams)&&Le[C.queryParams](M.queryParams,T.queryParams)&&!("exact"===C.fragment&&M.fragment!==T.fragment)}function At(M,T,C){return ct(M,T,T.segments,C)}function ct(M,T,C,L){if(M.segments.length>C.length){const U=M.segments.slice(0,C.length);return!(!ae(U,C)||T.hasChildren()||!tn(U,C,L))}if(M.segments.length===C.length){if(!ae(M.segments,C)||!tn(M.segments,C,L))return!1;for(const U in T.children)if(!M.children[U]||!At(M.children[U],T.children[U],L))return!1;return!0}{const U=C.slice(0,M.segments.length),Y=C.slice(M.segments.length);return!!(ae(M.segments,U)&&tn(M.segments,U,L)&&M.children[qt])&&ct(M.children[qt],T,Y,L)}}function tn(M,T,C){return T.every((L,U)=>Le[C](M[U].parameters,L.parameters))}class St{constructor(T,C,L){this.root=T,this.queryParams=C,this.fragment=L}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=tr(this.queryParams)),this._queryParamMap}toString(){return xn.serialize(this)}}class we{constructor(T,C){this.segments=T,this.children=C,this.parent=null,H(C,(L,U)=>L.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Mt(this)}}class te{constructor(T,C){this.path=T,this.parameters=C}get parameterMap(){return this._parameterMap||(this._parameterMap=tr(this.parameters)),this._parameterMap}toString(){return ho(this)}}function ae(M,T){return M.length===T.length&&M.every((C,L)=>C.path===T[L].path)}class qe{}class Rt{parse(T){const C=new pi(T);return new St(C.parseRootSegment(),C.parseQueryParams(),C.parseFragment())}serialize(T){const C=`/${Xe(T.root,!0)}`,L=function(M){const T=Object.keys(M).map(C=>{const L=M[C];return Array.isArray(L)?L.map(U=>`${ln(C)}=${ln(U)}`).join("&"):`${ln(C)}=${ln(L)}`}).filter(C=>!!C);return T.length?`?${T.join("&")}`:""}(T.queryParams);var M;return`${C}${L}${"string"==typeof T.fragment?`#${M=T.fragment,encodeURI(M)}`:""}`}}const xn=new Rt;function Mt(M){return M.segments.map(T=>ho(T)).join("/")}function Xe(M,T){if(!M.hasChildren())return Mt(M);if(T){const C=M.children[qt]?Xe(M.children[qt],!1):"",L=[];return H(M.children,(U,Y)=>{Y!==qt&&L.push(`${Y}:${Xe(U,!1)}`)}),L.length>0?`${C}(${L.join("//")})`:C}{const C=function(M,T){let C=[];return H(M.children,(L,U)=>{U===qt&&(C=C.concat(T(L,U)))}),H(M.children,(L,U)=>{U!==qt&&(C=C.concat(T(L,U)))}),C}(M,(L,U)=>U===qt?[Xe(M.children[qt],!1)]:[`${U}:${Xe(L,!1)}`]);return 1===Object.keys(M.children).length&&null!=M.children[qt]?`${Mt(M)}/${C[0]}`:`${Mt(M)}/(${C.join("//")})`}}function rn(M){return encodeURIComponent(M).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ln(M){return rn(M).replace(/%3B/gi,";")}function yr(M){return rn(M).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function bn(M){return decodeURIComponent(M)}function Mr(M){return bn(M.replace(/\+/g,"%20"))}function ho(M){return`${yr(M.path)}${function(M){return Object.keys(M).map(T=>`;${yr(T)}=${yr(M[T])}`).join("")}(M.parameters)}`}const mr=/^[^\/()?;=#]+/;function fo(M){const T=M.match(mr);return T?T[0]:""}const po=/^[^=?&#]+/,Dr=/^[^&#]+/;class pi{constructor(T){this.url=T,this.remaining=T}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new we([],{}):new we([],this.parseChildren())}parseQueryParams(){const T={};if(this.consumeOptional("?"))do{this.parseQueryParam(T)}while(this.consumeOptional("&"));return T}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const T=[];for(this.peekStartsWith("(")||T.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),T.push(this.parseSegment());let C={};this.peekStartsWith("/(")&&(this.capture("/"),C=this.parseParens(!0));let L={};return this.peekStartsWith("(")&&(L=this.parseParens(!1)),(T.length>0||Object.keys(C).length>0)&&(L[qt]=new we(T,C)),L}parseSegment(){const T=fo(this.remaining);if(""===T&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(T),new te(bn(T),this.parseMatrixParams())}parseMatrixParams(){const T={};for(;this.consumeOptional(";");)this.parseParam(T);return T}parseParam(T){const C=fo(this.remaining);if(!C)return;this.capture(C);let L="";if(this.consumeOptional("=")){const U=fo(this.remaining);U&&(L=U,this.capture(L))}T[bn(C)]=bn(L)}parseQueryParam(T){const C=function(M){const T=M.match(po);return T?T[0]:""}(this.remaining);if(!C)return;this.capture(C);let L="";if(this.consumeOptional("=")){const _e=function(M){const T=M.match(Dr);return T?T[0]:""}(this.remaining);_e&&(L=_e,this.capture(L))}const U=Mr(C),Y=Mr(L);if(T.hasOwnProperty(U)){let _e=T[U];Array.isArray(_e)||(_e=[_e],T[U]=_e),_e.push(Y)}else T[U]=Y}parseParens(T){const C={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const L=fo(this.remaining),U=this.remaining[L.length];if("/"!==U&&")"!==U&&";"!==U)throw new Error(`Cannot parse url '${this.url}'`);let Y;L.indexOf(":")>-1?(Y=L.substr(0,L.indexOf(":")),this.capture(Y),this.capture(":")):T&&(Y=qt);const _e=this.parseChildren();C[Y]=1===Object.keys(_e).length?_e[qt]:new we([],_e),this.consumeOptional("//")}return C}peekStartsWith(T){return this.remaining.startsWith(T)}consumeOptional(T){return!!this.peekStartsWith(T)&&(this.remaining=this.remaining.substring(T.length),!0)}capture(T){if(!this.consumeOptional(T))throw new Error(`Expected "${T}".`)}}class In{constructor(T){this._root=T}get root(){return this._root.value}parent(T){const C=this.pathFromRoot(T);return C.length>1?C[C.length-2]:null}children(T){const C=rr(T,this._root);return C?C.children.map(L=>L.value):[]}firstChild(T){const C=rr(T,this._root);return C&&C.children.length>0?C.children[0].value:null}siblings(T){const C=Oo(T,this._root);return C.length<2?[]:C[C.length-2].children.map(U=>U.value).filter(U=>U!==T)}pathFromRoot(T){return Oo(T,this._root).map(C=>C.value)}}function rr(M,T){if(M===T.value)return T;for(const C of T.children){const L=rr(M,C);if(L)return L}return null}function Oo(M,T){if(M===T.value)return[T];for(const C of T.children){const L=Oo(M,C);if(L.length)return L.unshift(T),L}return[]}class Ar{constructor(T,C){this.value=T,this.children=C}toString(){return`TreeNode(${this.value})`}}function ti(M){const T={};return M&&M.children.forEach(C=>T[C.value.outlet]=C),T}class Cs extends In{constructor(T,C){super(T),this.snapshot=C,Bo(this,T)}toString(){return this.snapshot.toString()}}function zo(M,T){const C=function(M,T){const _e=new ki([],{},{},"",{},qt,T,null,M.root,-1,{});return new $r("",new Ar(_e,[]))}(M,T),L=new c([new te("",{})]),U=new c({}),Y=new c({}),_e=new c({}),De=new c(""),Je=new si(L,U,_e,De,Y,qt,T,C.root);return Je.snapshot=C.root,new Cs(new Ar(Je,[]),C)}class si{constructor(T,C,L,U,Y,_e,De,Je){this.url=T,this.params=C,this.queryParams=L,this.fragment=U,this.data=Y,this.outlet=_e,this.component=De,this._futureSnapshot=Je}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,it.U)(T=>tr(T)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,it.U)(T=>tr(T)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function jr(M,T="emptyOnly"){const C=M.pathFromRoot;let L=0;if("always"!==T)for(L=C.length-1;L>=1;){const U=C[L],Y=C[L-1];if(U.routeConfig&&""===U.routeConfig.path)L--;else{if(Y.component)break;L--}}return function(M){return M.reduce((T,C)=>({params:Hn(Hn({},T.params),C.params),data:Hn(Hn({},T.data),C.data),resolve:Hn(Hn({},T.resolve),C._resolvedData)}),{params:{},data:{},resolve:{}})}(C.slice(L))}class ki{constructor(T,C,L,U,Y,_e,De,Je,Kt,Vn,un){this.url=T,this.params=C,this.queryParams=L,this.fragment=U,this.data=Y,this.outlet=_e,this.component=De,this.routeConfig=Je,this._urlSegment=Kt,this._lastPathIndex=Vn,this._resolve=un}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=tr(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=tr(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(L=>L.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class $r extends In{constructor(T,C){super(C),this.url=T,Bo(this,C)}toString(){return Qo(this._root)}}function Bo(M,T){T.value._routerState=M,T.children.forEach(C=>Bo(M,C))}function Qo(M){const T=M.children.length>0?` { ${M.children.map(Qo).join(", ")} } `:"";return`${M.value}${T}`}function Ts(M){if(M.snapshot){const T=M.snapshot,C=M._futureSnapshot;M.snapshot=C,Ni(T.queryParams,C.queryParams)||M.queryParams.next(C.queryParams),T.fragment!==C.fragment&&M.fragment.next(C.fragment),Ni(T.params,C.params)||M.params.next(C.params),function(M,T){if(M.length!==T.length)return!1;for(let C=0;C<M.length;++C)if(!Ni(M[C],T[C]))return!1;return!0}(T.url,C.url)||M.url.next(C.url),Ni(T.data,C.data)||M.data.next(C.data)}else M.snapshot=M._futureSnapshot,M.data.next(M._futureSnapshot.data)}function Jr(M,T){const C=Ni(M.params,T.params)&&function(M,T){return ae(M,T)&&M.every((C,L)=>Ni(C.parameters,T[L].parameters))}(M.url,T.url);return C&&!(!M.parent!=!T.parent)&&(!M.parent||Jr(M.parent,T.parent))}function Ss(M,T,C){if(C&&M.shouldReuseRoute(T.value,C.value.snapshot)){const L=C.value;L._futureSnapshot=T.value;const U=function(M,T,C){return T.children.map(L=>{for(const U of C.children)if(M.shouldReuseRoute(L.value,U.value.snapshot))return Ss(M,L,U);return Ss(M,L)})}(M,T,C);return new Ar(L,U)}{if(M.shouldAttach(T.value)){const Y=M.retrieve(T.value);if(null!==Y){const _e=Y.route;return _e.value._futureSnapshot=T.value,_e.children=T.children.map(De=>Ss(M,De)),_e}}const L=function(M){return new si(new c(M.url),new c(M.params),new c(M.queryParams),new c(M.fragment),new c(M.data),M.outlet,M.component,M)}(T.value),U=T.children.map(Y=>Ss(M,Y));return new Ar(L,U)}}function Hs(M){return"object"==typeof M&&null!=M&&!M.outlets&&!M.segmentPath}function cs(M){return"object"==typeof M&&null!=M&&M.outlets}function il(M,T,C,L,U){let Y={};return L&&H(L,(_e,De)=>{Y[De]=Array.isArray(_e)?_e.map(Je=>`${Je}`):`${_e}`}),new St(C.root===M?T:kl(C.root,M,T),Y,U)}function kl(M,T,C){const L={};return H(M.children,(U,Y)=>{L[Y]=U===T?C:kl(U,T,C)}),new we(M.segments,L)}class aa{constructor(T,C,L){if(this.isAbsolute=T,this.numberOfDoubleDots=C,this.commands=L,T&&L.length>0&&Hs(L[0]))throw new Error("Root segment cannot have matrix parameters");const U=L.find(cs);if(U&&U!==Q(L))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class la{constructor(T,C,L){this.segmentGroup=T,this.processChildren=C,this.index=L}}function Ui(M,T,C){if(M||(M=new we([],{})),0===M.segments.length&&M.hasChildren())return us(M,T,C);const L=function(M,T,C){let L=0,U=T;const Y={match:!1,pathIndex:0,commandIndex:0};for(;U<M.segments.length;){if(L>=C.length)return Y;const _e=M.segments[U],De=C[L];if(cs(De))break;const Je=`${De}`,Kt=L<C.length-1?C[L+1]:null;if(U>0&&void 0===Je)break;if(Je&&Kt&&"object"==typeof Kt&&void 0===Kt.outlets){if(!Is(Je,Kt,_e))return Y;L+=2}else{if(!Is(Je,{},_e))return Y;L++}U++}return{match:!0,pathIndex:U,commandIndex:L}}(M,T,C),U=C.slice(L.commandIndex);if(L.match&&L.pathIndex<M.segments.length){const Y=new we(M.segments.slice(0,L.pathIndex),{});return Y.children[qt]=new we(M.segments.slice(L.pathIndex),M.children),us(Y,0,U)}return L.match&&0===U.length?new we(M.segments,{}):L.match&&!M.hasChildren()?hs(M,T,C):L.match?us(M,0,U):hs(M,T,C)}function us(M,T,C){if(0===C.length)return new we(M.segments,{});{const L=function(M){return cs(M[0])?M[0].outlets:{[qt]:M}}(C),U={};return H(L,(Y,_e)=>{"string"==typeof Y&&(Y=[Y]),null!==Y&&(U[_e]=Ui(M.children[_e],T,Y))}),H(M.children,(Y,_e)=>{void 0===L[_e]&&(U[_e]=Y)}),new we(M.segments,U)}}function hs(M,T,C){const L=M.segments.slice(0,T);let U=0;for(;U<C.length;){const Y=C[U];if(cs(Y)){const Je=es(Y.outlets);return new we(L,Je)}if(0===U&&Hs(C[0])){L.push(new te(M.segments[T].path,No(C[0]))),U++;continue}const _e=cs(Y)?Y.outlets[qt]:`${Y}`,De=U<C.length-1?C[U+1]:null;_e&&De&&Hs(De)?(L.push(new te(_e,No(De))),U+=2):(L.push(new te(_e,{})),U++)}return new we(L,{})}function es(M){const T={};return H(M,(C,L)=>{"string"==typeof C&&(C=[C]),null!==C&&(T[L]=hs(new we([],{}),0,C))}),T}function No(M){const T={};return H(M,(C,L)=>T[L]=`${C}`),T}function Is(M,T,C){return M==C.path&&Ni(T,C.parameters)}class Un{constructor(T,C,L,U){this.routeReuseStrategy=T,this.futureState=C,this.currState=L,this.forwardEvent=U}activate(T){const C=this.futureState._root,L=this.currState?this.currState._root:null;this.deactivateChildRoutes(C,L,T),Ts(this.futureState.root),this.activateChildRoutes(C,L,T)}deactivateChildRoutes(T,C,L){const U=ti(C);T.children.forEach(Y=>{const _e=Y.value.outlet;this.deactivateRoutes(Y,U[_e],L),delete U[_e]}),H(U,(Y,_e)=>{this.deactivateRouteAndItsChildren(Y,L)})}deactivateRoutes(T,C,L){const U=T.value,Y=C?C.value:null;if(U===Y)if(U.component){const _e=L.getContext(U.outlet);_e&&this.deactivateChildRoutes(T,C,_e.children)}else this.deactivateChildRoutes(T,C,L);else Y&&this.deactivateRouteAndItsChildren(C,L)}deactivateRouteAndItsChildren(T,C){T.value.component&&this.routeReuseStrategy.shouldDetach(T.value.snapshot)?this.detachAndStoreRouteSubtree(T,C):this.deactivateRouteAndOutlet(T,C)}detachAndStoreRouteSubtree(T,C){const L=C.getContext(T.value.outlet),U=L&&T.value.component?L.children:C,Y=ti(T);for(const _e of Object.keys(Y))this.deactivateRouteAndItsChildren(Y[_e],U);if(L&&L.outlet){const _e=L.outlet.detach(),De=L.children.onOutletDeactivated();this.routeReuseStrategy.store(T.value.snapshot,{componentRef:_e,route:T,contexts:De})}}deactivateRouteAndOutlet(T,C){const L=C.getContext(T.value.outlet),U=L&&T.value.component?L.children:C,Y=ti(T);for(const _e of Object.keys(Y))this.deactivateRouteAndItsChildren(Y[_e],U);L&&L.outlet&&(L.outlet.deactivate(),L.children.onOutletDeactivated(),L.attachRef=null,L.resolver=null,L.route=null)}activateChildRoutes(T,C,L){const U=ti(C);T.children.forEach(Y=>{this.activateRoutes(Y,U[Y.value.outlet],L),this.forwardEvent(new Ur(Y.value.snapshot))}),T.children.length&&this.forwardEvent(new _r(T.value.snapshot))}activateRoutes(T,C,L){const U=T.value,Y=C?C.value:null;if(Ts(U),U===Y)if(U.component){const _e=L.getOrCreateContext(U.outlet);this.activateChildRoutes(T,C,_e.children)}else this.activateChildRoutes(T,C,L);else if(U.component){const _e=L.getOrCreateContext(U.outlet);if(this.routeReuseStrategy.shouldAttach(U.snapshot)){const De=this.routeReuseStrategy.retrieve(U.snapshot);this.routeReuseStrategy.store(U.snapshot,null),_e.children.onOutletReAttached(De.contexts),_e.attachRef=De.componentRef,_e.route=De.route.value,_e.outlet&&_e.outlet.attach(De.componentRef,De.route.value),Ts(De.route.value),this.activateChildRoutes(T,null,_e.children)}else{const De=function(M){for(let T=M.parent;T;T=T.parent){const C=T.routeConfig;if(C&&C._loadedConfig)return C._loadedConfig;if(C&&C.component)return null}return null}(U.snapshot),Je=De?De.module.componentFactoryResolver:null;_e.attachRef=null,_e.route=U,_e.resolver=Je,_e.outlet&&_e.outlet.activateWith(U,Je),this.activateChildRoutes(T,null,_e.children)}}else this.activateChildRoutes(T,null,L)}}class ds{constructor(T,C){this.routes=T,this.module=C}}function Do(M){return"function"==typeof M}function Co(M){return M instanceof St}const Ws=Symbol("INITIAL_VALUE");function Qr(){return nn(M=>mn(M.map(T=>T.pipe((0,On.q)(1),function(...M){const T=(0,pn.yG)(M);return(0,lt.e)((C,L)=>{(T?(0,Sn.z)(M,C,T):(0,Sn.z)(M,C)).subscribe(L)})}(Ws)))).pipe(lr((T,C)=>{let L=!1;return C.reduce((U,Y,_e)=>U!==Ws?U:(Y===Ws&&(L=!0),L||!1!==Y&&_e!==C.length-1&&!Co(Y)?U:Y),T)},Ws),(0,Wr.h)(T=>T!==Ws),(0,it.U)(T=>Co(T)?T:!0===T),(0,On.q)(1)))}class z{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new W,this.attachRef=null}}class W{constructor(){this.contexts=new Map}onChildOutletCreated(T,C){const L=this.getOrCreateContext(T);L.outlet=C,this.contexts.set(T,L)}onChildOutletDestroyed(T){const C=this.getContext(T);C&&(C.outlet=null,C.attachRef=null)}onOutletDeactivated(){const T=this.contexts;return this.contexts=new Map,T}onOutletReAttached(T){this.contexts=T}getOrCreateContext(T){let C=this.getContext(T);return C||(C=new z,this.contexts.set(T,C)),C}getContext(T){return this.contexts.get(T)||null}}let B=(()=>{class M{constructor(C,L,U,Y,_e){this.parentContexts=C,this.location=L,this.resolver=U,this.changeDetector=_e,this.activated=null,this._activatedRoute=null,this.activateEvents=new oe.vpe,this.deactivateEvents=new oe.vpe,this.attachEvents=new oe.vpe,this.detachEvents=new oe.vpe,this.name=Y||qt,C.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const C=this.parentContexts.getContext(this.name);C&&C.route&&(C.attachRef?this.attach(C.attachRef,C.route):this.activateWith(C.route,C.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const C=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(C.instance),C}attach(C,L){this.activated=C,this._activatedRoute=L,this.location.insert(C.hostView),this.attachEvents.emit(C.instance)}deactivate(){if(this.activated){const C=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(C)}}activateWith(C,L){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=C;const _e=(L=L||this.resolver).resolveComponentFactory(C._futureSnapshot.routeConfig.component),De=this.parentContexts.getOrCreateContext(this.name).children,Je=new J(C,De,this.location.injector);this.activated=this.location.createComponent(_e,this.location.length,Je),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return M.\u0275fac=function(C){return new(C||M)(oe.Y36(W),oe.Y36(oe.s_b),oe.Y36(oe._Vd),oe.$8M("name"),oe.Y36(oe.sBO))},M.\u0275dir=oe.lG2({type:M,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),M})();class J{constructor(T,C,L){this.route=T,this.childContexts=C,this.parent=L}get(T,C){return T===si?this.route:T===W?this.childContexts:this.parent.get(T,C)}}let Se=(()=>{class M{}return M.\u0275fac=function(C){return new(C||M)},M.\u0275cmp=oe.Xpm({type:M,selectors:[["ng-component"]],decls:1,vars:0,template:function(C,L){1&C&&oe._UZ(0,"router-outlet")},directives:[B],encapsulation:2}),M})();function ot(M,T=""){for(let C=0;C<M.length;C++){const L=M[C];ht(L,cn(T,L))}}function ht(M,T){M.children&&ot(M.children,T)}function cn(M,T){return T?M||T.path?M&&!T.path?`${M}/`:!M&&T.path?T.path:`${M}/${T.path}`:"":M}function or(M){const T=M.children&&M.children.map(or),C=T?Gs(Hn({},M),{children:T}):Hn({},M);return!C.component&&(T||C.loadChildren)&&C.outlet&&C.outlet!==qt&&(C.component=Se),C}function fn(M){return M.outlet||qt}function hr(M,T){const C=M.filter(L=>fn(L)===T);return C.push(...M.filter(L=>fn(L)!==T)),C}const Yn={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function Fr(M,T,C){var De;if(""===T.path)return"full"===T.pathMatch&&(M.hasChildren()||C.length>0)?Hn({},Yn):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const U=(T.matcher||uo)(C,M,T);if(!U)return Hn({},Yn);const Y={};H(U.posParams,(Je,Kt)=>{Y[Kt]=Je.path});const _e=U.consumed.length>0?Hn(Hn({},Y),U.consumed[U.consumed.length-1].parameters):Y;return{matched:!0,consumedSegments:U.consumed,lastChild:U.consumed.length,parameters:_e,positionalParamSegments:null!=(De=U.posParams)?De:{}}}function Dn(M,T,C,L,U="corrected"){if(C.length>0&&function(M,T,C){return C.some(L=>ro(M,T,L)&&fn(L)!==qt)}(M,C,L)){const _e=new we(T,function(M,T,C,L){const U={};U[qt]=L,L._sourceSegment=M,L._segmentIndexShift=T.length;for(const Y of C)if(""===Y.path&&fn(Y)!==qt){const _e=new we([],{});_e._sourceSegment=M,_e._segmentIndexShift=T.length,U[fn(Y)]=_e}return U}(M,T,L,new we(C,M.children)));return _e._sourceSegment=M,_e._segmentIndexShift=T.length,{segmentGroup:_e,slicedSegments:[]}}if(0===C.length&&function(M,T,C){return C.some(L=>ro(M,T,L))}(M,C,L)){const _e=new we(M.segments,function(M,T,C,L,U,Y){const _e={};for(const De of L)if(ro(M,C,De)&&!U[fn(De)]){const Je=new we([],{});Je._sourceSegment=M,Je._segmentIndexShift="legacy"===Y?M.segments.length:T.length,_e[fn(De)]=Je}return Hn(Hn({},U),_e)}(M,T,C,L,M.children,U));return _e._sourceSegment=M,_e._segmentIndexShift=T.length,{segmentGroup:_e,slicedSegments:C}}const Y=new we(M.segments,M.children);return Y._sourceSegment=M,Y._segmentIndexShift=T.length,{segmentGroup:Y,slicedSegments:C}}function ro(M,T,C){return(!(M.hasChildren()||T.length>0)||"full"!==C.pathMatch)&&""===C.path}function ts(M,T,C,L){return!!(fn(M)===L||L!==qt&&ro(T,C,M))&&("**"===M.path||Fr(T,M,C).matched)}function fs(M,T,C){return 0===T.length&&!M.children[C]}class Ci{constructor(T){this.segmentGroup=T||null}}class ua{constructor(T){this.urlTree=T}}function As(M){return new Et.y(T=>T.error(new Ci(M)))}function Ln(M){return new Et.y(T=>T.error(new ua(M)))}function La(M){return new Et.y(T=>T.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${M}'`)))}class Hc{constructor(T,C,L,U,Y){this.configLoader=C,this.urlSerializer=L,this.urlTree=U,this.config=Y,this.allowRedirects=!0,this.ngModule=T.get(oe.h0i)}apply(){const T=Dn(this.urlTree.root,[],[],this.config).segmentGroup,C=new we(T.segments,T.children);return this.expandSegmentGroup(this.ngModule,this.config,C,qt).pipe((0,it.U)(Y=>this.createUrlTree(Fl(Y),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Nr(Y=>{if(Y instanceof ua)return this.allowRedirects=!1,this.match(Y.urlTree);throw Y instanceof Ci?this.noMatchError(Y):Y}))}match(T){return this.expandSegmentGroup(this.ngModule,this.config,T.root,qt).pipe((0,it.U)(U=>this.createUrlTree(Fl(U),T.queryParams,T.fragment))).pipe(Nr(U=>{throw U instanceof Ci?this.noMatchError(U):U}))}noMatchError(T){return new Error(`Cannot match any routes. URL Segment: '${T.segmentGroup}'`)}createUrlTree(T,C,L){const U=T.segments.length>0?new we([],{[qt]:T}):T;return new St(U,C,L)}expandSegmentGroup(T,C,L,U){return 0===L.segments.length&&L.hasChildren()?this.expandChildren(T,C,L).pipe((0,it.U)(Y=>new we([],Y))):this.expandSegment(T,L,C,L.segments,U,!0)}expandChildren(T,C,L){const U=[];for(const Y of Object.keys(L.children))"primary"===Y?U.unshift(Y):U.push(Y);return(0,Zt.D)(U).pipe((0,xi.b)(Y=>{const _e=L.children[Y],De=hr(C,Y);return this.expandSegmentGroup(T,De,_e,Y).pipe((0,it.U)(Je=>({segment:Je,outlet:Y})))}),lr((Y,_e)=>(Y[_e.outlet]=_e.segment,Y),{}),function(M,T){const C=arguments.length>=2;return L=>L.pipe(M?(0,Wr.h)((U,Y)=>M(U,Y,L)):Tn.y,kn(1),C?to(T):Wi(()=>new Ht))}())}expandSegment(T,C,L,U,Y,_e){return(0,Zt.D)(L).pipe((0,xi.b)(De=>this.expandSegmentAgainstRoute(T,C,L,De,U,Y,_e).pipe(Nr(Kt=>{if(Kt instanceof Ci)return(0,Tt.of)(null);throw Kt}))),Bi(De=>!!De),Nr((De,Je)=>{if(De instanceof Ht||"EmptyError"===De.name){if(fs(C,U,Y))return(0,Tt.of)(new we([],{}));throw new Ci(C)}throw De}))}expandSegmentAgainstRoute(T,C,L,U,Y,_e,De){return ts(U,C,Y,_e)?void 0===U.redirectTo?this.matchSegmentAgainstRoute(T,C,U,Y,_e):De&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(T,C,L,U,Y,_e):As(C):As(C)}expandSegmentAgainstRouteUsingRedirect(T,C,L,U,Y,_e){return"**"===U.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(T,L,U,_e):this.expandRegularSegmentAgainstRouteUsingRedirect(T,C,L,U,Y,_e)}expandWildCardWithParamsAgainstRouteUsingRedirect(T,C,L,U){const Y=this.applyRedirectCommands([],L.redirectTo,{});return L.redirectTo.startsWith("/")?Ln(Y):this.lineralizeSegments(L,Y).pipe((0,$n.z)(_e=>{const De=new we(_e,{});return this.expandSegment(T,De,C,_e,U,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(T,C,L,U,Y,_e){const{matched:De,consumedSegments:Je,lastChild:Kt,positionalParamSegments:Vn}=Fr(C,U,Y);if(!De)return As(C);const un=this.applyRedirectCommands(Je,U.redirectTo,Vn);return U.redirectTo.startsWith("/")?Ln(un):this.lineralizeSegments(U,un).pipe((0,$n.z)(sr=>this.expandSegment(T,C,L,sr.concat(Y.slice(Kt)),_e,!1)))}matchSegmentAgainstRoute(T,C,L,U,Y){if("**"===L.path)return L.loadChildren?(L._loadedConfig?(0,Tt.of)(L._loadedConfig):this.configLoader.load(T.injector,L)).pipe((0,it.U)(sr=>(L._loadedConfig=sr,new we(U,{})))):(0,Tt.of)(new we(U,{}));const{matched:_e,consumedSegments:De,lastChild:Je}=Fr(C,L,U);if(!_e)return As(C);const Kt=U.slice(Je);return this.getChildConfig(T,L,U).pipe((0,$n.z)(un=>{const sr=un.module,er=un.routes,{segmentGroup:Ho,slicedSegments:Zo}=Dn(C,De,Kt,er),Ji=new we(Ho.segments,Ho.children);if(0===Zo.length&&Ji.hasChildren())return this.expandChildren(sr,er,Ji).pipe((0,it.U)(qo=>new we(De,qo)));if(0===er.length&&0===Zo.length)return(0,Tt.of)(new we(De,{}));const go=fn(L)===Y;return this.expandSegment(sr,Ji,er,Zo,go?qt:Y,!0).pipe((0,it.U)(Qi=>new we(De.concat(Qi.segments),Qi.children)))}))}getChildConfig(T,C,L){return C.children?(0,Tt.of)(new ds(C.children,T)):C.loadChildren?void 0!==C._loadedConfig?(0,Tt.of)(C._loadedConfig):this.runCanLoadGuards(T.injector,C,L).pipe((0,$n.z)(U=>{return U?this.configLoader.load(T.injector,C).pipe((0,it.U)(Y=>(C._loadedConfig=Y,Y))):(M=C,new Et.y(T=>T.error(Vr(`Cannot load children because the guard of the route "path: '${M.path}'" returned false`))));var M})):(0,Tt.of)(new ds([],T))}runCanLoadGuards(T,C,L){const U=C.canLoad;if(!U||0===U.length)return(0,Tt.of)(!0);const Y=U.map(_e=>{const De=T.get(_e);let Je;if((M=De)&&Do(M.canLoad))Je=De.canLoad(C,L);else{if(!Do(De))throw new Error("Invalid CanLoad guard");Je=De(C,L)}var M;return ee(Je)});return(0,Tt.of)(Y).pipe(Qr(),(0,Rr.b)(_e=>{if(!Co(_e))return;const De=Vr(`Redirecting to "${this.urlSerializer.serialize(_e)}"`);throw De.url=_e,De}),(0,it.U)(_e=>!0===_e))}lineralizeSegments(T,C){let L=[],U=C.root;for(;;){if(L=L.concat(U.segments),0===U.numberOfChildren)return(0,Tt.of)(L);if(U.numberOfChildren>1||!U.children[qt])return La(T.redirectTo);U=U.children[qt]}}applyRedirectCommands(T,C,L){return this.applyRedirectCreatreUrlTree(C,this.urlSerializer.parse(C),T,L)}applyRedirectCreatreUrlTree(T,C,L,U){const Y=this.createSegmentGroup(T,C.root,L,U);return new St(Y,this.createQueryParams(C.queryParams,this.urlTree.queryParams),C.fragment)}createQueryParams(T,C){const L={};return H(T,(U,Y)=>{if("string"==typeof U&&U.startsWith(":")){const De=U.substring(1);L[Y]=C[De]}else L[Y]=U}),L}createSegmentGroup(T,C,L,U){const Y=this.createSegments(T,C.segments,L,U);let _e={};return H(C.children,(De,Je)=>{_e[Je]=this.createSegmentGroup(T,De,L,U)}),new we(Y,_e)}createSegments(T,C,L,U){return C.map(Y=>Y.path.startsWith(":")?this.findPosParam(T,Y,U):this.findOrReturn(Y,L))}findPosParam(T,C,L){const U=L[C.path.substring(1)];if(!U)throw new Error(`Cannot redirect to '${T}'. Cannot find '${C.path}'.`);return U}findOrReturn(T,C){let L=0;for(const U of C){if(U.path===T.path)return C.splice(L),U;L++}return T}}function Fl(M){const T={};for(const L of Object.keys(M.children)){const Y=Fl(M.children[L]);(Y.segments.length>0||Y.hasChildren())&&(T[L]=Y)}return function(M){if(1===M.numberOfChildren&&M.children[qt]){const T=M.children[qt];return new we(M.segments.concat(T.segments),T.children)}return M}(new we(M.segments,T))}class wt{constructor(T){this.path=T,this.route=this.path[this.path.length-1]}}class Zn{constructor(T,C){this.component=T,this.route=C}}function Ps(M,T,C){const L=M._root;return ni(L,T?T._root:null,C,[L.value])}function ha(M,T,C){const L=function(M){if(!M)return null;for(let T=M.parent;T;T=T.parent){const C=T.routeConfig;if(C&&C._loadedConfig)return C._loadedConfig}return null}(T);return(L?L.module.injector:C).get(M)}function ni(M,T,C,L,U={canDeactivateChecks:[],canActivateChecks:[]}){const Y=ti(T);return M.children.forEach(_e=>{(function(M,T,C,L,U={canDeactivateChecks:[],canActivateChecks:[]}){const Y=M.value,_e=T?T.value:null,De=C?C.getContext(M.value.outlet):null;if(_e&&Y.routeConfig===_e.routeConfig){const Je=function(M,T,C){if("function"==typeof C)return C(M,T);switch(C){case"pathParamsChange":return!ae(M.url,T.url);case"pathParamsOrQueryParamsChange":return!ae(M.url,T.url)||!Ni(M.queryParams,T.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Jr(M,T)||!Ni(M.queryParams,T.queryParams);default:return!Jr(M,T)}}(_e,Y,Y.routeConfig.runGuardsAndResolvers);Je?U.canActivateChecks.push(new wt(L)):(Y.data=_e.data,Y._resolvedData=_e._resolvedData),ni(M,T,Y.component?De?De.children:null:C,L,U),Je&&De&&De.outlet&&De.outlet.isActivated&&U.canDeactivateChecks.push(new Zn(De.outlet.component,_e))}else _e&&Uo(T,De,U),U.canActivateChecks.push(new wt(L)),ni(M,null,Y.component?De?De.children:null:C,L,U)})(_e,Y[_e.value.outlet],C,L.concat([_e.value]),U),delete Y[_e.value.outlet]}),H(Y,(_e,De)=>Uo(_e,C.getContext(De),U)),U}function Uo(M,T,C){const L=ti(M),U=M.value;H(L,(Y,_e)=>{Uo(Y,U.component?T?T.children.getContext(_e):null:T,C)}),C.canDeactivateChecks.push(new Zn(U.component&&T&&T.outlet&&T.outlet.isActivated?T.outlet.component:null,U))}class sl{}function al(M){return new Et.y(T=>T.error(M))}class zl{constructor(T,C,L,U,Y,_e){this.rootComponentType=T,this.config=C,this.urlTree=L,this.url=U,this.paramsInheritanceStrategy=Y,this.relativeLinkResolution=_e}recognize(){const T=Dn(this.urlTree.root,[],[],this.config.filter(_e=>void 0===_e.redirectTo),this.relativeLinkResolution).segmentGroup,C=this.processSegmentGroup(this.config,T,qt);if(null===C)return null;const L=new ki([],Object.freeze({}),Object.freeze(Hn({},this.urlTree.queryParams)),this.urlTree.fragment,{},qt,this.rootComponentType,null,this.urlTree.root,-1,{}),U=new Ar(L,C),Y=new $r(this.url,U);return this.inheritParamsAndData(Y._root),Y}inheritParamsAndData(T){const C=T.value,L=jr(C,this.paramsInheritanceStrategy);C.params=Object.freeze(L.params),C.data=Object.freeze(L.data),T.children.forEach(U=>this.inheritParamsAndData(U))}processSegmentGroup(T,C,L){return 0===C.segments.length&&C.hasChildren()?this.processChildren(T,C):this.processSegment(T,C,C.segments,L)}processChildren(T,C){const L=[];for(const Y of Object.keys(C.children)){const _e=C.children[Y],De=hr(T,Y),Je=this.processSegmentGroup(De,_e,Y);if(null===Je)return null;L.push(...Je)}const U=Ys(L);return U.sort((T,C)=>T.value.outlet===qt?-1:C.value.outlet===qt?1:T.value.outlet.localeCompare(C.value.outlet)),U}processSegment(T,C,L,U){for(const Y of T){const _e=this.processSegmentAgainstRoute(Y,C,L,U);if(null!==_e)return _e}return fs(C,L,U)?[]:null}processSegmentAgainstRoute(T,C,L,U){if(T.redirectTo||!ts(T,C,L,U))return null;let Y,_e=[],De=[];if("**"===T.path){const er=L.length>0?Q(L).parameters:{};Y=new ki(L,er,Object.freeze(Hn({},this.urlTree.queryParams)),this.urlTree.fragment,io(T),fn(T),T.component,T,Rs(C),So(C)+L.length,fa(T))}else{const er=Fr(C,T,L);if(!er.matched)return null;_e=er.consumedSegments,De=L.slice(er.lastChild),Y=new ki(_e,er.parameters,Object.freeze(Hn({},this.urlTree.queryParams)),this.urlTree.fragment,io(T),fn(T),T.component,T,Rs(C),So(C)+_e.length,fa(T))}const Je=(M=T).children?M.children:M.loadChildren?M._loadedConfig.routes:[],{segmentGroup:Kt,slicedSegments:Vn}=Dn(C,_e,De,Je.filter(er=>void 0===er.redirectTo),this.relativeLinkResolution);var M;if(0===Vn.length&&Kt.hasChildren()){const er=this.processChildren(Je,Kt);return null===er?null:[new Ar(Y,er)]}if(0===Je.length&&0===Vn.length)return[new Ar(Y,[])];const un=fn(T)===U,sr=this.processSegment(Je,Kt,Vn,un?qt:U);return null===sr?null:[new Ar(Y,sr)]}}function gs(M){const T=M.value.routeConfig;return T&&""===T.path&&void 0===T.redirectTo}function Ys(M){const T=[],C=new Set;for(const L of M){if(!gs(L)){T.push(L);continue}const U=T.find(Y=>L.value.routeConfig===Y.value.routeConfig);void 0!==U?(U.children.push(...L.children),C.add(U)):T.push(L)}for(const L of C){const U=Ys(L.children);T.push(new Ar(L.value,U))}return T.filter(L=>!C.has(L))}function Rs(M){let T=M;for(;T._sourceSegment;)T=T._sourceSegment;return T}function So(M){let T=M,C=T._segmentIndexShift?T._segmentIndexShift:0;for(;T._sourceSegment;)T=T._sourceSegment,C+=T._segmentIndexShift?T._segmentIndexShift:0;return C-1}function io(M){return M.data||{}}function fa(M){return M.resolve||{}}function ci(M){return nn(T=>{const C=M(T);return C?(0,Zt.D)(C).pipe((0,it.U)(()=>T)):(0,Tt.of)(T)})}class Ks extends class{shouldDetach(T){return!1}store(T,C){}shouldAttach(T){return!1}retrieve(T){return null}shouldReuseRoute(T,C){return T.routeConfig===C.routeConfig}}{}const _s=new oe.OlP("ROUTES");class Nl{constructor(T,C,L,U){this.injector=T,this.compiler=C,this.onLoadStartListener=L,this.onLoadEndListener=U}load(T,C){if(C._loader$)return C._loader$;this.onLoadStartListener&&this.onLoadStartListener(C);const U=this.loadModuleFactory(C.loadChildren).pipe((0,it.U)(Y=>{this.onLoadEndListener&&this.onLoadEndListener(C);const _e=Y.create(T);return new ds(wi(_e.injector.get(_s,void 0,oe.XFs.Self|oe.XFs.Optional)).map(or),_e)}),Nr(Y=>{throw C._loader$=void 0,Y}));return C._loader$=new Ye(U,()=>new Lt.x).pipe(Pt()),C._loader$}loadModuleFactory(T){return ee(T()).pipe((0,$n.z)(C=>C instanceof oe.YKP?(0,Tt.of)(C):(0,Zt.D)(this.compiler.compileModuleAsync(C))))}}class Vl{shouldProcessUrl(T){return!0}extract(T){return T}merge(T,C){return T}}function cl(M){throw M}function ys(M,T,C){return T.parse("/")}function ma(M,T){return(0,Tt.of)(null)}const za={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ga={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Vi=(()=>{class M{constructor(C,L,U,Y,_e,De,Je){this.rootComponentType=C,this.urlSerializer=L,this.rootContexts=U,this.location=Y,this.config=Je,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Lt.x,this.errorHandler=cl,this.malformedUriErrorHandler=ys,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:ma,afterPreactivation:ma},this.urlHandlingStrategy=new Vl,this.routeReuseStrategy=new Ks,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=_e.get(oe.h0i),this.console=_e.get(oe.c2e);const un=_e.get(oe.R0b);this.isNgZoneEnabled=un instanceof oe.R0b&&oe.R0b.isInAngularZone(),this.resetConfig(Je),this.currentUrlTree=new St(new we([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Nl(_e,De,sr=>this.triggerEvent(new Vt(sr)),sr=>this.triggerEvent(new en(sr))),this.routerState=zo(this.currentUrlTree,this.rootComponentType),this.transitions=new c({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var C;return null==(C=this.location.getState())?void 0:C.\u0275routerPageId}setupNavigations(C){const L=this.events;return C.pipe((0,Wr.h)(U=>0!==U.id),(0,it.U)(U=>Gs(Hn({},U),{extractedUrl:this.urlHandlingStrategy.extract(U.rawUrl)})),nn(U=>{let Y=!1,_e=!1;return(0,Tt.of)(U).pipe((0,Rr.b)(De=>{this.currentNavigation={id:De.id,initialUrl:De.currentRawUrl,extractedUrl:De.extractedUrl,trigger:De.source,extras:De.extras,previousNavigation:this.lastSuccessfulNavigation?Gs(Hn({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),nn(De=>{const Je=this.browserUrlTree.toString(),Kt=!this.navigated||De.extractedUrl.toString()!==Je||Je!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||Kt)&&this.urlHandlingStrategy.shouldProcessUrl(De.rawUrl))return Yi(De.source)&&(this.browserUrlTree=De.extractedUrl),(0,Tt.of)(De).pipe(nn(un=>{const sr=this.transitions.getValue();return L.next(new Lr(un.id,this.serializeUrl(un.extractedUrl),un.source,un.restoredState)),sr!==this.transitions.getValue()?Er.E:Promise.resolve(un)}),function(M,T,C,L){return nn(U=>function(M,T,C,L,U){return new Hc(M,T,C,L,U).apply()}(M,T,C,U.extractedUrl,L).pipe((0,it.U)(Y=>Gs(Hn({},U),{urlAfterRedirects:Y}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),(0,Rr.b)(un=>{this.currentNavigation=Gs(Hn({},this.currentNavigation),{finalUrl:un.urlAfterRedirects})}),function(M,T,C,L,U){return(0,$n.z)(Y=>function(M,T,C,L,U="emptyOnly",Y="legacy"){try{const _e=new zl(M,T,C,L,U,Y).recognize();return null===_e?al(new sl):(0,Tt.of)(_e)}catch(_e){return al(_e)}}(M,T,Y.urlAfterRedirects,C(Y.urlAfterRedirects),L,U).pipe((0,it.U)(_e=>Gs(Hn({},Y),{targetSnapshot:_e}))))}(this.rootComponentType,this.config,un=>this.serializeUrl(un),this.paramsInheritanceStrategy,this.relativeLinkResolution),(0,Rr.b)(un=>{if("eager"===this.urlUpdateStrategy){if(!un.extras.skipLocationChange){const er=this.urlHandlingStrategy.merge(un.urlAfterRedirects,un.rawUrl);this.setBrowserUrl(er,un)}this.browserUrlTree=un.urlAfterRedirects}const sr=new Ae(un.id,this.serializeUrl(un.extractedUrl),this.serializeUrl(un.urlAfterRedirects),un.targetSnapshot);L.next(sr)}));if(Kt&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:sr,extractedUrl:er,source:Ho,restoredState:Zo,extras:Ji}=De,go=new Lr(sr,this.serializeUrl(er),Ho,Zo);L.next(go);const _o=zo(er,this.rootComponentType).snapshot;return(0,Tt.of)(Gs(Hn({},De),{targetSnapshot:_o,urlAfterRedirects:er,extras:Gs(Hn({},Ji),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=De.rawUrl,De.resolve(null),Er.E}),ci(De=>{const{targetSnapshot:Je,id:Kt,extractedUrl:Vn,rawUrl:un,extras:{skipLocationChange:sr,replaceUrl:er}}=De;return this.hooks.beforePreactivation(Je,{navigationId:Kt,appliedUrlTree:Vn,rawUrlTree:un,skipLocationChange:!!sr,replaceUrl:!!er})}),(0,Rr.b)(De=>{const Je=new Oe(De.id,this.serializeUrl(De.extractedUrl),this.serializeUrl(De.urlAfterRedirects),De.targetSnapshot);this.triggerEvent(Je)}),(0,it.U)(De=>Gs(Hn({},De),{guards:Ps(De.targetSnapshot,De.currentSnapshot,this.rootContexts)})),function(M,T){return(0,$n.z)(C=>{const{targetSnapshot:L,currentSnapshot:U,guards:{canActivateChecks:Y,canDeactivateChecks:_e}}=C;return 0===_e.length&&0===Y.length?(0,Tt.of)(Gs(Hn({},C),{guardsResult:!0})):function(M,T,C,L){return(0,Zt.D)(M).pipe((0,$n.z)(U=>function(M,T,C,L,U){const Y=T&&T.routeConfig?T.routeConfig.canDeactivate:null;if(!Y||0===Y.length)return(0,Tt.of)(!0);const _e=Y.map(De=>{const Je=ha(De,T,U);let Kt;if(function(M){return M&&Do(M.canDeactivate)}(Je))Kt=ee(Je.canDeactivate(M,T,C,L));else{if(!Do(Je))throw new Error("Invalid CanDeactivate guard");Kt=ee(Je(M,T,C,L))}return Kt.pipe(Bi())});return(0,Tt.of)(_e).pipe(Qr())}(U.component,U.route,C,T,L)),Bi(U=>!0!==U,!0))}(_e,L,U,M).pipe((0,$n.z)(De=>De&&function(M){return"boolean"==typeof M}(De)?function(M,T,C,L){return(0,Zt.D)(T).pipe((0,xi.b)(U=>(0,Sn.z)(function(M,T){return null!==M&&T&&T(new En(M)),(0,Tt.of)(!0)}(U.route.parent,L),function(M,T){return null!==M&&T&&T(new fi(M)),(0,Tt.of)(!0)}(U.route,L),function(M,T,C){const L=T[T.length-1],Y=T.slice(0,T.length-1).reverse().map(_e=>function(M){const T=M.routeConfig?M.routeConfig.canActivateChild:null;return T&&0!==T.length?{node:M,guards:T}:null}(_e)).filter(_e=>null!==_e).map(_e=>$e(()=>{const De=_e.guards.map(Je=>{const Kt=ha(Je,_e.node,C);let Vn;if(function(M){return M&&Do(M.canActivateChild)}(Kt))Vn=ee(Kt.canActivateChild(L,M));else{if(!Do(Kt))throw new Error("Invalid CanActivateChild guard");Vn=ee(Kt(L,M))}return Vn.pipe(Bi())});return(0,Tt.of)(De).pipe(Qr())}));return(0,Tt.of)(Y).pipe(Qr())}(M,U.path,C),function(M,T,C){const L=T.routeConfig?T.routeConfig.canActivate:null;if(!L||0===L.length)return(0,Tt.of)(!0);const U=L.map(Y=>$e(()=>{const _e=ha(Y,T,C);let De;if(function(M){return M&&Do(M.canActivate)}(_e))De=ee(_e.canActivate(T,M));else{if(!Do(_e))throw new Error("Invalid CanActivate guard");De=ee(_e(T,M))}return De.pipe(Bi())}));return(0,Tt.of)(U).pipe(Qr())}(M,U.route,C))),Bi(U=>!0!==U,!0))}(L,Y,M,T):(0,Tt.of)(De)),(0,it.U)(De=>Gs(Hn({},C),{guardsResult:De})))})}(this.ngModule.injector,De=>this.triggerEvent(De)),(0,Rr.b)(De=>{if(Co(De.guardsResult)){const Kt=Vr(`Redirecting to "${this.serializeUrl(De.guardsResult)}"`);throw Kt.url=De.guardsResult,Kt}const Je=new bt(De.id,this.serializeUrl(De.extractedUrl),this.serializeUrl(De.urlAfterRedirects),De.targetSnapshot,!!De.guardsResult);this.triggerEvent(Je)}),(0,Wr.h)(De=>!!De.guardsResult||(this.restoreHistory(De),this.cancelNavigationTransition(De,""),!1)),ci(De=>{if(De.guards.canActivateChecks.length)return(0,Tt.of)(De).pipe((0,Rr.b)(Je=>{const Kt=new pt(Je.id,this.serializeUrl(Je.extractedUrl),this.serializeUrl(Je.urlAfterRedirects),Je.targetSnapshot);this.triggerEvent(Kt)}),nn(Je=>{let Kt=!1;return(0,Tt.of)(Je).pipe(function(M,T){return(0,$n.z)(C=>{const{targetSnapshot:L,guards:{canActivateChecks:U}}=C;if(!U.length)return(0,Tt.of)(C);let Y=0;return(0,Zt.D)(U).pipe((0,xi.b)(_e=>function(M,T,C,L){return function(M,T,C,L){const U=Object.keys(M);if(0===U.length)return(0,Tt.of)({});const Y={};return(0,Zt.D)(U).pipe((0,$n.z)(_e=>function(M,T,C,L){const U=ha(M,T,L);return ee(U.resolve?U.resolve(T,C):U(T,C))}(M[_e],T,C,L).pipe((0,Rr.b)(De=>{Y[_e]=De}))),kn(1),(0,$n.z)(()=>Object.keys(Y).length===U.length?(0,Tt.of)(Y):Er.E))}(M._resolve,M,T,L).pipe((0,it.U)(Y=>(M._resolvedData=Y,M.data=Hn(Hn({},M.data),jr(M,C).resolve),null)))}(_e.route,L,M,T)),(0,Rr.b)(()=>Y++),kn(1),(0,$n.z)(_e=>Y===U.length?(0,Tt.of)(C):Er.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),(0,Rr.b)({next:()=>Kt=!0,complete:()=>{Kt||(this.restoreHistory(Je),this.cancelNavigationTransition(Je,"At least one route resolver didn't emit any value."))}}))}),(0,Rr.b)(Je=>{const Kt=new _t(Je.id,this.serializeUrl(Je.extractedUrl),this.serializeUrl(Je.urlAfterRedirects),Je.targetSnapshot);this.triggerEvent(Kt)}))}),ci(De=>{const{targetSnapshot:Je,id:Kt,extractedUrl:Vn,rawUrl:un,extras:{skipLocationChange:sr,replaceUrl:er}}=De;return this.hooks.afterPreactivation(Je,{navigationId:Kt,appliedUrlTree:Vn,rawUrlTree:un,skipLocationChange:!!sr,replaceUrl:!!er})}),(0,it.U)(De=>{const Je=function(M,T,C){const L=Ss(M,T._root,C?C._root:void 0);return new Cs(L,T)}(this.routeReuseStrategy,De.targetSnapshot,De.currentRouterState);return Gs(Hn({},De),{targetRouterState:Je})}),(0,Rr.b)(De=>{this.currentUrlTree=De.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(De.urlAfterRedirects,De.rawUrl),this.routerState=De.targetRouterState,"deferred"===this.urlUpdateStrategy&&(De.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,De),this.browserUrlTree=De.urlAfterRedirects)}),((M,T,C)=>(0,it.U)(L=>(new Un(T,L.targetRouterState,L.currentRouterState,C).activate(M),L)))(this.rootContexts,this.routeReuseStrategy,De=>this.triggerEvent(De)),(0,Rr.b)({next(){Y=!0},complete(){Y=!0}}),function(M){return(0,lt.e)((T,C)=>{try{T.subscribe(C)}finally{C.add(M)}})}(()=>{var De;Y||_e||this.cancelNavigationTransition(U,`Navigation ID ${U.id} is not equal to the current navigation id ${this.navigationId}`),(null==(De=this.currentNavigation)?void 0:De.id)===U.id&&(this.currentNavigation=null)}),Nr(De=>{if(_e=!0,function(M){return M&&M[Gn]}(De)){const Je=Co(De.url);Je||(this.navigated=!0,this.restoreHistory(U,!0));const Kt=new Eo(U.id,this.serializeUrl(U.extractedUrl),De.message);L.next(Kt),Je?setTimeout(()=>{const Vn=this.urlHandlingStrategy.merge(De.url,this.rawUrlTree),un={skipLocationChange:U.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Yi(U.source)};this.scheduleNavigation(Vn,"imperative",null,un,{resolve:U.resolve,reject:U.reject,promise:U.promise})},0):U.resolve(!1)}else{this.restoreHistory(U,!0);const Je=new dt(U.id,this.serializeUrl(U.extractedUrl),De);L.next(Je);try{U.resolve(this.errorHandler(De))}catch(Kt){U.reject(Kt)}}return Er.E}))}))}resetRootComponentType(C){this.rootComponentType=C,this.routerState.root.component=this.rootComponentType}setTransition(C){this.transitions.next(Hn(Hn({},this.transitions.value),C))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(C=>{const L="popstate"===C.type?"popstate":"hashchange";"popstate"===L&&setTimeout(()=>{var De;const U={replaceUrl:!0},Y=(null==(De=C.state)?void 0:De.navigationId)?C.state:null;if(Y){const Je=Hn({},Y);delete Je.navigationId,delete Je.\u0275routerPageId,0!==Object.keys(Je).length&&(U.state=Je)}const _e=this.parseUrl(C.url);this.scheduleNavigation(_e,L,Y,U)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(C){this.events.next(C)}resetConfig(C){ot(C),this.config=C.map(or),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(C,L={}){const{relativeTo:U,queryParams:Y,fragment:_e,queryParamsHandling:De,preserveFragment:Je}=L,Kt=U||this.routerState.root,Vn=Je?this.currentUrlTree.fragment:_e;let un=null;switch(De){case"merge":un=Hn(Hn({},this.currentUrlTree.queryParams),Y);break;case"preserve":un=this.currentUrlTree.queryParams;break;default:un=Y||null}return null!==un&&(un=this.removeEmptyProps(un)),function(M,T,C,L,U){if(0===C.length)return il(T.root,T.root,T,L,U);const Y=function(M){if("string"==typeof M[0]&&1===M.length&&"/"===M[0])return new aa(!0,0,M);let T=0,C=!1;const L=M.reduce((U,Y,_e)=>{if("object"==typeof Y&&null!=Y){if(Y.outlets){const De={};return H(Y.outlets,(Je,Kt)=>{De[Kt]="string"==typeof Je?Je.split("/"):Je}),[...U,{outlets:De}]}if(Y.segmentPath)return[...U,Y.segmentPath]}return"string"!=typeof Y?[...U,Y]:0===_e?(Y.split("/").forEach((De,Je)=>{0==Je&&"."===De||(0==Je&&""===De?C=!0:".."===De?T++:""!=De&&U.push(De))}),U):[...U,Y]},[]);return new aa(C,T,L)}(C);if(Y.toRoot())return il(T.root,new we([],{}),T,L,U);const _e=function(M,T,C){if(M.isAbsolute)return new la(T.root,!0,0);if(-1===C.snapshot._lastPathIndex){const Y=C.snapshot._urlSegment;return new la(Y,Y===T.root,0)}const L=Hs(M.commands[0])?0:1;return function(M,T,C){let L=M,U=T,Y=C;for(;Y>U;){if(Y-=U,L=L.parent,!L)throw new Error("Invalid number of '../'");U=L.segments.length}return new la(L,!1,U-Y)}(C.snapshot._urlSegment,C.snapshot._lastPathIndex+L,M.numberOfDoubleDots)}(Y,T,M),De=_e.processChildren?us(_e.segmentGroup,_e.index,Y.commands):Ui(_e.segmentGroup,_e.index,Y.commands);return il(_e.segmentGroup,De,T,L,U)}(Kt,this.currentUrlTree,C,un,null!=Vn?Vn:null)}navigateByUrl(C,L={skipLocationChange:!1}){const U=Co(C)?C:this.parseUrl(C),Y=this.urlHandlingStrategy.merge(U,this.rawUrlTree);return this.scheduleNavigation(Y,"imperative",null,L)}navigate(C,L={skipLocationChange:!1}){return function(M){for(let T=0;T<M.length;T++){const C=M[T];if(null==C)throw new Error(`The requested path contains ${C} segment at index ${T}`)}}(C),this.navigateByUrl(this.createUrlTree(C,L),L)}serializeUrl(C){return this.urlSerializer.serialize(C)}parseUrl(C){let L;try{L=this.urlSerializer.parse(C)}catch(U){L=this.malformedUriErrorHandler(U,this.urlSerializer,C)}return L}isActive(C,L){let U;if(U=!0===L?Hn({},za):!1===L?Hn({},ga):L,Co(C))return Be(this.currentUrlTree,C,U);const Y=this.parseUrl(C);return Be(this.currentUrlTree,Y,U)}removeEmptyProps(C){return Object.keys(C).reduce((L,U)=>{const Y=C[U];return null!=Y&&(L[U]=Y),L},{})}processNavigations(){this.navigations.subscribe(C=>{this.navigated=!0,this.lastSuccessfulId=C.id,this.currentPageId=C.targetPageId,this.events.next(new Pi(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,C.resolve(!0)},C=>{this.console.warn(`Unhandled Navigation Error: ${C}`)})}scheduleNavigation(C,L,U,Y,_e){var go,_o,Qi;if(this.disposed)return Promise.resolve(!1);const De=this.transitions.value,Je=Yi(L)&&De&&!Yi(De.source),Kt=De.rawUrl.toString()===C.toString(),Vn=De.id===(null==(go=this.currentNavigation)?void 0:go.id);if(Je&&Kt&&Vn)return Promise.resolve(!0);let sr,er,Ho;_e?(sr=_e.resolve,er=_e.reject,Ho=_e.promise):Ho=new Promise((qo,fl)=>{sr=qo,er=fl});const Zo=++this.navigationId;let Ji;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(U=this.location.getState()),Ji=U&&U.\u0275routerPageId?U.\u0275routerPageId:Y.replaceUrl||Y.skipLocationChange?null!=(_o=this.browserPageId)?_o:0:(null!=(Qi=this.browserPageId)?Qi:0)+1):Ji=0,this.setTransition({id:Zo,targetPageId:Ji,source:L,restoredState:U,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:C,extras:Y,resolve:sr,reject:er,promise:Ho,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Ho.catch(qo=>Promise.reject(qo))}setBrowserUrl(C,L){const U=this.urlSerializer.serialize(C),Y=Hn(Hn({},L.extras.state),this.generateNgRouterState(L.id,L.targetPageId));this.location.isCurrentPathEqualTo(U)||L.extras.replaceUrl?this.location.replaceState(U,"",Y):this.location.go(U,"",Y)}restoreHistory(C,L=!1){var U,Y;if("computed"===this.canceledNavigationResolution){const _e=this.currentPageId-C.targetPageId;"popstate"!==C.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null==(U=this.currentNavigation)?void 0:U.finalUrl)||0===_e?this.currentUrlTree===(null==(Y=this.currentNavigation)?void 0:Y.finalUrl)&&0===_e&&(this.resetState(C),this.browserUrlTree=C.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(_e)}else"replace"===this.canceledNavigationResolution&&(L&&this.resetState(C),this.resetUrlToCurrentUrlTree())}resetState(C){this.routerState=C.currentRouterState,this.currentUrlTree=C.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,C.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(C,L){const U=new Eo(C.id,this.serializeUrl(C.extractedUrl),L);this.triggerEvent(U),C.resolve(!1)}generateNgRouterState(C,L){return"computed"===this.canceledNavigationResolution?{navigationId:C,\u0275routerPageId:L}:{navigationId:C}}}return M.\u0275fac=function(C){oe.$Z()},M.\u0275prov=oe.Yz7({token:M,factory:M.\u0275fac}),M})();function Yi(M){return"imperative"!==M}let Mo=(()=>{class M{constructor(C,L,U,Y,_e){this.router=C,this.route=L,this.tabIndexAttribute=U,this.renderer=Y,this.el=_e,this.commands=null,this.onChanges=new Lt.x,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(C){if(null!=this.tabIndexAttribute)return;const L=this.renderer,U=this.el.nativeElement;null!==C?L.setAttribute(U,"tabindex",C):L.removeAttribute(U,"tabindex")}ngOnChanges(C){this.onChanges.next(this)}set routerLink(C){null!=C?(this.commands=Array.isArray(C)?C:[C],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const C={skipLocationChange:rs(this.skipLocationChange),replaceUrl:rs(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,C),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:rs(this.preserveFragment)})}}return M.\u0275fac=function(C){return new(C||M)(oe.Y36(Vi),oe.Y36(si),oe.$8M("tabindex"),oe.Y36(oe.Qsj),oe.Y36(oe.SBq))},M.\u0275dir=oe.lG2({type:M,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(C,L){1&C&&oe.NdJ("click",function(){return L.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[oe.TTD]}),M})(),ji=(()=>{class M{constructor(C,L,U){this.router=C,this.route=L,this.locationStrategy=U,this.commands=null,this.href=null,this.onChanges=new Lt.x,this.subscription=C.events.subscribe(Y=>{Y instanceof Pi&&this.updateTargetUrlAndHref()})}set routerLink(C){this.commands=null!=C?Array.isArray(C)?C:[C]:null}ngOnChanges(C){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(C,L,U,Y,_e){if(0!==C||L||U||Y||_e||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const De={skipLocationChange:rs(this.skipLocationChange),replaceUrl:rs(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,De),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:rs(this.preserveFragment)})}}return M.\u0275fac=function(C){return new(C||M)(oe.Y36(Vi),oe.Y36(si),oe.Y36(ue.S$))},M.\u0275dir=oe.lG2({type:M,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(C,L){1&C&&oe.NdJ("click",function(Y){return L.onClick(Y.button,Y.ctrlKey,Y.shiftKey,Y.altKey,Y.metaKey)}),2&C&&oe.uIk("target",L.target)("href",L.href,oe.LSH)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[oe.TTD]}),M})();function rs(M){return""===M||!!M}let $o=(()=>{class M{constructor(C,L,U,Y,_e,De){this.router=C,this.element=L,this.renderer=U,this.cdr=Y,this.link=_e,this.linkWithHref=De,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new oe.vpe,this.routerEventsSubscription=C.events.subscribe(Je=>{Je instanceof Pi&&this.update()})}ngAfterContentInit(){(0,Tt.of)(this.links.changes,this.linksWithHrefs.changes,(0,Tt.of)(null)).pipe((0,Xi.J)()).subscribe(C=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){var L;null==(L=this.linkInputChangesSubscription)||L.unsubscribe();const C=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(U=>!!U).map(U=>U.onChanges);this.linkInputChangesSubscription=(0,Zt.D)(C).pipe((0,Xi.J)()).subscribe(U=>{this.isActive!==this.isLinkActive(this.router)(U)&&this.update()})}set routerLinkActive(C){const L=Array.isArray(C)?C:C.split(" ");this.classes=L.filter(U=>!!U)}ngOnChanges(C){this.update()}ngOnDestroy(){var C;this.routerEventsSubscription.unsubscribe(),null==(C=this.linkInputChangesSubscription)||C.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const C=this.hasActiveLinks();this.isActive!==C&&(this.isActive=C,this.cdr.markForCheck(),this.classes.forEach(L=>{C?this.renderer.addClass(this.element.nativeElement,L):this.renderer.removeClass(this.element.nativeElement,L)}),this.isActiveChange.emit(C))})}isLinkActive(C){const L=function(M){return!!M.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return U=>!!U.urlTree&&C.isActive(U.urlTree,L)}hasActiveLinks(){const C=this.isLinkActive(this.router);return this.link&&C(this.link)||this.linkWithHref&&C(this.linkWithHref)||this.links.some(C)||this.linksWithHrefs.some(C)}}return M.\u0275fac=function(C){return new(C||M)(oe.Y36(Vi),oe.Y36(oe.SBq),oe.Y36(oe.Qsj),oe.Y36(oe.sBO),oe.Y36(Mo,8),oe.Y36(ji,8))},M.\u0275dir=oe.lG2({type:M,selectors:[["","routerLinkActive",""]],contentQueries:function(C,L,U){if(1&C&&(oe.Suo(U,Mo,5),oe.Suo(U,ji,5)),2&C){let Y;oe.iGM(Y=oe.CRH())&&(L.links=Y),oe.iGM(Y=oe.CRH())&&(L.linksWithHrefs=Y)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[oe.TTD]}),M})();class jl{}class hl{preload(T,C){return(0,Tt.of)(null)}}let yc=(()=>{class M{constructor(C,L,U,Y){this.router=C,this.injector=U,this.preloadingStrategy=Y,this.loader=new Nl(U,L,Je=>C.triggerEvent(new Vt(Je)),Je=>C.triggerEvent(new en(Je)))}setUpPreloading(){this.subscription=this.router.events.pipe((0,Wr.h)(C=>C instanceof Pi),(0,xi.b)(()=>this.preload())).subscribe(()=>{})}preload(){const C=this.injector.get(oe.h0i);return this.processRoutes(C,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(C,L){const U=[];for(const Y of L)if(Y.loadChildren&&!Y.canLoad&&Y._loadedConfig){const _e=Y._loadedConfig;U.push(this.processRoutes(_e.module,_e.routes))}else Y.loadChildren&&!Y.canLoad?U.push(this.preloadConfig(C,Y)):Y.children&&U.push(this.processRoutes(C,Y.children));return(0,Zt.D)(U).pipe((0,Xi.J)(),(0,it.U)(Y=>{}))}preloadConfig(C,L){return this.preloadingStrategy.preload(L,()=>(L._loadedConfig?(0,Tt.of)(L._loadedConfig):this.loader.load(C.injector,L)).pipe((0,$n.z)(Y=>(L._loadedConfig=Y,this.processRoutes(Y.module,Y.routes)))))}}return M.\u0275fac=function(C){return new(C||M)(oe.LFG(Vi),oe.LFG(oe.Sil),oe.LFG(oe.zs3),oe.LFG(jl))},M.\u0275prov=oe.Yz7({token:M,factory:M.\u0275fac}),M})(),vs=(()=>{class M{constructor(C,L,U={}){this.router=C,this.viewportScroller=L,this.options=U,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},U.scrollPositionRestoration=U.scrollPositionRestoration||"disabled",U.anchorScrolling=U.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(C=>{C instanceof Lr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=C.navigationTrigger,this.restoredId=C.restoredState?C.restoredState.navigationId:0):C instanceof Pi&&(this.lastId=C.id,this.scheduleScrollEvent(C,this.router.parseUrl(C.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(C=>{C instanceof Xn&&(C.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(C.position):C.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(C.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(C,L){this.router.triggerEvent(new Xn(C,"popstate"===this.lastSource?this.store[this.restoredId]:null,L))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return M.\u0275fac=function(C){oe.$Z()},M.\u0275prov=oe.Yz7({token:M,factory:M.\u0275fac}),M})();const xs=new oe.OlP("ROUTER_CONFIGURATION"),Ki=new oe.OlP("ROUTER_FORROOT_GUARD"),$l=[ue.Ye,{provide:qe,useClass:Rt},{provide:Vi,useFactory:function(M,T,C,L,U,Y,_e={},De,Je){const Kt=new Vi(null,M,T,C,L,U,wi(Y));return De&&(Kt.urlHandlingStrategy=De),Je&&(Kt.routeReuseStrategy=Je),function(M,T){M.errorHandler&&(T.errorHandler=M.errorHandler),M.malformedUriErrorHandler&&(T.malformedUriErrorHandler=M.malformedUriErrorHandler),M.onSameUrlNavigation&&(T.onSameUrlNavigation=M.onSameUrlNavigation),M.paramsInheritanceStrategy&&(T.paramsInheritanceStrategy=M.paramsInheritanceStrategy),M.relativeLinkResolution&&(T.relativeLinkResolution=M.relativeLinkResolution),M.urlUpdateStrategy&&(T.urlUpdateStrategy=M.urlUpdateStrategy),M.canceledNavigationResolution&&(T.canceledNavigationResolution=M.canceledNavigationResolution)}(_e,Kt),_e.enableTracing&&Kt.events.subscribe(Vn=>{var un,sr;null==(un=console.group)||un.call(console,`Router Event: ${Vn.constructor.name}`),console.log(Vn.toString()),console.log(Vn),null==(sr=console.groupEnd)||sr.call(console)}),Kt},deps:[qe,W,ue.Ye,oe.zs3,oe.Sil,_s,xs,[class{},new oe.FiY],[class{},new oe.FiY]]},W,{provide:si,useFactory:function(M){return M.routerState.root},deps:[Vi]},yc,hl,class{preload(T,C){return C().pipe(Nr(()=>(0,Tt.of)(null)))}},{provide:xs,useValue:{enableTracing:!1}}];function is(){return new oe.PXZ("Router",Vi)}let Ao=(()=>{class M{constructor(C,L){}static forRoot(C,L){return{ngModule:M,providers:[$l,ya(C),{provide:Ki,useFactory:_a,deps:[[Vi,new oe.FiY,new oe.tp0]]},{provide:xs,useValue:L||{}},{provide:ue.S$,useFactory:Ls,deps:[ue.lw,[new oe.tBr(ue.mr),new oe.FiY],xs]},{provide:vs,useFactory:Xc,deps:[Vi,ue.EM,xs]},{provide:jl,useExisting:L&&L.preloadingStrategy?L.preloadingStrategy:hl},{provide:oe.PXZ,multi:!0,useFactory:is},[va,{provide:oe.ip1,multi:!0,useFactory:vc,deps:[va]},{provide:Wt,useFactory:bs,deps:[va]},{provide:oe.tb,multi:!0,useExisting:Wt}]]}}static forChild(C){return{ngModule:M,providers:[ya(C)]}}}return M.\u0275fac=function(C){return new(C||M)(oe.LFG(Ki,8),oe.LFG(Vi,8))},M.\u0275mod=oe.oAB({type:M}),M.\u0275inj=oe.cJS({}),M})();function Xc(M,T,C){return C.scrollOffset&&T.setOffset(C.scrollOffset),new vs(M,T,C)}function Ls(M,T,C={}){return C.useHash?new ue.Do(M,T):new ue.b0(M,T)}function _a(M){return"guarded"}function ya(M){return[{provide:oe.deG,multi:!0,useValue:M},{provide:_s,multi:!0,useValue:M}]}let va=(()=>{class M{constructor(C){this.injector=C,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Lt.x}appInitializer(){return this.injector.get(ue.V_,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let L=null;const U=new Promise(De=>L=De),Y=this.injector.get(Vi),_e=this.injector.get(xs);return"disabled"===_e.initialNavigation?(Y.setUpLocationChangeListener(),L(!0)):"enabled"===_e.initialNavigation||"enabledBlocking"===_e.initialNavigation?(Y.hooks.afterPreactivation=()=>this.initNavigation?(0,Tt.of)(null):(this.initNavigation=!0,L(!0),this.resultOfPreactivationDone),Y.initialNavigation()):L(!0),U})}bootstrapListener(C){const L=this.injector.get(xs),U=this.injector.get(yc),Y=this.injector.get(vs),_e=this.injector.get(Vi),De=this.injector.get(oe.z2F);C===De.components[0]&&(("enabledNonBlocking"===L.initialNavigation||void 0===L.initialNavigation)&&_e.initialNavigation(),U.setUpPreloading(),Y.init(),_e.resetRootComponentType(De.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return M.\u0275fac=function(C){return new(C||M)(oe.LFG(oe.zs3))},M.\u0275prov=oe.Yz7({token:M,factory:M.\u0275fac}),M})();function vc(M){return M.appInitializer.bind(M)}function bs(M){return M.bootstrapListener.bind(M)}const Wt=new oe.OlP("Router Initializer")}},yn=>{yn(yn.s=3481)}]);